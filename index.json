[{"categories":["Gitlab","CI/CD"],"content":"ğŸš€ å‰è¨€ è®°å½•åŸºäº Gitlab ç¤¾åŒºç‰ˆæ­å»ºCI/CDï¼Œé€‚ç”¨ä¸ä¸­å°å›¢é˜Ÿçš„å¼€å‘ï¼ŒåŠŸèƒ½åŒ…å«prepare-\u003ebuild-\u003epush-\u003edeploy-\u003edingTalk notify Gitlab Pipelines\r","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:1:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© ç¯å¢ƒä¿¡æ¯ æ“ä½œç³»ç»Ÿï¼šKylin v10 (Ubuntu / CentOS å‡å¯) Kubernetes v1.28.0 Docker 24.0.5 Gitlab CE v14.1.8 (192.168.1.10) gitlab-runner v18.4.0 (192.168.1.100) Harbor v2.0 (192.168.1.20) Gin-Vue-Admin v2.8.6 ç›®æ ‡ï¼špush/merge åˆ° master â†’ è‡ªåŠ¨ build + push + k8s éƒ¨ç½² + é’‰é’‰é€šçŸ¥ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:2:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§± æ€»ä½“æµç¨‹ GitLab â†“ push / merge åˆ° master â†“ GitLab Runnerï¼ˆå®‰è£…åœ¨ 192.168.1.100ï¼‰ â†“ Docker build é•œåƒ â†“ Docker push é•œåƒåªHarborä»“åº“ â†“ kubectl apply -f deployment.yaml â†“ è®¿é—® NodePort ç«¯å£ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:3:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§° Gitlab Runner ä»‹ç»å’Œéƒ¨ç½² ç¯‡å¹…æœ‰é™ï¼Œé»˜è®¤åœ¨æ­å»ºæ•´ä¸ªci/cd å·¥å…·é“¾ä¸­ï¼Œå…¶å®ƒç»„ä»¶å·²ç»æå‰éƒ¨ç½²å¥½ï¼Œè¿™é‡Œé€‰å‹gitlab-runner v18.4.0ï¼Œç†è®ºä¸Šæ¥è®²å»ºè®®Gitlab CEå’Œgitlab-runner ç‰ˆæœ¬ç›¸åŒ¹é…ï¼Œ è¿™é‡Œç›´æ¥é€‰æ‹©äº†gitlab-runner v18.4.0 è¾ƒé«˜ç‰ˆæœ¬ï¼Œåœ¨éªŒè¯çš„è¿‡ç¨‹ä¸­å‘ç°ä¹Ÿæ˜¯å¯ä»¥ï¼Œå¹¶ä¸”æ’ä»¶ç‰ˆæœ¬å‘åå…¼å®¹ï¼Œå¹¶ä¸”è¿˜ä¼šä»‹ç»åŸºäºä¼ ç»Ÿå¸¸è§çš„Redhat ç³»åˆ—å’ŒDebian ç³»åˆ—çš„åœ¨çº¿å®‰è£…æ–¹å¼ï¼Œ ä½†æ˜¯åœ¨å›½äº§æ•°æ®åº“éƒ¨ç½²ï¼Œè¿™é‡Œé€‰æ‹©äºŒè¿›åˆ¶çš„æ–¹å¼è¿›è¡Œéƒ¨ç½² ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© ä¸€ã€GitLab Runner æ˜¯ä»€ä¹ˆï¼Ÿ GitLab Runner æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨æ¥æ‰§è¡Œä½ åœ¨ .gitlab-ci.yml ä¸­å®šä¹‰çš„ä»»åŠ¡ã€‚ å®ƒå¯ä»¥ç†è§£ä¸ºï¼š ğŸ’¬ â€œGitLab è´Ÿè´£å‘Šè¯‰ Runner è¦åšä»€ä¹ˆï¼ŒRunner è´Ÿè´£çœŸæ­£å»æ‰§è¡Œè¿™äº›æ“ä½œã€‚â€ ä¸¾ä¸ªä¾‹å­ï¼š å½“ä½ æŠŠä»£ç æäº¤ï¼ˆpushï¼‰åˆ° GitLab æ—¶ï¼š GitLab ä¼šæ£€æµ‹åˆ° .gitlab-ci.yml ç„¶åè§¦å‘ pipeline é€šçŸ¥ GitLab Runner Runner æ‹‰å–ä»£ç ã€æ‰§è¡Œ buildã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰æ“ä½œã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:1","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ—ï¸ äºŒã€Runner çš„å·¥ä½œæµç¨‹ æµç¨‹ç¤ºæ„å¦‚ä¸‹ï¼š å¼€å‘è€… push ä»£ç  â†“ GitLab è§¦å‘ Pipeline â†“ Runner æ‹‰å–ä»£ç æ‰§è¡Œ Job â†“ è¿”å›æ‰§è¡Œæ—¥å¿—å’ŒçŠ¶æ€ç»™ GitLab ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:2","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"âš™ ä¸‰ã€Runner çš„ç»„æˆç»“æ„ ä¸€ä¸ª GitLab Runner æœåŠ¡å¯æ³¨å†Œå¤šä¸ªâ€œæ‰§è¡Œå™¨â€ï¼ˆexecutorï¼‰æ¥è¿è¡Œ Jobã€‚ æ‰§è¡Œå™¨å°±æ˜¯å®šä¹‰ Runner å¦‚ä½•æ‰§è¡Œ CI/CD è„šæœ¬çš„æ–¹å¼ã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:3","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"å¸¸è§ Executor ç±»å‹ æ‰§è¡Œå™¨ç±»å‹ è¯´æ˜ é€‚ç”¨åœºæ™¯ shell ç›´æ¥åœ¨å®¿ä¸»æœºæ‰§è¡Œå‘½ä»¤ ç®€å•æµ‹è¯•ã€æœ¬åœ°ç¯å¢ƒ docker æ¯ä¸ª Job å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„ Docker å®¹å™¨æ‰§è¡Œ æ¨èã€æœ€å¸¸ç”¨ docker+machine åŠ¨æ€åˆ›å»ºä¸´æ—¶ VM æ‰§è¡Œä»»åŠ¡ äº‘ç¯å¢ƒ kubernetes åœ¨ K8s é›†ç¾¤ä¸­è°ƒåº¦ Pod æ‰§è¡Œ Job äº‘åŸç”Ÿå¹³å° ssh é€šè¿‡ SSH ç™»å½•è¿œç¨‹ä¸»æœºæ‰§è¡Œ å¼‚åœ°éƒ¨ç½²æˆ–ç§æœ‰ä¸»æœº virtualbox / parallels è™šæ‹Ÿæœºæ–¹å¼æ‰§è¡Œ æ¡Œé¢å®éªŒç¯å¢ƒ ğŸ’¡ å¤§å¤šæ•°å›¢é˜Ÿä½¿ç”¨ docker executorï¼Œå› ä¸ºå®ƒæœ€å¹²å‡€ã€æ˜“éš”ç¦»ã€æ˜“å¤ç°ã€‚ è¿™é‡Œä½¿ç”¨ssh executor æ‰§è¡Œå™¨ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:4","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§° å››ã€Runner çš„ä¸‰ç§ç±»å‹ Runner ç±»å‹ è¯´æ˜ åº”ç”¨èŒƒå›´ Shared Runner å¯¹æ•´ä¸ª GitLab å®ä¾‹å¯ç”¨ å¤šé¡¹ç›®å…±äº«ï¼ˆé€šå¸¸ç”±ç®¡ç†å‘˜é…ç½®ï¼‰ Group Runner å¯¹æŸä¸ªç»„ä¸‹çš„æ‰€æœ‰é¡¹ç›®å¯ç”¨ å¤šé¡¹ç›®ç»„å…±ç”¨ Specific Runner åªå¯¹ç‰¹å®šé¡¹ç›®å¯ç”¨ å°å›¢é˜Ÿé¡¹ç›®ç‹¬äº«ï¼ˆæ¨èå®éªŒä½¿ç”¨ï¼‰ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:5","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ”§ äº”ã€å®‰è£…ä¸æ³¨å†Œæµç¨‹ï¼ˆä»¥ Linux ä¸ºä¾‹ï¼‰ 1ï¸âƒ£ å®‰è£… GitLab Runner åœ¨ 172.16.2.118 ä¸Šæ‰§è¡Œï¼š Gitlab-runner å®‰è£…æ¨èå’ŒGitlab ç‰ˆæœ¬ä¿æŒä¸€è‡´ # ubuntu åœ¨çº¿å®‰è£… sudo apt update # é…ç½® runner ä»“åº“ curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash sudo apt install gitlab-runner -y # Redhat åœ¨çº¿å®‰è£… # é…ç½® runner ä»“åº“ curl -s https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh | sudo bash sudo yum install gitlab-runner-18.4.0 -y # æ£€æŸ¥ç‰ˆæœ¬ gitlab-runner --version # åœ¨çº¿å®‰è£…åä¼šåˆ›å»ºäº†gitlab-runnerç”¨æˆ·ï¼Œä½†æ˜¯gitlab-runnerç”¨æˆ·æƒé™æœ‰é™ grep gitlab-runner /etc/passwd # å¯åŠ¨å»ºè®®ä½¿ç”¨ root ç”¨æˆ·,ä¸ç„¶åœ¨æµæ°´çº¿è„šæœ¬ä¸­å¼•ç”¨äº†å…¶å®ƒå‘½ä»¤ä¼šæç¤ºæƒé™é—®é¢˜(å¦åˆ™è”ç³»è¿ç»´è¿›è¡Œææƒ) sudo gitlab-runner install --user=root --working-directory=/home/gitlab-runner # å¯åŠ¨ gitlab-runner start # å¸è½½ gitlab-runner uninstall âœ… å›½äº§æ“ä½œç³»ç»Ÿæœ€ç®€ã€æœ€å…¼å®¹çš„è§£å†³åŠæ³•ï¼ˆæ¨èï¼‰ ğŸ”§ ç›´æ¥å®‰è£…å®˜æ–¹ã€Œå•æ–‡ä»¶äºŒè¿›åˆ¶ç‰ˆã€ï¼Œä¸ä¾èµ–ä»»ä½• RPM åŒ…ã€‚ æ­¤æ–¹æ³•å·²åœ¨å›½äº§éº’éºŸã€ç»Ÿä¿¡ã€ä¸­æ ‡éº’éºŸç­‰ç³»ç»Ÿä¸Šå®æµ‹é€šè¿‡ã€‚ # ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ sudo curl -L --output /usr/local/bin/gitlab-runner \\ https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64 # èµ‹äºˆæ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/gitlab-runner # åˆ›å»ºè¿è¡Œç”¨æˆ· sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash # å®‰è£…ï¼Œè¿™é‡Œè¿˜æ˜¯ä½¿ç”¨root æƒé™ sudo gitlab-runner install --user=root --working-directory=/home/gitlab-runner sudo gitlab-runner start # æ£€æŸ¥ç‰ˆæœ¬ gitlab-runner --version gitlab-runner å®˜æ–¹ä¸‹è½½åœ°å€ gitlab-runner å®˜ç½‘éƒ¨ç½²æ–‡æ¡£ gitlab-runner å®˜ç½‘ä½¿ç”¨äºŒè¿›åˆ¶æ‰‹åŠ¨éƒ¨ç½²ï¼Œå¯ä»¥é€‚é…å›½äº§æ“ä½œç³»ç»Ÿ 2ï¸âƒ£ æ³¨å†Œ Runner # ç›´æ¥é…ç½®ï¼Œé€šè¿‡gitlab è·å–runner token sudo gitlab-runner register --url http://192.168.1.10/ --registration-token bixxxxxxhj8-xQ4V4 ç„¶åæ ¹æ®æç¤ºè¾“å…¥ï¼š Please enter the gitlab-ci coordinator URL: https://gitlab.example.com/ Please enter the gitlab-ci token: \u003cé¡¹ç›®ä¸­æ˜¾ç¤ºçš„ Runner Token\u003e Please enter the gitlab-ci description: my-runner Please enter the gitlab-ci tags: gva Please enter the executor: docker Please enter the default Docker image: docker:24.0.2 # äº¤äº’å¼é…ç½® [root@master gitlab-runner]# gitlab-runner register Runtime platform arch=amd64 os=linux pid=4168532 revision=139a0ac0 version=18.4.0 Running in system-mode. Enter the GitLab instance URL (for example, https://gitlab.com/): http://192.168.1.10/ Enter the registration token: bixxxxxxhj8-xQ4V4 Enter a description for the runner: [master]: cloudbackend Enter tags for the runner (comma-separated): gva Enter optional maintenance note for the runner: gavin WARNING: Support for registration tokens and runner parameters in the 'register' command has been deprecated in GitLab Runner 15.6 and will be replaced with support for authentication tokens. For more information, see https://docs.gitlab.com/ci/runners/new_creation_workflow/ Registering runner... succeeded correlation_id=01K7R3R2FPKS1RPQGWR4G9DZWQ runner=biixrApv2 Enter an executor: parallels, docker, docker+machine, kubernetes, instance, shell, virtualbox, docker-windows, docker-autoscaler, custom, ssh: shell Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded! Configuration (with the authentication token) was saved in \"/etc/gitlab-runner/config.toml\" å¡«å†™ä¿¡æ¯ï¼ˆç¤ºä¾‹ï¼‰ï¼š æç¤º ç¤ºä¾‹è¾“å…¥ Please enter the gitlab-ci coordinator URL http://your.gitlab.domain/ Please enter the gitlab-ci token ä» GitLab é¡¹ç›® â†’ Settings â†’ CI/CD â†’ Runners è·å– Please enter the gitlab-ci description kylin-runner Please enter the gitlab-ci tags gva å¯ä»¥ç†è§£ä¸ºç»™gitlab runnerå®ä¾‹å‘½å Please enter the executor shell æ³¨å†Œå®Œæˆåï¼ŒRunner ä¼šå‡ºç°åœ¨ GitLab â†’ Settings â†’ CI/CD â†’ Runners ä¸­ã€‚ å¯åŠ¨å¹¶éªŒè¯ï¼š sudo systemctl enable gitlab-runner sudo systemctl start gitlab-runner sudo systemctl status gitlab-runner sudo gitlab-runner status ç„¶åæ‰§è¡Œï¼š gitlab-runner list ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:6","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© å…­ã€Runner ä¸ .gitlab-ci.yml çš„å…³ç³» åœ¨ä½ çš„ .gitlab-ci.yml æ–‡ä»¶ä¸­ï¼š build: stage: build tags: - gva # Runner æ ‡ç­¾ï¼ˆåŒ¹é… Runnerï¼‰ script: - echo \"Build project\" ğŸ”¹ GitLab ä¼šæ ¹æ® tags: [gva] åŒ¹é…åˆ°ç›¸åº” Runner æ¥æ‰§è¡Œæ­¤ jobã€‚ å¦‚æœæ²¡æœ‰åŒ¹é…æ ‡ç­¾çš„ Runnerï¼ŒJob ä¼šä¸€ç›´å¤„äº pending çŠ¶æ€ã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:4:7","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"âš™ï¸GitLab CI é…ç½®æ–‡ä»¶ .gitlab-ci.yml åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º .gitlab-ci.yml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š stages: - prepare # å®šä¹‰JOBå…¨å±€ç¯å¢ƒå˜é‡ - build # ç¼–è¯‘ - push # é•œåƒæ¨é€ - deploy # éƒ¨ç½² - notify # é€šçŸ¥ # å…¨å±€å˜é‡å®šä¹‰ variables: PROJECT_NAME: gin-vue-admin IMAGE_NAME: 192.168.1.20/library/cloudbackend # ä¿®æ”¹ä¸ºä½ çš„ Harbor é¡¹ç›®åœ°å€ IMAGE_TAG: 202510201316 # å½“å‰æ„å»º tag K8S_DEPLOY_FILE: deploy/cloudbackend-deployment.yaml # k8s éƒ¨ç½²æ–‡ä»¶è·¯å¾„ K8S_DEPLOY_CM_FILE: deploy/cloudbackend-configmap.yaml K8S_DEPLOY_SERVICE_FILE: deploy/cloudbackend-service.yaml K8S_NAMESPACE: default DOCKER_DRIVER: overlay2 TIMEOUT: \"60s\" # ========================================== # å®šä¹‰ JOB å…¨å±€å˜é‡ï¼Œç”Ÿæˆæ—¶é—´æˆ³å¹¶ä¿å­˜ä¸º artifact (ä¸€æ¬¡ç”Ÿæˆï¼Œå…¨å±€å…±äº«) # ========================================== prepare: stage: prepare tags: - gva script: - echo \"IMAGE_TAG=$(date '+%Y%m%d%H%M%S')\" \u003e image_tag.env - cat image_tag.env artifacts: reports: dotenv: image_tag.env # âœ… GitLab ä¼šæŠŠè¿™é‡Œçš„å˜é‡æ³¨å…¥åç»­ Job ç¯å¢ƒä¸­ only: - master # ========================================== # Stage 1: æ„å»ºé•œåƒ # ========================================== build: stage: build tags: - gva before_script: - docker info script: - echo \"å¼€å§‹ $(date)\" - echo \"=== Step 1 å¼€å§‹æ„å»ºé•œåƒ ===\" - docker build --network=host -t $IMAGE_NAME:$IMAGE_TAG . - echo \"=== é•œåƒæ„å»ºå®Œæˆ $IMAGE_NAME:$IMAGE_TAG ===\" - echo \"ç»“æŸ $(date)\" only: - master # ========================================== # Stage 2: æ¨é€é•œåƒåˆ° Harbor # ========================================== push: stage: push tags: - gva before_script: - echo \"=== ç™»å½• Harbor ä»“åº“ ===\" - echo $HARBOR_PASSWORD | docker login 192.168.1.20 -u $HARBOR_USER --password-stdin script: - echo \"å¼€å§‹ $(date)\" - echo \"=== Step 2 æ¨é€é•œåƒ ===\" - docker push $IMAGE_NAME:$IMAGE_TAG - echo \"=== é•œåƒæ¨é€æˆåŠŸ $IMAGE_NAME:$IMAGE_TAG ===\" - echo \"ç»“æŸ $(date)\" only: - master # ========================================== # Stage 3: éƒ¨ç½²åˆ° k8s å¹¶æ”¯æŒè‡ªåŠ¨å›æ»š # ========================================== deploy: stage: deploy tags: - gva before_script: - echo \"=== å‡†å¤‡ K8s ç¯å¢ƒ ===\" - echo \"å½“å‰å‘½åç©ºé—´ $K8S_NAMESPACE\" - kubectl version --client script: - echo \"å¼€å§‹ $(date)\" - echo \"=== Step 3 è®°å½•å½“å‰é•œåƒç‰ˆæœ¬ ===\" - OLD_IMAGE=$(kubectl get deploy cloudbackend -n $K8S_NAMESPACE -o jsonpath='{.spec.template.spec.containers[0].image}') - echo \"ä¸Šä¸€ä¸ªç‰ˆæœ¬é•œåƒ $OLD_IMAGE\" - echo \"=== Step 4 æ›´æ–° Deployment é•œåƒ ===\" - kubectl apply -f $K8S_DEPLOY_CM_FILE -n $K8S_NAMESPACE - kubectl apply -f $K8S_DEPLOY_FILE -n $K8S_NAMESPACE - kubectl apply -f $K8S_DEPLOY_SERVICE_FILE -n $K8S_NAMESPACE - kubectl set image deployment/cloudbackend cloudbackend=$IMAGE_NAME:$IMAGE_TAG -n $K8S_NAMESPACE - echo \"=== Step 5 ç­‰å¾…æ–°ç‰ˆæœ¬ Pod å¯åŠ¨ ===\" - kubectl rollout status deployment/cloudbackend -n $K8S_NAMESPACE --timeout=$TIMEOUT || ROLLBACK=true - | if [ \"$ROLLBACK\" = \"true\" ]; then echo \"âŒ éƒ¨ç½²å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬: $OLD_IMAGE\" kubectl set image deployment/cloudbackend cloudbackend=$OLD_IMAGE -n $K8S_NAMESPACE kubectl rollout status deployment/cloudbackend -n $K8S_NAMESPACE --timeout=$TIMEOUT exit 1 else echo \"âœ… éƒ¨ç½²æˆåŠŸï¼Œæ–°ç‰ˆæœ¬é•œåƒ: $IMAGE_NAME:$IMAGE_TAG\" kubectl get pods -n $K8S_NAMESPACE -o wide fi - echo \"ç»“æŸ $(date)\" only: - master # ========================================== # é€šçŸ¥é˜¶æ®µ (ä¸å½±å“ä¸»æµç¨‹) # ========================================== notify: stage: notify tags: - gva script: - 'echo \"æ„å»ºå®Œæˆé€šçŸ¥ï¼š $(date)\"' after_script: - echo \"å½“å‰ Job çŠ¶æ€ $CI_JOB_STATUS\" - | if [ \"$CI_JOB_STATUS\" = \"success\" ]; then STATUS=\"âœ… æˆåŠŸ\" COLOR=\"green\" else STATUS=\"âŒ å¤±è´¥\" COLOR=\"red\" fi MESSAGE=\"{ \\\"msgtype\\\": \\\"markdown\\\", \\\"markdown\\\": { \\\"title\\\": \\\"[${CI_PROJECT_NAME}] æ„å»º${STATUS}\\\", \\\"text\\\": \\\"### ğŸš€ ${CI_PROJECT_NAME} CI/CD cloudé€šçŸ¥\\n \u003e **Pipeline ID:** ${CI_PIPELINE_ID}\\n \u003e **åˆ†æ”¯:** ${CI_COMMIT_REF_NAME}\\n \u003e **é•œåƒ:** ${IMAGE_NAME}:${IMAGE_TAG}\\n \u003e **æäº¤:** ${CI_COMMIT_SHORT_SHA}\\n \u003e **æ‰§è¡Œäºº:** ${GITLAB_USER_NAME}\\n \u003e **çŠ¶æ€:** ${STATUS}\\n \u003e **æ—¶é—´:** $(date '+%Y-%m-%d %H:%M:%S')\\n \u003e [æŸ¥çœ‹è¯¦æƒ…](${CI_PIPELINE_URL})\\\" } }\" curl -s \"${DINGTALK_WEBHOOK}\" \\ -H \"Content-Type: application/json\" \\ -d \"$MESSAGE\" when: always # âœ… æ— è®ºæˆåŠŸæˆ–å¤±è´¥éƒ½æ‰§è¡Œ only: - master æ³¨æ„ï¼š .gitlab-ci.yaml è„šæœ¬çš„ç§˜é’¥ç¯å¢ƒå˜é‡æ¨èé…ç½®åˆ°gitlab é¡¹ç›®ä¸‹çš„Variablesä¸‹,é¡¹ç›®-\u003eSettings-\u003eCI/CD-\u003eVariables,å½“ç„¶å†™æ­»åœ¨Gitlab-ci.yamlä¸­ä¹Ÿå¯ä»¥","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:5:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ³ Dockerfile ç¤ºä¾‹ï¼ˆæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ å¦‚æœä½ å·²æœ‰å®˜æ–¹ GVA é¡¹ç›®ï¼Œå¯å‚è€ƒä¸‹æ–¹åç«¯æ„å»º Dockerfileï¼Œè¯¥Dockerfile ä¼˜åŒ–äº†å¦‚ä¸‹é—®é¢˜ DNS è§£æä¸ç¨³å®šé—®é¢˜ ä½¿ç”¨å›½å†…é•œåƒæºè¿›è¡ŒåŠ é€Ÿä»£ç† ä¼˜åŒ–ä½¿ç”¨æ¡†æ¶ä¾èµ–ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºæ‹‰å–æ—¶é—´è¾ƒé•¿é—®é¢˜ ä¼˜åŒ–æ„å»ºåçš„image size å¤§å°é—®é¢˜ï¼Œå‡å°‘ä¸€åŠ FROM golang:alpine as builder WORKDIR /app # ä¼˜åŒ–ï¼šå…ˆå¤åˆ¶ go.mod / go.sum ä»…ç”¨äºä¾èµ–ç¼“å­˜ COPY go.mod go.sum ./ # é…ç½® Go ç¯å¢ƒå’Œå›½å†…ä»£ç† RUN go env -w GO111MODULE=on \\ \u0026\u0026 go env -w GOPROXY=https://goproxy.cn,https://proxy.golang.com.cn,https://goproxy.io,https://goproxy.tencentcloudapi.com,direct \\ \u0026\u0026 go env -w CGO_ENABLED=0 \\ \u0026\u0026 go mod download # å†å¤åˆ¶æºä»£ç ï¼ˆè¿™æ · go mod download æœ‰ç¼“å­˜ï¼‰ COPY . . # ç¼–è¯‘é˜¶æ®µï¼šåªç¼–è¯‘ serverï¼Œä¸è¿è¡Œ tidyï¼ˆtidy å¯åœ¨æœ¬åœ°æ‰§è¡Œï¼‰ RUN go build -trimpath -ldflags=\"-s -w\" -o server . FROM alpine:latest LABEL MAINTAINER=\"SliverHorn@sliver_horn@qq.com\" # è®¾ç½®æ—¶åŒº ENV TZ=Asia/Shanghai RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories \\ \u0026\u0026 apk add --no-cache tzdata openntpd \\ \u0026\u0026 ln -sf /usr/share/zoneinfo/$TZ /etc/localtime \\ \u0026\u0026 echo $TZ \u003e /etc/timezone WORKDIR /go/src/github.com/flipped-aurora/gin-vue-admin/server COPY --from=0 /app/server ./ COPY --from=0 /app/resource ./resource/ COPY --from=0 /app/config.docker.yaml ./ COPY --from=0 /app/config.yaml ./ # æŒ‚è½½ç›®å½•ï¼šå¦‚æœä½¿ç”¨äº†sqliteæ•°æ®åº“ï¼Œå®¹å™¨å‘½ä»¤ç¤ºä¾‹ï¼šdocker run -d -v /å®¿ä¸»æœºè·¯å¾„/gva.db:/app/gva.db -p 8888:8888 --name gva-server-v1 gva-server:1.0 # VOLUME [\"/app\"] EXPOSE 8888 ENTRYPOINT [\"./server\", \"-c\", \"config.yaml\"] ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:6:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© K8S éƒ¨ç½²ç¤ºä¾‹ apiVersion: v1 kind: ConfigMap metadata: name: cloudbackend-config data: config.yaml: | aliyun-oss: endpoint: yourEndpoint access-key-id: yourAccessKeyId access-key-secret: yourAccessKeySecret ... çœç•¥ --- apiVersion: apps/v1 kind: Deployment metadata: name: cloudbackend labels: app: cloudbackend spec: replicas: 1 selector: matchLabels: app: cloudbackend template: metadata: labels: app: cloudbackend spec: containers: - name: cloudbackend image: \"192.168.1.20/library/cloudbackend:v1\" imagePullPolicy: IfNotPresent ports: - name: http containerPort: 8888 env: - name: GIN_MODE value: \"release\" - name: ENVIRONMENT valueFrom: fieldRef: fieldPath: metadata.namespace - name: TZ value: \"Asia/Shanghai\" volumeMounts: - name: config-volume mountPath: /go/src/github.com/flipped-aurora/gin-vue-admin/server/config.yaml subPath: config.yaml imagePullSecrets: - name: harbor-secret volumes: - name: config-volume configMap: name: cloudbackend-config --- apiVersion: v1 kind: Service metadata: name: cloudbackend labels: app: cloudbackend spec: type: NodePort selector: app: cloudbackend ports: - name: http port: 8888 nodePort: 30088 ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:7:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§  æµ‹è¯•ä¸éªŒè¯ 1ï¸âƒ£ æ¨é€åˆ° masterï¼š git add . git commit -m \"test gitlab ci\" git push origin master 2ï¸âƒ£ æ‰“å¼€ GitLab é¡¹ç›®â†’ CI/CD â†’ Pipelines å¯çœ‹åˆ°ï¼š build âœ… push âœ… deploy âœ… 3ï¸âƒ£ éªŒè¯éƒ¨ç½²ï¼š kubectl get pods kubectl get svc è®¿é—®ï¼š http://k8s_master_vip:30088 æŸ¥çœ‹é’‰é’‰æ„å»ºé€šçŸ¥ DingTalk Notify\r","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:8:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© å¸¸è§é—®é¢˜æ’æŸ¥ é—®é¢˜ è§£å†³æ–¹æ³• docker: command not found åœ¨ Runner èŠ‚ç‚¹å®‰è£… docker å¹¶é…ç½®åˆ° PATHã€‚ kubectl not found ç¡®è®¤å·²å®‰è£… kubectl ä¸”èƒ½è®¿é—® k8s é›†ç¾¤ã€‚ Job ä¸€ç›´ pending æ£€æŸ¥ Runner æ˜¯å¦æ³¨å†Œåˆ°é¡¹ç›®ã€æ˜¯å¦æœ‰ tag åŒ¹é…ã€‚ é•œåƒæ— æ³•æ‹‰å– å°† imagePullPolicy è®¾ç½®ä¸º Never æˆ–æ¨é€åˆ°ç§æœ‰ä»“åº“ã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:9:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"ğŸ§© è¸©å‘ åœ¨æäº¤.gitlab-ci.yaml è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´æç¤ºå¦‚ä¸‹æŠ¥é”™ Syntax is incorrect. CI configuration validated, including all configuration added with the includes keyword ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:10:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"åŸå› åˆ†æ: GitLab CI çš„ YAML è§£æå™¨åœ¨ 14.x çš„æŸäº›ç‰ˆæœ¬é‡Œï¼Œå¯¹ script ä¸­åŒ…å«å†’å· : çš„è¡Œè§£æå¼‚å¸¸ å°¤å…¶æ˜¯è¿™ç§å½¢å¼ script: - echo \"=== Step 1: å¼€å§‹æ„å»ºé•œåƒ ===\" è§£æå™¨æŠŠ === Step 1: é‡Œçš„å†’å·å½“æˆ YAML keyï¼Œå¯¼è‡´æŠ¥é”™ï¼š jobs:build:script config should be a string or a nested array of strings æ³¨æ„ï¼Œè¿™ä¸æ˜¯æ ‡å‡† YAML é—®é¢˜ï¼Œè€Œæ˜¯ GitLab CI Lint åœ¨ç‰¹å®šç‰ˆæœ¬å¯¹å†’å·æ•æ„Ÿå¯¼è‡´çš„â€œè™šå‡æŠ¥é”™â€ã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:10:1","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"è§£å†³æ–¹æ¡ˆ æ–¹æ³• 1ï¼šå»æ‰å†’å· script: - echo \"=== Step 1 å¼€å§‹æ„å»ºé•œåƒ ===\" æ–¹æ³• 2ï¼šç”¨å•å¼•å·åŒ…è£¹æ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¨èï¼‰ script: - 'echo \"=== Step 1: å¼€å§‹æ„å»ºé•œåƒ ===\"' å¤–å±‚ä½¿ç”¨å•å¼•å· â€˜â€¦â€™ï¼Œé‡Œé¢çš„å†’å·å°±ä¸ä¼šè¢«è§£æå™¨è¯¯è®¤ä¸º keyã€‚ ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:10:2","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["Gitlab","CI/CD"],"content":"âœ… æ€»ç»“ æ¨¡å— æŠ€æœ¯ CI è§¦å‘ GitLab å†…ç½® webhook æ‰§è¡Œå™¨ GitLab Runnerï¼ˆshell æ¨¡å¼ï¼‰ æ„å»ºæ–¹å¼ Dockerfile æ„å»º éƒ¨ç½²æ–¹å¼ kubectl apply åˆ° k8s æš´éœ²æ–¹å¼ NodePort æœåŠ¡ æ•´ä½“ç‰¹æ€§ é›¶è½®è¯¢ã€è‡ªåŠ¨è§¦å‘ã€å¯è§†åŒ–ã€å¯æ‰©å±• ","date":"2025-10-20","objectID":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/:11:0","tags":["Gitlab","CI/CD"],"title":"åŸºäº Gitlab Runner æ„å»º Gin-Vue-Admin åç«¯ server æœåŠ¡CI/CD","uri":"/%E5%9F%BA%E4%BA%8E-gitlab-%E6%9E%84%E5%BB%BA-gin-vue-admin-%E5%90%8E%E7%AB%AF-server-%E6%9C%8D%E5%8A%A1cicd/"},{"categories":["linux"],"content":"setsid å’Œ nohup éƒ½æ˜¯ Linux/Unix ä¸‹å¸¸ç”¨çš„â€œåå°å¯åŠ¨å‘½ä»¤â€ï¼Œä½†å®ƒä»¬çš„åŸç†ã€ä½œç”¨èŒƒå›´å’Œé€‚ç”¨åœºæ™¯æ˜¯ä¸åŒçš„ã€‚ä¸‹é¢ç³»ç»Ÿæ¢³ç†ä¸€ä¸‹å¯¹æ¯”ã€‚ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:0:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"ğŸ§© ä¸€ã€nohupï¼šé˜²æ­¢è¿›ç¨‹æ”¶åˆ°æŒ‚æ–­ä¿¡å·ï¼ˆSIGHUPï¼‰ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:1:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… åŸºæœ¬ä½œç”¨ nohup çš„å…¨ç§°æ˜¯ â€œno hang upâ€ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š å½“ç”¨æˆ·é€€å‡ºç»ˆç«¯ï¼ˆä¾‹å¦‚å…³é—­ SSH æˆ–å…³é—­ç»ˆç«¯çª—å£ï¼‰æ—¶ï¼Œä¸è®©è¿›ç¨‹æ”¶åˆ° SIGHUPï¼ˆæŒ‚èµ·ä¿¡å·ï¼‰ï¼Œä»è€Œé¿å…è¢«ç³»ç»Ÿç»ˆæ­¢ã€‚ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:1:1","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… ä½¿ç”¨æ–¹å¼ nohup python3 app.py \u003e app.log 2\u003e\u00261 \u0026 è¯´æ˜ï¼š nohupï¼šé˜²æ­¢é€€å‡ºç»ˆç«¯åç¨‹åºé€€å‡ºï¼› \u003e app.log 2\u003e\u00261ï¼šå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½é‡å®šå‘åˆ° app.logï¼› \u0026ï¼šè®©å‘½ä»¤åœ¨åå°è¿è¡Œã€‚ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:1:2","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… å¸¸è§ç‰¹ç‚¹ ç‰¹ç‚¹ è¯´æ˜ ä¿¡å·ä¿æŠ¤ å¿½ç•¥ SIGHUPï¼Œç»ˆç«¯å…³é—­ç¨‹åºä»è¿è¡Œ ä¼šè¯å…³ç³» è¿›ç¨‹ä»å±äºå½“å‰ ä¼šè¯(session) è¾“å‡º é»˜è®¤è¾“å‡ºåˆ° nohup.outï¼ˆé™¤éé‡å®šå‘ï¼‰ å¸¸è§ç”¨é€” å¯åŠ¨åå°ä»»åŠ¡ï¼ˆå¦‚è„šæœ¬ã€å®ˆæŠ¤è¿›ç¨‹ï¼‰ å¯ç§»æ¤æ€§ é€‚ç”¨äºæ‰€æœ‰ç±» Unix ç³»ç»Ÿï¼ˆLinuxã€macOSã€BSD ç­‰ï¼‰ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:1:3","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"ğŸ§© äºŒã€setsidï¼šåˆ›å»ºæ–°çš„ä¼šè¯ï¼ˆSession Leaderï¼‰ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:2:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… åŸºæœ¬ä½œç”¨ setsid çš„å…¨ç§°æ˜¯ â€œset session idâ€ã€‚ å®ƒçš„ä½œç”¨æ˜¯ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ ä¼šè¯(session)ã€è¿›ç¨‹ç»„(process group)ï¼Œå¹¶è„±ç¦»åŸæ§åˆ¶ç»ˆç«¯ï¼ˆcontrolling terminalï¼‰ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒè®©è¿›ç¨‹å½»åº•ä¸å½“å‰ç»ˆç«¯åˆ†ç¦»ï¼Œä¸å†å±äºå½“å‰ç”¨æˆ·ä¼šè¯ã€‚ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:2:1","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… ä½¿ç”¨æ–¹å¼ setsid python3 app.py \u003e app.log 2\u003e\u00261 \u0026 ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:2:2","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âœ… å¸¸è§ç‰¹ç‚¹ ç‰¹ç‚¹ è¯´æ˜ ä¼šè¯å…³ç³» åˆ›å»ºæ–°çš„ä¼šè¯å’Œè¿›ç¨‹ç»„ï¼Œä¸å†å±äºå½“å‰ç»ˆç«¯ ä¿¡å·å½±å“ å®Œå…¨ç‹¬ç«‹äºåŸç»ˆç«¯ï¼Œä¸ä»…å¿½ç•¥ SIGHUPï¼Œè¿æ§åˆ¶ç»ˆç«¯æ–­å¼€ä¹Ÿæ— å½±å“ è¾“å‡º ä¸ä¼šè‡ªåŠ¨é‡å®šå‘è¾“å‡ºï¼Œè‹¥ä¸åŠ é‡å®šå‘ä¼šæ‰“å°åˆ°æ§åˆ¶å° å¸¸è§ç”¨é€” å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰å¯åŠ¨ï¼Œæ›´å½»åº•çš„åå°æ–¹å¼ å¯ç§»æ¤æ€§ é€‚ç”¨äº Linuxã€FreeBSDã€macOSã€Androidï¼ˆå¤šæ•° Unix-likeï¼‰ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:2:3","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"ğŸ†š ä¸‰ã€nohup ä¸ setsid çš„åŒºåˆ«æ€»ç»“è¡¨ å¯¹æ¯”é¡¹ nohup setsid ä¸»è¦ç›®çš„ é˜²æ­¢æŒ‚èµ·ï¼ˆå¿½ç•¥ SIGHUPï¼‰ åˆ›å»ºæ–°çš„ä¼šè¯ï¼Œå½»åº•è„±ç¦»ç»ˆç«¯ æ˜¯å¦åˆ›å»ºæ–°ä¼šè¯ å¦ æ˜¯ æ˜¯å¦å¿½ç•¥ SIGHUP æ˜¯ é—´æ¥æ˜¯ï¼ˆå› ä¸ºæ— ç»ˆç«¯ï¼‰ æ˜¯å¦éœ€è¦é‡å®šå‘è¾“å‡º å»ºè®®é‡å®šå‘ï¼Œå¦åˆ™å†™åˆ° nohup.out å¿…é¡»é‡å®šå‘ï¼Œå¦åˆ™ä»æ‰“å°åˆ°æ§åˆ¶å° æ˜¯å¦å±äºåŒä¸€ä¼šè¯ æ˜¯ï¼ˆåŸä¼šè¯ï¼‰ å¦ï¼ˆæ–°ä¼šè¯ï¼‰ å¸¸ç”¨åœºæ™¯ å¯åŠ¨é•¿æœŸè¿è¡Œä»»åŠ¡ã€æµ‹è¯•è„šæœ¬ å¯åŠ¨åå°å®ˆæŠ¤æœåŠ¡ã€ç”Ÿäº§éƒ¨ç½² æ˜¯å¦é€‚ç”¨äºæ‰€æœ‰ Linux/Unix âœ… æ˜¯ âœ… æ˜¯ï¼ˆä½†æŸäº›è€ç³»ç»Ÿéœ€å•ç‹¬å®‰è£… coreutilsï¼‰ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:3:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"ğŸ§  å››ã€å®é™…ä½¿ç”¨å»ºè®® éœ€æ±‚ æ¨èå‘½ä»¤ ä¸´æ—¶åå°è¿è¡Œã€å…³é—­ SSH ä¸æƒ³ä¸­æ–­ nohup ./app \u0026 å¯åŠ¨é•¿æœŸåå°æœåŠ¡æˆ–å®ˆæŠ¤ç¨‹åº setsid ./app \u003e log.txt 2\u003e\u00261 \u0026 æƒ³å½»åº•è„±ç¦»æ§åˆ¶ç»ˆç«¯å¹¶ä¸å†™æ—¥å¿— setsid ./app \u003e/dev/null 2\u003e\u00261 \u003c /dev/null \u0026 ç»“åˆ systemdã€supervisord ç®¡ç† æ›´æ¨èä½¿ç”¨ systemd æˆ– supervisord æ¥æ‰˜ç®¡è¿›ç¨‹ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:4:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"âš™ï¸ äº”ã€è¡¥å……ï¼šå¯ç»“åˆä½¿ç”¨ å…¶å®ä¹Ÿå¯ä»¥ ç»„åˆ ä½¿ç”¨ï¼š nohup setsid ./app \u003e app.log 2\u003e\u00261 \u0026 è¿™æ ·æ—¢é¿å…æŒ‚èµ·ä¿¡å·ï¼Œåˆå½»åº•è„±ç¦»æ§åˆ¶ç»ˆç«¯ï¼Œæ˜¯æœ€ç¨³å¦¥çš„åå°æ–¹å¼ä¹‹ä¸€ï¼ˆå°¤å…¶åœ¨åµŒå…¥å¼æˆ–æ— äººå€¼å®ˆè®¾å¤‡ä¸Šï¼‰ã€‚ ","date":"2025-04-19","objectID":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/:5:0","tags":["linux"],"title":"Linux åå°å¯åŠ¨å‘½ä»¤setsidå’Œnohupçš„åŒºåˆ«ä»‹ç»","uri":"/linux-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4setsid%E5%92%8Cnohup%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%8B%E7%BB%8D/"},{"categories":["å®‰å…¨"],"content":"å‰è¨€ è·¨ç«™è¯·æ±‚ä¼ªé€ (Cross-Site Request Forgery, CSRF)æ”»å‡»ã€‚å®ƒä¸XSSæ”»å‡»çš„ç›®æ ‡ä¸åŒï¼Œä½†å±å®³åŒæ ·å·¨å¤§ï¼Œæ˜¯Webå®‰å…¨çš„æ ¸å¿ƒå¨èƒä¹‹ä¸€ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:1","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"CSRFæ”»å‡»åŸç† CSRFæ”»å‡»çš„æ ¸å¿ƒåœ¨äºæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œè®©å…¶ä»¥ç”¨æˆ·çš„èº«ä»½åœ¨å·²è®¤è¯ï¼ˆç™»å½•ï¼‰çš„ç½‘ç«™ä¸Šæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ æ”»å‡»è€…çš„ç›®æ ‡ï¼š æ”»å‡»è€…è¯±ä½¿å·²ç»ç™»å½•äº†ç›®æ ‡ç½‘ç«™ï¼ˆä¾‹å¦‚é“¶è¡Œç½‘ç«™ bank.comï¼‰çš„ç”¨æˆ·ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå‘è¯¥ç›®æ ‡ç½‘ç«™å‘èµ·ä¸€ä¸ªæ¶æ„è¯·æ±‚ï¼ˆä¾‹å¦‚è½¬è´¦ç»™æ”»å‡»è€…ï¼‰ã€‚ ç”¨æˆ·å·²ç™»å½•ï¼š å—å®³è€…ç”¨æˆ·ä¹‹å‰å·²ç»æˆåŠŸç™»å½•äº†ç›®æ ‡ç½‘ç«™ï¼ˆbank.comï¼‰ï¼Œæµè§ˆå™¨ä¿å­˜äº†è¯¥ç½‘ç«™çš„ä¼šè¯Cookieï¼ˆæˆ–å…¶ä»–è®¤è¯å‡­è¯ï¼‰ã€‚åªè¦è¿™ä¸ªCookieæœªè¿‡æœŸï¼Œæµè§ˆå™¨åœ¨å‘ç›®æ ‡ç½‘ç«™å‘é€ä»»ä½•è¯·æ±‚æ—¶éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Šå®ƒã€‚ æ”»å‡»è€…ä¼ªé€ è¯·æ±‚ï¼š æ”»å‡»è€…ç²¾å¿ƒæ„é€ ä¸€ä¸ªæŒ‡å‘ç›®æ ‡ç½‘ç«™å…³é”®åŠŸèƒ½ï¼ˆä¾‹å¦‚è½¬è´¦æ¥å£ bank.com/transferï¼‰çš„HTTPè¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚åŒ…å«äº†æ‰§è¡Œæ¶æ„æ“ä½œæ‰€éœ€çš„æ‰€æœ‰å‚æ•°ï¼ˆå¦‚æ”¶æ¬¾è´¦æˆ·ã€è½¬è´¦é‡‘é¢ï¼‰ã€‚ å…³é”®ç‚¹ï¼š æ„é€ çš„è¯·æ±‚å¯ä»¥æ˜¯ GETï¼ˆæ›´å®¹æ˜“ï¼Œæ¯”å¦‚éšè—åœ¨å›¾ç‰‡é“¾æ¥æˆ–é“¾æ¥é‡Œï¼‰æˆ– POSTï¼ˆå¸¸ç”¨ï¼Œéšè—åœ¨è¡¨å•é‡Œï¼‰è¯·æ±‚ã€‚ è¯±éª—ç”¨æˆ·è§¦å‘è¯·æ±‚ï¼š æ”»å‡»è€…éœ€è¦è®¾æ³•è®©å·²ç»ç™»å½•äº†ç›®æ ‡ç½‘ç«™çš„ç”¨æˆ·è®¿é—®ä¸€ä¸ªæ¶æ„é¡µé¢ï¼ˆè¿™ä¸ªé¡µé¢å¯ä»¥åœ¨æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç«™ã€è®ºå›å¸–å­ã€åµŒå…¥é‚®ä»¶çš„é¡µé¢ã€ç”šè‡³è¢«XSSæ”»å‡»çš„ç½‘ç«™ï¼‰ã€‚ å½“å—å®³è€…è®¿é—®è¿™ä¸ªæ¶æ„é¡µé¢æ—¶ï¼Œè¯¥é¡µé¢ä¼šåŒ…å«è‡ªåŠ¨è§¦å‘æˆ–è¯±ä½¿ç”¨æˆ·ç‚¹å‡»å‘ç›®æ ‡ç½‘ç«™å‘èµ·ä¼ªé€ è¯·æ±‚çš„ä»£ç ã€‚ è¯·æ±‚è¢«å‘é€å¹¶æ‰§è¡Œï¼š ç”¨æˆ·çš„æµè§ˆå™¨è®¿é—®æ¶æ„é¡µé¢ï¼Œå¹¶æŒ‰ç…§é¡µé¢æŒ‡ç¤ºï¼ˆè‡ªåŠ¨æˆ–ç”¨æˆ·è§¦å‘ï¼‰å‘ç›®æ ‡ç½‘ç«™ bank.com/transfer å‘èµ·ä¼ªé€ çš„è¯·æ±‚ã€‚ ç”±äºç”¨æˆ·ä¹‹å‰å·²ç™»å½• bank.comï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†ç”¨æˆ·çš„ bank.com ä¼šè¯Cookieæ·»åŠ åˆ°è¯¥è¯·æ±‚å¤´ä¸­ã€‚ bank.com æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼šæ£€æŸ¥Cookieæœ‰æ•ˆ -\u003e éªŒè¯ç”¨æˆ·èº«ä»½é€šè¿‡ -\u003e æ‰§è¡Œè¯·æ±‚ä¸­çš„æ“ä½œï¼ˆè½¬è´¦ï¼‰-\u003e è¿”å›ç»“æœã€‚ æ”»å‡»å®Œæˆï¼š æ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…ã€æ— æ„çš„æƒ…å†µä¸‹ï¼Œä»¥ç”¨æˆ·çš„èº«ä»½å’Œæƒé™æˆåŠŸæ‰§è¡Œäº†æ¶æ„æ“ä½œï¼ˆå¦‚è½¬è´¦ç»™æ”»å‡»è€…è´¦æˆ·ï¼‰ã€‚å—å®³è€…ç›´åˆ°å‘ç°è‡ªå·±è´¦æˆ·å˜åŠ¨æ—¶æ‰ä¼šå¯Ÿè§‰åˆ°æ”»å‡»ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:2","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"CSRFæ”»å‡»çš„æ ¸å¿ƒè¦ç´  å—å®³è€…ç”¨æˆ·å·²ç™»å½•ç›®æ ‡ç½‘ç«™Aï¼ˆèº«ä»½è®¤è¯æœ‰æ•ˆï¼‰ã€‚ ç›®æ ‡ç½‘ç«™Açš„ä¼šè¯è®¤è¯æœºåˆ¶ä»…ä¾èµ–äºCookieï¼ˆæˆ–å…¶ä»–æµè§ˆå™¨è‡ªåŠ¨å‘é€çš„ä¿¡æ¯ï¼‰ã€‚ ç›®æ ‡ç½‘ç«™Aå­˜åœ¨å…³é”®æ“ä½œæ¥å£ï¼ˆå¦‚è½¬è´¦ã€æ”¹å¯†ã€æ”¹é‚®ç®±ã€å‘å¸–ï¼‰ï¼Œè¯¥æ¥å£ä»…é€šè¿‡ä¼šè¯Cookieé‰´åˆ«ç”¨æˆ·èº«ä»½ï¼Œå¯¹äºè¯·æ±‚çš„æ¥æºæ²¡æœ‰è¶³å¤ŸéªŒè¯ï¼ˆåªè¦Cookieå¯¹å°±æ‰§è¡Œï¼‰ã€‚ æ”»å‡»è€…èƒ½å¤Ÿæ„é€ å‡ºè¯¥å…³é”®æ“ä½œçš„å®Œæ•´HTTPè¯·æ±‚ï¼ˆçŸ¥é“URLã€å‚æ•°æ ¼å¼ï¼‰ã€‚ æ”»å‡»è€…èƒ½è¯±ä½¿å—å®³è€…ç”¨æˆ·åœ¨ç™»å½•çŠ¶æ€ä¸‹è®¿é—®åŒ…å«èƒ½è§¦å‘è¯¥è¯·æ±‚çš„æ¶æ„é¡µé¢ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:3","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"å¸¸è§çš„CSRFæ”»å‡»å®è·µï¼ˆæ„é€ æ¶æ„è¯·æ±‚çš„æ–¹å¼ï¼‰ GETè¯·æ±‚ä¼ªè£…ï¼š æ”»å‡»è€…ç›´æ¥åœ¨æ¶æ„é¡µé¢ä¸ŠåµŒå…¥æŒ‡å‘ç›®æ ‡æ¥å£çš„ GET è¯·æ±‚ï¼ˆé€šè¿‡ \u003cimg\u003e, \u003cscript\u003e, \u003ciframe\u003e ç­‰æ ‡ç­¾çš„ src å±æ€§ï¼‰ã€‚ ä¾‹å­ï¼š æ¶æ„é¡µé¢ä¸­åµŒå…¥ï¼š \u003cimg src=\"http://bank.com/transfer?to=attacker_account\u0026amount=10000\" width=\"0\" height=\"0\" /\u003e ç”¨æˆ·è®¿é—®è¯¥æ¶æ„é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šå°è¯•åŠ è½½å›¾ç‰‡ï¼Œè‡ªåŠ¨å‘ bank.com å‘é€è½¬è´¦çš„ GET è¯·æ±‚ï¼ˆå¸¦ä¸Šç”¨æˆ·Cookieï¼‰ï¼Œå®Œæˆæ”»å‡»ã€‚æ”»å‡»è€…è´¦å·æ”¶åˆ°10000å…ƒã€‚ é—®é¢˜ï¼š GET è¯·æ±‚é€šå¸¸ä¸åº”è¯¥ç”¨äºä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œä½†ç°åœ¨ä¹Ÿèƒ½çœ‹åˆ°ï¼ˆå±å®³æ›´å¤§ï¼‰ã€‚ POSTè¯·æ±‚ä¼ªè£…ï¼š æ”»å‡»è€…åœ¨æ¶æ„é¡µé¢ä¸­æ„é€ ä¸€ä¸ªéšè—çš„è¡¨å• (\u003cform\u003e) ï¼Œè¡¨å•çš„ action æŒ‡å‘ç›®æ ‡æ¥å£åœ°å€ï¼ˆbank.com/transferï¼‰ï¼Œmethod ä¸º POSTï¼Œè¡¨å•ä¸­åŒ…å«æ¶æ„æ“ä½œæ‰€éœ€çš„å‚æ•°ï¼ˆéšè—çš„è¾“å…¥æ¡†ï¼‰ã€‚ ä½¿ç”¨JSåœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æäº¤è¡¨å• (form.submit())ã€‚ ä¾‹å­ï¼š \u003cbody onload=\"document.forms[0].submit()\"\u003e \u003cform action=\"http://bank.com/transfer\" method=\"POST\"\u003e \u003cinput type=\"hidden\" name=\"to\" value=\"attacker_account\" /\u003e \u003cinput type=\"hidden\" name=\"amount\" value=\"10000\" /\u003e \u003cinput type=\"submit\" value=\"Click for Prize!\" /\u003e \u003c!-- ä¹Ÿå¯å®Œå…¨éšè—ï¼Œé onloadæäº¤ --\u003e \u003c/form\u003e \u003c/body\u003e ç”¨æˆ·è®¿é—®æ¶æ„é¡µé¢æ—¶ï¼Œè¡¨å•è¢«è‡ªåŠ¨æäº¤ï¼ˆå³ä½¿æäº¤æŒ‰é’®æ˜¯è¯±éª—æ€§çš„æˆ–éšè—çš„ï¼‰ï¼Œæµè§ˆå™¨å‘ bank.com å‘é€åŒ…å«æ¶æ„å‚æ•°å’Œç”¨æˆ·Cookieçš„ POST è¯·æ±‚ã€‚ åˆ©ç”¨å…¶ä»–æ ‡ç­¾/æ–¹æ³•ï¼š é™¤äº†å›¾ç‰‡å’Œè¡¨å•ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥åˆ©ç”¨ \u003clink\u003e (rel=stylesheet æˆ– prerender/prefetch)ã€\u003cvideo\u003eã€\u003cobject\u003eã€XMLHttpRequestã€fetch()ï¼ˆå¦‚æœå…è®¸è·¨åŸŸï¼‰ç­‰æ–¹æ³•æ¥å‘é€ä¼ªé€ è¯·æ±‚ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:4","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"CSRFæ”»å‡»çš„åæœ èµ„é‡‘æŸå¤±ï¼š ä¼ªé€ é“¶è¡Œè½¬è´¦æ“ä½œã€‚ è´¦æˆ·è¢«æ¥ç®¡ï¼š ä¼ªé€ ä¿®æ”¹å¯†ç ã€ä¿®æ”¹å¯†ä¿é‚®ç®±æ“ä½œã€‚ æ•°æ®æ³„éœ²/ç¯¡æ”¹ï¼š ä¼ªé€ ç”¨æˆ·èµ„æ–™ä¿®æ”¹ã€åˆ é™¤é‡è¦æ•°æ®æ“ä½œã€‚ éæˆæƒæ“ä½œï¼š ä¼ªé€ å‘é€æ¶ˆæ¯ã€å‘å¸ƒå¸–å­ã€æŠ•ç¥¨ã€è´­ç‰©è½¦ç»“ç®—ç­‰ç”¨æˆ·æƒé™èŒƒå›´å†…çš„ä»»ä½•æ“ä½œã€‚ å£°èª‰æŸå®³ï¼š å—å®³è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ¶æ„æ“ä½œå¯èƒ½æŸå®³å…¶ä¸ªäººæˆ–å…¬å¸çš„å£°èª‰ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:5","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"CSRFæ”»å‡»çš„é˜²èŒƒæªæ–½ï¼ˆæ ¸å¿ƒæ€æƒ³ï¼šå¢åŠ è¯·æ±‚çš„ä¸å¯é¢„æµ‹æ€§ï¼‰ CSRF Tokensï¼ˆæœ€å¸¸ç”¨ã€æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆï¼‰ï¼š åŸç†ï¼š ä¸ºæ¯ä¸ªç”¨æˆ·ä¼šè¯ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ã€éšæœºçš„ã€é«˜å¼ºåº¦çš„Tokenï¼ˆä»¤ç‰Œï¼‰ã€‚å°†è¿™ä¸ªTokenåŒ…å«åœ¨ï¼š æœåŠ¡ç«¯ç”Ÿæˆçš„è¡¨å•ä¸­ï¼ˆä½œä¸ºéšè—å­—æ®µ \u003cinput type=\"hidden\" name=\"csrf_token\" value=\"random_value\"\u003eï¼‰ã€‚ AJAXè¯·æ±‚çš„è¯·æ±‚å¤´ä¸­ï¼ˆX-CSRF-Token: random_valueï¼‰ã€‚ æœåŠ¡å™¨éªŒè¯ï¼š åœ¨å¤„ç†ä»»ä½•ä¼šæ”¹å˜çŠ¶æ€çš„è¯·æ±‚ï¼ˆPOST, PUT, DELETE, PATCHï¼‰æ—¶ï¼ŒæœåŠ¡å™¨æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦æºå¸¦äº†æœ‰æ•ˆçš„CSRF Tokenï¼Œå¹¶ä¸”è¯¥Tokenä¸å½“å‰ç”¨æˆ·ä¼šè¯ä¸­å­˜å‚¨çš„Tokenä¸€è‡´ã€‚ å®‰å…¨æ€§åˆ†æï¼š æ”»å‡»è€…æ— æ³•åœ¨è‡ªå·±çš„æ¶æ„é¡µé¢ä¸­é¢„å…ˆå¾—çŸ¥è¿™ä¸ªTokenï¼ˆå› ä¸ºTokenæ˜¯éšæœºçš„ä¸”å…³è”ç”¨æˆ·ä¼šè¯ï¼‰ã€‚ åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰é˜»æ­¢äº†æ¶æ„é¡µé¢é€šè¿‡JavaScriptä»åˆæ³•é¡µé¢è¯»å–Tokenï¼ˆå› ä¸ºæ¶æ„é¡µé¢å’Œç›®æ ‡ç½‘ç«™ä¸åŒæºï¼‰ã€‚ å› æ­¤ï¼Œæ”»å‡»è€…æ— æ³•åœ¨ä¼ªé€ çš„è¯·æ±‚ä¸­åŒ…å«æ­£ç¡®çš„Tokenï¼ŒæœåŠ¡å™¨ä¼šæ‹’ç»æ‰§è¡Œè¯·æ±‚ã€‚ å®ç°è¦ç‚¹ï¼š Tokenåº”ç»‘å®šåˆ°ç”¨æˆ·ä¼šè¯ï¼ˆsessionï¼‰ï¼Œå¹¶åœ¨ç”¨æˆ·ç™»å½•åç”Ÿæˆã€‚ Tokenåº”å…·æœ‰è¶³å¤Ÿçš„ç†µï¼ˆé•¿åº¦å’Œéšæœºæ€§ï¼‰ä»¥é˜²çŒœæµ‹ã€‚ Tokenåº”åœ¨è¡¨å•æäº¤åç«‹å³å¤±æ•ˆï¼ˆé˜²æ­¢è¡¨å•é‡å¤æäº¤ï¼‰æˆ–è€…åœ¨ä¸€ä¸ªä¼šè¯æœŸå†…æœ‰æ•ˆï¼ˆåè€…æ›´å¸¸è§ï¼Œä½†é£é™©ç¨é«˜ï¼‰ï¼Œç™»å‡ºååº”é”€æ¯ã€‚ ä½¿ç”¨POSTæ–¹æ³•ä¿æŠ¤æºå¸¦Tokençš„è¯·æ±‚ï¼ˆé¿å…Tokenæ³„æ¼åœ¨URLä¸Šï¼‰ã€‚ åŒé‡æäº¤CookieéªŒè¯ï¼š åŸç†ï¼š ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨é™¤äº†è®¾ç½®ä¼šè¯Cookieï¼ˆSet-Cookie: SessionId=...; ...ï¼‰ï¼Œè¿˜ä¼šåœ¨å®¢æˆ·ç«¯è®¾ç½®ä¸€ä¸ªå•ç‹¬çš„CSRF Token Cookieï¼ˆé€šå¸¸ä¸èƒ½æ ‡è®°ä¸º HttpOnlyï¼‰ï¼Œå¦‚ Set-Cookie: CSRF-Token=random_value; ...ã€‚ å®¢æˆ·ç«¯åœ¨å‘èµ·æ•æ„Ÿè¯·æ±‚ï¼ˆé€šå¸¸æ˜¯é GETï¼‰æ—¶ï¼Œé™¤äº†æµè§ˆå™¨è‡ªåŠ¨åœ¨ Cookie å¤´ä¸­å¸¦ä¸Šä¼šè¯Cookieå’ŒCSRF-Token Cookieï¼Œè¿˜éœ€è¦åœ¨è¯·æ±‚å¤´ï¼ˆå¦‚ X-CSRF-Tokenï¼‰æˆ–è€…è¯·æ±‚ä½“ï¼ˆå¦‚å‚æ•° csrf_tokenï¼‰ä¸­ä¹Ÿå¸¦ä¸Šè¿™ä¸ªCSRF Tokenå€¼ã€‚ æœåŠ¡å™¨åœ¨éªŒè¯è¯·æ±‚æ—¶ï¼š ä»è¯·æ±‚å¤´æˆ–è¯·æ±‚ä½“ä¸­å–å‡ºCSRF Tokenå€¼ï¼ˆTokenå€¼ï¼‰ã€‚ ä»è¯·æ±‚å¤´ä¸­çš„Cookieé‡Œå–å‡ºCSRF Token Cookieå€¼ã€‚ æ¯”è¾ƒè¿™ä¸¤ä¸ªTokenå€¼æ˜¯å¦ä¸€è‡´ã€‚ä¸€è‡´åˆ™æ‰§è¡Œæ“ä½œã€‚ å®‰å…¨æ€§åˆ†æï¼š æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚è®©æµè§ˆå™¨å¸¦ä¸Šåˆæ³•çš„ä¼šè¯Cookieï¼ˆå› ä¸ºæµè§ˆå™¨è‡ªåŠ¨åšï¼‰ï¼Œä½†æ— æ³•è®©æµè§ˆå™¨å¸¦ä¸Šåˆæ³•çš„CSRF Token Cookieå‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼ˆæ”»å‡»è€…æ‹¿ä¸åˆ°Cookieï¼‰ã€‚ æ”»å‡»è€…åœ¨ä¼ªé€ è¯·æ±‚çš„ X-CSRF-Token å¤´æˆ–è¯·æ±‚ä½“ä¸­æ”¾å…¥ä»€ä¹ˆå€¼ï¼Ÿä»–ä¸çŸ¥é“ç”¨æˆ·çœŸå®çš„CSRF Tokenå€¼ï¼ˆå› ä¸ºCookieä¸å¯è¢«æ¶æ„JSè¯»å–ï¼‰ï¼Œä¹Ÿæ— æ³•çŒœæµ‹ã€‚ å› æ­¤ï¼ŒæœåŠ¡å™¨æ”¶åˆ°çš„ä¼ªé€ è¯·æ±‚ä¸­ï¼Œè¯·æ±‚å¤´/ä½“ä¸­çš„Tokenå€¼å’ŒCookieä¸­çš„Tokenå€¼ä¸ä¸€è‡´ï¼ˆç”šè‡³ç¼ºå¤±ï¼‰ï¼ŒéªŒè¯å¤±è´¥ã€‚ ä¼˜ç¼ºç‚¹ï¼š ç›¸æ¯”å•çº¯ä½¿ç”¨Tokenåœ¨è¡¨å•ä¸­ï¼Œæ­¤æ–¹æ³•JSæ›´å®¹æ˜“è·å–Tokenï¼ˆä»Cookieè¯»å–ï¼‰ã€‚éœ€è¦é¢å¤–æ³¨æ„é˜²æ­¢å­åŸŸæ³„éœ²é—®é¢˜ï¼ˆè®¾ç½®Cookieçš„ Domain å’Œ Path å±æ€§ä¸¥æ ¼æ§åˆ¶èŒƒå›´ï¼‰ã€‚ç°ä»£æ¡†æ¶å¸¸ç”¨æ­¤æ–¹å¼ç»“åˆTokenä½¿ç”¨ã€‚ æ£€æŸ¥ Origin / Referer HTTPè¯·æ±‚å¤´ï¼š åŸç†ï¼š æœåŠ¡å™¨åœ¨å¤„ç†æ•æ„Ÿè¯·æ±‚æ—¶ï¼Œæ£€æŸ¥HTTPè¯·æ±‚å¤´ Originï¼ˆæ›´å¯é ï¼‰æˆ– Refererï¼ˆå­˜åœ¨éšç§é—®é¢˜å’Œå¯è¢«ç¯¡æ”¹é£é™©ï¼Œä½†æ—§æµè§ˆå™¨å…¼å®¹å¥½ï¼‰ã€‚ Origin å¤´ï¼š è¡¨ç¤ºè¯·æ±‚å‘èµ·çš„æºï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰ã€‚ä¸èƒ½ç”±JSè®¾ç½®ã€‚æµè§ˆå™¨åœ¨è·¨åŸŸè¯·æ±‚å’ŒåŒç«™ POST è¯·æ±‚ä¸­é€šå¸¸ä¼šå‘é€ã€‚ Referer å¤´ï¼š è¡¨ç¤ºè¯·æ±‚æ¥æºçš„å®Œæ•´é¡µé¢URLã€‚å¯èƒ½ä¼šè¢«ä¸€äº›é˜²ç«å¢™æˆ–æµè§ˆå™¨æ’ä»¶å±è”½æˆ–éšç§ä¿æŠ¤ç­–ç•¥ç§»é™¤ï¼ˆç©ºï¼‰ï¼Œä¹Ÿå¯èƒ½è¢«ç¯¡æ”¹ï¼ˆä¸å®‰å…¨ï¼‰ã€‚ æœåŠ¡å™¨éªŒè¯ï¼š å¦‚æœè¯·æ±‚å¤´ä¸­åŒ…å« Originï¼ŒæœåŠ¡å™¨æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é¢„æœŸçš„åˆæ³•æºï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªç™½åå•æºï¼Œé€šå¸¸æ˜¯ç½‘ç«™è‡ªå·±çš„æºåœ°å€ï¼‰ã€‚å¦‚æœè¯·æ±‚å¤´ä¸­æ²¡æœ‰ Originï¼ˆæ—§æµè§ˆå™¨æˆ–ç®€å•è¯·æ±‚å¦‚GETï¼‰ï¼Œå¯ä»¥æ£€æŸ¥ Refererï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¹¶ç¡®ä¿å…¶æ¥æºåŸŸæ˜¯åˆæ³•çš„ã€‚ ä¼˜ç¼ºç‚¹ï¼š å®ç°ç®€å•ã€‚ Origin å¤´æ¯” Referer å¯é ä¸”å®‰å…¨ã€‚ ä¸èƒ½å®Œå…¨ä¾èµ–ä½œä¸ºå”¯ä¸€é˜²çº¿ã€‚Referer å¤´å¯èƒ½è¢«ç¦ç”¨/ç¯¡æ”¹/ä¸ºç©ºã€‚åœ¨ç‰¹å®šé…ç½®çš„åµŒå¥—é¡µé¢ï¼ˆå¦‚ file: åè®®æˆ–HTTPSè·³HTTPï¼‰ä¸‹å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚æ”»å‡»è€…åœ¨æŸäº›ä¸­é—´äººæ”»å‡»ï¼ˆå¦‚Wifiçƒ­ç‚¹ï¼‰æˆ–æµè§ˆå™¨æ’ä»¶æ¼æ´åœºæ™¯ä¸‹å¯èƒ½ç»•è¿‡ã€‚ å»ºè®®ï¼š ä½œä¸ºæ·±åº¦é˜²å¾¡æªæ–½ï¼Œä¸CSRF Tokenç­‰æ–¹æ³•ç»“åˆä½¿ç”¨ï¼Œå¢åŠ æ”»å‡»éš¾åº¦ã€‚ è¦æ±‚è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼ˆé…åˆCORSï¼‰ï¼š åŸç†ï¼š æœåŠ¡ç«¯è¦æ±‚å¤„ç†æ•æ„Ÿæ“ä½œçš„è¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ POST, PUT, DELETE ç­‰ï¼‰å¿…é¡»æºå¸¦ä¸€ä¸ªç‰¹å®šçš„ã€éæ ‡å‡†çš„å®‰å…¨è‡ªå®šä¹‰HTTPè¯·æ±‚å¤´ï¼ˆå¦‚ X-Requested-With: XMLHttpRequest æˆ–è‡ªå®šä¹‰çš„ X-Custom-Header: Valueï¼‰ã€‚ æ”»å‡»è€…æ„é€ çš„CSRFæ”»å‡»é€šå¸¸ä½¿ç”¨ \u003cform\u003e æäº¤ï¼Œæµè§ˆå™¨é»˜è®¤ä¸ä¼šï¼ˆä¹Ÿæ— æ³•ï¼‰è‡ªåŠ¨è®¾ç½®è‡ªå®šä¹‰çš„è¯·æ±‚å¤´ï¼ˆåªä¼šåœ¨åŒæºè¯·æ±‚ä¸­è‡ªåŠ¨è®¾ç½®Cookieï¼‰ã€‚ CORSç­–ç•¥é™åˆ¶ï¼š å¦‚æœæœåŠ¡å™¨è®¾ç½®äº†ä¸¥æ ¼çš„CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç­–ç•¥ï¼Œåªå…è®¸ç‰¹å®šçš„æºï¼ˆè‡ªèº«ï¼‰å‘èµ·è¯·æ±‚ï¼Œé‚£ä¹ˆæ¶æ„é¡µé¢å‘èµ·çš„è·¨åŸŸAJAXè¯·æ±‚ï¼š éœ€è¦é¢„æ£€è¯·æ±‚ (OPTIONS)ã€‚ ç”±äºè¯·æ±‚æºå¸¦äº†è‡ªå®šä¹‰å¤´ï¼ˆå³ä½¿AJAXè®¾ç½®äº†X-Requested-Withç­‰å¤´ï¼‰ï¼Œè¿™ä¸ªé¢„æ£€è¯·æ±‚ä¼šè¢«æµè§ˆå™¨å‘é€ä»¥æ£€æŸ¥æ˜¯å¦è¢«ç›®æ ‡æœåŠ¡å™¨å…è®¸ã€‚ å…³é”®ï¼š é™¤éç›®æ ‡æœåŠ¡å™¨çš„CORSç­–ç•¥æ˜ç¡®å…è®¸äº†æ”»å‡»è€…æ¶æ„ç½‘ç«™çš„æºè®¿é—®å¹¶æºå¸¦è¯¥è‡ªå®šä¹‰å¤´ï¼Œå¦åˆ™é¢„æ£€è¯·æ±‚ä¼šè¢«æœåŠ¡å™¨æ‹’ç»ã€‚æµè§ˆå™¨å°±ä¸ä¼šå‘é€åç»­çœŸæ­£çš„æ•æ„Ÿè¯·æ±‚ã€‚å³ä½¿æ¶æ„ç½‘ç«™ç»•è¿‡AJAXä½¿ç”¨\u003cform\u003eï¼Œä¹Ÿæ— æ³•æ·»åŠ è‡ªå®šä¹‰å¤´ã€‚ å› æ­¤ï¼ŒæœåŠ¡å™¨æ”¶åˆ°æ²¡æœ‰è¿™ä¸ªè‡ªå®šä¹‰è¯·æ±‚å¤´çš„è¯·æ±‚ï¼ˆä¾‹å¦‚é€šè¿‡ \u003cform\u003e æäº¤çš„CSRFæ”»å‡»è¯·æ±‚ï¼‰ï¼Œå¯ä»¥æ‹’ç»å¤„ç†ã€‚ ä¼˜ç¼ºç‚¹ï¼š å®ç°ç›¸å¯¹ç®€å•ã€‚ åˆ©ç”¨æµè§ˆå™¨å®‰å…¨æœºåˆ¶ã€‚ ä¾èµ–äºCORSç­–ç•¥çš„æœ‰æ•ˆé…ç½®ï¼Œéœ€è¦ä¸¥æ ¼é™åˆ¶å…è®¸çš„æºï¼ˆAccess-Control-Allow-Originï¼‰ã€å…è®¸çš„è‡ªå®šä¹‰å¤´ï¼ˆAccess-Control-Allow-Headersï¼‰ã€‚é”™è¯¯çš„CORSé…ç½®ä¼šå¼•å…¥å…¶ä»–ä¸¥é‡æ¼æ´ï¼ˆå¦‚æ³„éœ²APIæ•°æ®ï¼‰ã€‚ åªå¯¹XMLHttpRequest / fetch()è¯·æ±‚æœ‰æ•ˆï¼Œæ— æ³•é˜²å¾¡é€šè¿‡\u003cform\u003eæäº¤çš„ç®€å•CSRFæ”»å‡»ï¼ˆä½†\u003cform\u003eæäº¤æ— æ³•æºå¸¦è‡ªå®šä¹‰å¤´ï¼ŒæœåŠ¡å™¨ä¼šæ‹’ç»æ­¤ç±»æ²¡å¸¦å¤´çš„è¯·æ±‚ï¼‰ã€‚ å¯¹äºä½¿ç”¨JSåº“å‘èµ·JSONPè¯·æ±‚çš„è€æ—§åº”ç”¨æ— æ•ˆã€‚ å»ºè®®ï¼š å¯¹äºä¸»è¦ä½¿ç”¨APIï¼ˆAJAXï¼‰è¿›è¡Œäº¤äº’çš„åº”ç”¨ï¼Œå¯ä»¥ä½œä¸ºCSRF Tokençš„æœ‰åŠ›è¡¥å……ã€‚å¯¹äºä¼ ç»Ÿå¤šè¡¨å•æäº¤çš„åº”ç”¨ï¼Œæ•ˆæœå—é™ã€‚ SameSite Cookieå±æ€§ï¼š åŸç†ï¼š åœ¨è®¾ç½®Cookieæ—¶ï¼ˆç‰¹åˆ«æ˜¯ä¼šè¯Cookieï¼‰ï¼Œæ·»åŠ  SameSite å±æ€§æ¥æ§åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚æ—¶æ˜¯å¦è¢«å‘é€ã€‚ SameSite=Strictï¼š æœ€ä¸¥æ ¼ã€‚æµè§ˆå™¨åªä¼šåœ¨åŒç«™è¯·æ±‚(å³è¯·æ±‚æ¥æºå’Œç›®æ ‡ç½‘ç«™åŒæº)ä¸­å‘é€æ­¤Cookieã€‚è¿™æ„å‘³ç€ç”¨æˆ·ç‚¹å‡»å¤–éƒ¨é“¾æ¥è¿›å…¥ç›®æ ‡ç½‘ç«™æ—¶ï¼Œæœ€å¼€å§‹è®¿é—®çš„é¡µé¢æ˜¯æ²¡æœ‰ä¼šè¯Cookieçš„ï¼ˆç›¸å½“äºç”¨æˆ·è¿˜æ²¡ç™»å½•çŠ¶æ€ï¼‰ï¼Œéœ€è¦é‡æ–°ç™»å½•ï¼Œç„¶åå†æ‰§è¡Œæ“ä½œï¼ˆå¦‚ä»é‚®ä»¶ä¸­çš„é“¾æ¥è¿›å…¥é“¶è¡Œï¼‰ã€‚å®‰å…¨ä½†ç”¨æˆ·ä½“éªŒå·®ã€‚ SameSite=Laxï¼š æ¨èçš„å¹³è¡¡æ–¹æ¡ˆï¼ˆç°ä»£æµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼‰ã€‚ åœ¨è·¨ç«™è¯·æ±‚ä¸­ï¼Œå¯¹äºâ€œå®‰å…¨çš„HTTPæ–¹æ³•â€ï¼ˆå¦‚ GET, HEADï¼‰ï¼Œä¸”è¯¥è¯·æ±‚ä¼šå¯¼è‡´æµè§ˆå™¨åœ¨é¡¶å±‚å¯¼èˆªæ åˆ‡æ¢é¡µé¢ï¼ˆå¦‚ \u003ca\u003e é“¾æ¥ç‚¹å‡»ï¼‰ï¼Œæµè§ˆå™¨ä¼šå‘é€Cookieã€‚ä½†å¯¹äºéå®‰å…¨çš„è¯·æ±‚ï¼ˆå¦‚ POST, PUT, DELETEï¼‰ã€æˆ–é€šè¿‡ \u003cimg\u003e, \u003cscript\u003e, \u003cform\u003eï¼ˆæ²¡æœ‰å¯¼è‡´é¡¶å±‚å¯¼èˆªæ”¹å˜ï¼‰å‘èµ·çš„è·¨ç«™è¯·æ±‚ï¼Œæµè§ˆå™¨åˆ™ä¸ä¼šå‘é€Cookieã€‚è¿™æ„å‘³ç€æ”»å‡»è€…ä¼ªé€ çš„ POST è½¬è´¦è¯·æ±‚ä¸ä¼šæºå¸¦ç”¨æˆ·çš„ SameSite=Lax ä¼šè¯Cookieï¼ŒæœåŠ¡å™¨è®¤ä¸ºç”¨æˆ·æœªç™»å½•ï¼ˆæˆ–ä¼šè¯æ— æ•ˆï¼‰ï¼Œæ”»å‡»å¤±è´¥ã€‚æ”»å‡»è€…ä¼ªé€ çš„ GET è¯·æ±‚ï¼ˆå¦‚è½¬è´¦é“¾æ¥ï¼Œè®¾ç½®Strictæˆ–Laxåï¼‰è™½ç„¶å¯èƒ½å‘é€Cookieï¼Œä½†è¦æ±‚æ˜¯é¡¶å±‚å¯¼èˆªè·³è½¬ï¼ˆç”¨æˆ·ä¼šçœ‹åˆ°é¡µé¢è·³è½¬åˆ°é“¶è¡Œå¹¶è½¬è´¦æˆåŠŸé¡µé¢ï¼Œæ›´å®¹æ˜“å¯Ÿè§‰ï¼‰ï¼Œå¹¶ä¸”å®‰å…¨æ–¹æ³•é€šå¸¸ä¸ç”¨æ¥åšæ•°æ®ä¿®æ”¹æ“ä½œï¼ˆé“¶è¡Œä¹Ÿä¸è¯¥ç”¨GETåšè½¬è´¦ï¼‰ã€‚ SameSite=None; Secureï¼š æœ€å®½æ¾ã€‚æµè§ˆå™¨ä¼šåœ¨è·¨ç«™è¯·æ±‚ä¸­å‘é€Cookieï¼Œä½†å¿…é¡»æ ‡è®°ä¸º Secureï¼ˆè¦æ±‚HTTPSï¼‰ã€‚åªæœ‰ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚è·¨å¤šä¸ªåŸŸåçš„ç™»å½•ç³»ç»Ÿï¼ŒåµŒå…¥çš„ç¬¬ä¸‰æ–¹iframeå†…å®¹éœ€è¦è®¤è¯ï¼‰æ‰éœ€è¦ã€‚å®¹æ˜“å—åˆ°CSRFæ”»å‡»ã€‚ ä¼˜ç¼ºç‚¹ï¼š æµè§ˆå™¨å†…ç½®æ”¯æŒï¼ŒæœåŠ¡ç«¯ä»…éœ€åœ¨è®¾ç½®Cookieæ—¶æ·»åŠ å±æ€§ï¼ˆå¦‚ Set-Cookie: SessionId=...; Secure; HttpOnly; SameSite=Lax; ...ï¼‰ã€‚ å®ç°æˆæœ¬æœ€ä½ã€‚ SameSite=Lax èƒ½æœ‰æ•ˆé˜²å¾¡ç»å¤§å¤šæ•°åŸºäº \u003cform\u003e POSTçš„CSRFæ”»å‡»ï¼Œä¸”ä¸å½±å“ç”¨æˆ·æ­£å¸¸æµè§ˆä½“éªŒï¼ˆç‚¹å‡»é“¾æ¥ç™»å½•çŠ¶æ€æœ‰æ•ˆï¼‰ã€‚ SameSite=Strict é˜²å¾¡æœ€å¼ºä½†ä½“éªŒå·®ã€‚ å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼ˆæ—§ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒåº¦æœ‰é™ï¼‰ï¼Œä½†ç°åœ¨ä¸»æµæµè§ˆå™¨æ”¯æŒè‰¯å¥½ã€‚ ä¸èƒ½ä½œä¸ºå”¯ä¸€é˜²å¾¡æªæ–½ã€‚ æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ã€åº”ç”¨æœ¬èº«å­˜åœ¨ä½å±CSRFæ¼æ´ï¼ˆå¦‚ç”¨GETåšçŠ¶æ€ä¿®æ”¹ï¼‰ã€ä»¥åŠ SameSite=None çš„è®¾ç½®ä¸å½“éƒ½ä¼šå‰Šå¼±æ•ˆæœã€‚ å»ºè®®ï¼š å¼ºçƒˆæ¨èä¸ºæ‰€æœ‰ä¼šè¯Cookieè®¾ç½® Secure; HttpOnly; SameSite=Laxï¼ˆæˆ–æ›´ä¸¥æ ¼çš„Strictï¼‰ã€‚ ä½œä¸ºåŸºç¡€é˜²å¾¡å±‚ï¼Œå¹¶ä¸å…¶ä»–æªæ–½ï¼ˆå¦‚CSRF","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:6","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["å®‰å…¨"],"content":"å®è·µé˜²å¾¡å»ºè®®æ€»ç»“ é»„é‡‘æ ‡å‡†ï¼š æ ¸å¿ƒé˜²å¾¡ï¼šå¯¹æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼ˆé GETï¼‰å¼ºåˆ¶ä½¿ç”¨ CSRF Tokens + éªŒè¯ï¼ˆåŒ…æ‹¬è¡¨å•å’ŒAJAXï¼‰ã€‚ åŸºç¡€åŠ å›ºï¼šä¸ºä¼šè¯Cookieè®¾ç½® Secure, HttpOnly, SameSite=Laxï¼ˆæˆ–Strictï¼‰ã€‚ æ·±åº¦é˜²å¾¡ï¼š å¯ç”¨åˆç†çš„CORSç­–ç•¥ï¼Œå¹¶è€ƒè™‘å¯¹äºAPIè¯·æ±‚è¦æ±‚ä½¿ç”¨è‡ªå®šä¹‰å®‰å…¨å¤´ (é…åˆCORS)ã€‚ æ£€æŸ¥å…³é”®è¯·æ±‚çš„ Origin å¤´ï¼ˆä½œä¸ºè¡¥å……éªŒè¯ï¼‰ã€‚ é¿å…ä½¿ç”¨ GET è¯·æ±‚è¿›è¡Œä»»ä½•æœ‰çŠ¶æ€æˆ–æ•æ„Ÿçš„æ“ä½œä¿®æ”¹ï¼ˆåº”ä½¿ç”¨ POST, PUT, DELETEï¼‰ã€‚ å®æ–½æœ€å°æƒé™åŸåˆ™ã€‚ ä½¿ç”¨ç°ä»£å®‰å…¨æ¡†æ¶ï¼Œå®ƒä»¬é€šå¸¸å†…ç½®CSRFé˜²æŠ¤ï¼ˆå¦‚Djangoçš„CSRFä¸­é—´ä»¶ï¼ŒSpring Securityçš„CSRFé˜²æŠ¤ï¼‰ã€‚ ç”¨æˆ·ä½“éªŒä¸å®‰å…¨çš„å¹³è¡¡ï¼š SameSite=Lax é€šå¸¸æ˜¯ä¼šè¯Cookieçš„æœ€ä½³è®¾ç½®ã€‚ é€šè¿‡ç»¼åˆè¿ç”¨è¿™äº›æªæ–½ï¼Œå°¤å…¶æ˜¯Token + SameSite=Laxï¼Œå¯ä»¥éå¸¸æœ‰æ•ˆåœ°æŠµå¾¡ç»å¤§å¤šæ•°çš„CSRFæ”»å‡»ï¼Œä¿æŠ¤ç”¨æˆ·è´¦æˆ·å’Œæ•°æ®çš„å®‰å…¨ã€‚å®‰å…¨æ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡çš„è¿‡ç¨‹ï¼Œçºµæ·±é˜²å¾¡æ˜¯å…³é”®ã€‚ ","date":"2025-03-13","objectID":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/:0:7","tags":["å®‰å…¨","Webå®‰å…¨"],"title":"è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFæ”»å‡»çš„åŸç†ä»¥åŠé˜²èŒƒæªæ–½","uri":"/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0csrf%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD/"},{"categories":["OpenSSH"],"content":"èƒŒæ™¯ Linuxæ“ä½œç³»ç»Ÿç¯å¢ƒï¼šCentOS 7.x å‰è¨€\rç”±äºå®‰å…¨æ‰«æä¸åŒä¸»æœºçš„ OpenSSH ç‰ˆæœ¬ä¸ä¸€ï¼Œæœ‰äº›ç‰ˆæœ¬å­˜åœ¨å®‰å…¨æ¼æ´é—®é¢˜ï¼Œç°å°† OpenSSH ç»Ÿä¸€å‡çº§è‡³v9.9p2 ç‰ˆæœ¬ï¼Œè¿™é‡Œè®°å½•ä¸‹æ•´ä¸ªæ“ä½œçš„è¿‡ç¨‹ã€‚ å¦‚æœ OpenSSL ç›¸å¯¹ç‰ˆæœ¬è¾ƒä½ï¼Œè¿™é‡Œå»ºè®®å…ˆå°†OpenSSç‰ˆæœ¬å‡çº§è‡³OpenSSL 1.1.1w 11 Sep 2023ï¼Œç„¶åå†å‡çº§ OpenSSH v9.9p2,å¦‚æœä½ çš„ä¸»æœºå½“å‰çš„OpenSSH ç‰ˆæœ¬ä¸ºv9.9p1ï¼Œåˆ™åŒæ ·å»ºè®®å‡çº§è‡³v9.9p2ï¼Œå› ä¸ºv9.9p1 å«æœ‰ä¸¤ä¸ªä¸­å±æ¼æ´ï¼ŒOpenSSH å®‰å…¨æ¼æ´(CVE-2025-26465 ) å’Œ OpenSSH èµ„æºç®¡ç†é”™è¯¯æ¼æ´(CVE-2025-26466 )ï¼Œæ­¤æ¼æ´åŒæ ·åœ¨ v9.9p2 ç‰ˆæœ¬è¿›è¡Œäº†ä¿®å¤ã€‚ ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:1:0","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"ç›¸å…³å®‰è£…åŒ… åœ°å€\ropensshä¸‹è½½åœ°å€ï¼šhttp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/ opensslä¸‹è½½åœ°å€ï¼šhttps://www.openssl.org/source/ zlibä¸‹è½½åœ°å€ï¼šhttp://www.zlib.net/ openssl-1.1.1w: https://www.openssl.org/source/openssl-1.1.1w.tar.gz\r","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:2:0","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å‡çº§ OpenSSL æŸ¥æ‰¾opensslç›¸å…³ç›®å½•ï¼Œç„¶åå¤‡ä»½ $ whereis openssl #openssl: /usr/bin/openssl /usr/lib64/openssl /usr/include/openssl /usr/share/man/man1/openssl.1ssl.gz $ cp -rp /usr/bin/openssl /usr/bin/openssl`date '+%Y%m%d'` $ cp -rp /usr/lib64/openssl /usr/lib64/openssl`date '+%Y%m%d'` $ cp -rp /usr/include/openssl /usr/include/openssl`date '+%Y%m%d'` ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:3:0","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å¸è½½æ—§ç‰ˆæœ¬ OpenSSL(å¯é€‰) $ yum -y remove openssl ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:3:1","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å®‰è£… OpenSSL v1.1.1w $ wget --inet4-only https://www.openssl.org/source/openssl-1.1.1w.tar.gz $ tar -xzvf openssl-1.1.1w.tar.gz $ cd openssl-1.1.1w/ #ç›®å½•é€‰æ‹©/usrï¼Œå› ä¸ºç³»ç»Ÿæœ€åˆå§‹çš„opensslçš„ç›®å½•å°±æ˜¯/usrï¼Œè¿™æ ·å¯ä»¥çœå»è½¯è¿æ¥ã€æ›´æ–°é“¾æ¥åº“çš„é—®é¢˜ $ ./config --prefix=/usr #å¦‚æœä¸åŠ prefix ,opensslçš„é»˜è®¤è·¯å¾„å¦‚ä¸‹ #Binï¼š /usr/local/bin/openssl #includeåº“ ï¼š/usr/local/include/openssl #libåº“ï¼š/usr/local/lib64/ #engineåº“ï¼š/usr/lib64/openssl/engines #ç¼–è¯‘å®‰è£…,è¿™ä¸¤æ­¥ç›¸å¯¹ä¼šè€—è´¹ç‚¹æ—¶é—´ $ make $ make install ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:3:2","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"éªŒè¯ $ whereis openssl openssl: /usr/bin/openssl /usr/include/openssl /usr/local/openssl /usr/share/man/man1/openssl.1ssl.gz /usr/share/man/man1/openssl.1ossl3.gz /usr/share/man/man1/openssl.1 $ openssl version OpenSSL 1.1.1w 11 Sep 2023 ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:3:3","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å‡çº§ OpenSSH è‡³ v9.9p2 ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:0","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ ä¸åŒç¯å¢ƒçš„ssh ç‰ˆæœ¬ä¼šæœ‰æ‰€ä¸åŒ $ ssh -V OpenSSH_8.0p1, OpenSSL 1.1.1k FIPS 25 Mar 2021 ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:1","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å‡çº§å‰å…ˆå¤‡ä»½ #é€šè¿‡whereis ssh sshdæ‰¾å‡ºbinæ–‡ä»¶ã€æºæ–‡ä»¶ï¼Œç„¶åå¤‡ä»½(manæ‰‹å†Œä¸éœ€è¦å¤‡ä»½) $ whereis ssh sshd #ssh: /usr/bin/ssh /etc/ssh /usr/share/man/man1/ssh.1.gz #sshd: /usr/sbin/sshd /usr/share/man/man8/sshd.8.gz #cp -rp /etc/ssh /etc/ssh`date '+%Y%m%d%H%M%S'` $ cp -rp /etc/ssh /etc/ssh`date '+%Y%m%d'` $ cp -p /usr/bin/ssh /usr/bin/ssh`date '+%Y%m%d'` $ cp -p /usr/sbin/sshd /usr/sbin/sshd`date '+%Y%m%d%'` $ cp -p /etc/ssh/sshd_config /etc/ssh/sshd_config`date '+%Y%m%d'` #å¤‡ä»½paméªŒè¯æ–‡ä»¶ $ cp -p /etc/pam.d/sshd /etc/pam.d/sshd`date '+%Y%m%d'` ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:2","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"å¸è½½æ—§ç‰ˆOpenSSH yum -y remove openssh ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:3","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"OpenSSH ç¦»çº¿å‡çº§ä¸€é”®è„šæœ¬ï¼ˆv9.9p2ï¼‰ vi upgrade_openssh.sh #!/bin/bash # OpenSSH ç¦»çº¿å‡çº§ä¸€é”®è„šæœ¬ï¼ˆv9.9p2ï¼‰ # æ£€æŸ¥æ‰§è¡Œæƒé™ if [[ \"$(whoami)\" != \"root\" ]]; then echo -e \"\\033[31mé”™è¯¯ï¼šå¿…é¡»ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œæ­¤è„šæœ¬ï¼\\033[0m\" \u003e\u00262 exit 1 fi # ç¯å¢ƒæ£€æŸ¥,å¯è‡ªè¡Œè°ƒæ•´ï¼Œå¹¶éCentOS Linux 7.x çš†å¯ check_environment() { echo -e \"\\n\\033[34m[1/7] æ­£åœ¨æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ...\\033[0m\" if ! grep -q \"CentOS Linux release 7.9\" /etc/redhat-release; then echo -e \"\\033[31mé”™è¯¯ï¼šä»…æ”¯æŒ CentOS 7 æ“ä½œç³»ç»Ÿï¼\\033[0m\" # exit 1 fi if [ \"$(uname -m)\" != \"x86_64\" ]; then echo -e \"\\033[31mé”™è¯¯ï¼šä»…æ”¯æŒ 64 ä½ç³»ç»Ÿï¼\\033[0m\" exit 1 fi echo -e \"\\033[32mç¯å¢ƒæ£€æŸ¥é€šè¿‡\\033[0m\" } # å®‰è£…ä¾èµ–åŒ… install_dependencies() { echo -e \"\\n\\033[34m[3/7] å®‰è£…åŸºç¡€ä¾èµ–...\\033[0m\" mkdir /opt/yilai cd /opt/yilai tar -xvf yilai.tar.gz cd yilai rpm -ivh *.rpm --nodeps --force echo -e \"\\033[32mä¾èµ–åŒ…å®‰è£…å®Œæˆ\\033[0m\" } # ç¼–è¯‘å®‰è£… zlib build_zlib() { echo -e \"\\n\\033[34m[4/7] ç¼–è¯‘å®‰è£… zlib...\\033[0m\" cd /opt tar -xvf zlib-1.3.1.tar.gz cd zlib-1.3.1 ./configure --prefix=/usr/local/zlib make \u0026\u0026 make install echo '/usr/local/zlib/lib' \u003e\u003e /etc/ld.so.conf ldconfig -v } # ç¼–è¯‘å®‰è£… OpenSSL build_openssl() { echo -e \"\\n\\033[34m[5/7] ç¼–è¯‘å®‰è£… OpenSSL...\\033[0m\" cd /opt tar -xvf openssl-1.1.1o.tar.gz cd openssl-1.1.1o ./config --prefix=/usr/local/ssl -d shared make \u0026\u0026 make install echo'/usr/local/ssl/lib' \u003e\u003e /etc/ld.so.conf ldconfig -v } # å®‰è£… OpenSSH install_openssh() { echo -e \"\\n\\033[34m[6/7] å‡çº§ OpenSSH åˆ° v9.9p2...\\033[0m\" # å¸è½½æ—§ç‰ˆæœ¬ # rpm -e --nodeps openssh-server openssh openssh-clients 2\u003e/dev/null yum -y remove openssh # ç¼–è¯‘å®‰è£… cd /opt wget --inet4-only https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.9p2.tar.gz tar -xvf openssh-9.9p2.tar.gz cd openssh-9.9p2 ./configure --prefix=/usr/local/openssh \\ --with-zlib=/usr/local/zlib \\ --with-ssl-dir=/usr/local/ssl \\ --without-openssl-header-check make \u0026\u0026 make install # é…ç½®æ–‡ä»¶ #æ£€æŸ¥æ˜¯å¦æœ‰PasswordAuthentication yesï¼Œè‹¥æ²¡æœ‰åˆ™éœ€è¿›è¡Œæ·»åŠ  cat /etc/ssh/sshd_config | grep PasswordAuthentication echo 'PermitRootLogin yes' \u003e\u003e /usr/local/openssh/etc/sshd_config echo 'PubkeyAuthentication yes' \u003e\u003e /usr/local/openssh/etc/sshd_config echo 'PasswordAuthentication yes' \u003e\u003e /usr/local/openssh/etc/sshd_config echo 'UsePAM yes' \u003e\u003e /usr/local/openssh/etc/sshd_config echo 'HostKeyAlgorithms ssh-rsa,ssh-dss ' \u003e\u003e /etc/ssh/sshd_config cp /usr/local/openssh/etc/sshd_config /etc/ssh/sshd_config # è¿˜åŸå¤‡ä»½çš„sshd_config(äºŒé€‰ä¸€) # /usr/bin/cp -fp /etc/ssh/sshd_config`date '+%Y%m%d'` /etc/ssh/sshd_config # æ›¿æ¢ç³»ç»Ÿå‘½ä»¤ï¼ˆä¿®å¤å…³é”®ç‚¹ï¼‰ if [ -f /usr/sbin/sshd ]; then mv /usr/sbin/sshd /usr/sbin/sshd.bak fi cp -f /usr/local/openssh/sbin/sshd /usr/sbin/sshd # ä½¿ç”¨æ–°ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ # ä¿®å¤æƒé™ chmod 755 /usr/sbin/sshd cp /usr/local/openssh/bin/ssh-keygen /usr/bin/ssh-keygen # å¤åˆ¶ ssh å‘½ä»¤ cp /usr/local/openssh/bin/ssh /usr/bin/ssh chmod 755 /usr/bin/ssh # å¯åŠ¨è„šæœ¬ cp -p contrib/redhat/sshd.init /etc/init.d/sshd chmod +x /etc/init.d/sshd chkconfig --add sshd chkconfig sshd on } # æœ€ç»ˆéªŒè¯ final_check() { echo -e \"\\n\\033[34m[7/7] æ‰§è¡Œæœ€ç»ˆæ£€æŸ¥...\\033[0m\" systemctl daemon-reload systemctl restart sshd ssh -V 2\u003e\u00261 | grep -q \"OpenSSH_9.9p2\" if [ $? -eq 0 ]; then echo -e \"\\033[32må‡çº§æˆåŠŸï¼å½“å‰SSHç‰ˆæœ¬ï¼š$(ssh -V 2\u003e\u00261)\\033[0m\" echo -e \"\\033[33mè­¦å‘Šï¼šè¯·é€šè¿‡æ–°SSHç«¯å£è¿æ¥ç¡®è®¤æ— è¯¯åï¼Œå†å…³é—­TelnetæœåŠ¡ï¼\\033[0m\" else echo -e \"\\033[31mé”™è¯¯ï¼šå‡çº§å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ï¼\\033[0m\" exit 1 fi } # ä¸»æ‰§è¡Œæµç¨‹,å»ºè®®åˆ†æ­¥æ‰§è¡Œ main() { check_environment install_dependencies build_zlib build_openssl install_openssh final_check } # æ‰§è¡Œä¸»å‡½æ•° main ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:4","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"æ‰§è¡Œ $ chmod +x upgrade_openssh.sh $ ./upgrade_openssh.sh ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:5","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["OpenSSH"],"content":"éªŒè¯ $ ssh -V # åº”æ˜¾ç¤º \"OpenSSH_9.9p2\" OpenSSH_9.9p2, OpenSSL 1.1.1j 16 Feb 2021 $ systemctl status sshd ","date":"2025-02-21","objectID":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/:4:6","tags":["OpenSSH"],"title":"OpenSSH v9.9p2æºç ç¦»çº¿ä¸€é”®å‡çº§","uri":"/openssh_v9.9p2%E6%BA%90%E7%A0%81%E7%A6%BB%E7%BA%BF%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7/"},{"categories":["GPU"],"content":"èƒŒæ™¯ éƒ¨ç½²é€šä¹‰åƒé—®å¤§æ¨¡å‹qwen2.5-7b-awqåŸºç¡€ç¯å¢ƒé¢„å®‰è£… ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:1:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"æœåŠ¡å™¨é…ç½® æ“ä½œç¯å¢ƒï¼šopenEuler 22.03 (æ¬§æ‹‰-LTS-SP1) cpu: 40c memory: 186G disk: 2T GPUç‰©ç†æœºï¼Œæ˜¾å¡å‹å·ä¸ºNVIDIA Tesla T4 (Tesla T4 è¢«å¹¿æ³›åº”ç”¨äºäº‘ç«¯æ¨ç†æœåŠ¡ã€è™šæ‹Ÿæ¡Œé¢åŸºç¡€è®¾æ–½(VDI)ã€è§†é¢‘è½¬ç ç­‰é¢†åŸŸ) æŸ¥çœ‹ GPU å‹å· $ ls /proc/driver/nvidia/gpus/ 0000:3b:00.0 $ cat 0000\\:3b\\:00.0/information Model: Tesla T4 IRQ: 218 GPU UUID: GPU-e42994d9-5240-0163-fbf5-deb9d57a348c Video BIOS: 90.04.38.00.03 Bus Type: PCIe DMA Size: 47 bits DMA Mask: 0x7fffffffffff Bus Location: 0000:3b:00.0 Device Minor: 0 GPU Firmware: 570.124.06 GPU Excluded: No ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:2:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"æ£€æµ‹ä¸»æœºæ˜¯å¦ä¸ºè™šæ‹ŸåŒ–ç¯å¢ƒ systemd-detect-virt æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ£€æµ‹è™šæ‹ŸåŒ–ç¯å¢ƒçš„å·¥å…·ã€‚ systemd-detect-virt å¦‚æœæ˜¯ç‰©ç†æœºï¼Œè¾“å‡ºä¸ºï¼š none å¦‚æœæ˜¯è™šæ‹Ÿæœºï¼Œè¾“å‡ºå¯èƒ½æ˜¯ï¼š kvm vmware virtualbox xen ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:2:1","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"1. æ£€æŸ¥ä»“åº“æº # debian $ sudo apt install -y g++ gcc gcc-c++ make build-essential pciutils bzip2 dkms # redhat $ sudo yum install -y g++ gcc gcc-c++ make pciutils bzip2 dkms æŸ¥çœ‹æ˜¯å¦å·²å®‰è£…gccå’Œpicutils # éªŒè¯ç³»ç»Ÿæ˜¯å¦æœ‰GCCç¼–è¯‘ç¯å¢ƒ $ gcc --version $ lspci æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬å’ŒGPU $ uname -a # æŸ¥æ‰¾ä¸ NVIDIA ç›¸å…³çš„ç¡¬ä»¶è®¾å¤‡æ˜¾å¡ $ lspci | grep -i nvidia ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:3:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å†…æ ¸ç‰ˆæœ¬æ£€æŸ¥ Redhat $ uname -r 3.10.0-1160.119.1.el7.x86_64 $ yum list installed|grep kernel kernel-headers-3.10.0-1160.108.1.el7.x86_64 kernel-devel-3.10.0-1160.71.1.el7.x86_64 kernel-3.10.0-1160.119.1.el7.x86_64 kernel-3.10.0-1160.el7.x86_64 kernel-tools-libs-3.10.0-1160.119.1.el7.x86_64 kernel-tools-3.10.0-1160.119.1.el7.x86_64 æ³¨æ„\ræŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™è·³è¿‡é‡æ–°å®‰è£…ï¼Œä¸åŒ¹é…éœ€è¦é‡æ–°å®‰è£…è¿›è¡ŒåŒ¹é…\råœ¨çº¿å®‰è£… # optionalå¯é€‰ sudo yum remove kernel-devel-$(uname -r) kernel-headers-$(uname -r) # å®‰è£… sudo yum install kernel-devel-$(uname -r) kernel-headers-$(uname -r) ç¦»çº¿å®‰è£…ä¸‹è½½centosæºç åŒ… develåœ°å€ï¼šhttp://rpmfind.net/linux/rpm2html/search.php?query=kernel-devel headersåœ°å€ï¼šhttp://rpmfind.net/linux/rpm2html/search.php?query=kernel-headers å®‰è£… $ rpm -ivh kernel-devel-3.10.0-1160.119.1.el7.x86_64.rpm --nodeps --force $ rpm -ivh kernel-rpm -ivh kernel-headers-3.10.0-1160.119.1.el7.x86_64.rpm --force ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:3:1","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"2. æ£€æŸ¥æ˜¾å¡ æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯å’Œé©±åŠ¨ä¿¡æ¯ # æŸ¥çœ‹ä¸»æ˜¾å¡æ˜¯å“ªä¸€ä¸ª # ä¸ºäº†æŸ¥çœ‹nvidia æ˜¾å¡ï¼Œå¯ä»¥å®‰è£…nvidia-detect,å¹¶è¿è¡Œæ­¤è½¯ä»¶ # debian $ apt-get install nvidia-detect # Redhat $ lspci |grep -i vga 03:00.0 VGA compatible controller: ASPEED Technology, Inc. ASPEED Graphics Family (rev 41) # æŸ¥æ‰¾ä¸ VGAï¼ˆè§†é¢‘å›¾å½¢é˜µåˆ—ï¼‰å…¼å®¹çš„æ˜¾ç¤ºæ§åˆ¶å™¨çš„ä¿¡æ¯ $ lspci -s 03:00.0 -v 03:00.0 VGA compatible controller: ASPEED Technology, Inc. ASPEED Graphics Family (rev 41) (prog-if 00 [VGA controller]) DeviceName: Onboard IGD Subsystem: ASPEED Technology, Inc. ASPEED Graphics Family Flags: bus master, medium devsel, latency 0, IRQ 17, NUMA node 0 Memory at 98000000 (32-bit, non-prefetchable) [size=64M] Memory at 9c000000 (32-bit, non-prefetchable) [size=128K] I/O ports at 2000 [size=128] Expansion ROM at 000c0000 [virtual] [disabled] [size=128K] Capabilities: [40] Power Management version 3 Capabilities: [50] MSI: Enable- Count=1/2 Maskable- 64bit+ Kernel driver in use: ast Kernel modules: ast ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:4:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"3. å®‰è£… å®‰è£…å…ˆæ£€æŸ¥æœ‰æ²¡æœ‰ cuda æ”¯æŒçš„GPU $ lspci | grep -i nvidia 3b:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1) ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"Nouveauå¼€æºå›¾å½¢é©±åŠ¨ç¦ç”¨ åé¢å®‰è£…æ—¶çš„å‘Šè­¦ä¿¡æ¯ï¼Œæå‰é¢„çŸ¥ WARNING: The Nouveau kernel driver is currently in use by your system. This driver is incompatible with the NVIDIA driverï¼Œand must be disabled before proceeding. è­¦å‘Šï¼šæ‚¨çš„ç³»ç»Ÿå½“å‰æ­£åœ¨ä½¿ç”¨Nouveauå†…æ ¸é©±åŠ¨ç¨‹åºã€‚æ­¤é©±åŠ¨ç¨‹åºä¸NVIDIAé©±åŠ¨ç¨‹åºä¸å…¼å®¹ï¼Œå¿…é¡»å…ˆç¦ç”¨æ‰èƒ½ç»§ç»­ã€‚ è§£é‡Šï¼š Nouveauæ˜¯ç”±ç¬¬ä¸‰æ–¹ä¸ºNVIDIAæ˜¾å¡æä¾›çš„å¼€æºå›¾å½¢é©±åŠ¨ï¼Œä½†å®ƒä¸NVIDIAå®˜æ–¹æä¾›çš„é©±åŠ¨å¯èƒ½ä¸å…¼å®¹ï¼Œå°¤å…¶åœ¨è¿è¡Œç‰¹å®šçš„æ¸¸æˆæˆ–åº”ç”¨ç¨‹åºæ—¶å¯èƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚å¦‚æœç³»ç»ŸæŠ¥å‘ŠNouveaué©±åŠ¨æ­£åœ¨ä½¿ç”¨ä¸­ï¼Œå¯èƒ½æ„å‘³ç€ä½ çš„ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨NVIDIAå®˜æ–¹æä¾›çš„é©±åŠ¨ï¼Œè¿™å¯èƒ½ä¼šé™ä½å›¾å½¢æ€§èƒ½æˆ–è€…å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šã€‚ è§£å†³æ–¹æ³•ï¼š ç¦ç”¨Nouveaué©±åŠ¨ï¼š Nouveau æ˜¯ä¸€ä¸ªå¼€æºçš„å›¾å½¢é©±åŠ¨ç¨‹åºï¼Œç”¨äºæ”¯æŒ NVIDIA æ˜¾å¡åœ¨ Linux ç³»ç»Ÿä¸Šçš„ä½¿ç”¨ã€‚å®ƒæ˜¯ç”±ç¤¾åŒºå¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›å¯¹ NVIDIA æ˜¾å¡çš„å¼€æºé©±åŠ¨æ”¯æŒï¼Œä»¥ä¾¿åœ¨ Linux ç³»ç»Ÿä¸Šå®ç°å›¾å½¢åŠ é€Ÿå’Œå…¶ä»–ç›¸å…³åŠŸèƒ½ã€‚åœ¨å®‰è£…ä¸“æœ‰çš„ NVIDIA é©±åŠ¨ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦ç¦ç”¨ Nouveau é©±åŠ¨ åˆ›å»ºæ–‡ä»¶/etc/modprobe.d/blacklist-nouveau.confï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # æŸ¥çœ‹nouveau æ˜¯å¦è¢«ç¦ç”¨ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œåˆ™è¯´æ˜ Nouveau å·²è¢«æˆåŠŸç¦ç”¨ $ lsmod | grep nouveau nouveau 2424832 0 mxm_wmi 16384 1 nouveau video 61440 1 nouveau ttm 118784 3 drm_vram_helper,drm_ttm_helper,nouveau drm_kms_helper 286720 5 drm_vram_helper,ast,nouveau drm 638976 7 drm_kms_helper,drm_vram_helper,ast,drm_ttm_helper,ttm,nouveau i2c_algo_bit 16384 3 igb,ast,nouveau wmi 36864 2 mxm_wmi,nouveau # ä»æœªæ‰‹åŠ¨ç¦ç”¨ Nouveau é©±åŠ¨ç¨‹åºï¼ˆå¼€æºçš„ NVIDIA æ˜¾å¡é©±åŠ¨ï¼‰ï¼Œåˆ™è¯¥æ–‡ä»¶ä¸ä¼šå­˜åœ¨ï¼Œç›´æ¥æ·»åŠ é…ç½®å†…å®¹å³å¯ $ sudo vi /etc/modprobe.d/blacklist-nouveau.conf #å°†nvidiafbæ³¨é‡Šæ‰: #blacklist nvidiafb # æ·»åŠ ä»¥ä¸‹å†…å®¹ blacklist nouveau options nouveau modeset=0 ç¦ç”¨Nouveaué©±åŠ¨åæ›´æ–°initramfsï¼š ä¿®æ”¹æ¨¡å—é»‘åå•åï¼Œéœ€è¦æ›´æ–° initramfs ä»¥ç¡®ä¿æ›´æ”¹ç”Ÿæ•ˆ # debian sudo update-initramfs -u # redhat sudo dracut --force å¤‡ä»½å½“å‰çš„é•œåƒå¹¶å»ºç«‹æ–°çš„é•œåƒ #å¤‡ä»½å½“å‰çš„é•œåƒ $ sudo mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.bak #å»ºç«‹æ–°çš„é•œåƒ $ sudo dracut /boot/initramfs-$(uname -r).img $(uname -r) # é‡å¯,ä¸é‡å¯ Nouveau æ¨¡å—å¯èƒ½ä»ç„¶è¢«åŠ è½½åˆ°å†…æ ¸ä¸­ï¼Œå½±å“nvidia é©±åŠ¨çš„å®‰è£… $ sudo reboot #æœ€åè¾“å…¥ä¸Šé¢çš„å‘½ä»¤éªŒè¯ $ lsmod | grep nouveau è¦å¸è½½nouveaué©±åŠ¨å¹¶æ¸…é™¤ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š(å¯é€‰) ç¦ç”¨æ‰å³å¯ # debian sudo apt-get remove --purge nouveau # redhat sudo yum t remove --purge nouveau ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:1","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å®‰è£…Nvidiaé©±åŠ¨ GPU äº‘æœåŠ¡å™¨æ­£å¸¸å·¥ä½œéœ€å®‰è£…æ­£ç¡®çš„åŸºç¡€è®¾æ–½è½¯ä»¶ï¼Œå¯¹ NVIDIA ç³»åˆ— GPU è€Œè¨€ï¼Œæœ‰ä¸¤ä¸ªå±‚æ¬¡çš„è½¯ä»¶åŒ…éœ€è¦å®‰è£…ï¼š é©±åŠ¨ GPU å·¥ä½œçš„ç¡¬ä»¶é©±åŠ¨ç¨‹åºã€‚ ä¸Šå±‚åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„åº“ã€‚ è‹¥æŠŠ NVIDIA GPU ç”¨ä½œé€šç”¨è®¡ç®—ï¼Œéœ€è¦å®‰è£… GeForce Driver + CUDAã€‚ å¤„ç† Secure Bootï¼ˆå¯é€‰ï¼‰ è‹¥ç³»ç»Ÿå¯ç”¨ Secure Bootï¼Œéœ€ä¸º NVIDIA å†…æ ¸æ¨¡å—ç­¾åæˆ–ç¦ç”¨ Secure Bootï¼ˆéœ€è¿›å…¥ BIOS è®¾ç½®ï¼‰ã€‚ ç¦ç”¨ Secure Boot ä¼šé™ä½ç³»ç»Ÿå¯¹æ¶æ„å†…æ ¸ä»£ç çš„é˜²æŠ¤èƒ½åŠ›ï¼Œä½†å…è®¸åŠ è½½æœªç­¾åçš„é©±åŠ¨ï¼ˆå¦‚ NVIDIA é©±åŠ¨ï¼‰ æ–¹æ³•1. æ£€æŸ¥æ˜¯å¦å¯ç”¨ Secure Boot # å®‰è£… mokutilï¼ˆå¦‚æœæœªå®‰è£…ï¼‰ $ sudo yum install mokutil -y # æŸ¥çœ‹ Secure Boot çŠ¶æ€ $ sudo mokutil --sb-state SecureBoot disabled Platform is in Setup Mode è¾“å‡ºç»“æœï¼š SecureBoot enabled è¡¨ç¤ºå·²å¯ç”¨ã€‚ SecureBoot disabled è¡¨ç¤ºå·²ç¦ç”¨ã€‚ æ–¹æ³•2.æ£€æŸ¥ UEFI å˜é‡æ–‡ä»¶ # ç¡®è®¤ç³»ç»Ÿä½¿ç”¨ UEFI å¯åŠ¨ï¼ˆéä¼ ç»Ÿ BIOSï¼‰ ls /sys/firmware/efi # æŸ¥çœ‹ Secure Boot çŠ¶æ€ cat /sys/firmware/efi/efivars/SecureBoot-* 2\u003e/dev/null è¾“å‡º 1 è¡¨ç¤ºå¯ç”¨ï¼Œ0 è¡¨ç¤ºç¦ç”¨ã€‚ ç¦ç”¨ Secure Boot Secure Boot æ˜¯ UEFI å›ºä»¶çš„åŠŸèƒ½ï¼Œç¦ç”¨éœ€è¿›å…¥ä¸»æ¿çš„ BIOS/UEFI è®¾ç½®ç•Œé¢ã€‚ä»¥ä¸‹æ˜¯é€šç”¨æ­¥éª¤ï¼š æ­¥éª¤ 1ï¼šé‡å¯å¹¶è¿›å…¥ BIOS/UEFI è®¾ç½® é‡å¯è®¡ç®—æœºï¼Œåœ¨å¼€æœºè‡ªæ£€ç•Œé¢æŒ‰ä¸‹ ç‰¹å®šæŒ‰é”®ï¼ˆå¸¸è§æŒ‰é”®ï¼šF2ã€F10ã€Delã€Escï¼Œå…·ä½“å–å†³äºä¸»æ¿å‹å·ï¼‰ã€‚ å¯¹äºè™šæ‹Ÿæœºï¼ˆå¦‚ VMware/VirtualBoxï¼‰ï¼Œéœ€åœ¨å¯åŠ¨æ—¶æŒ‰ Esc æˆ– F2 è¿›å…¥è®¾ç½®ã€‚ ** æ­¥éª¤ 2ï¼šæ‰¾åˆ° Secure Boot é€‰é¡¹** åœ¨ BIOS/UEFI ç•Œé¢ä¸­ï¼Œå¯¼èˆªåˆ° Security æˆ– Boot é€‰é¡¹å¡ã€‚ æŸ¥æ‰¾ Secure Boot é€‰é¡¹ï¼ˆå¯èƒ½ä½äº Advanced æˆ– Authentication å­èœå•ä¸­ï¼‰ã€‚ æ­¥éª¤ 3ï¼šç¦ç”¨ Secure Boot å°† Secure Boot è®¾ä¸º Disabledã€‚ ä¿å­˜è®¾ç½®å¹¶é€€å‡ºï¼ˆé€šå¸¸æŒ‰ F10 æˆ–é€‰æ‹© Save \u0026 Exitï¼‰ã€‚ æ­¥éª¤ 4ï¼šéªŒè¯ç¦ç”¨ç»“æœ é‡å¯åå›åˆ° CentOS 7ï¼Œå†æ¬¡è¿è¡Œæ£€æŸ¥å‘½ä»¤ï¼ˆå¦‚ sudo mokutil --sb-stateï¼‰ï¼Œç¡®è®¤è¾“å‡ºä¸º SecureBoot disabledã€‚ å®‰è£…é©±åŠ¨åç¼€åˆ†ä¸º.runå’Œ.rpm 1.æ‰“å¼€ NVIDIA é©±åŠ¨ä¸‹è½½é“¾æ¥ Advanced Driver Search | NVIDIA ã€‚ 2.é€‰æ‹©æ”¯æŒ RPM æˆ–è€…RUNçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶è·å–è¯¥åŒ…çš„ä¸‹è½½é“¾æ¥ã€‚ä¾‹å¦‚ï¼šé€‰æ‹© CentOS 7.xï¼Œ å¾—åˆ°ä¸‹è½½é“¾æ¥ï¼šDownload NVIDIA, GeForce, Quadro, and Tesla Drivers å¯é€‰å®‰è£… å®‰è£…NVIDIAå®˜æ–¹é©±åŠ¨ å…³é—­å›¾å½¢ç•Œé¢ä»¥é¿å…å†²çªï¼š sudo systemctl isolate multi-user.target è¿è¡Œå®‰è£…è„šæœ¬ï¼š ç¡®å®šä½ çš„æ˜¾å¡å‹å·ã€‚ ä»NVIDIAå®˜ç½‘ä¸‹è½½å¯¹åº”æ˜¾å¡çš„é©±åŠ¨ç¨‹åºã€‚ å®‰è£…é©±åŠ¨è¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡ç« ï¼š $ chmod +x NVIDIA-Linux-x86_64-(ç‰ˆæœ¬å·).run $ sudo ./NVIDIA-Linux-x86_64-570.124.06.run 1: Multiple kernel module types are available for this system. Which would you like to use? - é€‰æ‹© NVIDIA Proprietary 2. Building kernel modules è¿›åº¦æ¡... 3. WARNING: nvidia-installer was forced to guess the X library path '/usr/lib64' and X module path '/usr/lib64/xorg/modules'; these paths were not queryable from the system. If X fails to find the NVIDIA X driver module, please install the `pkg-config` utility and the X.Org SDK/development package for your distribution and reinstall the driver. è­¦å‘Šå¯ä»¥å¿½ç•¥ 4. Install NVIDIA's 32-bit compatibility libraries? æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©,è¿™é‡Œé€‰æ‹©å…¼å®¹ 5. Would you like to register the kernel module sources with DKMS? This will allow DKMS to automatically build a new module, if your kernel changes later. é€‰æ‹©YES 6. Registering the kernel modules with DKMS: è¿›åº¦æ¡... 7. Installation of the NVIDIA Accelerated Graphics Driver for Linux-x86_64 (version: 570.124.06) is now complete. å®‰è£…å®Œæˆ æŒ‰æç¤ºæ“ä½œï¼Œé€‰æ‹©ä»¥ä¸‹é€‰é¡¹ï¼š Yes å®‰è£… DKMSï¼ˆéœ€æå‰å®‰è£… dkms åŒ…ï¼‰ã€‚å‰é¢æ­¥éª¤å·²ç»æå‰é¢„å®‰è£… Yes è¦†ç›–å·²æœ‰çš„ Nouveau é…ç½®ã€‚ Yes å®‰è£… 32 ä½å…¼å®¹åº“ï¼ˆå¦‚éœ€ï¼‰ã€‚ å¤‡æ³¨ï¼š DKMS: DKMSï¼ˆDynamic Kernel Module Supportï¼‰æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºåœ¨å†…æ ¸æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘å’Œå®‰è£…å†…æ ¸æ¨¡å—ã€‚ Would you like to register the kernel module sources with DKMS? This will allow DKMS to automatically build a new module when a new kernel is installed. è¿™æ˜¯è¯¢é—®æ‚¨æ˜¯å¦å¸Œæœ›å°† NVIDIA é©±åŠ¨æ¨¡å—æ³¨å†Œåˆ° DKMSï¼ˆDynamic Kernel Module Supportï¼‰ä¸­ã€‚ å¦‚æœé€‰æ‹©â€œæ˜¯â€ï¼ŒDKMS å°†è‡ªåŠ¨ä¸ºæœªæ¥çš„å†…æ ¸ç‰ˆæœ¬é‡æ–°ç¼–è¯‘å’Œå®‰è£… NVIDIA é©±åŠ¨æ¨¡å—ã€‚ X.Org æ˜¯å¦ä¿®æ”¹ X.Org é…ç½®æ–‡ä»¶ Would you like to run the nvidia-xconfig utility to automatically update your X configuration file so that the NVIDIA X driver is used when you restart X? å¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨å›¾å½¢ç•Œé¢ï¼Œå»ºè®®é€‰æ‹©â€œæ˜¯â€ã€‚è¿™å°†ç¡®ä¿ X Server å¯åŠ¨æ—¶ä½¿ç”¨ NVIDIA é©±åŠ¨ã€‚ 32ä½å…¼å®¹åº“ å¦‚æœæ‚¨åœ¨ä¸€ä¸ª 64 ä½ç³»ç»Ÿä¸Šå®‰è£…é©±åŠ¨ï¼Œå®‰è£…ç¨‹åºå¯èƒ½ä¼šè¯¢é—®æ˜¯å¦å®‰è£… 32 ä½å…¼å®¹åº“ï¼š Install NVIDIA's 32-bit compatibility libraries? å¦‚æœæ‚¨éœ€è¦è¿è¡Œ 32 ä½åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚æŸäº›æ¸¸æˆæˆ–æ—§ç‰ˆè½¯ä»¶ï¼‰ï¼Œè¯·é€‰æ‹©â€œæ˜¯â€ã€‚ ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:2","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å®‰è£…æŠ¥é”™ ERROR: Unable to find the kernel source tree for the currently running kernel. Please make sure you have installed the kernel source files for your kernel and that they are properly configured; on Red Hat Linux systems, for example, be sure you have the 'kernel-source' or 'kernel-devel' RPM installed. If you know the correct kernel source files are installed, you may specify the kernel source path with the '--kernel-source-path' command line option. æŸ¥çœ‹ä¸€ä¸‹å†…æ ¸ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:3","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"éªŒè¯å®‰è£… é‡æ–°å¯åŠ¨ç³»ç»Ÿ $ sudo reboot # æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ï¼ŒéªŒè¯é©±åŠ¨æ˜¯å¦å·²æˆåŠŸå®‰è£… # æ£€æŸ¥ä¸»æœº GPU å’Œ NVIDIA é©±åŠ¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè¿”å› GPU çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚å‹å·ã€é©±åŠ¨ç‰ˆæœ¬ã€æ˜¾å­˜ä½¿ç”¨æƒ…å†µç­‰ï¼‰ï¼Œè¯´æ˜é©±åŠ¨å®‰è£…æˆåŠŸ $ nvidia-smi # æ˜¾ç¤º GPU çŠ¶æ€ Tue Mar 25 16:23:30 2025 +-----------------------------------------------------------------------------------------+ | NVIDIA-SMI 570.124.06 Driver Version: 570.124.06 CUDA Version: 12.8 | |-----------------------------------------+------------------------+----------------------+ | GPU Name Persistence-M | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap | Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |=========================================+========================+======================| | 0 Tesla T4 Off | 00000000:3B:00.0 Off | 0 | | N/A 70C P0 32W / 70W | 1MiB / 15360MiB | 4% Default | | | | N/A | +-----------------------------------------+------------------------+----------------------+ +-----------------------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=========================================================================================| | No running processes found | +-----------------------------------------------------------------------------------------+ # æ£€æŸ¥ NVIDIA æ¨¡å—æ˜¯å¦åŠ è½½ $ lsmod | grep nvidia # ç¡®è®¤æ¨¡å—å·²åŠ è½½ # æŸ¥çœ‹ GPU èµ„æºçš„ä½¿ç”¨æƒ…å†µ $ nvidia-smi pmon -s u -d 1 # gpu pid type sm mem enc dec jpg ofa command # Idx # C/G % % % % % % name 0 43043 C 0 0 - - - - funasr-wss-serv 0 43043 C 0 0 - - - - funasr-wss-serv æ³¨æ„\réœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡å®‰è£…æ˜¾å¡é©±åŠ¨çš„è¯ï¼Œæ˜¯ä¸ç”¨é‡å¯æœåŠ¡å™¨çš„ï¼Œåç»­æ›´æ–°é©±åŠ¨ç‰ˆæœ¬çš„è¯ï¼Œåˆ™æ˜¯éœ€è¦çš„ã€‚ä½†æ˜¯å»ºè®®ç¬¬ä¸€æ¬¡å®‰è£…é©±åŠ¨ä¹‹åï¼Œæœ€å¥½è¿˜æ˜¯é‡å¯ä¸‹ï¼Œé˜²æ­¢æ„å¤–æƒ…å†µçš„å‡ºç°å’Œå‘ç”Ÿã€‚\r","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:4","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å®‰è£… CUDAï¼ˆå¯é€‰ï¼‰ CUDA (Compute Unified Device Architecture) æ˜¯æ˜¾å¡å‚å•† NVIDIA æ¨å‡ºçš„è¿ç®—å¹³å°ã€‚ CUDAâ„¢ æ˜¯ä¸€ç§ç”± NVIDIA æ¨å‡ºçš„é€šç”¨å¹¶è¡Œè®¡ç®—æ¶æ„ï¼Œè¯¥æ¶æ„ä½¿ GPU èƒ½å¤Ÿè§£å†³å¤æ‚çš„è®¡ç®—é—®é¢˜ã€‚ å®ƒåŒ…å«äº† CUDA æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰ä»¥åŠ GPU å†…éƒ¨çš„å¹¶è¡Œè®¡ç®—å¼•æ“ã€‚ å¼€å‘äººå‘˜ç°åœ¨å¯ä»¥ä½¿ç”¨ C è¯­è¨€, C++ , FORTRAN æ¥ä¸º CUDAâ„¢ æ¶æ„ç¼–å†™ç¨‹åºï¼Œæ‰€ç¼–å†™å‡ºçš„ç¨‹åºå¯ä»¥åœ¨æ”¯æŒ CUDAâ„¢ çš„å¤„ç†å™¨ä¸Šä»¥è¶…é«˜æ€§èƒ½è¿è¡Œã€‚ GPU äº‘æœåŠ¡å™¨é‡‡ç”¨ NVIDIA æ˜¾å¡ï¼Œéœ€è¦å®‰è£… CUDA å¼€å‘è¿è¡Œç¯å¢ƒã€‚ 1.CUDAé©±åŠ¨ä¸‹è½½ 2.é€‰æ‹©æ“ä½œç³»ç»Ÿå’Œå®‰è£…åŒ…ï¼Œä»¥CentOS 7ä¸ºä¾‹ Installation Instructions: `sudo rpm -i cuda-repo-rhel7-7-5-local-7.5-18.x86_64.rpm` `sudo yum clean all` `sudo yum install cuda` åœ¨/usr/local/cuda/samples/1_Utilities/deviceQueryç›®å½•ä¸‹ï¼Œæ‰§è¡Œmakeå‘½ä»¤ï¼Œå¯ä»¥ç¼–è¯‘å‡ºdeviceQueryç¨‹åºã€‚ $ cd /usr/local/cuda/samples/1_Utilities/deviceQuery $ make æ‰§è¡ŒdeviceQueryæ­£å¸¸æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯ï¼Œæ­¤åˆ»è®¤ä¸ºCUDAå®‰è£…æ­£ç¡®ã€‚ æ³¨æ„\rå¦‚æœä½¿ç”¨rpmæ–‡ä»¶æŠ¥é”™ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨runæ–‡ä»¶è¿›è¡Œå®‰è£…(runfile(local))\r# ä¸‹è½½runæ–‡ä»¶è¿›è¡Œå®‰è£… sh cuda_*.run å»ºè®®æœ€å¥½ä¸è¦ä½¿ç”¨GUIå›¾å½¢åŒ–ç•Œé¢æ“ä½œï¼Œå®¹æ˜“æŠ¥é”™ã€‚ é©±åŠ¨ç¨‹åºå’Œ CUDA çš„å…³ç³»ï¼š å¯ä»¥æŠŠ é©±åŠ¨ç¨‹åºï¼ˆDriverï¼‰ å’Œ CUDA æƒ³è±¡æˆ â€œæ±½è½¦å¼•æ“â€ å’Œ â€œèµ›è½¦é…ä»¶åŒ…â€ çš„å…³ç³»ï¼š é©±åŠ¨ç¨‹åºï¼ˆDriverï¼‰ï¼š å°±åƒæ±½è½¦çš„ å¼•æ“ï¼Œå®ƒè®© GPU ç¡¬ä»¶èƒ½å¤Ÿè¢«æ“ä½œç³»ç»Ÿè¯†åˆ«å¹¶åŸºç¡€è¿è¡Œï¼ˆå¦‚æ˜¾ç¤ºç”»é¢ã€åŸºç¡€è®¡ç®—ï¼‰ã€‚æ²¡æœ‰å¼•æ“ï¼Œæ±½è½¦æ ¹æœ¬æ— æ³•å¯åŠ¨ã€‚ CUDAï¼š åˆ™åƒä¸€å¥— èµ›è½¦ä¸“ç”¨é…ä»¶åŒ…ï¼ˆå¦‚æ¶¡è½®å¢å‹ã€é«˜æ€§èƒ½å˜é€Ÿç®±ã€èµ›ç”¨è½®èƒç­‰ï¼‰ï¼Œå®ƒæä¾›äº†å¼€å‘é«˜æ€§èƒ½è®¡ç®—ç¨‹åºæ‰€éœ€çš„å·¥å…·å’Œæ¥å£ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—åº“ã€ç¼–è¯‘å™¨ï¼‰ã€‚åªæœ‰å®‰è£…äº† CUDAï¼Œä½ æ‰èƒ½åˆ©ç”¨ GPU çš„ç®—åŠ›åšæ·±åº¦å­¦ä¹ ã€ç§‘å­¦è®¡ç®—ç­‰å¤æ‚ä»»åŠ¡ã€‚ æ˜¯å¦éœ€è¦å®‰è£… CUDAï¼Ÿå–å†³äºä½ çš„éœ€æ±‚ å¦‚æœåªç”¨ GPU æ˜¾ç¤ºå›¾å½¢ï¼ˆå¦‚æ—¥å¸¸åŠå…¬ã€æ¸¸æˆï¼‰ï¼š å®‰è£…é©±åŠ¨ç¨‹åºå°±å¤Ÿäº†ï¼Œä¸éœ€è¦ CUDAã€‚ å¦‚æœè¦åš GPU è®¡ç®—ï¼ˆå¦‚æ·±åº¦å­¦ä¹ ã€ç§‘å­¦è®¡ç®—ï¼‰ï¼š å¿…é¡»å®‰è£… CUDAï¼Œå› ä¸ºï¼š æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆPyTorchã€TensorFlowï¼‰ä¾èµ– CUDA è°ƒç”¨ GPU ç®—åŠ›ã€‚ CUDA æä¾›äº† nvcc ç¼–è¯‘å™¨ã€cuBLAS ç­‰åŠ é€Ÿåº“ï¼Œæ˜¯å¼€å‘ GPU ç¨‹åºçš„åŸºçŸ³ã€‚ é©±åŠ¨å’Œ CUDA çš„ç‰ˆæœ¬ä¾èµ–å…³ç³» CUDA ç‰ˆæœ¬ä¾èµ–é©±åŠ¨ç¨‹åºç‰ˆæœ¬ï¼š æ¯ä¸ª CUDA ç‰ˆæœ¬éœ€è¦ æœ€ä½ç‰ˆæœ¬çš„é©±åŠ¨ç¨‹åº æ”¯æŒï¼ˆè§ NVIDIA CUDA æ–‡æ¡£ï¼‰ã€‚ä¾‹å¦‚ï¼š CUDA 12.x éœ€è¦é©±åŠ¨ç‰ˆæœ¬ â‰¥ 525.60.13 CUDA 11.x éœ€è¦é©±åŠ¨ç‰ˆæœ¬ â‰¥ 450.80.02 ä½ å®‰è£…çš„é©±åŠ¨ç‰ˆæœ¬ 570.124.06 æ”¯æŒå¤§éƒ¨åˆ† CUDA ç‰ˆæœ¬ï¼ˆå…·ä½“éœ€æŸ¥å…¼å®¹æ€§è¡¨ï¼‰ã€‚ å»ºè®®å®‰è£…æ–¹å¼ï¼š å…ˆå®‰è£…é©±åŠ¨ï¼ˆå·²è£…å¥½ï¼‰ã€‚ å†æ ¹æ®éœ€æ±‚å®‰è£… CUDA Toolkitï¼ˆä¾‹å¦‚é€šè¿‡ NVIDIA å®˜ç½‘æˆ–åŒ…ç®¡ç†å™¨ï¼‰ã€‚ å¦‚ä½•å®‰è£… CUDAï¼Ÿ æŸ¥çœ‹é©±åŠ¨æ”¯æŒçš„ CUDA ç‰ˆæœ¬ï¼š nvidia-smi # è¾“å‡ºé¡¶éƒ¨ä¼šæ˜¾ç¤ºæ”¯æŒçš„ CUDA ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼šCUDA Version: 12.2ï¼‰ ä» NVIDIA å®˜ç½‘ä¸‹è½½å¯¹åº” CUDA Toolkitï¼š CUDA Toolkit ä¸‹è½½é¡µé¢ é€‰æ‹©ä¸é©±åŠ¨å…¼å®¹çš„ç‰ˆæœ¬ï¼ŒæŒ‰å®˜æ–¹æ–‡æ¡£å®‰è£…ï¼ˆé€šå¸¸ç”¨ runfile æˆ–åŒ…ç®¡ç†å™¨ï¼‰ã€‚ éªŒè¯å®‰è£…ï¼š nvcc --version # æŸ¥çœ‹ CUDA ç¼–è¯‘å™¨ç‰ˆæœ¬ nvidia-smi # ç¡®è®¤é©±åŠ¨å’Œ CUDA ç‰ˆæœ¬å…¼å®¹ æ€»ç»“ é©±åŠ¨ç¨‹åºï¼šè®© GPU èƒ½è¢«ç³»ç»Ÿä½¿ç”¨ï¼ˆåŸºç¡€è¿è¡Œï¼‰ã€‚ CUDAï¼šè®©å¼€å‘è€…èƒ½åˆ©ç”¨ GPU åšé«˜æ€§èƒ½è®¡ç®—ï¼ˆåŠŸèƒ½æ‰©å±•ï¼‰ã€‚ å…³ç³»ï¼šé©±åŠ¨æ˜¯â€œæ±½æ²¹â€ï¼ŒCUDA æ˜¯â€œèµ›è½¦æ”¹è£…å¥—ä»¶â€â€”â€”æƒ³é£™è½¦ï¼Ÿä¸¤è€…ç¼ºä¸€ä¸å¯ï¼ ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:5:5","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å®‰è£… NVIDIA container toolkit é…å¥—å·¥å…· NVIDIA Container Toolkitä»‹ç»ï¼š NVIDIA Container Toolkit(å®¹å™¨å·¥å…·åŒ…)ä½¿ç”¨æˆ·èƒ½å¤Ÿæ„å»ºå’Œè¿è¡Œ GPU åŠ é€Ÿçš„å®¹å™¨ï¼Œè¯¥å·¥å…·åŒ…æ‹¬ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶åº“å’Œå®ç”¨ç¨‹åºï¼Œç”¨äºè‡ªåŠ¨é…ç½®å®¹å™¨ä»¥åˆ©ç”¨ NVIDIA GPUã€‚ ä½¿ç”¨èƒŒæ™¯ åœ¨ä½¿ç”¨å¤§æ¨¡å‹çš„æ—¶å€™ï¼Œå¾ˆå¤šæƒ…å†µéœ€è¦ç»å¸¸æ›´æ–°æ¨¡å‹æˆ–è€…ä½¿ç”¨å¹³å°ï¼Œæ‰€ä»¥æ—¶å¸¸æ›´æ–°ä»£ç æˆ–ç¯å¢ƒã€‚ ä½†æ˜¯è‹¥åœ¨å®ä½“æœºæ›´æ–°å¯¼è‡´ç¯å¢ƒæ··ä¹±ï¼Œç»´æŠ¤ä¸ä¾¿ï¼Œæ‰€ä»¥ä½¿ç”¨ docker ç¯å¢ƒè¿›è¡Œæ›´æ–°ã€‚ ä½¿ç”¨ docker è¿è¡Œæ¨¡å‹çš„æ—¶å€™è¦è®©å…¶æ”¯æŒ GPU éœ€è¦ä½¿ç”¨ nvidia-container-toolkit å·¥å…·ã€‚ NVIDIA Container Toolkit ä¸ºå®¹å™¨åŒ– GPU åŠ é€Ÿå·¥ä½œæä¾›äº†é«˜æ•ˆä¸”ä¾¿æ·çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æ·±åº¦å­¦ä¹ å’Œç§‘å­¦è®¡ç®—ç­‰åœºæ™¯çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚ æ ¸å¿ƒåŠŸèƒ½ GPU åŠ é€Ÿæ”¯æŒï¼š å°†ä¸»æœºçš„ NVIDIA GPU æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œä½¿å¾—å®¹å™¨èƒ½å¤Ÿç›´æ¥è®¿é—® GPU èµ„æºã€‚ è½»æ¾ç®¡ç† CUDA ç¯å¢ƒï¼š è‡ªåŠ¨åŠ è½½å¿…è¦çš„ NVIDIA é©±åŠ¨ç¨‹åºã€CUDA åº“å’Œè¿è¡Œæ—¶ï¼Œç®€åŒ–ç¯å¢ƒé…ç½®ã€‚ ä¸å®¹å™¨å¹³å°é›†æˆï¼š æ”¯æŒ Docker å’Œå…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdï¼‰ã€‚ çµæ´»çš„ GPU åˆ†é…ï¼š å…è®¸ç”¨æˆ·æŒ‡å®šå®¹å™¨å¯ä»¥è®¿é—®çš„ GPU æ•°é‡æˆ–ç‰¹å®š GPUã€‚ ç»„ä»¶ç»“æ„ NVIDIA Container Runtimeï¼š Docker è¿è¡Œæ—¶çš„æ‰©å±•ï¼Œç”¨äºåœ¨å®¹å™¨ä¸­åŠ è½½ GPU ç›¸å…³ç»„ä»¶ã€‚ NVIDIA Container CLIï¼š æä¾›äº†å‘½ä»¤è¡Œå·¥å…· nvidia-container-cliï¼Œå¯ä»¥ç”¨äºè°ƒè¯•å’Œç®¡ç† GPU æ˜ å°„ã€‚ æ”¯æŒçš„åº“å’Œå·¥å…·ï¼š è‡ªåŠ¨ä¸ºå®¹å™¨æŒ‚è½½ libcuda.so å’Œå…¶ä»–ç›¸å…³åº“ï¼Œä½¿å…¶æ”¯æŒ GPU åŠ é€Ÿã€‚ å‰ææ¡ä»¶ NVIDIA é©±åŠ¨ç¨‹åºï¼šç¡®ä¿ä¸»æœºå·²å®‰è£…æ”¯æŒçš„ NVIDIA é©±åŠ¨ç¨‹åºã€‚ Dockerï¼šå®‰è£… Dockerï¼Œç‰ˆæœ¬éœ€ä¸º 19.03 æˆ–æ›´é«˜ã€‚ æ£€æŸ¥nvidia-container-toolkit NVIDIA å®¹å™¨å·¥å…·åŒ…æ˜¯å¦å®‰è£… # debian $ dpkg -l | grep nvidia-container-toolkit # redhat $ rpm -l | grep nvidia-container-toolkit # æ·»åŠ  NVIDIA å®¹å™¨è¿è¡Œæ—¶çš„å®˜æ–¹å­˜å‚¨åº“ curl -s -L https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo | sudo tee /etc/yum.repos.d/nvidia-container-toolkit.repo # åœ¨çº¿å®‰è£…ï¼Œåœ¨çº¿å®‰è£…å¼‚å¸¸å¯ä»¥å°è¯•ç¦»çº¿å®‰è£… sudo yum install -y nvidia-container-toolkit ç¦»çº¿ä¸‹è½½å®‰è£… $ wget https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64/libnvidia-container1-1.14.6-1.x86_64.rpm $ wget https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64/libnvidia-container-tools-1.14.6-1.x86_64.rpm $ wget https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64/nvidia-container-toolkit-base-1.14.6-1.x86_64.rpm $ wget https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64/nvidia-container-toolkit-1.14.6-1.x86_64.rpm #æ‰‹åŠ¨å®‰è£… RPM åŒ…,å¦‚æœæ‚¨æ˜¯æ‰‹åŠ¨å®‰è£… .rpm æ–‡ä»¶ï¼Œç¡®ä¿ç‰ˆæœ¬åŒ¹é…åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š $ sudo rpm -ivh libnvidia-container1-1.14.6-1.x86_64.rpm $ sudo rpm -ivh libnvidia-container-tools-1.14.6-1.x86_64.rpm $ sudo rpm -ivh nvidia-container-toolkit-base-1.14.6-1.x86_64.rpm $ sudo rpm -ivh nvidia-container-toolkit-1.14.6-1.x86_64.rpm æµ‹è¯• $ nvidia-ctk --version NVIDIA Container Toolkit CLI version 1.14.6 commit: 5605d191332dcfeea802c4497360d60a65c7887e $ nvidia-container-cli --version cli-version: 1.14.6 lib-version: 1.14.6 build date: 2024-02-27T20:52+0000 build revision: d2eb0afe86f0b643e33624ee64f065dd60e952d4 build compiler: gcc 4.8.5 20150623 (Red Hat 4.8.5-44) build platform: x86_64 build flags: -D_GNU_SOURCE -D_FORTIFY_SOURCE=2 -DNDEBUG -std=gnu11 -O2 -g -fdata-sections -ffunction-sections -fplan9-extensions -fstack-protector -fno-strict-aliasing -fvisibility=hidden -Wall -Wextra -Wcast-align -Wpointer-arith -Wmissing-prototypes -Wnonnull -Wwrite-strings -Wlogical-op -Wformat=2 -Wmissing-format-attribute -Winit-self -Wshadow -Wstrict-prototypes -Wunreachable-code -Wconversion -Wsign-conversion -Wno-unknown-warning-option -Wno-format-extra-args -Wno-gnu-alignof-expression -Wl,-zrelro -Wl,-znow -Wl,-zdefs -Wl,--gc-sections # æŸ¥çœ‹nvidia-container-toolkitç‰ˆæœ¬ $ nvidia-container-runtime --version NVIDIA Container Runtime version 1.14.6 commit: 5605d191332dcfeea802c4497360d60a65c7887e spec: 1.2.0 runc version 1.1.12 commit: v1.1.12-0-g51d5e94 spec: 1.0.2-dev go: go1.21.11 libseccomp: 2.5.3 $ nvidia-container-toolkit --version NVIDIA Container Runtime Hook version 1.14.6 commit: 5605d191332dcfeea802c4497360d60a65c7887e æ³¨æ„\rdocker v20+ ä»¥ä¸Šç”¨ nvidia-container-toolkit ä»£æ›¿ nvidia-docker2 nvidia-container-runtimeç°åœ¨å« nvidia-container-toolkit ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:6:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å®¹å™¨è¿è¡Œæ—¶é…ç½® ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"Docker é…ç½® $ nvidia-ctk runtime configure --runtime=docker INFO[0000] Loading config from /etc/docker/daemon.json INFO[0000] Wrote updated config to /etc/docker/daemon.json INFO[0000] It is recommended that docker daemon be restarted. è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯å¯¹ docker çš„é…ç½®æ–‡ä»¶/etc/docker/daemon.jsonè¿›è¡Œä¿®æ”¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š # æ–°å¢é…ç½®ï¼š { ... \"storage-driver\": \"overlay2\", \"default-runtime\": \"nvidia\", \"runtimes\": { \"nvidia\": { \"path\": \"nvidia-container-runtime\", \"runtimeArgs\": [] } } ... } ä¿®æ”¹åé‡å¯docker $ sudo systemctl daemon-reload $ systemctl restart docker containerd # éªŒè¯å®¹å™¨è¿è¡Œæ—¶ $ docker info | grep \"Runtimes\" Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux nvidia runc ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:1","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"åœ¨ docker-compose.yml ä¸­æ·»åŠ æ”¯æŒ GPU ä»…ä¾›å‚è€ƒ services: ollama: image: ollama/ollama:0.5.4 container_name: ${CONTAINER_NAME} restart: unless-stopped ports: - ${PANEL_APP_PORT_HTTP}:11434 networks: - 1panel-network tty: true privileged: true volumes: - ./data:/root/.ollama labels: createdBy: \"Apps\" # æ·»åŠ  GPU æ”¯æŒ deploy: resources: reservations: devices: - capabilities: [gpu] # å¦‚æœä½¿ç”¨ NVIDIA Container Toolkitï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ environment: NVIDIA_VISIBLE_DEVICES: all NVIDIA_DRIVER_CAPABILITIES: \"compute,utility\" networks: 1panel-network: external: true ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:2","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"Containerd é…ç½® # nvidia-ctk runtime configure --runtime=containerd è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯å¯¹ containerd çš„é…ç½®æ–‡ä»¶ /etc/containerd/config.toml è¿›è¡Œä¿®æ”¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š version = 2 [plugins] [plugins.\"io.containerd.grpc.v1.cri\"] [plugins.\"io.containerd.grpc.v1.cri\".containerd] default_runtime_name = \"nvidia\" [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.nvidia] privileged_without_host_devices = false runtime_engine = \"\" runtime_root = \"\" runtime_type = \"io.containerd.runc.v2\" [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.nvidia.options] BinaryName = \"/usr/bin/nvidia-container-runtime\" ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:3","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"åœ¨çº¿æˆ–è€…ç¦»çº¿ä½¿ç”¨å›½å¤–ä»£ç† # åœ¨çº¿ cd /etc/yum.repos.d/ wget https://mirrors.ustc.edu.cn/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo sed -i 's#nvidia.github.io#mirrors.ustc.edu.cn#g' nvidia-container-toolkit.repo yum makecache yum install -y nvidia-container-toolkit # ç¦»çº¿ $ cat \u003e\u003envidia-container-toolkit.repo\u003c\u003cEOF [nvidia-container-toolkit] name=nvidia-container-toolkit baseurl=https://mirrors.ustc.edu.cn/libnvidia-container/stable/rpm/\\$basearch repo_gpgcheck=1 gpgcheck=0 enabled=1 gpgkey=https://mirrors.ustc.edu.cn/libnvidia-container/gpgkey sslverify=1 sslcacert=/etc/pki/tls/certs/ca-bundle.crt [nvidia-container-toolkit-experimental] name=nvidia-container-toolkit-experimental baseurl=https://mirrors.ustc.edu.cn/libnvidia-container/experimental/rpm/$basearch repo_gpgcheck=1 gpgcheck=0 enabled=0 gpgkey=https://mirrors.ustc.edu.cn/libnvidia-container/gpgkey sslverify=1 sslcacert=/etc/pki/tls/certs/ca-bundle.crt EOF yum install -y nvidia-container-toolkit ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:4","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"nvidia docker, nvidia docker2, nvidia container toolkitsåŒºåˆ« åœ¨dockerå®¹å™¨ä¸­ç”¨GPUæ—¶ï¼ŒæŸ¥é˜…äº†ç½‘ä¸Šè®¸å¤šæ•™ç¨‹ï¼Œæ•™ç¨‹ä¹‹é—´æ¦‚å¿µæ¨¡ç³Šä¸æ¸…ï¼Œç›¸äº’çŸ›ç›¾ï¼Œè¿‡æ—¶çš„æ•™ç¨‹å’Œæ–°çš„æ•™ç¨‹æ··æ‚åœ¨ä¸€èµ·ã€‚ä¸»è¦åŸå› æ˜¯Nvidiaä¸ºdockerå®¹å™¨çš„æ”¯æŒå‘ç”Ÿäº†å¥½å‡ ä»£å˜æ›´ï¼Œapiå‘ç”Ÿäº†ä¸å°‘å˜åŒ–ã€‚ çœæµç‰ˆæ€»ç»“ å‡¡æ˜¯ä½¿ç”¨äº†å‘½ä»¤nvidia dockeræˆ–è€…åœ¨dockerä¸­å¼•å…¥äº†â€“runtime=nvidiaå‚æ•°çš„éƒ½æ˜¯è¿‡æ—¶æ•™ç¨‹ï¼Œæœ€æ–°æ–¹æ³•åªéœ€è¦ä¸‹è½½nvidia-container-toolkitsï¼Œåœ¨dockerä¸­å¼•å…¥â€“gpuså‚æ•°å³å¯ã€‚ nvidia docker(ä¸æ¨è) nvidia dockeræ˜¯NVIDIAç¬¬ä¸€ä»£æ”¯æŒdockerå®¹å™¨å†…ä½¿ç”¨GPUèµ„æºçš„é¡¹ç›®ã€‚è¿è¡Œæ—¶ç”¨nvidia-dockerå‘½ä»¤ã€‚ æ ¹æ®nvidia dockeråœ¨github ( https://github.com/NVIDIA/nvidia-docker )ä¸Šçš„æè¿°ï¼Œå·²ç»ä¸å†ä½¿ç”¨äº† nvidia docker2(ä¸æ¨è) nvidia docker2æ˜¯NVIDIAç¬¬äºŒä»£æ”¯æŒdockerå®¹å™¨å†…ä½¿ç”¨GPUèµ„æºçš„é¡¹ç›®ã€‚è¿è¡Œæ—¶ç”¨nvidia-dockerå‘½ä»¤ï¼Œä¸”éœ€è¦æŒ‡å®šå‚æ•°â€“runtime=nvidia. æ ¹æ® github (https://github.com/NVIDIA/nvidia-docker#backward-compatibility) çš„æè¿°ï¼Œä¸€ä»£å’ŒäºŒä»£ä¹‹é—´æœ‰å¦‚ä¸‹å…¼å®¹æ€§ã€‚ Backward compatibility To help transitioning code from 1.0 to 2.0, a bash script is provided in /usr/bin/nvidia-docker for backward compatibility. It will automatically inject the --runtime=nvidia argument and convert NV_GPU to NVIDIA_VISIBLE_DEVICES. ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨äºŒä»£ä¸­ï¼Œæ—¢å¯ä»¥ä½¿ç”¨nvidia dockerå‘½ä»¤ï¼Œè¿™ä¼šè‡ªåŠ¨å¼•å…¥å‚æ•°â€“runtime=nvidiaä¹Ÿå¯ä»¥ä½¿ç”¨dockerå‘½ä»¤ï¼Œæ‰‹åŠ¨æŒ‡å®šå‚æ•°â€“runtime=nvidia nvidia-container-toolkits(æ¨è) æ ¹æ®githubè¿™æ˜¯æœ€æ–°çš„æ”¯æŒæ–¹æ¡ˆï¼Œå¦‚å¸–å­æè¿°ï¼Œnvidia docker2 è¢«Nvidia container toolkitså–ä»£ï¼Œæ— éœ€æŒ‡å®šâ€“runtimeå‚æ•°ï¼Œåªéœ€è¦ä¼ é€’â€“gpuså‚æ•° ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:7:5","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"k8s éƒ¨ç½²nvidiaè®¾å¤‡æ’ä»¶(æ‰©å±•) $ kubectl apply -f https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/1.0.0-beta4/nvidia-device-plugin.yml # æˆ–è€…å®‰è£… NVIDIA GPU Operatorï¼Œé€‚ç”¨K8Sç‰ˆæœ¬ 1.23ç‰ˆæœ¬ä»¥ä¸Š # æ·»åŠ  NVIDIA Helm repository $ helm repo add nvidia https://helm.ngc.nvidia.com/nvidia \u0026\u0026 helm repo update $ helm install -n gpu-operator --create-namespace gpu-operator nvidia/gpu-operator \\ --set driver.enabled=false \\ --set dcgmExporter.enabled=true \\ --set migManager.enabled=true \\ --set driver.vgpu.enabled=true \\ --set migStrategy=mixed ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:8:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"k8s è°ƒåº¦GPU ä»»åŠ¡æµ‹è¯• æµ‹è¯•ä¸€gpu.yaml apiVersion: v1 kind: Pod metadata: name: tf-pod spec: containers: - name: tf-container image: tensorflow/tensorflow:2.14.0-gpu command: [ \"/bin/sh\" ] args: [ \"-c\", \"tail -f\" ] resources: limits: cpu: 200m memory: 512Mi nvidia.com/gpu: 1 # requesting 1 GPU æµ‹è¯•äºŒ cat cuda-vectoradd.yaml apiVersion: v1 kind: Pod metadata: name: cuda-vectoradd spec: restartPolicy: OnFailure containers: - name: cuda-vectoradd image: \"nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda11.7.1-ubuntu20.04\" resources: limits: nvidia.com/gpu: 1 # requesting 1 GPU nodeSelector: accekerator: nvidia-rtx4090 æµ‹è¯•ä¸‰ $ docker run -d --gpus all--name pytorch swr.cn-south-1.myhuaweicloud.com/myj-prod-local-cluster-repository/pytorch:cuda11.8 docker exec -it pytorch bash æ‰§è¡Œ python3,è°ƒç”¨cuda è®¡ç®—æ˜¾å¡ æµ‹è¯•å›› è¿›pod é‡Œé¢æ‰§è¡Œnvida-smi æ˜¯å¦æœ‰è¾“å‡ºï¼Œæœ‰è¾“å‡ºè¯´æ˜æˆåŠŸäº† ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:8:1","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"æ’é”™ç­”ç–‘ é—®é¢˜\rcould not select device driver \"\" with capabilities: [[gpu]] é€šå¸¸æ˜¯ç”±äº Docker æ²¡æœ‰æ­£ç¡®è¯†åˆ«åˆ° GPUï¼Œæˆ–è€… NVIDIA Docker é…ç½®ä¸æ­£ç¡®ã€‚å¯èƒ½æ˜¯ nvidia-container-toolkit å·¥å…·åŒ…æ²¡æœ‰å®‰è£…ï¼Œdockeré…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤è¿è¡Œæ—¶æ²¡æœ‰æ·»åŠ nvidiaé…ç½® Is there a difference between: nvidia-docker run and docker run --runtime=nvidia ? docker run --runtime=nvidia is only available since nvidia-docker v2. ","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:9:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["GPU"],"content":"å‚è€ƒ ä¸‹è½½å®‰è£…NVIDIAé©±åŠ¨ç¨‹åº kernel å†…æ ¸æºç åŒ… Installation Guide Linux :: CUDA Toolkit Documentation è¿™é‡ŒæŸ¥çœ‹å—æ”¯æŒçš„Linuxç‰ˆæœ¬ NVIDIA Container Toolkit ä»‹ç»åŠå®‰è£… by Unbuntu æ¬§æ‹‰openEuler 22.03 (LTS-SP1)å®‰è£…NVIDIA Driver Installing the NVIDIA Container Toolkit å®˜ç½‘ Openeuler v22.03 AI å¤§æ¨¡å‹æœåŠ¡é•œåƒä½¿ç”¨æŒ‡å— nvidia-container-toolkit github NVIDIA Container è¿è¡Œæ—¶åº“ USTC ä¸­ç§‘å¤§å®˜æ–¹é•œåƒ CUDA å’ŒGPU é©±åŠ¨å‹å…¼å®¹æ€§ ä¿¡æ¯\ræœ¬æ–‡æ¡£æ‰€æä¾›çš„æŒ‡å¼•å’Œå‚è€ƒä¸»è¦åŸºäºç‰¹å®šå®è·µè®¾å¤‡çš„æ“ä½œç»éªŒã€‚ç”±äºä¸åŒè®¾å¤‡åœ¨ç¡¬ä»¶é…ç½®ã€è½¯ä»¶ç‰ˆæœ¬ã€ä½¿ç”¨åœºæ™¯ç­‰æ–¹é¢å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå› æ­¤ï¼Œå½“æ‚¨åœ¨ä½¿ç”¨å…¶ä»–è®¾å¤‡æ—¶ï¼Œæ‰€é‡åˆ°çš„é—®é¢˜å¯èƒ½ä¸æ­¤æ–‡æ¡£æ‰€è¿°æœ‰æ‰€ä¸åŒã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¤§éƒ¨åˆ†è®¾å¤‡çš„å®‰è£…æ–¹æ³•å’ŒåŸºæœ¬æ­¥éª¤ä»ç„¶ä¿æŒç›¸ä¼¼ã€‚\r","date":"2025-01-11","objectID":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/:10:0","tags":["GPU"],"title":"Linuxç³»ç»ŸNvidiaé©±åŠ¨éƒ¨ç½²","uri":"/linux%E7%B3%BB%E7%BB%9Fnvidia%E9%A9%B1%E5%8A%A8%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"ä¸€ã€XtraDB Backupï¼ˆPercona XtraBackupï¼‰ä»‹ç» MySQLå†·å¤‡ã€mysqldumpã€MySQLçƒ­æ‹·è´éƒ½æ— æ³•å®ç°å¯¹æ•°æ®åº“è¿›è¡Œå¢é‡å¤‡ä»½ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¢é‡å¤‡ä»½æ˜¯éå¸¸å®ç”¨çš„ï¼Œå¦‚æœæ•°æ®å¤§äº50Gæˆ–100Gï¼Œå­˜å‚¨ç©ºé—´è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¯å¤©è¿›è¡Œå®Œæ•´å¤‡ä»½ï¼Œå¦‚æœæ¯å¤©äº§ç”Ÿçš„æ•°æ®é‡è¾ƒå¤§ï¼Œéœ€è¦å®šåˆ¶æ•°æ®å¤‡ä»½ç­–ç•¥ã€‚ä¾‹å¦‚æ¯å‘¨å®ç”¨å®Œæ•´å¤‡ä»½ï¼Œå‘¨ä¸€åˆ°å‘¨å…­å®ç”¨å¢é‡å¤‡ä»½ã€‚è€ŒPercona-Xtrabackupå°±æ˜¯ä¸ºäº†å®ç°å¢é‡å¤‡ä»½è€Œå‡ºç°çš„ä¸€æ¬¾ä¸»æµå¤‡ä»½å·¥å…·ï¼Œxtrabakackupæœ‰2ä¸ªå·¥å…·ï¼Œåˆ†åˆ«æ˜¯xtrabakupã€innobakupeã€‚ XtraBackup æ˜¯ç”± Percona å¼€å‘çš„å¼€æºå·¥å…·ï¼Œä¸“é—¨ç”¨äº MySQL åŠå…¼å®¹æ•°æ®åº“ï¼ˆå¦‚ MariaDBã€Percona Serverï¼‰çš„åœ¨çº¿çƒ­å¤‡ä»½ã€‚å®ƒæ”¯æŒ InnoDB/XtraDB å­˜å‚¨å¼•æ“çš„é«˜æ•ˆå¤‡ä»½ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š éé˜»å¡å¤‡ä»½ï¼šå¤‡ä»½è¿‡ç¨‹ä¸­ä¸é˜»å¡æ•°æ®åº“çš„è¯»å†™æ“ä½œã€‚ å¢é‡å¤‡ä»½ï¼šä»…å¤‡ä»½è‡ªä¸Šæ¬¡å¤‡ä»½ä»¥æ¥æ›´æ”¹çš„æ•°æ®ï¼ŒèŠ‚çœæ—¶é—´å’Œå­˜å‚¨ã€‚ å¿«é€Ÿæ¢å¤ï¼šæ”¯æŒé€šè¿‡å…¨é‡+å¢é‡å¤‡ä»½é“¾å¿«é€Ÿæ¢å¤æ•°æ®ã€‚ å¤‡ä»½å‹ç¼©ä¸åŠ å¯†ï¼šå¯é€‰å‹ç¼©ï¼ˆå¦‚ --compressï¼‰å’ŒåŠ å¯†åŠŸèƒ½ï¼Œä¼˜åŒ–å­˜å‚¨å®‰å…¨ã€‚ è‡ªåŠ¨å®ç°å¤‡ä»½æ£€éªŒ å¼€æºï¼Œå…è´¹ ","date":"2024-12-17","objectID":"/xtrabackup/:1:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"XtraBackup å¯¹å¤‡ä»½ MySQL æ•°æ®è¡¨ç±»å‹çš„æ”¯æŒ ä¼—æ‰€å‘¨çŸ¥ï¼ŒXtrabackupæ˜¯ä¸€ä¸ªå¯¹InnoDBåšæ•°æ®å¤‡ä»½çš„å·¥å…·ï¼Œæ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼ˆå¤‡ä»½æ—¶ä¸å½±å“æ•°æ®è¯»å†™ï¼‰ï¼Œæ˜¯å•†ä¸šå¤‡ä»½å·¥å…·InnoDB Hotbackupçš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£å“ã€‚ä½†æ˜¯åœ¨å…¬å¸ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨çš„ç‰ˆæœ¬è¿˜æ˜¯MySQL v5.7 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸šåŠ¡å‡çº§åˆ°äº†MySQL 8.0ç‰ˆæœ¬ï¼Œä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨çš„è¡¨ç±»å‹ä¸åŒï¼Œåœ¨ä½¿ç”¨Xtrabackupæˆ‘ä»¬è¦äº†è§£å®ƒçš„é€‚ç”¨èŒƒå›´ä»¥åŠä¼šæœ‰å“ªäº›å½±å“ã€‚ åœ¨ Percona XtraBackup çš„å†å²ç‰ˆæœ¬ä¸­ï¼Œ2.4 ç‰ˆæœ¬ æ˜¯æœ€åä¸€ä¸ªæ”¯æŒåŒæ—¶å¤‡ä»½ InnoDB å’Œ MyISAM è¡¨çš„ç‰ˆæœ¬ã€‚ å…³é”®ç‚¹ï¼š XtraBackup 2.4ï¼š æ”¯æŒ InnoDBï¼ˆåŒ…æ‹¬ XtraDBï¼‰çš„çƒ­å¤‡ä»½ï¼ˆä¸é”è¡¨ï¼‰ã€‚ æ”¯æŒ MyISAM çš„å¤‡ä»½ï¼Œä½†ä¼šçŸ­æš‚é”å®šè¡¨ï¼ˆFLUSH TABLES WITH READ LOCKï¼‰ã€‚ é€‚ç”¨äº MySQL 5.1ã€5.5ã€5.6 å’Œ 5.7 (5.7.9 ~ 5.7.28)ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬ï¼‰ã€‚ XtraBackup 8.0+ï¼š ä» XtraBackup 8.0 å¼€å§‹ï¼ŒPercona ç§»é™¤äº†å¯¹ MyISAM è¡¨çš„æ”¯æŒï¼Œä»…ä¸“æ³¨äº InnoDB å’Œ Percona Server çš„å¢å¼ºåŠŸèƒ½ã€‚ é€‚ç”¨äº MySQL 8.0 åŠæ›´é«˜ç‰ˆæœ¬ã€‚ å»ºè®®ï¼š å¦‚æœä½ çš„æ•°æ®åº“åŒ…å« MyISAM è¡¨ï¼Œå¹¶ä¸”éœ€è¦å®Œæ•´å¤‡ä»½ï¼Œè¯·ä½¿ç”¨ XtraBackup 2.4ã€‚ å¦‚æœåªæœ‰ InnoDB è¡¨ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°çš„ XtraBackup 8.0+ ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚ é¢å¤–è¯´æ˜ï¼š XtraBackup 2.4 ä»ç„¶å¯ä»¥å¤‡ä»½ MyISAM è¡¨ï¼Œä½†å¤‡ä»½æœŸé—´ä¼šçŸ­æš‚é”è¡¨ï¼Œå¯èƒ½å½±å“å†™å…¥æ“ä½œã€‚ å¯¹äºçº¯ InnoDB ç¯å¢ƒï¼Œæ¨èå‡çº§åˆ° XtraBackup 8.0+ ä»¥æ”¯æŒ MySQL 8.0 çš„æ–°ç‰¹æ€§ï¼ˆå¦‚ redo log æ ¼å¼å˜æ›´ï¼‰ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:1:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"XtraBackup å·¥å…·ä»‹ç» xtrabackupå·¥å…·æ–‡ä»¶ç»„æˆ: Xtrabackup2.2 ç‰ˆä¹‹å‰åŒ…æ‹¬4ä¸ªå¯æ‰§è¡Œæ–‡ä»¶: innobackupex: Perl è„šæœ¬ xtrabackup: C/C++ï¼Œç¼–è¯‘çš„äºŒè¿›åˆ¶ç¨‹åº xbcrypt: åŠ è§£å¯† xbstream: æ”¯æŒå¹¶å‘å†™çš„æµæ–‡ä»¶æ ¼å¼ xtrabackup æ˜¯ç”¨æ¥å¤‡ä»½ InnoDB è¡¨çš„ï¼Œä¸èƒ½å¤‡ä»½éInnoDB è¡¨ï¼Œå’Œ MySQLServer æ²¡æœ‰äº¤äº’ innobackupex è„šæœ¬ç”¨æ¥å¤‡ä»½éInnoDB è¡¨ï¼ŒåŒæ—¶ä¼šè°ƒç”¨ xtrabackup å‘½ä»¤æ¥å¤‡ä»½ InnoDB è¡¨ï¼Œè¿˜ä¼šå’Œ MySQLServer å‘é€å‘½ä»¤è¿›è¡Œäº¤äº’ï¼Œå¦‚åŠ å…¨å±€è¯»é”(FTWRL)ã€è·å–ä½ç‚¹(SHOW SLAVESTATUS)ç­‰ã€‚å³innobackupexæ˜¯åœ¨ xtrabackup ä¹‹ä¸Šåšäº†ä¸€å±‚å°è£…å®ç°çš„ xtrabackupçš„æ–°ç‰ˆå˜åŒ– xtrabackupç‰ˆæœ¬å‡çº§åˆ°2.4åï¼Œç›¸æ¯”ä¹‹å‰çš„2.1æœ‰äº†æ¯”è¾ƒå¤§çš„å˜åŒ–:innobackupex åŠŸèƒ½å…¨éƒ¨é›†æˆåˆ° xtrabackup é‡Œé¢ï¼Œåªæœ‰ä¸€ä¸ª binaryç¨‹åºï¼Œå¦å¤–ä¸ºäº†å…¼å®¹è€ƒè™‘ï¼Œinnobackupexä½œä¸ºxtrabackupçš„è½¯é“¾æ¥ï¼Œå³xtrabackupç°åœ¨æ”¯æŒéInnodbè¡¨å¤‡ä»½ï¼Œå¹¶ä¸”Innobackupexåœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œå»ºè®®é€šè¿‡xtrabackupæ›¿æ¢innobackupex ","date":"2024-12-17","objectID":"/xtrabackup/:1:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"xtrabackupå¤‡ä»½æµç¨‹å›¾ xtrabackupå¤‡ä»½æµç¨‹å›¾\r","date":"2024-12-17","objectID":"/xtrabackup/:1:3","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"äºŒã€XtraBackup ä¸ MySQL çš„ç‰ˆæœ¬å¯¹åº”è§„åˆ™ ","date":"2024-12-17","objectID":"/xtrabackup/:2:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"1. åŒ¹é…è§„åˆ™ XtraBackup ç‰ˆæœ¬ å…¼å®¹çš„ MySQL ç‰ˆæœ¬ è¯´æ˜ 8.0.x MySQL 8.0ã€Percona Server 8.0 æ”¯æŒ MySQL 8.0 çš„æ–°ç‰¹æ€§ï¼ˆå¦‚ REDO/UNDO æ—¥å¿—æ ¼å¼å˜æ›´ã€æ•°æ®å­—å…¸ä¼˜åŒ–ï¼‰ 2.4.x MySQL 5.6ã€5.7ã€Percona 5.7 æ”¯æŒ MySQL 5.6/5.7ï¼Œä¸å…¼å®¹ MySQL 8.0 2.3.x åŠä»¥ä¸‹ MySQL 5.5 æˆ–æ›´æ—©ç‰ˆæœ¬ å·²é€æ¸æ·˜æ±° å…³é”®æ³¨æ„äº‹é¡¹ï¼š MySQL 8.0 å¿…é¡»ä½¿ç”¨ XtraBackup 8.0+ï¼Œå¦åˆ™å¤‡ä»½ä¼šç›´æ¥æŠ¥é”™ï¼ˆä¾‹å¦‚ Unsupported redo log formatï¼‰ã€‚ MySQL 5.7 å»ºè®®ä½¿ç”¨ XtraBackup 2.4.xï¼Œéƒ¨åˆ† 8.0 ç‰ˆæœ¬å¯èƒ½å…¼å®¹ä½†éœ€éªŒè¯ã€‚ Percona Server éœ€ä¸ XtraBackup ç‰ˆæœ¬å¯¹é½ï¼ˆå¦‚ Percona Server 5.7 â†’ XtraBackup 2.4ï¼‰ã€‚ xtrabackup-version-match-1\rxtrabackup-version-match-2\r","date":"2024-12-17","objectID":"/xtrabackup/:2:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"2. ç‰ˆæœ¬å‡çº§ä¸é™çº§ç­–ç•¥ 1. MySQL å‡çº§ï¼ˆå¦‚ 5.7 â†’ 8.0ï¼‰ æ­¥éª¤ï¼š å‡çº§ XtraBackup åˆ° 8.0+ã€‚ åˆ›å»ºæ–°å¤‡ä»½ï¼ˆæ—§å¤‡ä»½å¯èƒ½æ— æ³•ç›´æ¥æ¢å¤è‡³ MySQL 8.0ï¼‰ã€‚ 2. XtraBackup é™çº§ æ­¥éª¤ï¼š # å¸è½½å½“å‰ç‰ˆæœ¬ sudo yum remove percona-xtrabackup-80 # å®‰è£…æ—§ç‰ˆæœ¬ sudo yum install percona-xtrabackup-24 ","date":"2024-12-17","objectID":"/xtrabackup/:2:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¸‰ã€å®‰è£… XtraBackup ","date":"2024-12-17","objectID":"/xtrabackup/:3:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"1. å®‰è£… XtraBackup 1. æ·»åŠ  Percona å®˜æ–¹ä»“åº“ é¿å…ä½¿ç”¨é»˜è®¤ä»“åº“ï¼ˆå¯èƒ½ç‰ˆæœ¬è¿‡æ—§ï¼‰ï¼Œä¼˜å…ˆé€šè¿‡ Percona ä»“åº“å®‰è£…ï¼š # å®‰è£… Percona ä»“åº“ sudo yum install https://repo.percona.com/yum/percona-release-latest.noarch.rpm # å¯ç”¨ä»“åº“ sudo percona-release setup ps80 # è‹¥éœ€ MySQL 8.0 å¯¹åº”å·¥å…· # æˆ– sudo percona-release setup ps57 # è‹¥éœ€ MySQL 5.7 å¯¹åº”å·¥å…· 2. æŸ¥çœ‹å¯å®‰è£…çš„ XtraBackup ç‰ˆæœ¬ sudo yum list percona-xtrabackup-* # ç¤ºä¾‹è¾“å‡ºï¼š # percona-xtrabackup-80.x86_64 8.0.33-28.1.el7 percona-release-x86_64 # percona-xtrabackup-24.x86_64 2.4.28-1.el7 percona-release-x86_64 3. å®‰è£…æŒ‡å®šç‰ˆæœ¬ æ ¹æ® MySQL ç‰ˆæœ¬é€‰æ‹©å¯¹åº”çš„åŒ…ï¼š MySQL 8.0ï¼š sudo yum install percona-xtrabackup-80 MySQL 5.6/5.7ï¼š sudo yum install percona-xtrabackup-24 ç¦»çº¿å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬ # In RPM-based distribution (like CentOS 7), you need to: sudo yum install cmake gcc gcc-c++ libaio libaio-devel bison ncurses-devel \\ libgcrypt-devel libcurl-devel libev-devel python-sphinx vim-common # æˆ–è€…ç›´æ¥é€šè¿‡ yum å®‰è£…æ¥è§£å†³ä¾èµ–çš„é—®é¢˜ sudo yum install -y percona-xtrabackup-24-2.4.20-1.el7.x86_64.rpm sudo rpm -qa |grep xtrabackup percona-xtrabackup-24-2.4.20-1.el7.x86_64 4. éªŒè¯å®‰è£…ç‰ˆæœ¬ # xtrabackupä¼šè‡ªåŠ¨è¯»å–mysqlé…ç½® xtrabackup --version # è¾“å‡ºç¤ºä¾‹ï¼š # xtrabackup version 2.4.20 based on MySQL server 5.7.26 Linux (x86_64) (revision id: c8b4056) æ³¨æ„\rxtrabackup å’Œ mysql æ•°æ®åº“ç‰ˆæœ¬æ˜¯æœ‰å¯¹åº”å…³ç³»çš„\r","date":"2024-12-17","objectID":"/xtrabackup/:3:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¸‰ã€ä½¿ç”¨ XtraBackup è¿›è¡Œå¢é‡å¤‡ä»½åŠè¿˜åŸ ","date":"2024-12-17","objectID":"/xtrabackup/:4:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"1. å…¨é‡å¤‡ä»½ ","date":"2024-12-17","objectID":"/xtrabackup/:4:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"2. æ‰§è¡Œå…¨é‡å¤‡ä»½ mkdir -p /path/to/full_backup xtrabackup --backup --target-dir=/path/to/full_backup \\ --user=\u003cmysql_user\u003e --password=\u003cmysql_password\u003e --target-dirï¼šæŒ‡å®šå¤‡ä»½æ–‡ä»¶å­˜å‚¨ç›®å½•ï¼Œç›®å½•ä¸éœ€è¦æå‰åˆ›å»º å¤‡ä»½å®Œæˆåï¼Œè¾“å‡ºæç¤º completed OK! è¡¨ç¤ºæˆåŠŸã€‚ å…¨é‡å¤‡ä»½å¯ä»¥ä¸€å‘¨æˆ–è€…ä¸€å¤©æ‰§è¡Œä¸€æ¬¡ æŸ¥çœ‹å¤‡ä»½ä¿¡æ¯ cat /path/to/full_backup/xtrabackup_checkpoints cat /path/to/full_backup/xtrabackup_info cat /path/to/full_backup/backup-my.cnf 2. å¤‡ä»½æ–‡ä»¶ç»“æ„ å…¨é‡å¤‡ä»½ï¼šåŒ…å«æ‰€æœ‰æ•°æ®æ–‡ä»¶ã€‚ å¢é‡å¤‡ä»½ï¼šä»…å«å˜åŒ–çš„æ•°æ®é¡µï¼ˆæ–‡ä»¶åç¼€ .delta å’Œ .metaï¼‰ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:4:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"2. è¿˜åŸå…¨é‡å¤‡ä»½ è¿˜åŸå‰éœ€è¦åœæ‰MySQL æœåŠ¡ ç¡®ä¿MySQL æ•°æ®ç›®å½•æ˜¯æ¸…ç©ºçŠ¶æ€ 1. é¢„æ•´ç† é¢„æ•´ç†ï¼Œç›®çš„æ˜¯å°†æœªå®Œæˆçš„äº‹åŠ¡è¿›è¡Œå›æ»š xtrabackup --prepare --target-dir=/path/to/full_backup æ³¨æ„\ré€‚åˆå•çº¯åœ°è¿›è¡Œå…¨é‡å¤‡ä»½çš„æ¢å¤ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰“ç®—åœ¨å…¶ä¸Šåº”ç”¨ä»»ä½•å¢é‡å¤‡ä»½\r2. æœ€ç»ˆå‡†å¤‡å¹¶æ¢å¤æ•°æ® xtrabackup --prepare --target-dir=/path/to/full_backup åœæ­¢ MySQL æœåŠ¡ï¼Œæ¸…ç©ºæ•°æ®ç›®å½•ï¼Œå°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶å›æ•°æ®ç›®å½•ï¼š 3.å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½• ä¾‹å¦‚æ•°æ®åº“ä¸»æœºå®•æœºæˆ–è€…æŒ‚æ‰äº†ï¼Œå°†å¤‡ä»½çš„æ•°æ®æ‹·è´åˆ°æ–°çš„ä¸»æœºæˆ–è€…ä¿®å¤çš„æ•°æ®åº“ä¸»æœºç›®å½•ä¸‹ xtrabackup --copy-back --target-dir=/path/to/full_backup 4.è¿˜åŸå±æ€§ ä¿®æ”¹æ‰€å±è€…å’Œæ‰€å±ç»„ chown -R mysql:mysql /var/lib/mysql /var/lib/mysql æ˜¯é»˜è®¤ç›®å½•ï¼Œå¯é€šè¿‡/etc/my.cnfæ¥è¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚æœ‰ä¿®æ”¹åŠ¨æ€è°ƒæ•´ 5.å¯åŠ¨æœåŠ¡ systemctl start mysqld ","date":"2024-12-17","objectID":"/xtrabackup/:4:3","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"MySQL å¢é‡å¤‡ä»½ ","date":"2024-12-17","objectID":"/xtrabackup/:5:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"MySQL å¢é‡å¤‡ä»½ï¼ˆåŸºäº xtrabackupï¼‰ 1. åŸºäº LSN çš„å¢é‡å¤‡ä»½ XtraBackup é€šè¿‡ LSNï¼ˆLog Sequence Numberï¼‰è¿½è¸ªæ•°æ®é¡µå˜åŒ–ï¼Œå¢é‡å¤‡ä»½éœ€åŸºäºä¸Šä¸€æ¬¡å…¨é‡æˆ–å¢é‡å¤‡ä»½ï¼š # ç¬¬ä¸€æ¬¡ä¿®æ”¹åå¢é‡å¤‡ä»½ xtrabackup --backup --target-dir=/path/to/inc_backup_1 \\ --incremental-basedir=/path/to/full_backup \\ --user=\u003cmysql_user\u003e --password=\u003cmysql_password\u003e # ç¬¬äºŒæ¬¡ä¿®æ”¹åå¢é‡å¤‡ä»½ xtrabackup --backup --target-dir=/path/to/inc_backup_2 \\ --incremental-basedir=/path/to/inc_backup_1 \\ --user=\u003cmysql_user\u003e --password=\u003cmysql_password\u003e --incremental-basedirï¼šæŒ‡å‘ä¸Šæ¬¡å¤‡ä»½çš„ç›®å½•ï¼ˆå…¨é‡æˆ–å¢é‡ï¼‰ã€‚ å¤‡ä»½ç”Ÿæˆä¸‰ä¸ªå¤‡ä»½ç›®å½•/path/to/{full_backup,inc_backup_1,inc_backup_2} ","date":"2024-12-17","objectID":"/xtrabackup/:5:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"MySQL å¢é‡å¤‡ä»½ï¼ˆåŸºäº xtrabackupï¼‰è¿˜åŸ è¿˜åŸå‰éœ€è¦åœæ‰MySQL æœåŠ¡ ç¡®ä¿MySQL æ•°æ®ç›®å½•æ˜¯æ¸…ç©ºçŠ¶æ€ 1. å‡†å¤‡å…¨é‡å¤‡ä»½ é¢„å‡†å¤‡ï¼šç¡®ä¿æ•°æ®ä¸€è‡´ï¼Œé˜»æ­¢å›æ»šæœªå®Œæˆçš„äº‹åŠ¡ xtrabackup --prepare --apply-log-only --target-dir=/path/to/full_backup â€“apply-log-onlyé˜»æ­¢å›æ»šæœªå®Œæˆçš„äº‹åŠ¡ï¼Œå®ƒä»…æ‰§è¡Œredoæ—¥å¿—çš„åº”ç”¨è€Œä¸æ‰§è¡Œundoæ“ä½œã€‚è¿™æ„å‘³ç€äº‹åŠ¡ä¸ä¼šè¢«å›æ»šã€‚ é€‚ç”¨åœºæ™¯ï¼šå½“è®¡åˆ’åº”ç”¨å¢é‡å¤‡ä»½ï¼ˆIncremental Backupï¼‰åˆ°å…¨é‡å¤‡ä»½æ—¶ï¼Œéœ€è¦å…ˆä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥å‡†å¤‡å…¨é‡å¤‡ä»½ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿åç»­çš„å¢é‡å¤‡ä»½å¯ä»¥æ­£ç¡®åœ°åº”ç”¨åˆ°åŸºç¡€å¤‡ä»½ä¸Šã€‚ ä¹Ÿå°±æ˜¯è¯´ä½ çš„æ¢å¤ç­–ç•¥åŒ…æ‹¬å…ˆåšä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šåº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¢é‡å¤‡ä»½ï¼Œåˆ™é¦–å…ˆéœ€è¦ä½¿ç”¨ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼ˆå¸¦â€“apply-log-onlyé€‰é¡¹ï¼‰å‡†å¤‡å…¨é‡å¤‡ä»½ï¼Œä¹‹åæŒ‰ç…§é¡ºåºé€ä¸€å‡†å¤‡å¹¶åº”ç”¨æ¯ä¸ªå¢é‡å¤‡ä»½ï¼ˆåŒæ ·ä½¿ç”¨â€“apply-log-onlyç›´åˆ°æœ€åä¸€ä¸ªå¢é‡å¤‡ä»½ï¼‰ã€‚æœ€åï¼Œä½¿ç”¨ï¼ˆä¸å¸¦â€“apply-log-onlyé€‰é¡¹ï¼‰æ¥å®Œæˆå‡†å¤‡è¿‡ç¨‹ï¼Œä½¿å¾—æ•´ä¸ªå¤‡ä»½é›†ï¼ˆåŒ…æ‹¬å…¨é‡å’Œæ‰€æœ‰å¢é‡éƒ¨åˆ†ï¼‰å¯ä»¥ç”¨äºæ¢å¤ã€‚ 2. è¿˜åŸåˆå¹¶å¢é‡å¤‡ä»½ åˆå¹¶å¢é‡å¤‡ä»½åˆ°å…¨é‡å¤‡ä»½ï¼š # åˆå¹¶ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½åˆ°å®Œå…¨å¤‡ä»½ xtrabackup --prepare --apply-log-only --target-dir=/path/to/full_backup \\ --incremental-dir=/path/to/inc_backup_1 # åˆå¹¶ç¬¬äºŒæ¬¡å¢é‡å¤‡ä»½åˆ°å®Œå…¨å¤‡ä»½:æœ€åä¸€æ¬¡è¿˜åŸä¸éœ€è¦åŠ --apply-log-only xtrabackup --prepare --target-dir=/path/to/full_backup \\ --incremental-dir=/path/to/inc_backup_2 3.å¤åˆ¶åˆ°æ•°æ®åº“ç›®å½• ä¾‹å¦‚æ•°æ®åº“ä¸»æœºå®•æœºæˆ–è€…æŒ‚æ‰äº†ï¼Œå°†å¤‡ä»½çš„æ•°æ®æ‹·è´åˆ°æ–°çš„ä¸»æœºæˆ–è€…ä¿®å¤çš„æ•°æ®åº“ä¸»æœºç›®å½•ä¸‹ xtrabackup --copy-back --target-dir=/path/to/full_backup è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ cp å‘½ä»¤è¿›è¡Œå¤åˆ¶ æ³¨æ„\ræ•°æ®åº“ç›®å½•å¿…é¡»ä¸ºç©ºï¼Œä¸”MySQLæœåŠ¡ä¸èƒ½å¯åŠ¨\r4.è¿˜åŸå±æ€§ ä¿®æ”¹æ‰€å±è€…å’Œæ‰€å±ç»„ chown -R mysql:mysql /var/lib/mysql /var/lib/mysql æ˜¯é»˜è®¤ç›®å½•ï¼Œå¦‚æœ‰ä¿®æ”¹åŠ¨æ€è°ƒæ•´ 5.å¯åŠ¨æœåŠ¡ systemctl start mysqld ","date":"2024-12-17","objectID":"/xtrabackup/:5:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"MySQL å¢é‡å¤‡ä»½ï¼ˆåŸºäº Binlogï¼‰ ","date":"2024-12-17","objectID":"/xtrabackup/:5:3","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"1. å¯ç”¨ Binlog åœ¨ my.cnf ä¸­é…ç½®ï¼š [mysqld] log_bin = /var/lib/mysql/mysql-bin server_id = 1 ","date":"2024-12-17","objectID":"/xtrabackup/:5:4","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"2. å®šæœŸå¤‡ä»½ Binlog # åˆ·æ–°æ—¥å¿—ï¼Œç”Ÿæˆæ–° Binlog æ–‡ä»¶ mysqladmin flush-logs # å¤‡ä»½æ—§çš„ Binlog æ–‡ä»¶ï¼ˆå¦‚ mysql-bin.000001ï¼‰ cp /var/lib/mysql/mysql-bin.000001 /backup/ ","date":"2024-12-17","objectID":"/xtrabackup/:5:5","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"3. ä½¿ç”¨ Binlog æ¢å¤æ•°æ® # æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹ mysqlbinlog /backup/mysql-bin.000001 | mysql -u root -p ","date":"2024-12-17","objectID":"/xtrabackup/:5:6","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"äº”ã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹© å¤‡ä»½æ–¹å¼ XtraBackup å¢é‡å¤‡ä»½ Binlog å¢é‡å¤‡ä»½ ç²’åº¦ é¡µé¢çº§ï¼ˆç‰©ç†å¤‡ä»½ï¼‰ SQL è¯­å¥çº§ï¼ˆé€»è¾‘å¤‡ä»½ï¼‰ æ¢å¤é€Ÿåº¦ å¿«ï¼ˆç›´æ¥æ–‡ä»¶æ›¿æ¢ï¼‰ æ…¢ï¼ˆéœ€é‡æ”¾ SQLï¼‰ é€‚ç”¨åœºæ™¯ å¤§å‹æ•°æ®åº“å¿«é€Ÿæ¢å¤ ç²¾ç»†æ¢å¤ï¼ˆå¦‚è¯¯åˆ å•è¡¨ï¼‰ å­˜å‚¨å ç”¨ ä¸­ç­‰ï¼ˆä»…å˜åŒ–é¡µï¼‰ è¾ƒå¤§ï¼ˆè®°å½•æ‰€æœ‰å˜æ›´ï¼‰ ","date":"2024-12-17","objectID":"/xtrabackup/:6:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"å…­ã€ XtraBackup 2.4 å¸¸ç”¨å‚æ•° ä»¥ä¸‹æ˜¯ Percona XtraBackup 2.4 çš„å¸¸ç”¨å‚æ•°è§£é‡Šè¡¨æ ¼ï¼Œæ¶µç›–å¤‡ä»½ã€æ¢å¤ã€å‹ç¼©ã€åŠ å¯†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼š ","date":"2024-12-17","objectID":"/xtrabackup/:7:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"XtraBackup 2.4 æ ¸å¿ƒå‚æ•°è¡¨ å‚æ•° ç±»å‹ è¯´æ˜ é»˜è®¤å€¼ ç¤ºä¾‹ é€šç”¨å‚æ•° --backup å‘½ä»¤ æ‰§è¡Œå…¨é‡å¤‡ä»½ã€‚ - xtrabackup --backup --target-dir=/backup --prepare å‘½ä»¤ å‡†å¤‡å¤‡ä»½æ–‡ä»¶ï¼ˆåº”ç”¨æ—¥å¿—ï¼Œä½¿å…¶å¯æ¢å¤ï¼‰ã€‚ - xtrabackup --prepare --target-dir=/backup --copy-back å‘½ä»¤ å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ° MySQL æ•°æ®ç›®å½•ã€‚ - xtrabackup --copy-back --target-dir=/backup --target-dir é€‰é¡¹ æŒ‡å®šå¤‡ä»½æ–‡ä»¶çš„å­˜å‚¨ç›®å½•ã€‚ - --target-dir=/backup/full --datadir é€‰é¡¹ æŒ‡å®š MySQL æ•°æ®ç›®å½•è·¯å¾„ã€‚ /var/lib/mysql --datadir=/data/mysql å¢é‡å¤‡ä»½ --incremental é€‰é¡¹ æ‰§è¡Œå¢é‡å¤‡ä»½ã€‚ false --incremental --target-dir=/backup/inc1 --incremental-basedir é€‰é¡¹ æŒ‡å®šå¢é‡å¤‡ä»½çš„åŸºç¡€ç›®å½•ï¼ˆä¸Šä¸€æ¬¡å…¨é‡æˆ–å¢é‡å¤‡ä»½çš„è·¯å¾„ï¼‰ã€‚ - --incremental-basedir=/backup/full --incremental-lsn é€‰é¡¹ æ‰‹åŠ¨æŒ‡å®šå¢é‡å¤‡ä»½çš„èµ·å§‹ LSNï¼ˆæ›¿ä»£ --incremental-basedirï¼‰ã€‚ - --incremental-lsn=12345678 å‹ç¼©ä¸è§£å‹ --compress é€‰é¡¹ å¯ç”¨å¤‡ä»½æ–‡ä»¶å‹ç¼©ï¼ˆä½¿ç”¨ QuickLZ ç®—æ³•ï¼‰ã€‚ false --compress --compress-threads é€‰é¡¹ æŒ‡å®šå‹ç¼©çº¿ç¨‹æ•°ï¼ˆå¹¶è¡Œå‹ç¼©ï¼‰ã€‚ 1 --compress --compress-threads=4 --decompress é€‰é¡¹ è§£å‹å·²å‹ç¼©çš„å¤‡ä»½æ–‡ä»¶ï¼ˆéœ€åœ¨ --prepare é˜¶æ®µä½¿ç”¨ï¼‰ã€‚ false xtrabackup --prepare --decompress --target-dir=/backup åŠ å¯† --encrypt é€‰é¡¹ å¯ç”¨å¤‡ä»½æ–‡ä»¶åŠ å¯†ï¼ˆæ”¯æŒ AES128/AES192/AES256ï¼‰ã€‚ false --encrypt=AES256 --encrypt-key é€‰é¡¹ ç›´æ¥æŒ‡å®šåŠ å¯†å¯†é’¥ï¼ˆä¸æ¨èï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼‰ã€‚ - --encrypt-key=\"MySecretKey123\" --encrypt-key-file é€‰é¡¹ ä»æ–‡ä»¶è¯»å–åŠ å¯†å¯†é’¥ï¼ˆæ¨èæ–¹å¼ï¼‰ã€‚ - --encrypt-key-file=/path/to/keyfile --encrypt-threads é€‰é¡¹ æŒ‡å®šåŠ å¯†çº¿ç¨‹æ•°ï¼ˆå¹¶è¡ŒåŠ å¯†ï¼‰ã€‚ 1 --encrypt=AES256 --encrypt-threads=4 å¹¶è¡Œå¤„ç† --parallel é€‰é¡¹ æŒ‡å®šå¤‡ä»½æˆ–æ¢å¤æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆåŠ é€Ÿå¤§æ–‡ä»¶æ“ä½œï¼‰ã€‚ 1 --parallel=4 --use-memory é€‰é¡¹ æŒ‡å®š --prepare é˜¶æ®µå¯ç”¨çš„å†…å­˜å¤§å°ï¼ˆæé«˜å¤„ç†é€Ÿåº¦ï¼‰ã€‚ 100MB --use-memory=2G æ—¥å¿—ä¸ç›‘æ§ --log é€‰é¡¹ æŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµ --log=/var/log/xtrabackup.log --stream é€‰é¡¹ å°†å¤‡ä»½æµå¼ä¼ è¾“åˆ°æ ‡å‡†è¾“å‡ºï¼ˆé€šå¸¸ç»“åˆå‹ç¼©æˆ–åŠ å¯†ä½¿ç”¨ï¼‰ã€‚ false --stream=xbstream | gzip \u003e backup.xbstream.gz --stats é€‰é¡¹ è¾“å‡ºå¤‡ä»½ç»Ÿè®¡ä¿¡æ¯ï¼ˆéœ€é…åˆ --backup ä½¿ç”¨ï¼‰ã€‚ false --stats é«˜çº§é€‰é¡¹ --slave-info é€‰é¡¹ å¤‡ä»½ä»åº“æ—¶è®°å½•å¤åˆ¶ä¿¡æ¯ï¼ˆç”¨äºæ„å»ºæ–°ä»åº“ï¼‰ã€‚ false --slave-info --safe-slave-backup é€‰é¡¹ åœæ­¢å¤åˆ¶çº¿ç¨‹ä»¥ç¡®ä¿å¤‡ä»½ä¸€è‡´æ€§ï¼ˆä»åº“å¤‡ä»½æ—¶ä½¿ç”¨ï¼‰ã€‚ false --safe-slave-backup --throttle é€‰é¡¹ é™åˆ¶å¤‡ä»½æ—¶çš„ I/O æ“ä½œé€Ÿç‡ï¼ˆå•ä½ï¼šIOPSï¼‰ã€‚ 0ï¼ˆæ— é™åˆ¶ï¼‰ --throttle=100 --version-check é€‰é¡¹ æ£€æŸ¥ Percona Server æˆ– MySQL ç‰ˆæœ¬å…¼å®¹æ€§ã€‚ true --version-check=false ","date":"2024-12-17","objectID":"/xtrabackup/:7:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"å…³é”®å‚æ•°ä½¿ç”¨ç¤ºä¾‹ 1. å…¨é‡å¤‡ä»½ + å‹ç¼© + åŠ å¯† xtrabackup --backup \\ --target-dir=/backup/full \\ --compress \\ --compress-threads=4 \\ --encrypt=AES256 \\ --encrypt-key-file=/etc/mysql/xtrabackup.key \\ --encrypt-threads=4 2. å¢é‡å¤‡ä»½ # ç¬¬ä¸€æ¬¡å¢é‡ï¼ˆåŸºäºå…¨é‡ï¼‰ xtrabackup --backup \\ --target-dir=/backup/inc1 \\ --incremental-basedir=/backup/full # ç¬¬äºŒæ¬¡å¢é‡ï¼ˆåŸºäºå‰ä¸€æ¬¡å¢é‡ï¼‰ xtrabackup --backup \\ --target-dir=/backup/inc2 \\ --incremental-basedir=/backup/inc1 3. å‡†å¤‡å¤‡ä»½å¹¶è§£å‹ # è§£å‹å¹¶åº”ç”¨æ—¥å¿— xtrabackup --prepare \\ --target-dir=/backup/full \\ --decompress è¡¥å…… å®‰è£… qpress è§£å‹ç¼© qpress ä¾¿æºå¼é«˜é€Ÿæ–‡ä»¶å½’æ¡£å™¨ å½“å…¨é‡å¤‡ä»½è¿›è¡Œå‹ç¼©åï¼Œåœ¨è¿˜åŸæ—¶è§£å‹éœ€è¦è§£å‹æ—¶éœ€è¦qpresså‘½ä»¤ $ wget -d --user-agent=\"Mozilla/5.0 (Windows NT x.y; rv:10.0) Gecko/20100101 Firefox/10.0\" https://docs-tencentdb-1256569818.cos.ap-guangzhou.myqcloud.com/qpress-11-linux-x64.tar $ tar -xf qpress-11-linux-x64.tar -C /usr/local/bin $ source /etc/profile ","date":"2024-12-17","objectID":"/xtrabackup/:7:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"æ³¨æ„äº‹é¡¹ åŠ å¯†å¯†é’¥ç®¡ç†ï¼š ä¼˜å…ˆä½¿ç”¨ --encrypt-key-file æ›¿ä»£ --encrypt-keyï¼Œé¿å…å¯†é’¥æ³„éœ²ã€‚ å¯†é’¥æ–‡ä»¶éœ€ä¸¥æ ¼é™åˆ¶æƒé™ï¼ˆå¦‚ chmod 600ï¼‰ã€‚ å¹¶è¡Œä¸èµ„æºå ç”¨ï¼š é«˜å¹¶å‘ï¼ˆ--parallelã€--compress-threadsï¼‰å¯èƒ½æ˜¾è‘—å¢åŠ  CPU å’Œå†…å­˜æ¶ˆè€—ã€‚ ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®æ ¹æ®ç¡¬ä»¶èµ„æºè°ƒæ•´ã€‚ ç‰ˆæœ¬å…¼å®¹æ€§ï¼š XtraBackup 2.4 æ”¯æŒ MySQL 5.1~5.7 å’Œ Percona Server å¯¹åº”ç‰ˆæœ¬ã€‚ ç¡®ä¿å¤‡ä»½å·¥å…·ä¸æ•°æ®åº“ç‰ˆæœ¬åŒ¹é…ã€‚ å¢é‡å¤‡ä»½ä¾èµ–é“¾ï¼š å¢é‡å¤‡ä»½å¿…é¡»åŸºäºå®Œæ•´çš„å…¨é‡å¤‡ä»½é“¾ï¼Œæ¢å¤æ—¶éœ€æŒ‰é¡ºåºåˆå¹¶æ‰€æœ‰å¢é‡ã€‚ å®šæœŸæ¸…ç†è¿‡æ—¶çš„å¤‡ä»½é“¾ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ é€šè¿‡åˆç†ç»„åˆè¿™äº›å‚æ•°ï¼Œå¯ä»¥å®ç°é«˜æ•ˆã€å®‰å…¨çš„æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤æ“ä½œã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:7:3","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¸ƒã€ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“å¤‡ä»½ç­–ç•¥ ","date":"2024-12-17","objectID":"/xtrabackup/:8:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¸€ã€å¤‡ä»½é¢‘ç‡å»ºè®® 1. å…¨é‡å¤‡ä»½é¢‘ç‡ å»ºè®®å‘¨æœŸï¼šæ¯å‘¨ 1 æ¬¡å…¨é‡å¤‡ä»½ ç†ç”±ï¼š å…¨é‡å¤‡ä»½æ˜¯æ¢å¤çš„åŸºç¡€ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚ å¦‚æœæ•°æ®é‡è¾ƒå°ï¼ˆå¦‚ TB çº§ä»¥ä¸‹ï¼‰ï¼Œå»ºè®®æ¯å‘¨æ‰§è¡Œä¸€æ¬¡å…¨é‡å¤‡ä»½ã€‚ å¦‚æœæ•°æ®é‡æå¤§ï¼ˆå¦‚æ•°å TBï¼‰ï¼Œå¯å»¶é•¿è‡³æ¯ 2 å‘¨ä¸€æ¬¡ï¼Œä½†éœ€ç»“åˆå¢é‡å¤‡ä»½ç­–ç•¥é™ä½é£é™©ã€‚ æ‰§è¡Œæ—¶é—´ï¼š é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸï¼ˆå¦‚å‡Œæ™¨ï¼‰ä»¥å‡å°‘å¯¹ I/O å’Œ CPU çš„å½±å“ã€‚ 2. å¢é‡å¤‡ä»½é¢‘ç‡ å»ºè®®å‘¨æœŸï¼šæ¯æ—¥ 1 æ¬¡å¢é‡å¤‡ä»½ ç†ç”±ï¼š å¢é‡å¤‡ä»½ä»…æ•è·è‡ªä¸Šæ¬¡å…¨é‡æˆ–å¢é‡åçš„æ•°æ®å˜åŒ–ï¼Œèµ„æºå ç”¨ä½ã€‚ æ¯æ—¥ä¸€æ¬¡å¯å¹³è¡¡ RPOï¼ˆæ¢å¤ç‚¹ç›®æ ‡ï¼‰ä¸å­˜å‚¨æˆæœ¬ã€‚ ç‰¹æ®Šæƒ…å†µè°ƒæ•´ï¼š è‹¥æ•°æ®å˜æ›´é¢‘ç¹ï¼ˆå¦‚ç”µå•†å¤§ä¿ƒæœŸé—´ï¼‰ï¼Œå¯ç¼©çŸ­è‡³æ¯å°æ—¶ä¸€æ¬¡å¢é‡å¤‡ä»½ã€‚ è‹¥æ•°æ®å˜æ›´æå°‘ï¼ˆå¦‚é™æ€é…ç½®åº“ï¼‰ï¼Œå¯æ”¾å®½è‡³æ¯ 2-3 å¤©ä¸€æ¬¡ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:8:1","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"äºŒã€å¤‡ä»½ç­–ç•¥ç¤ºä¾‹ å‘¨ä¸€ï¼šå…¨é‡å¤‡ä»½ï¼ˆbaseï¼‰ å‘¨äºŒ~å‘¨æ—¥ï¼šæ¯æ—¥å¢é‡å¤‡ä»½ï¼ˆinc1, inc2, ..., inc6ï¼‰ ä¸‹å‘¨ä¸€ï¼šæ–°ä¸€è½®å…¨é‡å¤‡ä»½ + æ¸…ç†æ—§å¤‡ä»½é“¾ ","date":"2024-12-17","objectID":"/xtrabackup/:8:2","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¸‰ã€å…³é”®æ³¨æ„äº‹é¡¹ 1. å¤‡ä»½ä¿ç•™ç­–ç•¥ ä¿ç•™è‡³å°‘ 2-3 ä¸ªå…¨é‡å¤‡ä»½é“¾ï¼ˆå¦‚æœ€è¿‘ 2 å‘¨çš„å¤‡ä»½ï¼‰ï¼Œé˜²æ­¢å¤‡ä»½æŸåæˆ–è¯¯åˆ ã€‚ å¢é‡å¤‡ä»½éœ€ä¸å…¶ä¾èµ–çš„å…¨é‡å¤‡ä»½å…±åŒä¿ç•™ï¼Œç¡®ä¿æ¢å¤é“¾å®Œæ•´ã€‚ 2. æ¢å¤æ—¶é—´ä¼˜åŒ– å¢é‡å¤‡ä»½é“¾ä¸å®œè¿‡é•¿ï¼ˆå»ºè®®ä¸è¶…è¿‡ 7 æ¬¡å¢é‡ï¼‰ï¼Œå¦åˆ™æ¢å¤æ—¶åˆå¹¶æ—¶é—´å¯èƒ½è¶…å‡º RTOã€‚ è‹¥å¢é‡é“¾è¿‡é•¿ï¼Œå¯è°ƒæ•´å…¨é‡å¤‡ä»½é¢‘ç‡ï¼ˆå¦‚æ¯ 3 å¤©ä¸€æ¬¡å…¨é‡ï¼‰ã€‚ 3. ç»“åˆ Binlog å®ç°ç²¾ç»†åŒ–æ¢å¤ å¯ç”¨ MySQL Binlogï¼ŒæŒ‰éœ€ï¼ˆå¦‚æ¯ 5-15 åˆ†é’Ÿï¼‰å½’æ¡£ Binlog æ–‡ä»¶ã€‚ æ¢å¤æ—¶ï¼Œå…ˆé€šè¿‡ XtraBackup è¿˜åŸåˆ°æœ€è¿‘å¤‡ä»½ç‚¹ï¼Œå†é€šè¿‡ Binlog æ¢å¤åˆ°ç²¾ç¡®æ—¶é—´ç‚¹ã€‚ 4. ç›‘æ§ä¸éªŒè¯ ç›‘æ§å¤‡ä»½ä»»åŠ¡çŠ¶æ€ï¼Œç¡®ä¿æ— å¤±è´¥æˆ–é—æ¼ã€‚ å®šæœŸæ¼”ç»ƒæ¢å¤æµç¨‹ï¼ˆå¦‚æ¯å­£åº¦ä¸€æ¬¡ï¼‰ï¼ŒéªŒè¯å¤‡ä»½æœ‰æ•ˆæ€§ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:8:3","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"å››ã€å…¸å‹åœºæ™¯è°ƒæ•´å»ºè®® åœºæ™¯ å…¨é‡å¤‡ä»½é¢‘ç‡ å¢é‡å¤‡ä»½é¢‘ç‡ å¤‡æ³¨ å°å‹æ•°æ®åº“ï¼ˆ\u003c 100GBï¼‰ æ¯å‘¨ 1 æ¬¡ æ¯æ—¥ 1 æ¬¡ æ¢å¤é€Ÿåº¦å¿«ï¼Œèµ„æºå‹åŠ›å°ã€‚ ä¸­å‹æ•°æ®åº“ï¼ˆ100GB~1TBï¼‰ æ¯å‘¨ 1 æ¬¡ æ¯æ—¥ 1 æ¬¡ï¼ˆæˆ– 12h/æ¬¡ï¼‰ å¢é‡é¢‘ç‡å¯æ ¹æ®ç™½å¤©/å¤œé—´è´Ÿè½½è°ƒæ•´ã€‚ å¤§å‹æ•°æ®åº“ï¼ˆ\u003e 1TBï¼‰ æ¯å‘¨ 1 æ¬¡ æ¯æ—¥ 2-4 æ¬¡ ç¼©çŸ­å¢é‡é—´éš”ï¼Œé¿å…å•æ¬¡å¢é‡è¿‡å¤§ã€‚ è¶…é«˜å†™å…¥è´Ÿè½½æ•°æ®åº“ æ¯ 3 å¤© 1 æ¬¡ æ¯å°æ—¶ 1 æ¬¡ é€šè¿‡æ›´é¢‘ç¹å…¨é‡å¤‡ä»½å‡å°‘å¢é‡é“¾é•¿åº¦ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:8:4","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"æ€»ç»“ æ ¸å¿ƒåŸåˆ™ï¼šå…¨é‡å¤‡ä»½é¢‘ç‡ç”±æ•°æ®é‡å’Œæ¢å¤æ—¶é—´å®¹å¿åº¦å†³å®šï¼Œå¢é‡å¤‡ä»½é¢‘ç‡ç”±æ•°æ®å˜æ›´é€Ÿåº¦å†³å®šã€‚ å¹³è¡¡ç‚¹ï¼šåœ¨å­˜å‚¨æˆæœ¬ã€å¤‡ä»½èµ„æºå¼€é”€ã€RTO/RPO ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ã€‚ åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®ä¸šåŠ¡å‘¨æœŸï¼ˆå¦‚èŠ‚å‡æ—¥ã€ä¿ƒé”€ï¼‰çµæ´»è°ƒæ•´å¤‡ä»½ç­–ç•¥ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:8:5","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"å…«ã€å…³é”®æ³¨æ„äº‹é¡¹ å®šæœŸéªŒè¯å¤‡ä»½ï¼šé€šè¿‡æ¢å¤æµ‹è¯•ç¡®ä¿å¤‡ä»½æœ‰æ•ˆæ€§ã€‚ ç›‘æ§å¤‡ä»½ä»»åŠ¡ï¼šç»“åˆ cron æˆ–å·¥å…·ï¼ˆå¦‚ Rundeckï¼‰è‡ªåŠ¨åŒ–å¤‡ä»½ã€‚ å¤‡ä»½ä¿ç•™ç­–ç•¥ï¼šä¿ç•™å¤šä¸ªå…¨é‡+å¢é‡å¤‡ä»½ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚ æ··åˆä½¿ç”¨ç­–ç•¥ï¼šXtraBackup + Binlog æä¾›åŒé‡ä¿éšœï¼Œæ”¯æŒæ—¶é—´ç‚¹æ¢å¤ï¼ˆPITRï¼‰ã€‚ é€šè¿‡åˆç†é€‰æ‹©å·¥å…·å’Œç­–ç•¥ï¼Œå¯ç¡®ä¿ MySQL æ•°æ®çš„é«˜æ•ˆå¤‡ä»½ä¸å¯é æ¢å¤ã€‚ ","date":"2024-12-17","objectID":"/xtrabackup/:9:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"ä¹ã€æœ€ä½³å®è·µ å§‹ç»ˆæ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§ï¼šåœ¨å‡çº§ MySQL æˆ– XtraBackup å‰ï¼ŒæŸ¥é˜… Percona å®˜æ–¹æ–‡æ¡£ã€‚ æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹ï¼šåœ¨éç”Ÿäº§ç¯å¢ƒéªŒè¯å¤‡ä»½æ–‡ä»¶çš„å¯ç”¨æ€§ã€‚ è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†ï¼šä½¿ç”¨ Ansible/Puppet ç­‰å·¥å…·ç¡®ä¿ç¯å¢ƒç‰ˆæœ¬ä¸€è‡´ã€‚ å°†è¢«å¤‡ä»½æ•°æ®æ”¾åˆ°è¿œç¨‹æ•°æ®åº“ä¸»æœºä¸‹ï¼šæå‡å®‰å…¨æ€§ ","date":"2024-12-17","objectID":"/xtrabackup/:10:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["MySQL"],"content":"å‚è€ƒ XtraDB Backup å®˜ç½‘ Percona Operator for MySQL based on Percona Server for MySQL XtraDB Backup ä¸‹è½½ github autoxtrabackup script gitee autoxtrabackup script ","date":"2024-12-17","objectID":"/xtrabackup/:11:0","tags":["MySQL","XtraBackup"],"title":"XtraDB Backupï¼ˆPercona XtraBackupï¼‰å¤‡ä»½MySQLè¯¦ç»†ä»‹ç»","uri":"/xtrabackup/"},{"categories":["linux"],"content":"iptables æ˜¯è¿ç»´ä¸­çš„é‡ç‚¹ä½†ä¸ç®—æ˜¯ç‰¹åˆ«çš„éš¾ç‚¹ï¼Œæ˜¯ç½‘ç«™è®¿é—®çš„å¤§é—¨ï¼Œæœ¬ç¯‡è®°å½•å¯¹ iptables çš„å¸¸ç”¨æ¢³ç† ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:0:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"æ¦‚è¿° å°ç«¯å£ å°IP å®ç°Natä¸Šç½‘ å…±äº«ä¸Šç½‘ ç«¯å£æ˜ å°„(ç«¯å£è½¬å‘)ï¼Œip æ˜ å°„ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:1:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"æ ¸å¿ƒè§£é‡Š iptablesé€‚ç”¨linuxæ‰€æœ‰å‘è¡Œç‰ˆï¼Œyumå®‰è£…æ–¹å¼ä¸º â€œyum install iptables-servicesâ€ iptablesåŸºäºlinux netfilter, Netfilteræ˜¯Linux 2.4.xå¼•å…¥çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œå®ƒä½œä¸ºä¸€ä¸ªé€šç”¨çš„ã€æŠ½è±¡çš„æ¡†æ¶ï¼Œæä¾›ä¸€æ•´å¥—çš„hookå‡½æ•°çš„ç®¡ç†æœºåˆ¶ï¼Œä½¿å¾—è¯¸å¦‚æ•°æ®åŒ…è¿‡æ»¤ã€ç½‘ç»œåœ°å€è½¬æ¢(NAT)å’ŒåŸºäºåè®®ç±»å‹çš„è¿æ¥è·Ÿè¸ªæˆä¸ºäº†å¯èƒ½ linux å†…æ ¸ä¸­ï¼Œnetfilterï¼Œ nf_* çš„é…ç½®éƒ½ä¼šå½±å“netfilterçš„æ€§èƒ½ iptablesç»“æ„ï¼šiptables -\u003e Tables -\u003e Chains -\u003e Rules. å³tablesç”±chainsç»„æˆï¼Œè€Œchainsç”±rulesç»„æˆ iptables æ”¯æŒè¡¨ç±»å‹æœ‰ filter ï¼ˆé»˜è®¤ï¼‰ï¼Œ natï¼Œ mangleï¼Œ raw ï¼Œ ä¼˜å…ˆçº§ raw \u003e mangle \u003e nat \u003e filter iptables çš„ nat åŠŸèƒ½ä¾èµ–linuxå†…æ ¸çš„net.ipv4.ip_forwardï¼Œ net.ipv6.ip_forward iptables çš„ nat åŠŸèƒ½åŒ…å«snatï¼Œdnatï¼Œå…¶ä¸­snatä»…ç”¨äºpostrouting MASQUERADEæ˜¯SNATçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œä¸»è¦ç”¨äºåŠ¨æ€è¿”å›snatåœ°å€ é˜²ç«å¢™å®ä¾‹: (/etc/sysconfig/iptablesï¼‰ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:2:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptableså’Œnetfilterçš„å…³ç³» Iptableså’Œnetfilterçš„å…³ç³»æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è®©äººæä¸æ¸…çš„é—®é¢˜ã€‚å¾ˆå¤šçš„çŸ¥é“iptableså´ä¸çŸ¥é“netfilterã€‚å…¶å®iptablesåªæ˜¯Linuxé˜²ç«å¢™çš„ç®¡ç†å·¥å…·è€Œå·²ï¼Œä½äº/sbin/iptablesã€‚çœŸæ­£å®ç°é˜²ç«å¢™åŠŸèƒ½çš„æ˜¯netfilterï¼Œå®ƒæ˜¯Linuxå†…æ ¸ä¸­å®ç°åŒ…è¿‡æ»¤çš„å†…éƒ¨ç»“æ„ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:3:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptables ç®¡ç† å®‰è£…äº†iptables-serviceåæ–¹ä¾¿é€šè¿‡systemdç®¡ç†iptablesæœåŠ¡ $ sudo yum install iptables-services $ sudo rpm -ql iptables-services /etc/sysconfig/ip6tables /etc/sysconfig/iptables # é˜²ç«å¢™é…ç½®æ–‡ä»¶ /usr/lib/systemd/system/ip6tables.service /usr/lib/systemd/system/iptables.service # é˜²ç«å¢™é…ç½®æ–‡ä»¶(å‘½ä»¤) systemctl start iptables ... $ sudo rpm -ql iptables ... /usr/sbin/ip6tables /usr/sbin/ip6tables-restore /usr/sbin/ip6tables-save /usr/sbin/iptables # iptables å‘½ä»¤ æ·»åŠ /åˆ é™¤/æŸ¥çœ‹ è§„åˆ™(4è¡¨5é“¾) /usr/sbin/iptables-restore # æ¢å¤ /usr/sbin/iptables-save # iptablesè§„åˆ™ è¾“å‡º(ä¿å­˜) /usr/sbin/xtables-multi ... æ³¨æ„: ä½¿ç”¨iptables è®°å¾—å°†firewalld å…³é—­æ‰systemctl disable firewalld é˜²ç«å¢™æ¿€æ´» é˜²æŠ¤å¢™æ˜¯é»˜è®¤åµŒå…¥åˆ°linuxå†…æ ¸ä¸­ï¼Œä½†æ˜¯æ²¡æœ‰é»˜è®¤æ¿€æ´»,lsmodæŸ¥çœ‹å†…æ ¸ä¸­åŠ è½½äº†å“ªäº›æ¨¡å— $ sudo lsmod|egrep \"iptables|nat|filter\" xt_nat 12681 4 nf_nat_masquerade_ipv4 13463 1 ipt_MASQUERADE iptable_nat 12875 1 nf_nat_ipv4 14115 1 iptable_nat nf_nat 26583 3 nf_nat_ipv4,xt_nat,nf_nat_masquerade_ipv4 nf_conntrack 143411 6 nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4 iptable_filter 12810 1 br_netfilter 22256 0 bridge 155432 1 br_netfilter ip_tables 27126 2 iptable_filter,iptable_nat libcrc32c 12644 3 xfs,nf_nat,nf_conntrack ä¸´æ—¶åŠ è½½å’Œæ°¸ä¹…åŠ è½½ # 1. å†™å…¥åˆ°å¼€æœºå¯åŠ¨ $ modprobe iptable_filter $ modprobe iptable_nat $ modprobe iptable_mangle $ modprobe iptable_raw $ modprobe nf_conntrack $ modprobe nf_conntrack_ipv4 $ modprobe nf_nat # éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸ $ lsmod | grep iptable $ lsmod | grep nf_conntrack # 2. æ°¸ä¹… $ cat \u003e /etc/modules-load.d/iptables.conf \u003c\u003cEOF iptable_filter iptable_nat iptable_mangle iptable_raw nf_conntrack nf_conntrack_ipv4 nf_nat EOF # éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸ $ sudo lsmod|egrep \"iptables|nat|filter\" æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„è§„åˆ™ # 1. é»˜è®¤æ˜¯æŸ¥çœ‹filter è¡¨ $ iptables -nL # 2. æŸ¥çœ‹nat è¡¨çš„è§„åˆ™ $ iptables -t nat -nL ç¤ºä¾‹ $ iptables -nL Chain INPUT (policy ACCEPT) # é“¾é»˜è®¤è§„åˆ™ target prot opt source destination ACCEPT tcp -- 192.168.47.0/24 0.0.0.0/0 tcp dpt:30181 # è§„åˆ™ Chain FORWARD (policy ACCEPT) # é“¾é»˜è®¤è§„åˆ™ target prot opt source destination DOCKER-USER all -- 0.0.0.0/0 0.0.0.0/0 # è§„åˆ™ Chain OUTPUT (policy ACCEPT) target prot opt source destination ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:4:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptablesä¼ è¾“æ•°æ®åŒ…çš„è¿‡ç¨‹ å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ç½‘å¡æ—¶ï¼Œå®ƒé¦–å…ˆè¿›å…¥PREROUTINGé“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„IPåˆ¤æ–­æ˜¯å¦éœ€è¦è½¬é€å‡ºå»ã€‚ å¦‚æœæ•°æ®åŒ…å°±æ˜¯è¿›å…¥æœ¬æœºçš„ï¼Œå®ƒå°±ä¼šæ²¿ç€å›¾å‘ä¸‹ç§»åŠ¨ï¼Œåˆ°è¾¾INPUTé“¾ã€‚æ•°æ®åŒ…åˆ°äº†INPUTé“¾åï¼Œä»»ä½•è¿›ç¨‹éƒ½ä¼šæ”¶åˆ°å®ƒã€‚æœ¬æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥å‘é€æ•°æ®åŒ…ï¼Œè¿™äº›æ•°æ®åŒ…ä¼šç»è¿‡OUTPUTé“¾ï¼Œç„¶ååˆ°è¾¾POSTROUTINGé“¾è¾“å‡ºã€‚ å¦‚æœæ•°æ®åŒ…æ˜¯è¦è½¬å‘å‡ºå»çš„ï¼Œä¸”å†…æ ¸å…è®¸è½¬å‘ï¼Œæ•°æ®åŒ…å°±ä¼šå¦‚å›¾æ‰€ç¤ºå‘å³ç§»åŠ¨ï¼Œç»è¿‡FORWARDé“¾ï¼Œç„¶ååˆ°è¾¾POSTROUTINGé“¾è¾“å‡ºã€‚ iptablesä¼ è¾“æ•°æ®åŒ…çš„è¿‡ç¨‹\r","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:5:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"4è¡¨-5é“¾-è§„åˆ™ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:6:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"é˜²ç«å¢™çš„ç§ç±»åŠä½¿ç”¨è¯´æ˜ ç¡¬ä»¶ï¼šæ•´ä¸ªä¼ä¸šå…¥å£ ä¸‰å±‚è·¯ç”±ï¼šH3C åä¸º Cisco(æ€ç§‘) é˜²æŠ¤å¢™ï¼šæ·±ä¿¡æœ è½¯ä»¶ï¼šå¼€æºè½¯ä»¶ ç½‘ç«™å†…éƒ¨ å°ip iptables å†™å…¥åˆ°Linux å†…æ ¸ä¸­ ä»¥åæœåŠ¡docker å·¥ä½œåœ¨4å±‚ firewalld C7 nftables C8 ufw(ubuntu fire wall) Ubuntu äº‘é˜²ç«å¢™(å…¬æœ‰äº‘) é˜¿é‡Œäº‘ å®‰å…¨ç»„(å°ip,å°ç«¯å£) NATç½‘å…³(å…±äº«ä¸Šç½‘ï¼Œç«¯å£æ˜ å°„) wafåº”ç”¨é˜²ç«å¢™ wafé˜²ç«å¢™(åº”ç”¨é˜²ç«å¢™ï¼Œå¤„ç†7å±‚çš„æ”»å‡»)SQLæ³¨å…¥ åè¯ç®€è¦ç†Ÿæ‚‰ å®¹å™¨ è¡¨ï¼šå­˜æ”¾é“¾çš„å®¹å™¨ï¼Œé˜²ç«å¢™æœ€å¤§æ¦‚å¿µ é“¾ï¼šå­˜æ”¾è§„åˆ™çš„å®¹å™¨ è§„åˆ™ï¼šå‡†è®¸æˆ–æ‹’ç»è§„åˆ™ï¼Œæœªæ¥å†™çš„é˜²ç«å¢™æ¡ä»¶å°±æ˜¯å„ç§é˜²ç«å¢™è§„åˆ™ è¯¦ç»†è§£é‡Šï¼š è¡¨ï¼ˆtablesï¼‰æä¾›ç‰¹å®šçš„åŠŸèƒ½ï¼Œiptableså†…ç½®äº†4ä¸ªè¡¨ï¼Œå³filterè¡¨ã€natè¡¨ã€mangleè¡¨å’Œrawè¡¨ï¼Œåˆ†åˆ«ç”¨äºå®ç°åŒ…è¿‡æ»¤ï¼Œç½‘ç»œåœ°å€è½¬æ¢ã€åŒ…é‡æ„(ä¿®æ”¹)å’Œæ•°æ®è·Ÿè¸ªå¤„ç†ã€‚ é“¾ï¼ˆchainsï¼‰æ˜¯æ•°æ®åŒ…ä¼ æ’­çš„è·¯å¾„ï¼Œæ¯ä¸€æ¡é“¾å…¶å®å°±æ˜¯ä¼—å¤šè§„åˆ™ä¸­çš„ä¸€ä¸ªæ£€æŸ¥æ¸…å•ï¼Œæ¯ä¸€æ¡é“¾ä¸­å¯ä»¥æœ‰ä¸€æ¡æˆ–æ•°æ¡è§„åˆ™ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªé“¾æ—¶ï¼Œiptableså°±ä¼šä»é“¾ä¸­ç¬¬ä¸€æ¡è§„åˆ™å¼€å§‹æ£€æŸ¥ï¼Œçœ‹è¯¥æ•°æ®åŒ…æ˜¯å¦æ»¡è¶³è§„åˆ™æ‰€å®šä¹‰çš„æ¡ä»¶ã€‚å¦‚æœæ»¡è¶³ï¼Œç³»ç»Ÿå°±ä¼šæ ¹æ®è¯¥æ¡è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•å¤„ç†è¯¥æ•°æ®åŒ…ï¼›å¦åˆ™iptableså°†ç»§ç»­æ£€æŸ¥ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœè¯¥æ•°æ®åŒ…ä¸ç¬¦åˆé“¾ä¸­ä»»ä¸€æ¡è§„åˆ™ï¼Œiptableså°±ä¼šæ ¹æ®è¯¥é“¾é¢„å…ˆå®šä¹‰çš„é»˜è®¤ç­–ç•¥æ¥å¤„ç†æ•°æ®åŒ…ã€‚ Iptablesé‡‡ç”¨â€œè¡¨â€å’Œâ€œé“¾â€çš„åˆ†å±‚ç»“æ„ã€‚åœ¨REHL4ä¸­æ˜¯ä¸‰å¼ è¡¨äº”ä¸ªé“¾ã€‚ç°åœ¨REHL5ã€6æˆäº†å››å¼ è¡¨äº”ä¸ªé“¾äº†ï¼Œä¸è¿‡å¤šå‡ºæ¥çš„é‚£ä¸ªè¡¨ç”¨çš„ä¹Ÿä¸å¤ªå¤šï¼Œæ‰€ä»¥åŸºæœ¬è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ã€‚ä¸‹é¢ç½—åˆ—ä¸€ä¸‹è¿™å››å¼ è¡¨å’Œäº”ä¸ªé“¾ã€‚æ³¨æ„ä¸€å®šè¦æ˜ç™½è¿™äº›è¡¨å’Œé“¾çš„å…³ç³»åŠä½œç”¨ã€‚ å››è¡¨äº”é“¾\r","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:6:1","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"è§„åˆ™è¡¨ filterè¡¨â€”â€”ä¸‰ä¸ªé“¾ï¼šINPUTã€FORWARDã€OUTPUT ä½œç”¨ï¼šè¿‡æ»¤æ•°æ®åŒ…Â å†…æ ¸æ¨¡å—ï¼šiptables_filter. Natè¡¨â€”â€”ä¸‰ä¸ªé“¾ï¼šPREROUTINGã€POSTROUTINGã€OUTPUT ä½œç”¨ï¼šç”¨äºç½‘ç»œåœ°å€è½¬æ¢ï¼ˆIPã€ç«¯å£ï¼‰ å†…æ ¸æ¨¡å—ï¼šiptable_nat Mangleè¡¨â€”â€”äº”ä¸ªé“¾ï¼šPREROUTINGã€POSTROUTINGã€INPUTã€OUTPUTã€FORWARD ä½œç”¨ï¼šä¿®æ”¹æ•°æ®åŒ…çš„æœåŠ¡ç±»å‹ã€TTLã€å¹¶ä¸”å¯ä»¥é…ç½®è·¯ç”±å®ç°QOSå†…æ ¸æ¨¡å—ï¼šiptable_mangle(åˆ«çœ‹è¿™ä¸ªè¡¨è¿™ä¹ˆéº»çƒ¦ï¼Œå’±ä»¬è®¾ç½®ç­–ç•¥æ—¶å‡ ä¹éƒ½ä¸ä¼šç”¨åˆ°å®ƒ) Rawè¡¨â€”â€”ä¸¤ä¸ªé“¾ï¼šOUTPUTã€PREROUTING ä½œç”¨ï¼šå†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç† å†…æ ¸æ¨¡å—ï¼šiptable_raw å¤‡æ³¨ï¼šå¸¸ç”¨çš„è¡¨æœ‰filterã€Natè¿™ä¸¤ä¸ªè¡¨ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:6:2","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"è§„åˆ™é“¾ INPUTâ€”â€”è¿›æ¥çš„æ•°æ®åŒ…åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥ OUTPUTâ€”â€”å¤–å‡ºçš„æ•°æ®åŒ…åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥ FORWARDâ€”â€”è½¬å‘æ•°æ®åŒ…æ—¶åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥ PREROUTINGâ€”â€”å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©å‰åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ ï¼ˆè®°ä½ï¼æ‰€æœ‰çš„æ•°æ®åŒ…è¿›æ¥çš„æ—¶ä¾¯éƒ½å…ˆç”±è¿™ä¸ªé“¾å¤„ç†ï¼‰ POSTROUTINGâ€”â€”å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©ååº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ ï¼ˆæ‰€æœ‰çš„æ•°æ®åŒ…å‡ºæ¥çš„æ—¶ä¾¯éƒ½å…ˆç”±è¿™ä¸ªé“¾å¤„ç†ï¼‰ å¤‡æ³¨ï¼šå¸¸ç”¨çš„è§„åˆ™é“¾æœ‰INPUTã€OUTPUTã€FORWARD ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:6:3","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å››è¡¨äº”é“¾è¯¦è§£ iptables æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äºé…ç½®é˜²ç«å¢™è§„åˆ™çš„æ ¸å¿ƒå·¥å…·ï¼ŒåŸºäº Netfilter æ¡†æ¶å®ç°ã€‚å®ƒçš„æ ¸å¿ƒé€»è¾‘å›´ç»• å››è¡¨äº”é“¾ å±•å¼€ï¼Œç”¨äºæ§åˆ¶ç½‘ç»œæ•°æ®åŒ…çš„ä¼ è¾“å’Œå¤„ç†æµç¨‹ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"ä¸€ã€å››è¡¨ï¼ˆTablesï¼‰ å››è¡¨æ˜¯è§„åˆ™çš„åˆ†ç±»å®¹å™¨ï¼Œæ¯ä¸ªè¡¨è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ï¼š filter è¡¨ï¼ˆé»˜è®¤è¡¨ï¼‰ åŠŸèƒ½ï¼šæ•°æ®åŒ…çš„è¿‡æ»¤ï¼ˆå…è®¸/æ‹’ç»ï¼‰ã€‚ åº”ç”¨åœºæ™¯ï¼šæ§åˆ¶è®¿é—®æƒé™ï¼ˆå¦‚ç¦æ­¢æŸä¸ª IP è®¿é—®ï¼‰ã€‚ å…³è”é“¾ï¼šINPUTã€FORWARDã€OUTPUTã€‚ nat è¡¨ï¼ˆNetwork Address Translationï¼‰ åŠŸèƒ½ï¼šç½‘ç»œåœ°å€è½¬æ¢ï¼ˆä¿®æ”¹æº/ç›®æ ‡ IP æˆ–ç«¯å£ï¼‰ã€‚ åº”ç”¨åœºæ™¯ï¼šç«¯å£è½¬å‘ï¼ˆDNATï¼‰ã€å…±äº«ä¸Šç½‘ï¼ˆSNATï¼‰ã€‚ å…³è”é“¾ï¼šPREROUTINGï¼ˆDNATï¼‰ã€POSTROUTINGï¼ˆSNATï¼‰ã€OUTPUTã€‚ mangle è¡¨ åŠŸèƒ½ï¼šä¿®æ”¹æ•°æ®åŒ…å†…å®¹ï¼ˆå¦‚ TTLã€TOS å­—æ®µï¼‰æˆ–æ ‡è®°æ•°æ®åŒ…ã€‚ åº”ç”¨åœºæ™¯ï¼šé«˜çº§æµé‡æ§åˆ¶ï¼ˆå¦‚ QoS æ ‡è®°ï¼‰ã€‚ å…³è”é“¾ï¼šæ‰€æœ‰äº”é“¾ï¼ˆPREROUTINGã€INPUTã€FORWARDã€OUTPUTã€POSTROUTINGï¼‰ã€‚ raw è¡¨ åŠŸèƒ½ï¼šç»•è¿‡è¿æ¥è·Ÿè¸ªï¼ˆConnection Trackingï¼‰ã€‚ åº”ç”¨åœºæ™¯ï¼šæé«˜æ€§èƒ½ï¼ˆå¦‚ç¦ç”¨æŸäº›è¿æ¥çš„è·Ÿè¸ªï¼‰ã€‚ å…³è”é“¾ï¼šPREROUTINGã€OUTPUTã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:1","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"äºŒã€äº”é“¾ï¼ˆChainsï¼‰ äº”é“¾æ˜¯æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ç»è¿‡çš„â€œæ£€æŸ¥ç‚¹â€ï¼Œå†³å®šäº†è§„åˆ™ç”Ÿæ•ˆçš„æ—¶æœºï¼š PREROUTING è§¦å‘æ—¶æœºï¼šæ•°æ®åŒ…è¿›å…¥ç½‘å¡åï¼Œè·¯ç”±å†³ç­–ä¹‹å‰ã€‚ å¸¸ç”¨è¡¨ï¼šnatï¼ˆDNATï¼‰ã€mangleã€rawã€‚ INPUT è§¦å‘æ—¶æœºï¼šæ•°æ®åŒ…ç›®æ ‡æ˜¯æœ¬æœºï¼ˆå¦‚è®¿é—®æœ¬åœ°æœåŠ¡ï¼‰ã€‚ å¸¸ç”¨è¡¨ï¼šfilterï¼ˆå…è®¸/æ‹’ç»ï¼‰ã€mangleã€‚ FORWARD è§¦å‘æ—¶æœºï¼šæ•°æ®åŒ…éœ€è¦è½¬å‘åˆ°å…¶ä»–è®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰ã€‚ å¸¸ç”¨è¡¨ï¼šfilterï¼ˆæ˜¯å¦å…è®¸è½¬å‘ï¼‰ã€mangleã€‚ OUTPUT è§¦å‘æ—¶æœºï¼šæœ¬æœºç”Ÿæˆçš„å‡ºç«™æ•°æ®åŒ…ï¼ˆå¦‚æœ¬æœºå‘èµ·çš„è¯·æ±‚ï¼‰ã€‚ å¸¸ç”¨è¡¨ï¼šfilterã€natã€mangleã€rawã€‚ POSTROUTING è§¦å‘æ—¶æœºï¼šæ•°æ®åŒ…ç¦»å¼€ç½‘å¡å‰ï¼Œè·¯ç”±å†³ç­–ä¹‹åã€‚ å¸¸ç”¨è¡¨ï¼šnatï¼ˆSNATï¼‰ã€mangleã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:2","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"ä¸‰ã€è¡¨å’Œé“¾çš„å¯¹åº”å…³ç³» è¡¨å æ”¯æŒçš„é“¾ filter INPUT, FORWARD, OUTPUT nat PREROUTING, OUTPUT, POSTROUTING mangle æ‰€æœ‰äº”é“¾ï¼ˆPREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTINGï¼‰ raw PREROUTING, OUTPUT ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:3","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å››ã€å¤„ç†ä¼˜å…ˆçº§ è¡¨çš„ä¼˜å…ˆçº§ï¼šraw â†’ mangle â†’ nat â†’ filterã€‚ ï¼ˆä¾‹å¦‚ï¼šPREROUTING é“¾ä¸­ï¼Œå…ˆå¤„ç† raw è¡¨è§„åˆ™ï¼Œå†å¤„ç† mangle è¡¨ï¼Œæœ€åæ˜¯ nat è¡¨ã€‚ï¼‰ é“¾çš„æµç¨‹ï¼š å…¥ç«™æµé‡ï¼šPREROUTING â†’ INPUT è½¬å‘æµé‡ï¼šPREROUTING â†’ FORWARD â†’ POSTROUTING å‡ºç«™æµé‡ï¼šOUTPUT â†’ POSTROUTING ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:4","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"äº”ã€å¸¸è§æ“ä½œç¤ºä¾‹ ç¦æ­¢æŸä¸ª IP è®¿é—®æœ¬æœºï¼ˆfilter è¡¨ + INPUT é“¾ï¼‰ï¼š iptables -A INPUT -s 192.168.1.100 -j DROP å°† 80 ç«¯å£è½¬å‘åˆ° 8080ï¼ˆnat è¡¨ + PREROUTING é“¾ï¼‰ï¼š iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080 ä¿®æ”¹å‡ºç«™æ•°æ®åŒ…çš„ TTLï¼ˆmangle è¡¨ + OUTPUT é“¾ï¼‰ï¼š iptables -t mangle -A OUTPUT -j TTL --ttl-set 64 é€šè¿‡ç†è§£å››è¡¨äº”é“¾çš„ä½œç”¨å’Œæµç¨‹ï¼Œå¯ä»¥æ›´ç²¾å‡†åœ°æ§åˆ¶ç½‘ç»œè¡Œä¸ºï¼Œä¾‹å¦‚å®ç°é˜²ç«å¢™ã€NATã€æµé‡æ ‡è®°ç­‰åŠŸèƒ½ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:7:5","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptables æ‰§è¡Œæµç¨‹ å·¥ä½œæµç¨‹å°ç»“ï¼š é˜²ç«å¢™æ˜¯å±‚å±‚è¿‡æ»¤çš„ï¼Œå®é™…æ˜¯æŒ‰ç…§é…ç½®è§„åˆ™çš„é¡ºåºä»ä¸Šåˆ°ä¸‹ï¼Œä»å‰åˆ°åè¿›è¡Œè¿‡æ»¤çš„ã€‚ å¦‚æœåŒ¹é…æˆåŠŸè§„åˆ™ï¼Œå³æ˜ç¡®è¡¨ç¤ºæ˜¯æ‹’ç»(DROP)è¿˜æ˜¯æ¥å—(ACCEPT),æ•°æ®åŒ…å°±ä¸å†å‘ä¸‹åŒ¹é…æ–°çš„è§„åˆ™ å¦‚æœè§„åˆ™ä¸­æ²¡æœ‰æ˜ç¡®è¡¨æ˜æ˜¯é˜»æ­¢è¿˜æ˜¯é€šè¿‡çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åŒ¹é…è§„åˆ™ï¼Œå‘ä¸‹è¿›è¡ŒåŒ¹é…ï¼Œç›´åˆ°åŒ¹é…é»˜è®¤è§„åˆ™å¾—åˆ°æ˜ç¡®çš„é˜»æ­¢è¿˜æ˜¯é€šè¿‡ é˜²ç«å¢™çš„é»˜è®¤è§„åˆ™æ˜¯æ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…å®Œæ‰ä¼šåŒ¹é…çš„ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:8:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å¸¸ç”¨ iptables å‚æ•°ç¼©å†™åŠå«ä¹‰ çŸ­é€‰é¡¹ å®Œæ•´å½¢å¼/å«ä¹‰ åŠŸèƒ½è¯´æ˜ -s --source åŒ¹é… æº IP åœ°å€æˆ–ç½‘æ®µï¼ˆå¦‚ -s 192.168.1.100 æˆ– -s 10.0.0.0/24ï¼‰ã€‚ -d --destination åŒ¹é… ç›®æ ‡ IP åœ°å€æˆ–ç½‘æ®µï¼ˆå¦‚ -d 203.0.113.5ï¼‰ã€‚ -p --protocol æŒ‡å®š åè®®ç±»å‹ï¼ˆå¦‚ -p tcpã€-p udpã€-p icmpï¼‰ã€‚ -j --jump æŒ‡å®šè§„åˆ™åŒ¹é…åçš„ åŠ¨ä½œï¼ˆå¦‚ -j ACCEPTã€-j DROPã€-j REJECTï¼‰ã€‚ -i --in-interface åŒ¹é… è¾“å…¥ç½‘ç»œæ¥å£ï¼ˆå¦‚ -i eth0ï¼‰ã€‚ -o --out-interface åŒ¹é… è¾“å‡ºç½‘ç»œæ¥å£ï¼ˆå¦‚ -o wlan0ï¼‰ã€‚ -m --match å¯ç”¨ æ‰©å±•æ¨¡å—ï¼ˆå¦‚ -m multiportã€-m state --state ESTABLISHEDï¼‰ã€‚ --sport --source-port åŒ¹é… æºç«¯å£ï¼ˆéœ€é…åˆ -p tcp æˆ– -p udpï¼Œå¦‚ --sport 22ï¼‰ã€‚ --dport --destination-port åŒ¹é… ç›®æ ‡ç«¯å£ï¼ˆéœ€é…åˆ -p tcp æˆ– -p udpï¼Œå¦‚ --dport 80ï¼‰ã€‚ -A --append åœ¨è§„åˆ™é“¾ æœ«å°¾è¿½åŠ  æ–°è§„åˆ™ï¼ˆå¦‚ -A INPUTï¼‰ã€‚ -I --insert åœ¨è§„åˆ™é“¾ æŒ‡å®šä½ç½®æ’å…¥ æ–°è§„åˆ™ï¼ˆé»˜è®¤æ’å…¥åˆ°å¼€å¤´ï¼Œå¦‚ -I INPUT 2 æ’åˆ°ç¬¬2æ¡ï¼‰ã€‚ -D --delete ä»è§„åˆ™é“¾ä¸­ åˆ é™¤ æŒ‡å®šè§„åˆ™ï¼ˆå¦‚ -D INPUT 3 åˆ é™¤ç¬¬3æ¡è§„åˆ™ï¼‰ã€‚ -L --list åˆ—å‡ºè§„åˆ™é“¾å†…å®¹ï¼ˆå¦‚ iptables -L INPUTï¼‰ã€‚ -F --flush æ¸…ç©ºè§„åˆ™é“¾ï¼ˆå¦‚ iptables -F INPUTï¼‰ã€‚ -N --new-chain åˆ›å»ºè‡ªå®šä¹‰é“¾ï¼ˆå¦‚ iptables -N MY_CHAINï¼‰ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:9:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptables filter è¡¨æ¡ˆä¾‹ # å±è”½å•ä¸ªIPçš„å‘½ä»¤ $ iptables -I INPUT -s 223.70.232.41 -j DROP # æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™ä¿¡æ¯ $ iptables -nvL --line-numbers $ sudo iptables-save \u003e /etc/sysconfig/iptables $ sudo iptables-restore \u003c /etc/sysconfig/iptables # æ”¹åŠ¨ä¹‹å‰å…ˆå¤‡ä»½ï¼Œå…»æˆå¥½ä¹ æƒ¯ $ cp /etc/sysconfig/iptables /etc/sysconfig/iptables.bak $ iptables -F #æ¸…ç©ºé˜²ç«å¢™è§„åˆ™ # åªæ˜¯æ‹’ç»æŸä¸ªip çš„è®¿é—®ä¸éœ€è¦åŠ åè®® $ iptables -I INPUT 1 -s 192.168.143.102 -j DROP # æ‹’ç»ç½‘æ®µè®¿é—®æœ¬æœº $ iptables -I INPUT 1 -s 192.168.143.0/24 -j DROP # æ„Ÿå¹å·å–åï¼Œæ³¨æ„ä¸è¦è‡ªå·±è·³æ¿æœºçš„ ip ä¹Ÿç»™å±è”½æ‰äº†ï¼Œå¦åˆ™ xshell æ— æ³•è¿æ¥ $ iptables -I INPUT 1 ! -s 192.168.143.0/24 -j DROP # ä¸»æœºå¯¹172.21.29.116 ip å¼€æ”¾22 ç«¯å£æƒé™ï¼ŒåŠ ç«¯å£åˆ™éœ€è¦åŠ åè®® $ iptables -I INPUT 1 -s 172.21.29.116 -p tcp --dport 22 -j ACCEPT # ç¦æ­¢ç½‘æ®µè®¿é—®æŒ‡å®šçš„ç«¯å£ $ iptables -I INPUT 1 -s 192.168.143.0/24 -p tcp --dport 8080 -j ACCEPT # ç¦æ­¢ç½‘æ®µè®¿é—®æŒ‡å®šçš„å¤šä¸ªç«¯å£ $ iptables -I INPUT 1 -s 192.168.143.0/24 -p tcp -m multiport --dports 8080,80,9090 -j ACCEPT # ç¦æ­¢ç½‘æ®µè®¿é—®æŒ‡å®šçš„ç«¯å£èŒƒå›´ $ iptables -I INPUT 1 -s 192.168.143.0/24 -p tcp --dports 1000:2000 -j ACCEPT # åˆ é™¤ç¬¬ä¸€æ¡è§„åˆ™ $ iptables -D INPUT 1 # ä¸»æœº ç¦æ­¢ping icmp $ iptables -I INPUT -p icmp --icmp-type 8 -j DROP # é€šè¿‡é˜²æŠ¤å¢™æ§åˆ¶è¿æ¥çŠ¶æ€ $ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT $ iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:10:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å®è·µï¼šé™åˆ¶ ip è¿æ¥æ•° é™åˆ¶æ¥è‡ªä»»ä½•IPåœ°å€çš„TCPè¿æ¥åˆ°ç«¯å£22ï¼ˆSSHé»˜è®¤ç«¯å£ï¼‰ï¼Œå¦‚æœæ¥è‡ªåŒä¸€IPçš„å¹¶å‘è¿æ¥æ•°è¶…è¿‡100ï¼Œåˆ™æ‹’ç»è¿™äº›è¿æ¥ï¼Œå¹¶ä½¿ç”¨ICMPç«¯å£ä¸å¯è¾¾æ¶ˆæ¯ä½œä¸ºå“åº” $ iptables -A INPUT -p tcp --dport 22 -m connlimit --connlimit-above 100 --connlimit-mask 32 -j REJECT --reject-with icmp-port-unreachable $ iptables -nL --line-numbers Chain INPUT (policy ACCEPT) num target prot opt source destination 1 REJECT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:22 #conn src/32 \u003e 100 reject-with icmp-port-unreachable ... å‘½ä»¤å‚æ•°é‡Šä¹‰ï¼š -A INPUT: å°†è§„åˆ™æ·»åŠ åˆ°INPUTé“¾ä¸­ã€‚INPUTé“¾å¤„ç†æ‰€æœ‰å…¥ç«™æ•°æ®åŒ…ã€‚ -p tcp: æŒ‡å®šåè®®ä¸ºTCPã€‚ --dport 22: ç›®æ ‡ç«¯å£æ˜¯22ï¼Œå³SSHæœåŠ¡çš„é»˜è®¤ç«¯å£ã€‚ -m connlimit: ä½¿ç”¨connlimitæ¨¡å—æ¥é™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯IPçš„å¹¶å‘è¿æ¥æ•°ã€‚ --connlimit-above 100: å¦‚æœä¸€ä¸ªæºIPåœ°å€å‘èµ·çš„å¹¶å‘è¿æ¥æ•°è¶…è¿‡100ï¼Œåˆ™åº”ç”¨æ­¤è§„åˆ™ã€‚ --connlimit-mask 32: å¯¹äºIPv4ï¼Œè¿™è¡¨ç¤ºé’ˆå¯¹å•ä¸ªIPåœ°å€è¿›è¡Œé™åˆ¶ï¼ˆå­ç½‘æ©ç é•¿åº¦ä¸º32æ„å‘³ç€æ¯ä¸ªç‹¬ç«‹çš„IPåœ°å€ï¼‰ã€‚ -j REJECT: åŒ¹é…æ¡ä»¶åæ‰§è¡Œçš„ç›®æ ‡åŠ¨ä½œæ˜¯REJECTï¼ˆæ‹’ç»ï¼‰ã€‚ --reject-with icmp-port-unreachable: å½“æ‹’ç»æ•°æ®åŒ…æ—¶ï¼Œå‘é€ICMPç«¯å£ä¸å¯è¾¾çš„æ¶ˆæ¯ä½œä¸ºå“åº”ã€‚ è¿™æ¡è§„åˆ™å°†ä¼šå¯¹å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸ŠSSHæœåŠ¡ï¼ˆç«¯å£22ï¼‰çš„æ‰€æœ‰æµé‡ç”Ÿæ•ˆï¼Œè‹¥æŸä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥æ•°è¶…è¿‡äº†100ï¼Œåˆ™æ–°çš„è¿æ¥è¯·æ±‚å°†è¢«æ‹’ç»ï¼Œå¹¶è¿”å›ICMPç«¯å£ä¸å¯è¾¾çš„æ¶ˆæ¯ç»™å‘èµ·è€…ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢å•ä¸€æ¥æºçš„è¿‡å¤šè¿æ¥è¯·æ±‚ï¼Œæœ‰åŠ©äºé˜²èŒƒä¸€äº›ç±»å‹çš„Dosæ”»å‡»æˆ–æ»¥ç”¨è¡Œä¸ºã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:10:1","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"ç”Ÿäº§é…ç½®å‚è€ƒ # 1. æ”¾å¼€22 ç«¯å£è®¿é—® $ iptables -A INPUT -p tcp --dport 22 -j ACCEPT # 2. å›ç¯ç«¯å£æ”¾å¼€ $ iptables -A INPUT -i lo -j ACCEPT $ iptables -A OUTPUT -o lo -j ACCEPT # 3. æ”¾å¼€å¸¸ç”¨ç«¯å£ $ iptables -A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT # 4. æŒ‡å®šç½‘æ®µçš„è®¿é—® $ iptables -A INPUT -s 192.168.143.0/24 -j ACCEPT $ iptables -A INPUT -s 10.168.143.0/24 -j ACCEPT # 5. è¿æ¥çŠ¶æ€ $ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # 6. # æ‹’ç»æ‰€æœ‰å…¶ä»–å…¥ç«™æµé‡ $ iptables -P INPUT DROP # æ±‡æ€» $ iptables-save ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:10:2","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptables å¸¸ç”¨å‘½ä»¤å‚æ•° iptables æ˜¯ Linux ç³»ç»Ÿä¸‹ç®¡ç†é˜²ç«å¢™è§„åˆ™çš„æ ¸å¿ƒå·¥å…·ï¼Œå…¶å‚æ•°ç”¨äºå®šä¹‰è§„åˆ™çš„åŒ¹é…æ¡ä»¶ã€æ“ä½œç›®æ ‡å’Œè§„åˆ™ç®¡ç†ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨å‚æ•°åˆ†ç±»åŠè¯¦ç»†è¯´æ˜ï¼š ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"ä¸€ã€è§„åˆ™ç®¡ç†å‚æ•° å‚æ•° è¯´æ˜ -A \u003cé“¾å\u003e åœ¨æŒ‡å®šé“¾çš„æœ«å°¾æ·»åŠ è§„åˆ™ï¼ˆAppendï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -A INPUT -s 192.168.1.0/24 -j ACCEPT -I \u003cé“¾å\u003e [è§„åˆ™ç¼–å·] åœ¨æŒ‡å®šé“¾çš„æŒ‡å®šä½ç½®æ’å…¥è§„åˆ™ï¼ˆInsertï¼‰ï¼Œé»˜è®¤æ’å…¥åˆ°é“¾é¦–ã€‚ ç¤ºä¾‹ï¼šiptables -I INPUT 2 -p tcp --dport 80 -j DROP -D \u003cé“¾å\u003e [è§„åˆ™ç¼–å·] åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æŸæ¡è§„åˆ™ï¼ˆDeleteï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -D INPUT 3 -F [é“¾å] æ¸…ç©ºæŒ‡å®šé“¾çš„æ‰€æœ‰è§„åˆ™ï¼ˆFlushï¼‰ï¼Œä¸æŒ‡å®šé“¾åˆ™æ¸…ç©ºæ‰€æœ‰é“¾ã€‚ ç¤ºä¾‹ï¼šiptables -F INPUT -L [é“¾å] åˆ—å‡ºæŒ‡å®šé“¾çš„è§„åˆ™ï¼ˆListï¼‰ï¼Œä¸æŒ‡å®šé“¾åˆ™åˆ—å‡ºæ‰€æœ‰é“¾ã€‚ ç¤ºä¾‹ï¼šiptables -L INPUT -nv -N \u003cé“¾å\u003e åˆ›å»ºè‡ªå®šä¹‰é“¾ï¼ˆNewï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -N MY_CHAIN -X \u003cé“¾å\u003e åˆ é™¤è‡ªå®šä¹‰ç©ºé“¾ï¼ˆDelete chainï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -X MY_CHAIN -P \u003cé“¾å\u003e \u003cåŠ¨ä½œ\u003e è®¾ç½®é“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œå¦‚ ACCEPT æˆ– DROPã€‚ ç¤ºä¾‹ï¼šiptables -P INPUT DROP ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:1","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"äºŒã€åŒ¹é…æ¡ä»¶å‚æ•° å‚æ•° è¯´æ˜ -s \u003cIP/ç½‘æ®µ\u003e åŒ¹é…æºIPåœ°å€ã€‚ ç¤ºä¾‹ï¼š-s 192.168.1.100 æˆ– -s 10.0.0.0/24 -d \u003cIP/ç½‘æ®µ\u003e åŒ¹é…ç›®æ ‡IPåœ°å€ã€‚ -p \u003cåè®®\u003e åŒ¹é…åè®®ç±»å‹ï¼ˆå¦‚ tcp, udp, icmp, allï¼‰ã€‚ ç¤ºä¾‹ï¼š-p tcp --sport \u003cç«¯å£\u003e åŒ¹é…æºç«¯å£ï¼ˆéœ€é…åˆ -p tcp æˆ– -p udpï¼‰ã€‚ ç¤ºä¾‹ï¼š--sport 8080 --dport \u003cç«¯å£\u003e åŒ¹é…ç›®æ ‡ç«¯å£ã€‚ ç¤ºä¾‹ï¼š--dport 22 -i \u003cç½‘å¡\u003e åŒ¹é…è¾“å…¥ç½‘å¡ï¼ˆå¦‚ eth0ï¼‰ã€‚ ç¤ºä¾‹ï¼š-i eth0 -o \u003cç½‘å¡\u003e åŒ¹é…è¾“å‡ºç½‘å¡ã€‚ -m \u003cæ¨¡å—\u003e ä½¿ç”¨æ‰©å±•æ¨¡å—ï¼ˆå¦‚ state, multiport, iprangeï¼‰ã€‚ ç¤ºä¾‹ï¼š-m state --state ESTABLISHED --state \u003cçŠ¶æ€\u003e åŒ¹é…è¿æ¥çŠ¶æ€ï¼ˆå¦‚ NEW, ESTABLISHED, RELATEDï¼‰ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:2","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"ä¸‰ã€åŠ¨ä½œå‚æ•°ï¼ˆ-j å‚æ•°æŒ‡å®šï¼‰ åŠ¨ä½œ è¯´æ˜ ACCEPT å…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚ DROP ä¸¢å¼ƒæ•°æ®åŒ…ï¼ˆæ— å“åº”ï¼‰ã€‚ REJECT æ‹’ç»æ•°æ®åŒ…ï¼ˆè¿”å›é”™è¯¯å“åº”ï¼‰ã€‚ LOG è®°å½•æ—¥å¿—åˆ°ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚ /var/log/messagesï¼‰ã€‚ ç¤ºä¾‹ï¼š-j LOG --log-prefix \"Blocked: \" SNAT æºåœ°å€è½¬æ¢ï¼ˆç”¨äº nat è¡¨çš„ POSTROUTING é“¾ï¼‰ã€‚ ç¤ºä¾‹ï¼š-j SNAT --to-source 1.2.3.4 DNAT ç›®æ ‡åœ°å€è½¬æ¢ï¼ˆç”¨äº nat è¡¨çš„ PREROUTING é“¾ï¼‰ã€‚ ç¤ºä¾‹ï¼š-j DNAT --to-destination 192.168.1.100:8080 MASQUERADE åŠ¨æ€æºåœ°å€è½¬æ¢ï¼ˆé€‚ç”¨äºåŠ¨æ€ IPï¼Œå¦‚æ‹¨å·ç½‘ç»œï¼‰ã€‚ ç¤ºä¾‹ï¼š-j MASQUERADE REDIRECT ç«¯å£é‡å®šå‘ï¼ˆå¸¸ç”¨äºé€æ˜ä»£ç†ï¼‰ã€‚ ç¤ºä¾‹ï¼š-j REDIRECT --to-port 8080 ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:3","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å››ã€å…¶ä»–å¸¸ç”¨å‚æ•° å‚æ•° è¯´æ˜ -t \u003cè¡¨å\u003e æŒ‡å®šæ“ä½œçš„è¡¨ï¼ˆé»˜è®¤ filterï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -t nat -L -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚æ•°æ®åŒ…è®¡æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -L -v -n ä¸è§£æåŸŸåï¼ˆç›´æ¥æ˜¾ç¤º IP åœ°å€ï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -L -n --line-numbers æ˜¾ç¤ºè§„åˆ™ç¼–å·ï¼ˆä¾¿äºåˆ é™¤æˆ–æ’å…¥ï¼‰ã€‚ ç¤ºä¾‹ï¼šiptables -L INPUT --line-numbers ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:4","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"äº”ã€å…¸å‹ç¤ºä¾‹ 1. åŸºç¡€é˜²ç«å¢™è§„åˆ™ # å…è®¸æœ¬åœ°å›ç¯æ¥å£ $ iptables -A INPUT -i lo -j ACCEPT # å…è®¸å·²å»ºç«‹çš„è¿æ¥ $ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # å…è®¸ SSH è¿æ¥ï¼ˆç«¯å£ 22ï¼‰ $ iptables -A INPUT -p tcp --dport 22 -j ACCEPT # æ‹’ç»æ‰€æœ‰å…¶ä»–å…¥ç«™æµé‡ $ iptables -P INPUT DROP 2. ç«¯å£è½¬å‘ï¼ˆNATï¼‰ # å¯ç”¨ IP è½¬å‘ $ echo 1 \u003e /proc/sys/net/ipv4/ip_forward # å°†å¤–éƒ¨ 80 ç«¯å£è½¬å‘åˆ°å†…ç½‘ 192.168.1.100:8080 $ iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080 $ iptables -t nat -A POSTROUTING -j MASQUERADE 3. é™é€Ÿè§„åˆ™ï¼ˆä½¿ç”¨ limit æ¨¡å—ï¼‰ # é™åˆ¶ ICMP è¯·æ±‚é¢‘ç‡ï¼ˆæ¯ç§’ 1 ä¸ªï¼‰ $ iptables -A INPUT -p icmp -m limit --limit 1/s -j ACCEPT $ iptables -A INPUT -p icmp -j DROP ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:5","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å…­ã€æ³¨æ„äº‹é¡¹ è§„åˆ™é¡ºåºï¼šè§„åˆ™æŒ‰é¡ºåºåŒ¹é…ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåç»­è§„åˆ™ä¸å†æ‰§è¡Œã€‚ é»˜è®¤ç­–ç•¥ï¼šè®¾ç½®é»˜è®¤ç­–ç•¥ä¸º DROP å‰ï¼Œéœ€ç¡®ä¿å…è®¸å¿…è¦æµé‡ï¼ˆå¦‚ SSHï¼‰ã€‚ æŒä¹…åŒ–è§„åˆ™ï¼šé‡å¯åè§„åˆ™ä¼šä¸¢å¤±ï¼Œéœ€ä½¿ç”¨ iptables-save å’Œ iptables-restore ä¿å­˜è§„åˆ™ï¼š iptables-save \u003e /etc/iptables/rules.v4 iptables-restore \u003c /etc/iptables/rules.v4 æŒæ¡è¿™äº›å‚æ•°åï¼Œå¯ä»¥çµæ´»é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œå®ç°æµé‡è¿‡æ»¤ã€NAT è½¬æ¢ã€æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½ã€‚ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:11:6","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"iptables æ€»ç»“ iptables åœ¨å·¥ä½œä¸­ä¹Ÿæ˜¯å¸¸ç”¨åˆ°çš„æœåŠ¡ï¼Œé‡è¦ä½†æ˜¯ä¸æ˜¯å¾ˆå¤æ‚ï¼Œè¿™é‡Œæ‰¾äº†ä¸€ä¸ªiptablesé¢è¯•å‚è€ƒï¼Œè‡ªå·±å¯ä»¥å†™ä¸€å†™ï¼ŒåŠ æ·±å·©å›ºä¸‹,åœ¨ç”Ÿäº§ç¯å¢ƒå±‚é¢æ‰§è¡Œå‰æœ€å¥½æ˜¯ç°åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ä¸‹ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:12:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"å‚è€ƒ iptablesè¯¦ç»†æ•™ç¨‹ï¼šåŸºç¡€ã€æ¶æ„ã€æ¸…ç©ºè§„åˆ™ã€è¿½åŠ è§„åˆ™ã€åº”ç”¨å®ä¾‹ ","date":"2024-11-19","objectID":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/:13:0","tags":["linux","é˜²ç«å¢™"],"title":"Linux é˜²ç«å¢™iptablesè¯¦è§£","uri":"/linux%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AF%A6%E8%A7%A3/"},{"categories":["MySQL"],"content":"èƒŒæ™¯ä¿¡æ¯ ä¸ºäº†å¢åŠ æ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œå¢å¼ºæœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œä»ä¼ ç»Ÿçš„å•æœåŠ¡åº”ç”¨å‡çº§åˆ°é›†ç¾¤æœåŠ¡åº”ç”¨æ˜¯ä¸€ä¸ªåˆé€‚æ–¹æ¡ˆï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹MySQL 5.7 ç‰ˆæœ¬çš„éƒ¨ç½²ï¼Œ5.7 ç‰ˆæœ¬ä¹Ÿæ˜¯ç›®å‰å¤§å¤šæ•°ä¼ä¸šå½“å‰åœ¨ç”¨çš„ç‰ˆæœ¬ï¼Œè™½ç„¶ä¹Ÿæœ‰å¾ˆå¤šä¼ä¸šå‡çº§åˆ°äº†8.0 ç‰ˆæœ¬ï¼Œä¸è¿‡ä»å®‰è£…éƒ¨ç½²çš„è§’åº¦æ¥çœ‹å…¶å®æ˜¯å¤§åŒå°å¼‚çš„ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:1:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"ç¯å¢ƒå‡†å¤‡ æ“ä½œç³»ç»Ÿç‰ˆæœ¬ cpu å†…å­˜ ç£ç›˜ IP éƒ¨ç½²æ–¹å¼ MySQLç‰ˆæœ¬ ä¸»ä»èŠ‚ç‚¹ centos 7.9 2c 4G 40G 192.168.143.101 rpm 5.7.20 Master centos 7.9 2c 4G 40G 192.168.143.102 rpm 5.7.20 Slave ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:2:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å®‰è£…MySQL 5.7 1ã€ä¸‹è½½å®‰è£…åŒ… $ cd /path/to/directory $ wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.20-1.el7.x86_64.rpm-bundle.tar # åˆ é™¤ä¸éœ€è¦çš„å®‰è£…åŒ… $ ls |grep -vE 'client|libs|common|server-5.7'|xargs rm -f 2ã€å®‰è£…ä¾èµ– # mysql-community-common-5.7.20-1.el7.x86_64.rpm ä¾èµ– $ sudo yum -y install gcc vim wget net-tools lrzsz libaio # mysql-community-client-5.7.20-1.el7.x86_64.rpm ä¾èµ– $ sudo yum install ncurses-compat-libs -y # mysql-community-server-5.7.20-1.el7.x86_64.rpm ä¾èµ– $ sudo yum install libaio numactl-libs -y 3ã€æœåŠ¡å™¨æ—¶é—´æ ¡æ­£ 4ã€å…³é—­é˜²ç«å¢™å’Œå®‰å…¨(ä¸»ä») $ setenforce 0 $ systemctl stop firewalld $ systemctl disable firewalld 4.1 (å¯é€‰)å¦‚æœä½ çš„ä»“åº“ä¸­æ²¡æœ‰ ncurses-compat-libsï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ä»“åº“ï¼Œä¾‹å¦‚ EPEL (Extra Packages for Enterprise Linux)ï¼š $ sudo yum install epel-release -y $ sudo yum install ncurses-compat-libs -y 4.2 (å¯é€‰) æ£€éªŒç³»ç»Ÿæ˜¯å¦åŒ…å«mariadb-lib æ£€éªŒç³»ç»Ÿæ˜¯å¦åŒ…å«mariadb-lib,å¦‚æœæœ‰éœ€è¦å¸è½½ï¼Œå¦åˆ™mysql æ— æ³•å®‰è£… rpm -qa | grep mariadb rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64 5ã€å®‰è£… $ sudo rpm -ivh mysql-community-common-5.7.20-1.el7.x86_64.rpm $ sudo rpm -ivh mysql-community-libs-5.7.20-1.el7.x86_64.rpm $ sudo rpm -ivh mysql-community-libs-compat-5.7.20-1.el7.x86_64.rpm $ sudo rpm -ivh mysql-community-client-5.7.20-1.el7.x86_64.rpm $ sudo rpm -ivh mysql-community-server-5.7.20-1.el7.x86_64.rpm $ rpm -qa|grep mysql mysql-community-common-5.7.20-1.el7.x86_64 mysql-community-libs-5.7.20-1.el7.x86_64 mysql-community-libs-compat-5.7.20-1.el7.x86_64 mysql-community-client-5.7.20-1.el7.x86_64 mysql-community-server-5.7.20-1.el7.x86_64 # æ£€æŸ¥ç”Ÿæˆçš„mysql ç›®å½•å’Œæ–‡ä»¶ $ ls /var/lib/mysql /etc/my.cnf /etc/my.cnf /var/lib/mysql: 6ã€å®‰è£…è¿‡ç¨‹æ‘˜å– # rpm -ivh mysql-community-server-5.7.20-1.el7.x86_64.rpm warning: mysql-community-server-5.7.20-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY Verifying... ################################# [100%] Preparing... ################################# [100%] Updating / installing... 1:mysql-community-server-5.7.20-1.e################################# [100%] /usr/lib/tmpfiles.d/mysql.conf:16: Line references path below legacy directory /var/run/, updating /var/run/mysqld â†’ /run/mysqld; please update the tmpfiles.d/ drop-in file accordingly. æ³¨æ„\rè¿™ä¸ªè­¦å‘Šæç¤ºè¯´æ˜è¯¥ RPM åŒ…æœªè¢« GPG ç­¾åéªŒè¯ã€‚å¦‚æœä½ ä¿¡ä»»è¿™ä¸ªåŒ…çš„æ¥æºï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªè­¦å‘Š\ræˆ–è€…ä¸€æ¬¡æ€§å®‰è£…ä¼šè‡ªåŠ¨è¿›è¡Œä¾èµ–é¡ºåºå®‰è£…è°ƒæ•´ï¼š sudo rpm -ivh *.rpm ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:3:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å®‰è£…åŒ…åŠŸèƒ½å’Œä½œç”¨ éƒ¨ç½² MySQL 5.7.20 ç‰ˆæœ¬çš„ RPM åŒ…æ—¶ï¼Œéœ€è¦ç¡®ä¿æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå®‰è£…è¿™äº›åŒ…ï¼Œå› ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªåŒ…çš„åŠŸèƒ½ä½œç”¨å’Œæ¨èçš„å®‰è£…é¡ºåºï¼š mysql-community-common-5.7.20-1.el7.x86_64.rpm åŠŸèƒ½ï¼šæä¾›æ‰€æœ‰ MySQL ç»„ä»¶å…±äº«çš„æ–‡ä»¶ã€‚ ä½œç”¨ï¼šè¿™ä¸ªåŒ…æ˜¯åŸºç¡€ï¼Œå…¶ä»–ç»„ä»¶ä¾èµ–å®ƒæä¾›çš„æ–‡ä»¶ã€‚ mysql-community-libs-5.7.20-1.el7.x86_64.rpm åŠŸèƒ½ï¼šåŒ…å«å®¢æˆ·ç«¯åº“æ–‡ä»¶ã€‚ ä½œç”¨ï¼šä¸ºä½¿ç”¨ MySQL å®¢æˆ·ç«¯è¿æ¥åˆ° MySQL æ•°æ®åº“æœåŠ¡å™¨æä¾›å¿…è¦çš„åº“æ–‡ä»¶ã€‚ mysql-community-libs-compat-5.7.20-1.el7.x86_64.rpm åŠŸèƒ½ï¼šæä¾›å…¼å®¹æ€§åº“æ–‡ä»¶ã€‚ ä½œç”¨ï¼šä¸ºæ—§ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºæä¾›ä¸æ—§ç‰ˆ MySQL åº“çš„å‘åå…¼å®¹æ€§ã€‚ mysql-community-client-5.7.20-1.el7.x86_64.rpm åŠŸèƒ½ï¼šåŒ…å« MySQL å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·ã€‚ ä½œç”¨ï¼šå…è®¸ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸ MySQL æ•°æ®åº“äº¤äº’ã€‚ mysql-community-server-5.7.20-1.el7.x86_64.rpm åŠŸèƒ½ï¼šæä¾› MySQL æ•°æ®åº“æœåŠ¡å™¨ã€‚ ä½œç”¨ï¼šè¿™æ˜¯æ ¸å¿ƒåŒ…ï¼Œè´Ÿè´£å¤„ç† SQL æŸ¥è¯¢å¹¶ç®¡ç†æ•°æ®åº“ã€‚ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:3:1","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"é…ç½®ä¸»æœåŠ¡å™¨ MySQL çš„ä¸»é…ç½®æ–‡ä»¶é€šå¸¸ä½äº /etc/my.cnf æˆ– /etc/mysql/my.cnfï¼Œå…·ä½“å–å†³äºä½ çš„æ“ä½œç³»ç»Ÿã€‚å¯¹äºæŸäº›å‘è¡Œç‰ˆæˆ–è‡ªå®šä¹‰å®‰è£…ï¼Œé…ç½®æ–‡ä»¶å¯èƒ½ä½äºå…¶ä»–ä½ç½®ï¼Œå¦‚ /etc/my.cnf.d/ ç›®å½•ä¸‹çš„æŸä¸ªæ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼š $ mysql --help | grep \"Default options\" -A 1 Default options are read from the following files in the given order: /etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf è°ƒæ•´éœ€è¦å°†æ•°æ®æ”¾åˆ°/data/mysql ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•ä¸ºå¤–æŒ‚ç£ç›˜ï¼Œç£ç›˜ç©ºé—´è¾ƒå¤§ï¼Œè€Œä¸æ˜¯å®‰è£…åœ¨é»˜è®¤çš„ç³»ç»Ÿç£ç›˜ç›®å½•ä¸‹ åˆ›å»ºå®‰è£…ç›®å½•/data/mysql mkdir -p /data/mysql/binlog chown -R mysql:mysql /data/mysql chomod -R 755 /data/mysql ä¿®æ”¹/etc/my.cnfé…ç½®æ–‡ä»¶ [mysqld] user = mysql port = 3306 sql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER lower_case_table_names = 1 group_concat_max_len = 40960 max_allowed_packet = 1G datadir = /data/mysql socket = /data/mysql/mysql.sock log_error = /data/mysql/mysqld.log pid_file = /data/mysql/mysqld.pid # è®¾ç½®server_id,æ³¨æ„è¦å”¯ä¸€ server_id = 1 # å¿½ç•¥çš„æ•°æ®ï¼ŒæŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ #binlog-ignore-db=mysql # æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ #binlog-do-db=test ###binlog### binlog_format = row ## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒSlaveçš„Masteræ—¶ä½¿ç”¨ log_bin = /data/mysql/binlog/binlog.log expire_logs_days = 7 master_info_repository = table relay_log_info_repository = table ###slave### slave_parallel_type = LOGICAL_CLOCK slave_parallel_workers = 4 log_bin_trust_function_creators = 1 skip_slave_start = ON relay_log_recovery = ON ###buffer_pool### join_buffer_size = 32M sort_buffer_size = 16M query_cache_size = 512M myisam_sort_buffer_size = 128M thread_cache_size = 128 tmp_table_size = 512M max_heap_table_size = 128M read_rnd_buffer_size = 2M #InnoDB# default_storage_engine = InnoDB innodb_file_per_table = ON innodb_flush_log_at_trx_commit = 2 innodb_buffer_pool_size = 4G innodb_log_file_size = 1024M innodb_flush_method = O_DIRECT ##### MyISAM##### key_buffer_size = 512M ### character_set##### character_set_server = utf8 collation_server = utf8_general_ci explicit_defaults_for_timestamp = ON ####name_resolves#### host_cache_size = 0 skip_name_resolve = ON ###connection### max_connections = 25000 max_connect_errors = 10000 ### Enable slow_query_log permanent ### slow_query_log = 1 long_query_time = 0.5 slow_query_log_file = /data/mysql/mysql_slow.log ### MASTER_MASTER ### auto_increment_increment = 1 auto_increment_offset = 1 [mysql] #prompt = 'mysql[\\u@\\h]:[\\d]:' [client] socket = /data/mysql/mysql.sock port = 3306 å¯åŠ¨mysqldæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯ $ sudo systemctl enable mysqld --now $ sudo systemctl status mysqld ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:4:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"é…ç½®ä»æœåŠ¡å™¨ åˆ›å»ºå®‰è£…ç›®å½•/data/mysql mkdir -p /data/mysql/binlog chown -R mysql:mysql /data/mysql chomod -R 755 /data/mysql ä¿®æ”¹/etc/my.cnfé…ç½®æ–‡ä»¶ [mysqld] # è®¾ç½®server_id,æ³¨æ„è¦å”¯ä¸€ server_id = 1 ... ### MASTER_MASTER ### auto_increment_increment = 1 auto_increment_offset = 2 # å¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼Œç¡®ä¿ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹çš„ AUTO_INCREMENT å€¼ä¸å†²çª å¯åŠ¨mysqldæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯ $ sudo systemctl enable mysqld --now $ sudo systemctl status mysqld ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:5:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"ä¿®æ”¹ç™»å½•å¯†ç  ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:6:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å¿«æ·æ“ä½œ MYSQL_OLDPASSWORD=`awk '/A temporary password/{print $NF}' /data/mysql/mysqld.log` MYSQL_ROOT_PASSWORD=\"your_mysql_password\" mysqladmin -u root -p$MYSQL_OLDPASSWORD password $MYSQL_ROOT_PASSWORD \u0026\u003e/dev/null ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:6:1","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"åˆ†æ­¥æ“ä½œ 1ã€è·å–ä¸´æ—¶å¯†ç  é»˜è®¤æ˜¯åœ¨/var/log/mysqld.log æ–‡ä»¶ä¸‹ï¼Œè¿™é‡Œä¿®æ”¹äº†å®‰è£…ç›®å½•ä¸º/data/mysql sudo grep 'temporary password' /data/mysq/mysqld.log # grep 'temporary password' /var/log/mysqld.log 2024-11-25T06:34:37.637723Z 1 [Note] A temporary password is generated for root@localhost: hvqki:Gp\u003e0EI 2ã€ä¸´æ—¶å¯†ç ç™»å½• mysql -u root -p 3ã€ç™»å½•åä¿®æ”¹é»˜è®¤å¯†ç å¹¶è¿›è¡Œå®‰å…¨é…ç½®ï¼š é¦–æ¬¡ç™»å½•åï¼Œå»ºè®®ç«‹å³æ›´æ”¹ root å¯†ç å¹¶æ‰§è¡Œ mysql_secure_installation è„šæœ¬æ¥æé«˜å®‰å…¨æ€§ã€‚ ç™»å½•åä¿®æ”¹rootå¯†ç  ALTER USER 'root'@'%' IDENTIFIED BY 'your_password'; mysql\u003e ALTER USER 'root'@'%' IDENTIFIED BY 'your_password'; Query OK, 0 rows affected (0.00 sec) mysql\u003e show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | +--------------------+ 4 rows in set (0.00 sec) # èµ‹è¿œç¨‹è®¿é—®æƒé™ mysql\u003e GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'your_password' WITH GRANT OPTION; Query OK, 0 rows affected, 1 warning (0.02 sec) mysql\u003e flush privileges; Query OK, 0 rows affected (0.00 sec) mysql\u003e select host, user, authentication_string, plugin from user; +-----------+---------------+-------------------------------------------+-----------------------+ | host | user | authentication_string | plugin | +-----------+---------------+-------------------------------------------+-----------------------+ | localhost | root | *4E02A7566A743B1042608F7ED03213DE937E7D0E | mysql_native_password | | localhost | mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | | localhost | mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | | % | root | *4E02A7566A743B1042608F7ED03213DE937E7D0E | mysql_native_password | +-----------+---------------+-------------------------------------------+-----------------------+ 4 rows in set (0.00 sec) 4ã€mysql_secure_installation MySQL å®‰å…¨è®¾ç½®(å¯é€‰) mysql_secure_installation æ˜¯ä¸€ä¸ªç”¨äºæé«˜ MySQL å®‰è£…å®‰å…¨æ€§çš„è„šæœ¬ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æ‰§è¡Œä¸€ç³»åˆ—çš„å®‰å…¨è®¾ç½®ï¼Œä¾‹å¦‚è®¾ç½® root å¯†ç ã€ç§»é™¤åŒ¿åç”¨æˆ·ã€ç¦ç”¨è¿œç¨‹ root ç™»å½•ã€ç§»é™¤æµ‹è¯•æ•°æ®åº“ç­‰ã€‚ä»¥ä¸‹æ˜¯æ‰§è¡Œ mysql_secure_installation è„šæœ¬çš„è¯¦ç»†æ­¥éª¤ï¼š [root@localhost mysql]\u003c20241225 14:42:33\u003e# sudo mysql_secure_installation Securing the MySQL server deployment. Enter password for user root: è·Ÿéšæç¤ºå®Œæˆé…ç½® è¿è¡Œè„šæœ¬åï¼Œä½ ä¼šè¢«é—®åˆ°ä¸€ç³»åˆ—é—®é¢˜ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªé—®é¢˜çš„å¤§è‡´å†…å®¹å’Œå»ºè®®çš„å›ç­”æ–¹å¼ï¼š Enter password for user root: è¾“å…¥ä½ å½“å‰çš„ root ç”¨æˆ·å¯†ç ï¼ˆå³å®‰è£…æ—¶ç”Ÿæˆçš„ä¸´æ—¶å¯†ç æˆ–ä½ åˆšåˆšè®¾ç½®çš„æ–°å¯†ç ï¼‰ã€‚ Switch to unix_socket authentication [Y/n] è¿™ä¸ªé€‰é¡¹æ˜¯å…³äºæ˜¯å¦åˆ‡æ¢åˆ° Unix Socket è®¤è¯æ’ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹é€‰æ‹© N ä¸å¯ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œè¿™æ ·å¯ä»¥ç»§ç»­ä½¿ç”¨åŸºäºå¯†ç çš„èº«ä»½éªŒè¯ã€‚ Change the root password? [Y/n] å¦‚æœä½ å·²ç»åœ¨ç™»å½•æ—¶ä¿®æ”¹äº† root å¯†ç ï¼Œå¯ä»¥é€‰æ‹© nï¼›å¦‚æœè¿˜æ²¡æœ‰ä¿®æ”¹ï¼Œå¯ä»¥é€‰æ‹© y å¹¶æŒ‰ç…§æç¤ºè®¾ç½®æ–°å¯†ç ã€‚ Remove anonymous users? [Y/n] ç§»é™¤åŒ¿åç”¨æˆ·å¯ä»¥æé«˜å®‰å…¨æ€§ï¼Œæ¨èé€‰æ‹© Yã€‚ Disallow root login remotely? [Y/n] ç¦æ­¢ root ç”¨æˆ·ä»è¿œç¨‹ç™»å½•é€šå¸¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œé™¤éä½ éœ€è¦è¿œç¨‹ç®¡ç† MySQLï¼Œæ¨èé€‰æ‹© Yã€‚æµ‹è¯•ç¯å¢ƒä¹Ÿå¯ä»¥é€‰æ‹©n Remove test database and access to it? [Y/n] ç§»é™¤æµ‹è¯•æ•°æ®åº“åŠå…¶è®¿é—®æƒé™ä¹Ÿæ˜¯æé«˜å®‰å…¨æ€§çš„æªæ–½ä¹‹ä¸€ï¼Œæ¨èé€‰æ‹© Yã€‚æµ‹è¯•ç¯å¢ƒä¹Ÿå¯ä»¥é€‰æ‹©n Reload privilege tables now? [Y/n] é‡æ–°åŠ è½½æƒé™è¡¨ä»¥ä½¿æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œæ¨èé€‰æ‹© Yã€‚ å¯¹è¯å‚è€ƒ Securing the MySQL server deployment. Enter password for user root: ******** Estimated strength of the password: 100 Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : Y By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y ... Success! Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y ... Success! By default, MySQL comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload priv","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:6:2","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å®‰è£…åéªŒè¯ å¯ä»¥å°è¯•é€šè¿‡ MySQL å®¢æˆ·ç«¯ç™»å½•åˆ°æœåŠ¡å™¨ã€‚ ä½¿ç”¨ mysqladmin å·¥å…·éªŒè¯æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š $ mysqladmin -u root -p version Enter password: mysqladmin Ver 8.42 Distrib 5.7.20, for Linux on x86_64 Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Server version 5.7.20 Protocol version 10 Connection Localhost via UNIX socket UNIX socket /var/lib/mysql/mysql.sock Uptime: 14 min 46 sec Threads: 1 Questions: 12 Slow queries: 0 Opens: 106 Flush tables: 1 Open tables: 99 Queries per second avg: 0.013 ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:7:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å¼€å¯ä¸»ä»åŒæ­¥ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:8:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"Master èŠ‚ç‚¹ # ç™»å½•åˆ° MySQL ä¸»èŠ‚ç‚¹ $ mysql -u root -p # åˆ›å»ºå¤åˆ¶ç”¨æˆ·ï¼ˆä¾‹å¦‚ï¼š`replica_user`ï¼‰ CREATE USER 'replica_user'@'192.168.143.102' IDENTIFIED BY 'your_password'; #æˆäºˆå¤åˆ¶æƒé™ GRANT REPLICATION SLAVE ON *.* TO 'replica_user'@'192.168.143.102'; # åˆ·æ–°æƒé™ FLUSH PRIVILEGES; # è·å–ä¸»èŠ‚ç‚¹çš„äºŒè¿›åˆ¶æ—¥å¿—ä½ç½® SHOW MASTER STATUS; +------------------+----------+--------------+------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | +------------------+----------+--------------+------------------+ | mysql-bin.000001 | 154 | your_database_name | | +------------------+----------+--------------+------------------+ è®°ä¸‹ FileäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šmysql-bin.000001ï¼‰å’Œ Positionåç§»é‡ï¼ˆä¾‹å¦‚ï¼š154ï¼‰çš„å€¼ã€‚ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:8:1","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"Slave èŠ‚ç‚¹ # ç™»å½•åˆ° MySQL å¤‡èŠ‚ç‚¹ $ mysql -u root -p # é…ç½®ä¸»èŠ‚ç‚¹ä¿¡æ¯ # ä½¿ç”¨ `CHANGE MASTER TO` å‘½ä»¤é…ç½®ä»åº“æŒ‡å‘ä¸»åº“ã€‚ä½ éœ€è¦æä¾›ä¸»åº“çš„ IP åœ°å€ã€ç”¨æˆ·åã€å¯†ç ä»¥åŠä¸Šé¢æåˆ°çš„ `File` å’Œ `Position` å€¼ï¼š CHANGE MASTER TO MASTER_HOST='192.168.143.101', MASTER_USER='replica_user', MASTER_PASSWORD='your_password', MASTER_LOG_FILE='mysql-bin.000001', -- ä¸»èŠ‚ç‚¹çš„æ—¥å¿—æ–‡ä»¶ MASTER_LOG_POS=154; -- ä¸»èŠ‚ç‚¹çš„æ—¥å¿—ä½ç½® #å¯åŠ¨å¤åˆ¶è¿›ç¨‹ å¼€å§‹ä»åº“çš„ I/O å’Œ SQL çº¿ç¨‹ä»¥å¼€å§‹å¤åˆ¶è¿‡ç¨‹ï¼š START SLAVE; # æŸ¥çœ‹å¤åˆ¶çŠ¶æ€ æ£€æŸ¥ä»åº“çš„çŠ¶æ€ï¼Œç¡®è®¤å¤åˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š SHOW SLAVE STATUS\\G; å…³æ³¨ä»¥ä¸‹å­—æ®µï¼š Slave_IO_Running: åº”è¯¥æ˜¯ Yes Slave_SQL_Running: åº”è¯¥æ˜¯ Yes Last_Error: åº”ä¸ºç©ºæˆ–æ— é”™è¯¯ä¿¡æ¯ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:8:2","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"æµ‹è¯•ä¸»ä»åŒæ­¥ åœ¨Masterä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºæ•°æ®åº“å’Œè¡¨ï¼Œå¹¶æ’å…¥æ•°æ®ï¼š mysql\u003e create database test; mysql\u003e use test; mysql\u003e create table test(age int); mysql\u003e insert into test values(1); mysql\u003e select * from test; +------+ | age | +------+ | 1 | +------+ åœ¨ä»æœåŠ¡å™¨ä¸Šæ£€æŸ¥æ•°æ®æ˜¯å¦åŒæ­¥ï¼š mysql\u003e select * from test.test; +------+ | age | +------+ | 1 | +------+ 1 row in set (0.00 sec) ä»¥ä¸Šæ“ä½œç¡®ä¿äº†ä¸»æœåŠ¡å™¨çš„æ•°æ®æˆåŠŸå¤åˆ¶åˆ°ä»æœåŠ¡å™¨ï¼Œå®ç°äº†ä¸»ä»åŒæ­¥ã€‚ ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:9:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å¸è½½ MySQL å¸è½½æˆ–è€…å¸è½½é‡æ–°å®‰è£… systemctl stop mysqld systemctl status mysqld rpm -evh rpmåŒ…å # ä¾æ¬¡å¸è½½rpmåŒ…ï¼ŒæŒ‰ç…§ä¸‹é¢é¡ºåºå¸è½½ä¸ç„¶ä¼šæŠ¥é”™ sudo rpm -evh mysql-community-server-5.7.20-1.el7.x86_64 sudo rpm -evh mysql-community-client-5.7.20-1.el7.x86_64 sudo rpm -evh mysql-community-libs-compat-5.7.20-1.el7.x86_64 sudo rpm -evh mysql-community-libs-5.7.20-1.el7.x86_64 sudo rpm -evh mysql-community-common-5.7.20-1.el7.x86_64 # æŸ¥è¯¢æ˜¯å¦è¿˜å­˜åœ¨é—æ¼æ–‡ä»¶ rpm -qa|grep mysql # åˆ é™¤ mysql æ•°æ®åº“å†…å®¹ sudo rm -rf /data/mysql sudo rm -rf /var/lib/mysql sudo rm -rf /usr/local/mysql sudo rm -rf /var/run/mysqld sudo rm -rf /etc/my.cnf sudo rm -f /var/log/mysqld.log ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:10:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["MySQL"],"content":"å‚è€ƒ MySQL v5.7 rpm å®‰è£…åŒ… MySQL å®˜ç½‘å„ä¸ªç‰ˆæœ¬å®‰è£…åŒ… ","date":"2024-10-16","objectID":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/:11:0","tags":["MySQL"],"title":"MySQL é›†ç¾¤ä¹‹ä¸»ä»éƒ¨ç½²","uri":"/mysql%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"èƒŒæ™¯ ä¸ºç‰©è”ç½‘å’Œè¾¹ç¼˜è®¡ç®—æ„å»ºçš„ç»è¿‡è®¤è¯çš„Kuberneteså‘è¡Œç‰ˆï¼Œåˆ™æ˜¯Rancheræ——ä¸‹äº§å“ Great for: Edge IoT CI Development ARM Embedding k8s Situations where a PhD in k8s clusterology is infeasible ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:1:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"å‘å±•å†ç¨‹ å¾®å‹kuberneteså‘è¡Œç‰ˆ CNCFè®¤è¯çš„Kuberneteså‘è¡Œç‰ˆ 50MBå·¦å³äºŒè¿›åˆ¶åŒ…ï¼Œ500MBå·¦å³å†…å­˜æ¶ˆè€— å•ä¸€è¿›ç¨‹åŒ…å«Kubernetes master,Kubelet,å’Œ containerd æ”¯æŒSQLite/Mysql/PostgreSQL/DQliteå’Œetcd åŒæ—¶ä¸ºx86 64,Arm64,å’Œ Armv7 å¹³å°å‘å¸ƒ å˜æ›´ å¤šåˆä¸€ï¼šå°†åŸºç¡€æœåŠ¡åˆå¹¶åˆ°äº†å•ä¸€çš„è¿›ç¨‹ä¸­ï¼Œå¦‚api-server,controller managerã€schedulerå’Œcloud-controller-manageråˆåˆ°äº†å•ä¸€çš„è¿›ç¨‹ä¸­,ç®€åŒ–äº†è¿ç»´ï¼Œé™ä½äº†å¤æ‚åº¦ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"åŸºæœ¬æ¶æ„ è§’è‰² k3s server api-server controller-manager scheduler etcd(option) containerd k3s-agent k3s agent k3s-agent containerd|docker(optional) K3s æ¶æ„\ræŠ€æœ¯äº®ç‚¹ å•è¿›ç¨‹æ¶æ„ç®€åŒ–éƒ¨ç½² ç§»é™¤å„ç§éå¿…é¡»ä»£ç ï¼Œå‡å°èµ„æºå ç”¨ TLSè¯ä¹¦ç®¡ç† å†…ç½®Containerd å†…ç½®è‡ªè¿è¡Œrootfs å†…ç½®Helm Chartç®¡ç†æœºåˆ¶ å†…ç½®L4/L7 LBæ”¯æŒ å…¶å®ƒ é»˜è®¤ä½¿ç”¨containerd é»˜è®¤å‘½åç©ºé—´ kube-system kube-public kube-node-release k3s èµ„æºæ–‡ä»¶ç›®å½•ï¼š/var/lib/rancher/k3s ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:3:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"å®‰è£…éƒ¨ç½² ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:4:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"server éƒ¨ç½² $ mkdir /root/k3s \u0026\u0026 cd /root/k3s # 1. k3sé•œåƒæ–‡ä»¶,æŒ‡å®šå®‰è£…ç‰ˆæœ¬ä¸º v1.24.9 $ wget https://github.com/k3s-io/k3s/releases/download/v1.24.9-rc1%2Bk3s2/k3s-airgap-images-amd64.tar.gz $ sudo mkdir -p /var/lib/rancher/k3s/agent/images/ $ sudo cp /root/k3s/k3s-airgap-images-amd64.tar /var/lib/rancher/k3s/agent/images/ # 2. k3så®‰è£…è„šæœ¬ $ wget https://rancher-mirror.rancher.cn/k3s/k3s-install.sh # 3. k3säºŒè¿›åˆ¶æ–‡ä»¶ $ wget https://github.com/k3s-io/k3s/releases/download/v1.24.9-rc1%2Bk3s2/k3s $ sudo chmod a+x /root/k3s/k3s /root/k3s/k3s-install.sh $ sudo cp /root/k3s/k3s /usr/local/bin/ # 4. å®‰è£…k3s $ INSTALL_K3S_SKIP_DOWNLOAD=true /root/k3s/k3s-install.sh # 5. éªŒè¯ $ crictl images IMAGE TAG IMAGE ID SIZE docker.io/rancher/klipper-helm v0.7.4-build20221121 6f2af12f2834b 252MB docker.io/rancher/klipper-lb v0.4.0 3449ea2a2bfa7 9.21MB docker.io/rancher/local-path-provisioner v0.0.23 9621e18c33880 37.7MB docker.io/rancher/mirrored-coredns-coredns 1.9.4 a81c2ec4e946d 49.8MB docker.io/rancher/mirrored-library-busybox 1.34.1 827365c7baf13 5.09MB docker.io/rancher/mirrored-library-traefik 2.9.4 288889429becf 136MB docker.io/rancher/mirrored-metrics-server v0.6.2 25561daa66605 70.2MB docker.io/rancher/mirrored-pause 3.6 6270bb605e12e 686kB $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-687d6d7765-h8xvr 1/1 Running 0 2m25s kube-system coredns-7b5bbc6644-nbvnf 1/1 Running 0 2m25s kube-system helm-install-traefik-crd-zfzqv 0/1 Completed 0 2m25s kube-system metrics-server-667586758d-5gvfd 1/1 Running 0 2m25s kube-system svclb-traefik-07d6e08f-gbvwd 2/2 Running 0 107s kube-system traefik-64b96ccbcd-tbcth 1/1 Running 0 107s kube-system helm-install-traefik-tvcc8 0/1 Completed 2 2m25s # server èŠ‚ç‚¹è·å–k3s token $ mynodetoken=`awk -F ':' '{print $4}' /var/lib/rancher/k3s/server/token` ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:4:1","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"agent éƒ¨ç½² # 1. å‡†å¤‡k3s äºŒè¿›åˆ¶ $ mkdir /root/k3s \u0026\u0026 cd /root/k3s $ wget https://github.com/k3s-io/k3s/releases/download/v1.24.9-rc1%2Bk3s2/k3s $ wget https://rancher-mirror.rancher.cn/k3s/k3s-install.sh # éœ€ä¿è¯å„ä¸»æœºåç§°ä¸ä¸€æ ·è¿›å…¥ /etc/hostname å’Œ /etc/hosts ä¿®æ”¹å³å¯ $ INSTALL_K3S_SKIP_DOWNLOAD=true INSTALL_K3S_VERSION=\"v1.24.9-rc1+k3s2\" K3S_URL=https://192.168.143.101:6443 K3S_TOKEN=7983aa3ee5b8a70afa61a79e2e6476d6 /root/k3s/k3s-install.sh # åœ¨çº¿å®‰è£… $ curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn \\ K3S_URL=https://192.168.143.101:6443 \\ K3S_TOKEN=7983aa3ee5b8a70afa61a79e2e6476d6 INSTALL_K3S_VERSION=\"v1.24.9-rc1+k3s2\" \\ sh - # 2. æŸ¥çœ‹çŠ¶æ€ $ systemctl status k3s-agent â— k3s-agent.service - Lightweight Kubernetes Loaded: loaded (/etc/systemd/system/k3s-agent.service; enabled; vendor preset: disabled) Active: active (running) since Thu 2024-09-23 17:05:24 CST; 8s ago Docs: https://k3s.io Process: 4125 ExecStartPre=/sbin/modprobe overlay (code=exited, status=0/SUCCESS) Process: 4121 ExecStartPre=/sbin/modprobe br_netfilter (code=exited, status=0/SUCCESS) Process: 4116 ExecStartPre=/bin/sh -xc ! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service 2\u003e/dev/null (code=exited, status=0/SUCCESS) Main PID: 4131 (k3s-agent) Tasks: 24 Memory: 300.4M CGroup: /system.slice/k3s-agent.service â”œâ”€4131 /usr/local/bin/k3s agent â””â”€4159 containerd # 3. åˆ‡åˆ°server èŠ‚ç‚¹ $ kubectl get node NAME STATUS ROLES AGE VERSION master Ready control-plane,master 25m v1.24.9-rc1+k3s2 node1 Ready \u003cnone\u003e 64s v1.24.9-rc1+k3s2 ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:4:2","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"K3s å„åå­—ç©ºé—´ä»‹ç» åœ¨Kubernetesä¸­ï¼ŒåŒ…æ‹¬K3sï¼Œå‘½åç©ºé—´ï¼ˆNamespacesï¼‰æä¾›äº†ä¸€ç§æœºåˆ¶æ¥åˆ’åˆ†é›†ç¾¤èµ„æºã€‚å®ƒä»¬å¯¹äºç»„ç»‡å’Œéš”ç¦»å·¥ä½œè´Ÿè½½éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸­ã€‚ä»¥ä¸‹æ˜¯K3sä¸­å¸¸è§çš„å‡ ä¸ªå‘½åç©ºé—´åŠå…¶ä½œç”¨ï¼š defaultï¼š è¿™æ˜¯Kubernetesé›†ç¾¤ä¸­çš„é»˜è®¤å‘½åç©ºé—´ã€‚å¦‚æœä½ æ²¡æœ‰ç‰¹åˆ«æŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´ï¼Œé‚£ä¹ˆä½ çš„Podã€æœåŠ¡ç­‰èµ„æºå°†ä¼šè¢«åˆ›å»ºåœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚ kube-systemï¼š è¯¥å‘½åç©ºé—´åŒ…å«äº†ç”±Kubernetesç³»ç»Ÿè‡ªèº«åˆ›å»ºçš„æ‰€æœ‰ç»„ä»¶ï¼Œå¦‚æ ¸å¿ƒDNSæœåŠ¡ï¼ˆCoreDNSï¼‰ã€å„ç§æ§åˆ¶å™¨å’ŒæœåŠ¡ä»£ç†ï¼ˆkube-proxyï¼‰ã€‚æ­¤å¤–ï¼Œå¦‚æœä½¿ç”¨äº†æŸäº›ç½‘ç»œæ’ä»¶æˆ–å­˜å‚¨æ’ä»¶ï¼Œç›¸å…³çš„Podä¹Ÿä¼šå‡ºç°åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚ kube-publicï¼š è¿™ä¸ªå‘½åç©ºé—´æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‘½åç©ºé—´ï¼Œæ—¨åœ¨ä¾›æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬é‚£äº›æœªè®¤è¯çš„ç”¨æˆ·ï¼‰è¯»å–ã€‚å®ƒé€šå¸¸ç”¨äºæ”¾ç½®æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®çš„ä¿¡æ¯ï¼Œä¾‹å¦‚é›†ç¾¤å¼•å¯¼ä»¤ç‰Œï¼ˆbootstrap tokensï¼‰ã€‚åœ¨æ ‡å‡†é…ç½®ä¸‹ï¼Œæ­¤å‘½åç©ºé—´å†…åªæœ‰ä¸€ä¸ªConfigMapå¯¹è±¡ï¼Œåä¸ºcluster-infoï¼Œå®ƒåŒ…å«äº†å…³äºAPIæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ kube-node-leaseï¼š è¿™ä¸ªå‘½åç©ºé—´æ˜¯ä»Kubernetes 1.16ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ï¼Œç”¨æ¥å­˜æ”¾èŠ‚ç‚¹ç§Ÿçº¦ï¼ˆNode Leaseï¼‰å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡å…è®¸èŠ‚ç‚¹å®šæœŸæ›´æ–°å…¶æ´»è·ƒçŠ¶æ€ï¼Œä»è€Œä¼˜åŒ–äº†èŠ‚ç‚¹å¥åº·æ£€æŸ¥çš„è¿‡ç¨‹ï¼Œä½¿å¾—é›†ç¾¤èƒ½å¤Ÿæ›´å¿«åœ°æ£€æµ‹åˆ°ä¸å¥åº·çš„èŠ‚ç‚¹ã€‚ å…¶ä»–å‘½åç©ºé—´ï¼š ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ›´å¤šçš„å‘½åç©ºé—´æ¥ç»„ç»‡ä¸åŒçš„åº”ç”¨æˆ–è€…å›¢é˜Ÿçš„å·¥ä½œè´Ÿè½½ã€‚è¿™æœ‰åŠ©äºèµ„æºç®¡ç†å’Œé…é¢æ§åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒé¡¹ç›®ä¹‹é—´æä¾›ä¸€å®šç¨‹åº¦çš„éš”ç¦»ã€‚ ç‰¹å®šäºK3sçš„å‘½åç©ºé—´ï¼š åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒK3så¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„å‘½åç©ºé—´ä»¥æ”¯æŒç‰¹å®šçš„åŠŸèƒ½æˆ–é›†æˆã€‚ä¾‹å¦‚ï¼Œå½“å¯ç”¨æŸäº›é™„åŠ ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šè‡ªåŠ¨åˆ›å»ºç›¸åº”çš„å‘½åç©ºé—´æ¥æ‰˜ç®¡è¿™äº›ç»„ä»¶ã€‚ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:5:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"å…¶ä»–åå­—ç©ºé—´ catle-system Rancherçš„\"catle-system\"å‘½åç©ºé—´é€šå¸¸ç”¨äºå­˜å‚¨Rancheræ§åˆ¶å¹³é¢ç»„ä»¶çš„èµ„æºï¼Œå¦‚WebhookæœåŠ¡(rancher-webhookpod)å’Œä¸å®‰å…¨ç›¸å…³çš„é…ç½®ï¼Œæ¯”å¦‚TLSè¯ä¹¦(cattle-webhook-tls)ã€‚è¿™äº›ç»„ä»¶æ˜¯Rancherç®¡ç†é›†ç¾¤è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæ“ä½œçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ å½“ä½ æåˆ°æ´²é™¤1oca1é›†ç¾¤catt1e-systemå‘½åç©ºé—´ä¸­çš„ç‰¹å®šPodå’ŒTLSå¯†é’¥æ—¶ï¼Œè¿™æ„å‘³ç€ä½ å¯èƒ½æ­£åœ¨æ¸…ç†æµ‹è¯•ç¯å¢ƒæˆ–è€…å‡†å¤‡è¿›è¡Œç»´æŠ¤æ“ä½œã€‚ä»¥ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:5:1","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"ç”Ÿäº§ç¯å¢ƒå‚è€ƒ k3s ç‰ˆæœ¬v1.22 æ•°æ®åº“ï¼šetcd å®¹å™¨è¿è¡Œæ—¶ï¼šcontainerd v1.5.9-k3s1 ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:6:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"1. server æœåŠ¡çŠ¶æ€ $ systemctl status k3s â— k3s.service - Lightweight Kubernetes Loaded: loaded (/etc/systemd/system/k3s.service; enabled; vendor preset: disabled) Active: active (running) since Mon 2024-05-13 23:00:30 CST; 8 months 10 days ago Docs: https://k3s.io Main PID: 25364 (k3s-server) Tasks: 84 Memory: 938.8M CGroup: /system.slice/k3s.service â”œâ”€17092 /var/lib/rancher/k3s/data/8307e9b398a0ee686ec38e18339d1464f75158a8b948b059b564246f4af3a0a6/bin/containerd-shim-runc-v2 -namespace k8s.io -id f11d857c503976e830b667a4... â”œâ”€25364 /usr/local/bin/k3s server â”œâ”€25379 containerd $ systemctl status etcd â— etcd.service - Etcd Server Loaded: loaded (/usr/lib/systemd/system/etcd.service; enabled; vendor preset: disabled) Active: active (running) since Fri 2022-05-20 09:50:06 CST; 2 years 8 months ago Main PID: 63172 (etcd) Tasks: 11 Memory: 413.0M CGroup: /system.slice/etcd.service â””â”€63172 /opt/etcd/etcd --config-file=/data/etcd/2379/conf/etcd.conf ç‰ˆæœ¬ $ kubectl version Client Version: version.Info{Major:\"1\", Minor:\"22\", GitVersion:\"v1.22.6+k3s1\", GitCommit:\"3228d9cb9a4727d48f60de4f1ab472f7c50df904\", GitTreeState:\"clean\", BuildDate:\"2022-01-25T01:27:44Z\", GoVersion:\"go1.16.10\", Compiler:\"gc\", Platform:\"linux/amd64\"} Server Version: version.Info{Major:\"1\", Minor:\"22\", GitVersion:\"v1.22.6+k3s1\", GitCommit:\"3228d9cb9a4727d48f60de4f1ab472f7c50df904\", GitTreeState:\"clean\", BuildDate:\"2022-01-25T01:27:44Z\", GoVersion:\"go1.16.10\", Compiler:\"gc\", Platform:\"linux/amd64\"} $ kubectl -n kube-system get all NAME READY STATUS RESTARTS AGE pod/coredns-96cc4f57d-7k4gr 1/1 Running 0 2y247d pod/metrics-server-ff9dbcb6c-vl8hl 1/1 Running 0 2y200d NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/kube-dns ClusterIP 10.43.0.10 \u003cnone\u003e 53/UDP,53/TCP,9153/TCP 2y248d service/kubelet ClusterIP None \u003cnone\u003e 10250/TCP,10255/TCP,4194/TCP 2y247d service/metrics-server ClusterIP 10.43.99.234 \u003cnone\u003e 443/TCP 2y248d NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/coredns 1/1 1 1 2y248d deployment.apps/metrics-server 1/1 1 1 2y248d NAME DESIRED CURRENT READY AGE replicaset.apps/coredns-96cc4f57d 1 1 1 2y248d replicaset.apps/metrics-server-ff9dbcb6c 1 1 1 2y248d å®¹å™¨è¿è¡Œæ—¶ ctr æ˜¯ containerd çš„å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…· $ ctr --help NAME: ctr - __ _____/ /______ / ___/ __/ ___/ / /__/ /_/ / \\___/\\__/_/ containerd CLI USAGE: ctr [global options] command [command options] [arguments...] VERSION: v1.5.9-k3s1 $ ctr version Client: Version: v1.5.9-k3s1 Revision: Go version: go1.16.10 Server: Version: v1.5.9-k3s1 Revision: UUID: 521e28e5-d9b4-4ae9-9dfd-48f742329485 ç›¸å…³é•œåƒ $ ctr images list -q|grep -v sha256|grep -v fluent docker.io/rancher/mirrored-coredns-coredns:1.8.6 docker.io/rancher/mirrored-metrics-server:v0.5.2 docker.io/rancher/mirrored-pause:3.6 docker.io/rancher/pause:3.1 docker.io/rancher/rancher-agent:v2.6.6 systemd å¯åŠ¨é…ç½® $ cat /etc/systemd/system/k3s.service [Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io Wants=network-online.target After=network-online.target [Install] WantedBy=multi-user.target [Service] Type=notify EnvironmentFile=-/etc/default/%N EnvironmentFile=-/etc/sysconfig/%N EnvironmentFile=-/etc/systemd/system/k3s.service.env KillMode=process Delegate=yes # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s ExecStartPre=/bin/sh -xc '! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service' ExecStartPre=-/sbin/modprobe br_netfilter ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/k3s \\ server \\ '--disable' \\ 'traefik' \\ '--disable' \\ 'servicelb' \\ '--disable' \\ 'local-storage' \\ '--datastore-endpoint=http://192.168.47.24:2379,http://192.168.47.25:2379,http://192.168.47.26:2379' \\ '--tls-san' \\ '192.168.47.251' \\ '--token' \\ 'secret' \\ '--kubelet-arg=container-log-max-files=5' \\ '--kubelet-arg=container-log-max-s","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:6:1","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"2. agent $ systemctl status k3s-agent â— k3s-agent.service - Lightweight Kubernetes Loaded: loaded (/etc/systemd/system/k3s-agent.service; enabled; vendor preset: disabled) Active: active (running) since Mon 2024-05-13 23:03:57 CST; 8 months 10 days ago Docs: https://k3s.io Main PID: 68145 (k3s-agent) Tasks: 120 Memory: 1.2G CGroup: /system.slice/k3s-agent.service k3s-agent.service é…ç½®æ–‡ä»¶ä¿¡æ¯ # cat /etc/systemd/system/k3s-agent.service [Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io Wants=network-online.target After=network-online.target [Install] WantedBy=multi-user.target [Service] Type=exec EnvironmentFile=-/etc/default/%N EnvironmentFile=-/etc/sysconfig/%N EnvironmentFile=-/etc/systemd/system/k3s-agent.service.env KillMode=process Delegate=yes # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s ExecStartPre=/bin/sh -xc '! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service' ExecStartPre=-/sbin/modprobe br_netfilter ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/k3s \\ agent \\ '--kubelet-arg' \\ 'container-log-max-files=5' \\ '--kubelet-arg' \\ 'container-log-max-size=100Mi' \\ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:6:2","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"ç”¨æˆ·æ¡ˆä¾‹ é€‰æ‹©K3sçš„åŸå›  k3sä¸Kubernetesä½¿ç”¨ä¹ æƒ¯å®Œå…¨ä¸€è‡´:ä¸Šæ‰‹æ— ä»£ä»· ä¸å…¶ä»–åŒç±»äº§å“æ¯”ï¼Œæ— åŠŸèƒ½ç»‘å®š å…¼å®¹Armè®¾å¤‡ é€šè¿‡å¯¼å…¥Rancherè¿›è¡Œç»Ÿä¸€çº³ç®¡ æ— å‚å•†é”å®šï¼Œæ— éœ€ç»‘å®šç¡¬ä»¶ 100% å¼€æºï¼Œåˆä½œæ–¹å¼çµæ´» å‡ºé”™é‡å¯å°±å¯ä»¥äº†ï¼Œä¸åƒk8s å‡ºé”™é‡å¯ä¹Ÿä¸ä¸€å®šèƒ½è§£å†³ï¼Œå“ˆå“ˆ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:7:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"Q/A ä½¿ç”¨k8s æ›¿æ¢k3s æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœåªæ˜¯æ™®é€šçš„ä½¿ç”¨ä¸€äº›workload æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œå¦‚æœworkload ä¸­çš„ä¸€äº›åº”ç”¨ä½¿ç”¨äº†ä¸€äº›è¯¸å¦‚è‡ªå®šä¹‰çš„cloud provider æ˜¯ä¸é€‚é…çš„ï¼Œä¸€èˆ¬åº”ç”¨äºiotä¹‹ç±»çš„åœºæ™¯ ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:8:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["K3s"],"content":"å‚è€ƒ k3så®˜ç½‘ Rancher Product K3s Document Kubernetes Document K3s Github ä»0åˆ°1åŸºç¡€å…¥é—¨ å…¨é¢äº†è§£k3s ä¸€æ–‡æå®šå…¨åœºæ™¯K3sç¦»çº¿å®‰è£… k3så®‰è£…æŒ‡å®šç‰ˆæœ¬ä»¥åŠç¦»çº¿å®‰è£…ï¼ˆdocker) 11-K3S å®‰è£…-ä»ªè¡¨ç›˜åŠå¸è½½K3s ","date":"2024-09-23","objectID":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:9:0","tags":["K3s"],"title":"K3s å¿«é€Ÿå…¥é—¨åŠå®‰è£…éƒ¨ç½²","uri":"/k3s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%8F%8A%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["linux"],"content":"rsync(remote synchronize)æ˜¯ä¸€ä¸ªè¿œç¨‹æ•°æ®åŒæ­¥å·¥å…·ï¼Œå¯é€šè¿‡ LAN/WAN å¿«é€ŸåŒæ­¥å¤šå°ä¸»æœºä¹‹é—´çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ rsync åŒæ­¥æœ¬åœ°ç¡¬ç›˜ä¸­çš„ä¸åŒç›®å½•ã€‚rsync æ˜¯ç”¨äºæ›¿ä»£rcpçš„ä¸€ä¸ªå·¥å…·ï¼Œrsync ä½¿ç”¨æ‰€è°“çš„ rsyncç®—æ³• è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œè¿™ç§ç®—æ³•åªä¼ é€ä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ•´ä»½ä¼ é€ï¼Œå› æ­¤é€Ÿåº¦ç›¸å½“å¿«ã€‚ rsync åŸºäºinotifyå¼€å‘,inotify ä¸»è¦çš„åŠŸèƒ½æ˜¯ç›‘æµ‹ç›®æ ‡ç›®å½•æ˜¯å¦æœ‰å˜åŒ–ã€‚rsync ç”¨ä½œåŒæ­¥ï¼Œinotify ç”¨ä½œç›‘æµ‹ï¼Œä¸¤è€…ç»“åˆä½¿ç”¨å®ç°é™æ€èµ„æºæ–¹æ¡ˆåŒæ­¥çš„å®ç°ã€‚ Rsyncæœ‰ä¸‰ç§æ¨¡å¼ æœ¬åœ°æ¨¡å¼(ç±»ä¼¼äºcpå‘½ä»¤) è¿œç¨‹æ¨¡å¼(ç±»ä¼¼äºscpå‘½ä»¤) å®ˆæŠ¤è¿›ç¨‹(socketè¿›ç¨‹ï¼šæ˜¯rsyncçš„é‡è¦åŠŸèƒ½) ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:0:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"å®‰è£… æµ‹è¯•æœºå™¨èŠ‚ç‚¹192.168.143.101ä½œä¸ºæºä¸»æœº å’Œ 192.168.143.102ä½œä¸ºç›®æ ‡ä¸»æœº rsync ç»“åˆinotify ç›‘æ§æºä¸»æœºçš„æŒ‡å®šç›®å½•å®æ—¶æ¨é€åˆ°ç›®æ ‡ä¸»æœºçš„æŒ‡å®šç›®å½•ä¸‹ï¼Œå®ç°é™æ€èµ„æºçš„å®æ—¶åŒæ­¥ å®‰è£…é…ç½®(Red Hat) $ yum install rsync -y # ä¿®æ”¹é…ç½®æ–‡ä»¶ $ vim /etc/rsyncd.conf Â·Â·Â· [ftp] path = /data/rsync_test # å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯ $ systemctl enable rsyncd --now # or $ rsync --daemon # æŸ¥çœ‹ç›®æ ‡ä¸»æœºåŒæ­¥æºä¸»æœºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ $ rsync --list-only lushuan@192.168.143.101::ftp drwxr-xr-x 19 2025/02/10 10:20:40 . -rw-r--r-- 0 2025/02/10 10:20:40 1.txt # è¿œç¨‹åŒæ­¥1ï¼šå°†æœ¬åœ°å†…å®¹åŒæ­¥åˆ°è¿œç¨‹ä¸»æœº rsync -av source/ username@remote_host:destination $ rsync -avz /data/rsync_test/ lushuan@192.168.143.102::ftp/ # è¿œç¨‹åŒæ­¥2: å°†è¿œç¨‹ä¸»æœºå†…å®¹åŒæ­¥åˆ°æœ¬åœ° $ rsync -avz 192.168.143.101::ftp/ /data/rsync_test/ receiving incremental file list ./ 1.txt æ³¨æ„ ä¼ è¾“çš„åŒæ–¹éƒ½å¿…é¡»å®‰è£… rsyncã€‚ ç›®æ ‡ä¸»æœºéœ€è¦é˜²ç«å¢™éœ€è¦å¯¹æºä¸»æœºå¼€æ”¾873 ç«¯å£æƒé™ ç›®æ ‡ä¸»æœºçš„åŒæ­¥ç›®å½•æƒé™åº”ä¸º755 ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:1:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"rsyncd å¢åŠ å®‰å…¨è®¤è¯åŠå…å¯†ç™»å½• echo \"lushuan:111\" \u003e\u003e /etc/rsyncd.pwd chmod 600 /etc/rsyncd.pwd vim /etc/rsyncd.conf ... auth users = lushuan secrets file=/etc/rsyncd.pwd [ftp] path = /data/rsync_test $ rsync --list-only lushuan@192.168.143.101::ftp Password: (111) drwxr-xr-x 19 2025/02/10 10:20:40 . -rw-r--r-- 0 2025/02/10 10:20:40 1.txt # ç›®æ ‡ä¸»æœºå…äº¤äº’è¾“å…¥å¯†ç æ–¹å¼åŒæ­¥æ–‡ä»¶ $ echo \"111\" \u003e\u003e /etc/rsyncd.pwd.client $ chmod 600 /etc/rsyncd.pwd.client $ rsync --list-only --password-file=/etc/rsyncd.pwd.client lushuan@192.168.143.101::ftp drwxr-xr-x 19 2025/02/10 10:20:40 . -rw-r--r-- 0 2025/02/10 10:20:40 1.txt # æ‰§è¡Œå¢é‡åŒæ­¥æ“ä½œåˆ°ç›®æ ‡ä¸»æœºçš„ç›®æ ‡ç›®å½• /data/rsync_test $ rsync -avz --password-file=/etc/rsyncd.pwd.client lushuan@192.168.143.101::ftp /data/rsync_test # ç›®æ ‡ä¸»æœºæ“ä½œï¼Œæºä¸»æœºæœ‰æ–‡ä»¶åˆ é™¤æ—¶æ‰§è¡ŒåŒæ­¥æ“ä½œ --delete $ rsync -avz --delete --password-file=/etc/rsyncd.pwd.client lushuan@192.168.143.101::ftp /data/rsync_test rsync å¸¸ç”¨é€‰é¡¹ é€‰é¡¹ å«ä¹‰ -a, --archive å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§ï¼ˆç›¸å½“äº -rlptgoD çš„ç»„åˆï¼‰ã€‚ -r, --recursive å¯¹å­ç›®å½•ä»¥é€’å½’æ¨¡å¼å¤„ç†ï¼ŒåŒæ­¥ç›®å½•æ—¶åŒ…æ‹¬å­ç›®å½•åŠå…¶ä¸­çš„æ–‡ä»¶ã€‚ -v, --verbose è¯¦ç»†æ¨¡å¼è¾“å‡ºï¼Œæ˜¾ç¤ºæ›´å¤šçš„å…³äºä¼ è¾“è¿‡ç¨‹çš„ä¿¡æ¯ã€‚ -z, --compress åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‹ç¼©æ–‡ä»¶æ•°æ®ã€‚ -P ç›¸å½“äº --partial --progressï¼Œæ˜¾ç¤ºä¼ è¾“è¿›åº¦å¹¶ä¿ç•™éƒ¨åˆ†ä¼ è¾“çš„æ–‡ä»¶ï¼ˆå¦‚æœä¼ è¾“ä¸­æ–­ï¼‰ã€‚ -u, --update åªæ›´æ–°ç›®æ ‡ç«¯è¾ƒæ—§çš„æ–‡ä»¶æˆ–ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè·³è¿‡æ¯”æºæ–‡ä»¶æ–°çš„ç›®æ ‡æ–‡ä»¶ã€‚ -l, --links ä¿ç•™ç¬¦å·é“¾æ¥ï¼Œå°†æºç›®å½•ä¸­çš„ç¬¦å·é“¾æ¥ä½œä¸ºé“¾æ¥ç›´æ¥å¤åˆ¶è€Œä¸æ˜¯å®ƒä»¬æŒ‡å‘çš„å®é™…æ–‡ä»¶ã€‚ -p, --perms ä¿ç•™æ–‡ä»¶æƒé™ã€‚ -t, --times ä¿ç•™ä¿®æ”¹æ—¶é—´ã€‚ -g, --group ä¿ç•™æ–‡ä»¶æ‰€å±ç»„ä¿¡æ¯ã€‚ -o, --owner ä¿ç•™æ–‡ä»¶æ‰€æœ‰è€…ä¿¡æ¯ï¼ˆä»…é€‚ç”¨äºè¶…çº§ç”¨æˆ·ï¼‰ã€‚ -D ç›¸å½“äº --devices --specialsï¼Œä¿ç•™è®¾å¤‡æ–‡ä»¶å’Œç‰¹æ®Šæ–‡ä»¶ã€‚ --delete åˆ é™¤ç›®æ ‡ä½ç½®ä¸Šå­˜åœ¨ä½†åœ¨æºä½ç½®ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä½¿ç›®æ ‡ä½ç½®çš„å†…å®¹å®Œå…¨ä¸æºä½ç½®ä¸€è‡´ã€‚ --exclude=PATTERN æŒ‡å®šæ’é™¤è§„åˆ™ï¼Œä¸ä¼ è¾“åŒ¹é…è¯¥æ¨¡å¼çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:2:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"rsync æ¨é€æ–¹æ¡ˆ è¿‘æ—¶æ¨é€(ç›®æ ‡ä¸»æœºå®šæ—¶è½®è¯¢æ‹‰å–æºä¸»æœºï¼Œä¼šæœ‰ä¸€å®šçš„ç½‘ç»œèµ„æºçš„æµªè´¹) å®æ—¶æ¨é€ ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:3:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"å®æ—¶æ¨é€æºæœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨é…ç½® æºä¸»æœº192.168.143.101å’Œç›®æ ‡ä¸»æœº192.168.143.102 rsyncd é…ç½®ä¿®æ”¹ # 1. 192.168.143.102 ç›®æ ‡ä¸»æœºé…ç½® $ echo \"lushuan:111\" \u003e\u003e /etc/rsyncd.pwd $ chmod 600 /etc/rsyncd.pwd $ vim /etc/rsyncd.conf ... uid = root # åˆ›å»º/data/rsync_testç›®å½•çš„ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ gid = root # åˆ›å»º/data/rsync_testç›®å½•çš„ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ auth users = lushuan secrets file=/etc/rsyncd.pwd read only = no [ftp] path = /data/rsync_test # é‡å¯æœåŠ¡ $ systemctl restart rsyncd # 2.192.168.143.101 æºä¸»æœºé…ç½® $ echo \"111\" \u003e\u003e /etc/rsyncd.pwd.client $ chmod 600 /etc/rsyncd.pwd.client $ rsync --list-only --password-file=/etc/rsyncd.pwd.client lushuan@192.168.143.102::ftp # é‡å¯æœåŠ¡ $ systemctl restart rsyncd # å®æ—¶æ¨é€(æ‰‹åŠ¨) $ rsync -avz --delete --password-file=/etc/rsyncd.pwd.client /data/rsync_test/ lushuan@192.168.143.102::ftp ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:3:1","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"inotify ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:4:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"inotify ä»‹ç» inotify æ˜¯ä¸€ç§ç”¨äº Linux ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ç›‘æ§æœºåˆ¶ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºç›‘å¬æ–‡ä»¶æˆ–ç›®å½•çš„å˜åŒ–ã€‚é€šè¿‡ inotifyï¼Œç¨‹åºå¯ä»¥æ¥æ”¶åˆ°è¯¸å¦‚æ–‡ä»¶è¢«è¯»å–ã€å†™å…¥ã€åˆ›å»ºã€åˆ é™¤ã€æƒé™æ›´æ”¹ç­‰æ“ä½œçš„é€šçŸ¥ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆéœ€è¦å®æ—¶å“åº”æ–‡ä»¶ç³»ç»Ÿå˜åŒ–çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚è‡ªåŠ¨åŒæ­¥æ–‡ä»¶ã€æ—¥å¿—ç›‘æ§æˆ–è€…ä½œä¸ºæŸäº›å¼€å‘å·¥å…·ï¼ˆå¦‚çƒ­é‡è½½åŠŸèƒ½ï¼‰çš„åŸºç¡€ã€‚ ä»¥ä¸‹æ˜¯ inotify çš„ä¸€äº›å…³é”®ç‰¹æ€§ï¼š é«˜æ•ˆæ€§ï¼šä¸ä¹‹å‰çš„æ–¹æ¡ˆï¼ˆä¾‹å¦‚ dnotifyï¼‰ç›¸æ¯”ï¼Œinotify ä½¿ç”¨äº†æ›´é«˜æ•ˆçš„æœºåˆ¶æ¥è·Ÿè¸ªæ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ï¼Œå‡å°‘äº†èµ„æºæ¶ˆè€—ã€‚ çµæ´»æ€§ï¼šå¯ä»¥ç›‘è§†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•æ ‘ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ã€‚ éé€’å½’ç›‘æ§ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹ç›®å½•çš„ç›‘æ§ä¸æ˜¯é€’å½’çš„ï¼›å¦‚æœè¦ç›‘æ§å­ç›®å½•ï¼Œåˆ™éœ€è¦ä¸ºæ¯ä¸ªå­ç›®å½•å•ç‹¬è®¾ç½®ç›‘æ§ï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ¥å®ç°é€’å½’ç›‘æ§ã€‚ ä¸°å¯Œçš„äº‹ä»¶ç±»å‹ï¼šæ”¯æŒå¤šç§ç±»å‹çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè®¿é—®æ–‡ä»¶ï¼ˆaccessï¼‰ã€ä¿®æ”¹æ–‡ä»¶ï¼ˆmodifyï¼‰ã€æ–‡ä»¶å±æ€§æˆ–å†…å®¹çš„æ”¹å˜ï¼ˆattribï¼‰ã€æ‰“å¼€æ–‡ä»¶ï¼ˆopenï¼‰ã€å…³é—­æ–‡ä»¶ï¼ˆcloseï¼‰ã€ç§»åŠ¨ï¼ˆmoveï¼‰ã€åˆ›å»ºï¼ˆcreateï¼‰ã€åˆ é™¤ï¼ˆdeleteï¼‰ç­‰ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹æ¥å£ï¼ˆå¦‚ C è¯­è¨€æä¾›çš„ API æˆ–è€…å„ç§è„šæœ¬è¯­è¨€çš„æ‰©å±•åº“ï¼‰ç›´æ¥ä½¿ç”¨ inotifyï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ä¸€äº›åŸºäº inotify å¼€å‘çš„å·¥å…·ï¼Œå¦‚ inotify-toolsï¼Œå®ƒæä¾›äº†å‘½ä»¤è¡Œå·¥å…· inotifywait å’Œ inotifywatch æ¥ç®€åŒ–ç›‘æ§ä»»åŠ¡ã€‚ ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œinotify å·²ç»æˆä¸ºç°ä»£ Linux ç³»ç»Ÿä¸Šç›‘æ§æ–‡ä»¶ç³»ç»Ÿæ´»åŠ¨çš„æ ‡å‡†æ–¹å¼ä¹‹ä¸€ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinotify ä¸»è¦é€‚ç”¨äº Linux ç³»ç»Ÿï¼Œåœ¨å…¶ä»–ç±» Unix ç³»ç»Ÿä¸Šå¯èƒ½ä¸ç›´æ¥å¯ç”¨ã€‚ ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:4:1","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"å®‰è£… æ¨é€ç«¯192.168.143.101å®‰è£…inotify # ä¾èµ– yum install -y automake # å®‰è£… yum install -y inotify-tools æºä¸»æœºç›‘æ§ç›®å½• inotifywait -m -r --timefmt '%Y-%m-%d %H:%M:%S' --format '%T %w%f %e' -e close_write,modify,delete,create,attrib,move /data/rsync_test/ ç®€å•çš„è‡ªåŠ¨åŒ–è„šæœ¬ #!/bin/bash SOURCE=\"/data/rsync_test/\" DEST_USER=\"lushuan\" DEST_HOST=\"192.168.143.102\" DEST_DIR=\"ftp\" # å¦‚æœæ²¡æœ‰è®¾ç½®åŠ å¯†è®¤è¯å¯ä»¥ç§»é™¤æ‰ PASSWORD_FILE=\"/etc/rsyncd.pwd.client\" inotifywait -m -r --timefmt '%Y-%m-%d %H:%M:%S' -e close_write,modify,delete,create,attrib,move --format '%w%f' ${SOURCE} | while read NEWFILE do rsync -avz --delete --password-file=${PASSWORD_FILE} ${SOURCE} ${DEST_USER}@${DEST_HOST}::${DEST_DIR} done inotifywait å¸¸ç”¨å‚æ•°åŠå…¶å«ä¹‰ é€‰é¡¹ å«ä¹‰ -m, --monitor æŒç»­ç›‘æ§è€Œä¸é€€å‡ºï¼Œå³ä½¿åœ¨é¦–æ¬¡äº‹ä»¶å‘ç”Ÿåä¹Ÿç»§ç»­ç›‘å¬ã€‚ -r, --recursive é€’å½’ç›‘å¬æ‰€æœ‰å­ç›®å½•ä¸­çš„äº‹ä»¶ã€‚ -e, --event æ˜ç¡®æŒ‡å®šè¦ç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼Œå¦‚ access, modify, attrib, move, create, delete, close_write ç­‰ã€‚å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªäº‹ä»¶ï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚ --timefmt å½“ä¸ --format ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè®¾ç½®æ—¶é—´è¾“å‡ºæ ¼å¼ï¼Œä¾‹å¦‚ '%Y-%m-%d %H:%M:%S'ã€‚ --format å®šåˆ¶è¾“å‡ºä¿¡æ¯çš„æ ¼å¼ï¼Œå¦‚ '[%T] %w %f %#Xe'ï¼Œå…¶ä¸­ %T è¡¨ç¤ºæ—¶é—´ï¼Œ%w ç›‘å¬çš„ç›®å½•ï¼Œ%f å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶åï¼Œ%#Xe è¡¨ç¤ºäº‹ä»¶åˆ—è¡¨ã€‚ -q, --quiet å‡å°‘æˆ–æ¶ˆé™¤éé”™è¯¯æ¶ˆæ¯çš„è¾“å‡ºï¼Œç”¨äºå‡å°‘å‘½ä»¤è¡Œè¾“å‡ºçš„ä¿¡æ¯é‡ã€‚ -d, --daemon ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œé€šå¸¸é…åˆ --outfile ä½¿ç”¨æ¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶ã€‚ --outfile æŒ‡å®šè¾“å‡ºé‡å®šå‘åˆ°çš„æ–‡ä»¶è·¯å¾„ï¼Œå¸¸ä¸ -d é€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚ ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:4:2","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"æœ€ä½³å®è·µ åœ¨éƒ¨ç½²rsyncd æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æƒé™ç›¸å…³çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯é…ç½®ç›¸å…³çš„é—®é¢˜ï¼Œä¸‹é¢ç»™å‡ºå¯¹åº”çš„å‚è€ƒï¼Œè‹¥æœæœ‰å…¶å®ƒçš„å¼‚å¸¸æŠ¥é”™å¯ä»¥å‚è€ƒrsyncæ•…éšœæ’é™¤è§£ç­”,ä¸‹é¢æ˜¯é…ç½®å‚è€ƒï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥ä¿®æ”¹ï¼Œè¿™é‡Œæ˜¯åŠ å¯†è®¤è¯çš„é…ç½®ã€‚ å¦å¤–å¦‚æœæ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå¯èƒ½é‡åˆ°é˜²ç«å¢™æ²¡æœ‰å¼€æ”¾çš„é—®é¢˜ï¼Œæ³¨æ„æ”¾å¼€ä¸€ä¸‹ 873 ç«¯å£ï¼Œæœ€åå°±æ˜¯æºä¸»æœºå’Œç›®æ ‡ä¸»æœºå¦‚æœæ˜¯éroot ç”¨æˆ·æ³¨æ„æŸ¥çœ‹ç›®å½•çš„æƒé™ï¼Œæ¨èç›®å½•æƒé™ä¸º766 ... uid = root gid = root auth users = lushuan secrets file=/etc/rsyncd.pwd read only = no [ftp] path = /data/rsync_test ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:5:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["linux"],"content":"å‚è€ƒ rsyncå®˜ç½‘ rsync ç”¨æ³•æ•™ç¨‹ rsyncæ•…éšœæ’é™¤è§£ç­” ","date":"2024-08-26","objectID":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/:6:0","tags":["rsync"],"title":"rsyncç»“åˆinotifyå®ç°é™æ€èµ„æºå®æ—¶åŒæ­¥","uri":"/rsync%E7%BB%93%E5%90%88inotify%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"},{"categories":["Helm"],"content":"å‰è¨€ é€šè¿‡Helméƒ¨ç½²åº”ç”¨ï¼Œä¿®æ”¹configmapåï¼ŒDeployment å‰¯æœ¬æ§åˆ¶å™¨ä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤pod é‡å»ºä¸€ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œ è¿™é‡Œå®è·µé€šè¿‡æ·»åŠ æ ‡ç­¾çš„æ–¹å¼åœ¨é€šè¿‡åªä¿®æ”¹configmapä¹Ÿèƒ½è”åŠ¨Deploymentè‡ªåŠ¨é‡å»º ","date":"2024-07-21","objectID":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/:1:0","tags":["Helm"],"title":"Helmä¿®æ”¹configmapååº”ç”¨è‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ","uri":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/"},{"categories":["Helm"],"content":"å®‰è£…åº”ç”¨ helm repo add bitnami https://charts.bitnami.com/bitnami # ä»¥grafana åº”ç”¨éƒ¨ç½²ä¸ºä¾‹ --untar æ‹‰å–ä¸‹æ¥åè‡ªåŠ¨è§£å‹ helm pull bitnami/grafana --untar # è¿™é‡Œåšåˆ›å»ºæµ‹è¯•ï¼Œå…³é—­æŒä¹…åŒ–ï¼Œä¸åˆ›å»ºpvc helm install grafana ./grafana --set persistence.enabled=false $ helm list NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION grafana default 4 2024-07-21 15:28:58.208948145 +0800 CST deployed grafana-11.3.26 11.3.0 $ kubectl get pod NAME READY STATUS RESTARTS AGE grafana-6cc56576dc-97bvw 1/1 Running 0 138m ","date":"2024-07-21","objectID":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/:2:0","tags":["Helm"],"title":"Helmä¿®æ”¹configmapååº”ç”¨è‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ","uri":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/"},{"categories":["Helm"],"content":"éªŒè¯ 1ã€ä¿®æ”¹é…ç½® vim grafana/templates/deployment.yaml 2ã€æ·»åŠ label labels: {{- include \"common.labels.standard\" ( dict \"customLabels\" .Values.commonLabels \"context\" $ ) | nindent 4 }} app.kubernetes.io/component: grafana configmap-hash: \"{{ .Values.config | toYaml | sha256sum | trunc 63 }}\" # æ·»åŠ configmap-hash 3ã€ä¿®æ”¹configmap vim grafana/templates/configmap.yaml data å†…å®¹æ·»åŠ ä¸€è¡Œæµ‹è¯•æ•°æ®GF_TEST: /opt/test root@k8s-master01:~/helm# kubectl get cm grafana-envvars -o yaml apiVersion: v1 data: GF_AUTH_LDAP_ALLOW_SIGN_UP: \"false\" GF_AUTH_LDAP_CONFIG_FILE: /opt/bitnami/grafana/conf/ldap.toml GF_AUTH_LDAP_ENABLED: \"false\" GF_INSTALL_PLUGINS: \"\" GF_PATHS_CONFIG: /opt/bitnami/grafana/conf/grafana.ini GF_PATHS_DATA: /opt/bitnami/grafana/data GF_PATHS_LOGS: /opt/bitnami/grafana/logs GF_PATHS_PLUGINS: /opt/bitnami/grafana/data/plugins GF_PATHS_PROVISIONING: /opt/bitnami/grafana/conf/provisioning GF_SECURITY_ADMIN_USER: admin GF_TEST: /opt/test 4ã€å‡çº§ $ helm upgrade grafana ./grafana --set persistence.enabled=false # å¯ä»¥çœ‹åˆ°å®¹å™¨å‘ç”Ÿäº†é‡å»º $ kubectl get pod NAME READY STATUS RESTARTS AGE grafana-6cc56576dc-97bvw 1/1 Running 0 145m grafana-7b8869fd4f-6jrd5 0/1 Running 0 4s ","date":"2024-07-21","objectID":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/:3:0","tags":["Helm"],"title":"Helmä¿®æ”¹configmapååº”ç”¨è‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ","uri":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/"},{"categories":["Helm"],"content":"æ€»ç»“ Helmå€ŸåŠ©æ·»åŠ æ ‡ç­¾hashåŒ–ï¼ŒåŠ¨æ€æ›´æ–°deployment ","date":"2024-07-21","objectID":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/:4:0","tags":["Helm"],"title":"Helmä¿®æ”¹configmapååº”ç”¨è‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ","uri":"/helm%E4%BF%AE%E6%94%B9configmap%E5%90%8E%E5%BA%94%E7%94%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%94%9F%E6%95%88/"},{"categories":["Kubernetes"],"content":"æ•´ä½“æµç¨‹ éƒ¨ç½²å‡†å¤‡ k8s é›†ç¾¤å®¹å™¨è¿è¡Œæ—¶ Containerd å‡†å¤‡ k8s é›†ç¾¤éƒ¨ç½² k8s é›†ç¾¤è½¯ä»¶ apt æºå‡†å¤‡ k8s é›†ç¾¤è½¯ä»¶å®‰è£… k8s é›†ç¾¤åˆå§‹åŒ– k8s é›†ç¾¤worker èŠ‚ç‚¹åŠ å…¥ k8s é›†ç¾¤ç½‘ç»œæ’ä»¶ Calico å‡†å¤‡ éƒ¨ç½²åº”ç”¨éªŒè¯é›†ç¾¤å¯ç”¨æ€§ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:1:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"é›†ç¾¤ç¯å¢ƒä¿¡æ¯ æ“ä½œç³»ç»ŸUbuntu22.04 éƒ¨ç½² k8s ç‰ˆæœ¬ä¸ºv1.28 å®¹å™¨è¿è¡Œæ—¶ä¸º Containerd 1.7.11 ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:2:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"1. ä¸»æœºå‡†å¤‡ è™šæ‹Ÿæœºæ˜¯é€šè¿‡vmvare åˆ›å»ºçš„ï¼Œæ­å»ºçš„k8s é›†ç¾¤æ˜¯éé«˜å¯ç”¨æ¨¡å¼ï¼Œä¸‹æ–¹æä¾›éƒ¨ç½²è„šæœ¬ã€‚ éƒ¨ç½²è¿‡ç¨‹ä¸­ç”±äº2024å¹´6æœˆä»½ docker é•œåƒä»“åº“ä¸å†å¯¹å¤§é™†æä¾›æœåŠ¡ï¼Œéœ€è¦è¿›è¡Œç¦»çº¿éƒ¨ç½²ï¼Œä¸»è¦æ˜¯ calico è¿™ä¸€å—ä¼šæœ‰é•œåƒæºç¼ºå¤±,å¯¹åº”ç« èŠ‚ä¼šæœ‰è¡¥å……è¯´æ˜åŠè§£å†³æ–¹æ¡ˆ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:3:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"1.1 æ“ä½œç³»ç»Ÿ æ“ä½œç³»ç»Ÿ ç‰ˆæœ¬ è¯´æ˜ ubuntu ubuntu-22.04.4-live-server-amd64 æœ€å°åŒ– ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:3:1","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"1.2 ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜ ip CPU å†…å­˜ ç¡¬ç›˜ è§’è‰² ä¸»æœºå 192.168.1.11 2C 4G 30G master k8s-nastert01 192.168.1.7 2C 4G 30G node k8s-node01 ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:3:2","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"1.3 ä¸»æœºé…ç½® æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ 1.3.1 ä¸»æœºåé…ç½® #master èŠ‚ç‚¹ hostnamectl set-hostname k8s-nastert01 #ndoe èŠ‚ç‚¹ hostnamectl set-hostname k8s-node01 1.3.2 ä¸»æœºip åœ°å€é…ç½® vmvare åˆ›å»ºè™šæ‹Ÿæœºç½‘ç»œé€‚é…å™¨é€‰æ‹©æ¡¥æ¥æ¨¡å¼(è‡ªåŠ¨)ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ipåœ°å€ï¼Œå¦åˆ™å½“è™šæ‹Ÿæœºé‡å¯åip åœ°å€ä¼šå‘ç”Ÿå˜åŒ– k8s-master01 èŠ‚ç‚¹ sudo cp /etc/netplan/00-installer-config.yaml /etc/netplan/00-installer-config.yaml_before cat \u003c\u003c EOF \u003e /etc/netplan/00-installer-config.yaml # This is the network config written by 'subiquity' network: ethernets: ens33: addresses: - 192.168.1.11/16 nameservers: addresses: - 114.114.114.114 # å›½å†…ç§»åŠ¨è”é€š - 8.8.8.8 # è°·æ­Œ search: [] routes: - to: default via: 192.168.1.1 # ç”µè„‘æœ¬åœ°ç½‘å…³åœ°å€ version: 2 EOF # ä½¿é…ç½®ç”Ÿæ•ˆ sudo netplan apply k8s-node01 èŠ‚ç‚¹ sudo cp /etc/netplan/00-installer-config.yaml /etc/netplan/00-installer-config.yaml_before cat \u003c\u003c EOF \u003e /etc/netplan/00-installer-config.yaml # This is the network config written by 'subiquity' network: ethernets: ens33: addresses: - 192.168.1.7/16 nameservers: addresses: - 114.114.114.114 # å›½å†…ç§»åŠ¨è”é€š - 8.8.8.8 # è°·æ­Œ search: [] routes: - to: default via: 192.168.1.1 version: 2 EOF # ä½¿é…ç½®ç”Ÿæ•ˆ sudo netplan apply 1.3.3 ä¸»æœºåå’Œip åœ°å€è§£æ cat \u003e\u003e /etc/hosts \u003c\u003c EOF \u003e 192.168.1.11 k8s-master01 \u003e 192.168.1.7 k8s-node01 \u003e EOF 1.3.4 chronyæ—¶é—´åŒæ­¥é…ç½® k8s-master01 èŠ‚ç‚¹æ‰§è¡Œ $ cp /etc/chrony/chrony.conf /etc/chrony/chrony.conf_bak $ cat \u003e /etc/chrony/chrony.conf \u003c\u003c EOF confdir /etc/chrony/conf.d server ntp.aliyun.com iburst allow 192.168.1.1/24 sourcedir /run/chrony-dhcp sourcedir /etc/chrony/sources.d keyfile /etc/chrony/chrony.keys driftfile /var/lib/chrony/chrony.drift ntsdumpdir /var/lib/chrony logdir /var/log/chrony maxupdateskew 100.0 rtcsync makestep 1 3 leapsectz right/UTC EOF $ date Thu Jun 20 10:10:56 AM CST 2024 # è®¾ç½®æ—¶åŒº $ timedatectl set-timezone Asia/Shanghai # éƒ¨ç½²æ—¶é—´åŒæ­¥æœåŠ¡å™¨ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯ $ apt install ntpdate chrony -y $ ntpdate time2.aliyun.com $ systemctl start chrony $ systemctl status chrony $ systemctl enable chrony # æŸ¥çœ‹ chronyd æ—¶é—´åŒæ­¥æœåŠ¡çš„æºçš„ç»Ÿè®¡ä¿¡æ¯ $ chronyc sourcestats -v k8s-node01 èŠ‚ç‚¹æ‰§è¡Œ,ä¿®æ”¹ server ä¸º master èŠ‚ç‚¹ip $ cp /etc/chrony/chrony.conf /etc/chrony/chrony.conf_bak $ cat \u003e /etc/chrony/chrony.conf \u003c\u003c EOF confdir /etc/chrony/conf.d server 192.168.1.11 iburst sourcedir /run/chrony-dhcp sourcedir /etc/chrony/sources.d keyfile /etc/chrony/chrony.keys driftfile /var/lib/chrony/chrony.drift ntsdumpdir /var/lib/chrony logdir /var/log/chrony maxupdateskew 100.0 rtcsync makestep 1 3 leapsectz right/UTC EOF $ date Thu Jun 20 10:15:56 AM CST 2024 # è®¾ç½®æ—¶åŒº $ timedatectl set-timezone Asia/Shanghai # éƒ¨ç½²æ—¶é—´åŒæ­¥æœåŠ¡å™¨ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯ $ apt install ntpdate chrony -y $ ntpdate time2.aliyun.com $ systemctl start chrony $ systemctl status chrony $ systemctl enable chrony # æŸ¥çœ‹ chronyd æ—¶é—´åŒæ­¥æœåŠ¡çš„æºçš„ç»Ÿè®¡ä¿¡æ¯ $ chronyc sourcestats -v 1.3.5 é…ç½®å†…æ ¸è½¬å‘åŠç½‘æ¡¥è¿‡æ»¤ # è½¬å‘IPv4å¹¶è®©iptablesçœ‹åˆ°æ¡¥æ¥æµé‡ $ sudo cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF # æ‰‹åŠ¨åŠ è½½ $ modprobe overlay $ modprobe br_netfilter # æ£€æµ‹æ˜¯å¦åŠ è½½ $ lsmod | egrep \"overlay\" $ lsmod | egrep \"br_netfilter\" # æ·»åŠ ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®,è®¾ç½®æ‰€éœ€çš„sysctlå‚æ•°ï¼Œå‚æ•°åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ $ sudo cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF #æ£€æŸ¥sysctlæ˜¯å¦æˆåŠŸåº”ç”¨ï¼š $ sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward # æ‰‹åŠ¨åŠ è½½ #sudo sysctl -p /etc/sysctl.d/k8s.conf # or $ sudo sysctl --system 1.3.6 å®‰è£…ipsetå’Œipvsadm $ apt install ipset ipvsadm -y # é…ç½®ipvsadm å†…æ ¸æ¨¡å—åŠ è½½ $ cat \u003c\u003c EOF \u003e /etc/modules-load.d/ipvs.conf ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh nf_conntrack EOF # æ‰‹åŠ¨åŠ è½½æ¨¡å— $ modprobe -- ip_vs $ modprobe -- ip_vs_rr $ modprobe -- ip_vs_wrr $ modprobe -- ip_vs_sh $ modprobe -- nf_conntrack 1.3.7 å…³é—­SWAPåˆ†åŒº k8s é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ # ä¸´æ—¶å…³é—­ $ swapoff -a # æ°¸ä¹…å…³é—­ $ sed -i '/swap/ s/^\\(.*\\)$/#\\1/g' /etc/fstab # éªŒè¯æ˜¯å¦ç¦ç”¨æˆåŠŸ swapon -s # æ²¡æœ‰è¾“å‡ºè¡¨ç¤ºç¦ç”¨æˆåŠŸ 1.3.8 æ‰€æœ‰è®¾å¤‡å…è®¸ root ç”¨æˆ· $ cat \u003e\u003e /etc/ssh/sshd_config \u003c\u003c EOF PermitRootLogin yes PasswordAuthentication yes EOF 1.3.9 å…³é—­é˜²ç«å¢™ #æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ $ sudo systemctl status ufw #å…³é—­é˜²ç«å¢™ $ sudo systemctl stop ufw #ç¦æ­¢é˜²ç«å¢™å¼€æœºå¯åŠ¨ $ sudo systemctl disable ufw ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:3:3","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"2. éƒ¨ç½²Conatinerd æœåŠ¡ æ‰€æœ‰ä¸»æœºéƒ½è¦æ‰§è¡Œ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:4:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"2.1 ä¸‹è½½åŠå®‰è£… # éƒ¨ç½² containerd $ wget https://github.com/containerd/containerd/releases/download/v1.7.11/cri-containerd-static-1.7.11-linux-amd64.tar.gz #tar Czxvf /usr/local/ cri-containerd-static-1.7.11-linux-amd64.tar.gz $ sudo tar -zxvf cri-containerd-cni-1.7.11-linux-amd64.tar.gz -C / è­¦å‘Š\rè¿™é‡Œé€‰æ‹©çš„é€‚é…k8s å®¹å™¨è¿è¡Œæ—¶çš„containerd,æœ‰ä¸€ä¸ªå‰ç¼€cri(container runtime interface)ï¼Œå¦å¤–æ ¹æ®è‡ªå·±çš„æ“ä½œç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„æ¶æ„ï¼Œå¸¸ç”¨çš„æ˜¯amd64\r","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:4:1","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"2.2 é…ç½®ContainerdæœåŠ¡ $ mkdir -p /etc/containerd $ containerd config default \u003e /etc/containerd/config.toml # ä¿®æ”¹ä¸ºå›½å†…ä»£ç†é•œåƒä»“åº“ $ sed -i 's/registry.k8s.io\\/pause:3.8/registry.cn-hangzhou.aliyuncs.com\\/google_containers\\/pause:3.9/g' /etc/containerd/config.toml # é©±åŠ¨ä½¿ç”¨ä¸ºSystemdCgroup $ sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml $ sed -i 's/disabled_plugins/#disabled_plugins/g' /etc/containerd/config.toml ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:4:2","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"2.3 è®¾ç½®containerdå¼€æœºè‡ªå¯åŠ¨ $ systemctl enable --now containerd #éªŒè¯ç‰ˆæœ¬ $ containerd --version ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:4:3","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"3. k8sé›†ç¾¤éƒ¨ç½² æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:5:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"3.1 k8sé…ç½®é›†ç¾¤è½¯ä»¶aptæºåŠå®‰è£… #ä¸‹è½½ç”¨äº Kubernetes è½¯ä»¶åŒ…ä»“åº“çš„å…¬å…±ç­¾åå¯†é’¥ã€‚æ‰€æœ‰ä»“åº“éƒ½ä½¿ç”¨ç›¸åŒçš„ç­¾åå¯†é’¥ï¼Œå› æ­¤ä½ å¯ä»¥å¿½ç•¥URLä¸­çš„ç‰ˆæœ¬ curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg # æ·»åŠ  Kubernetes apt ä»“åº“ã€‚ è¯·æ³¨æ„ï¼Œæ­¤ä»“åº“ä»…åŒ…å«é€‚ç”¨äº Kubernetes 1.28 çš„è½¯ä»¶åŒ… echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list # æ›´æ–° apt åŒ…ç´¢å¼•å¹¶å®‰è£…ä½¿ç”¨ Kubernetes apt ä»“åº“æ‰€éœ€è¦çš„åŒ… sudo apt-get update sudo apt-get install -y apt-transport-https ca-certificates curl gpg # k8s é›†ç¾¤è½¯ä»¶å®‰è£… # 3.2.1 æ›´æ–° apt åŒ…ç´¢å¼•ï¼Œå®‰è£… kubeletã€kubeadm å’Œ kubectlï¼Œå¹¶é”å®šå…¶ç‰ˆæœ¬(é˜²æ­¢è‡ªåŠ¨æ›´æ–°)ï¼š $ sudo apt-get update $ apt-get install -y kubelet=1.28.11-00 kubeadm=1.28.11-00 kubectl=1.28.11-00 # æŸ¥çœ‹æ”¯æŒçš„ç‰ˆæœ¬ï¼Œç›®å‰æ˜¯æ¯å¹´ä¼šæ›´æ–°4ä¸ªç‰ˆæœ¬ $ apt-cache madison kubeadm # å¹¶é”å®šå…¶ç‰ˆæœ¬(é˜²æ­¢è‡ªåŠ¨æ›´æ–°) $ sudo apt-mark hold kubelet kubeadm kubectl ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:5:1","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"3.2 æŸ¥çœ‹apt ä»“åº“æ˜¯å¦ç¼“å­˜k8s å®‰è£…ç»„ä»¶ apt-cache policy kubeadm|head - 10 ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:5:2","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"3.3 éƒ¨ç½²k8s é›†ç¾¤ master èŠ‚ç‚¹ ä¿®æ”¹kubeadm åˆå§‹åŒ–é…ç½®æ–‡ä»¶ #é»˜è®¤åˆå§‹åŒ–é…ç½®æ–‡ä»¶ç”Ÿæˆ $ kubeadm config print init-defaults \u003e kube-config.yaml # ä¿®æ”¹é…ç½®æ–‡ä»¶ $ sed -i \"s/advertiseAddress: 1.2.3.4/advertiseAddress: 192.168.1.11/g\" kube-config.yaml $ sed -i \"s/name: node/name: k8s-master01/g\" kube-config.yaml $ sed -i \"s/imageRepository: k8s.gcr.io/imageRepository: $ registry.cn-hangzhou.aliyuncs.com\\/google_containers/g\" kube-config.yaml $ sed -i \"s/imageRepository: registry.k8s.io/imageRepository: $ registry.cn-hangzhou.aliyuncs.com\\/google_containers/g\" kube-config.yaml # è¿½åŠ åˆ¶å®špod ipç½‘æ®µ $ sed -i '/serviceSubnet/a\\ podSubnet: 10.244.0.0/16' kube-config.yaml æ·»åŠ ipvs å’Œ kubelet é…ç½®,kube-config.yamlä¸ºç”Ÿæˆçš„é…ç½®æ–‡ä»¶ $ cat \u003c\u003c EOF \u003e\u003e kube-config.yaml --- apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration mode: ipvs --- kind: KubeletConfiguration apiVersion: kubelet.config.k8s.io/v1beta1 cgroupDriver: systemd EOF æå‰ä¸‹è½½éœ€è¦çš„é•œåƒä¿¡æ¯ # æŸ¥çœ‹kubeadm æ‰€éœ€è¦çš„é•œåƒåˆ—è¡¨ $ kubeadm config images list --kubernetes-version=v1.28.11 # æå‰ä¸‹è½½é•œåƒ,ä½¿ç”¨ä¸­å›½åŒºé•œåƒåŠ é€Ÿ $ kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers # æŸ¥çœ‹ä¸‹è½½çš„é•œåƒï¼Œé•œåƒä¿å­˜åœ¨k8s.io namesapce ä¸‹ $ ctr -n=k8s.io i ls å¼€å§‹éƒ¨ç½²ï¼Œå¹¶å°†log æ‰“å°åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ # ä½¿ç”¨éƒ¨ç½²é…ç½®æ–‡ä»¶åˆå§‹åŒ–k8s é›†ç¾¤ $ kubeadm init --config kube-config.yaml|tee -a kubeadm_init.log #è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š Your Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config Alternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.conf You should now deploy a pod network to the cluster. Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 192.168.1.11:6443 --token abcdef.0123456789abcdef \\ --discovery-token-ca-cert-hash sha256:fb0b8abf6780b7dff4f155edd2ed74a80a085081e25bb5469b906410a7a80398 æ‰§è¡ŒæˆåŠŸå æ ¹æ®æç¤ºè¿˜éœ€è¦å†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config export KUBECONFIG=/etc/kubernetes/admin.conf æŠ€å·§\ræ‰§è¡Œå¤±è´¥æŸ¥çœ‹æŠ¥é”™åè°ƒæ•´ï¼Œä½¿ç”¨kubeadm resetè¿˜åŸåé‡æ–°æ‰§è¡Œ\rmaster èŠ‚ç‚¹éªŒè¯ $ kubectl get node -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME k8s-master01 Ready control-plane 7d12h v1.28.11 192.168.1.11 \u003cnone\u003e Ubuntu 22.04.4 LTS 5.15.0-94-generic containerd://1.7.11 kube-config.yaml å®Œæˆé…ç½®æ–‡ä»¶ apiVersion: kubeadm.k8s.io/v1beta3 bootstrapTokens: - groups: - system:bootstrappers:kubeadm:default-node-token token: abcdef.0123456789abcdef ttl: 24h0m0s usages: - signing - authentication kind: InitConfiguration localAPIEndpoint: advertiseAddress: 192.168.1.11 # ä¿®æ”¹å†…å®¹ bindPort: 6443 nodeRegistration: criSocket: unix:///var/run/containerd/containerd.sock # ä¿®æ”¹å†…å®¹ imagePullPolicy: IfNotPresent name: k8s-master01 # ä¿®æ”¹å†…å®¹ taints: null --- apiServer: timeoutForControlPlane: 4m0s apiVersion: kubeadm.k8s.io/v1beta3 certificatesDir: /etc/kubernetes/pki clusterName: kubernetes controllerManager: {} dns: {} etcd: local: dataDir: /var/lib/etcd imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers # ä¿®æ”¹å†…å®¹ kind: ClusterConfiguration kubernetesVersion: 1.28.0 networking: dnsDomain: cluster.local serviceSubnet: 10.96.0.0/12 podSubnet: 10.244.0.0/16 # æ·»åŠ å†…å®¹ scheduler: {} # æ·»åŠ å†…å®¹ --- apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration mode: ipvs --- kind: KubeletConfiguration apiVersion: kubelet.config.k8s.io/v1beta1 cgroupDriver: systemd node èŠ‚ç‚¹ join è¿™é‡Œæ‰‹åŠ¨æŒ‡å®šcri-socket kubeadm join 192.168.1.11:6443 --token abcdef.0123456789abcdef \\ --discovery-token-ca-cert-hash \\ --cri-socket=unix:///run/containerd/containerd.sock ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:5:3","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"4. k8sé›†ç¾¤éƒ¨ç½²ç½‘ç»œæ’ä»¶ calico å¸¸è§çš„ç½‘ç»œæ’ä»¶æœ‰å¤šç§ï¼Œæ¯”å¦‚flannelã€Calicoå’ŒCiliumï¼Œæœ¬æ¬¡å®éªŒä½¿ç”¨Calicoä½¿ç”¨ã€‚ é¦–å…ˆè®¿é—®Calicoå¸®åŠ©æ–‡æ¡£https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:6:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"master èŠ‚ç‚¹ calico éƒ¨ç½²ä½¿ç”¨çš„æ˜¯operator çš„æ–¹å¼ï¼Œä¸”ä¸å†å’Œkube-system å…±ç”¨ä¸€ä¸ªnamespaceï¼Œå¦èµ·äº†ä¸€ä¸ªnamesapce calico-system,å¼•å…¥äº†istio ç›¸å…³ç»„ä»¶æœåŠ¡ï¼Œè¯¦æƒ…å¯ä»¥çœ‹ä¸‹calicoå®˜ç½‘ é…ç½®æ’ä»¶éœ€è¦çš„ç¯å¢ƒ wget https://raw.githubusercontent.com/projectcalico/calico/v3.27.2/manifests/tigera-operator.yaml kubectl create -f tigera-operator.yaml ä¸‹è½½å®¢æˆ·ç«¯èµ„æºæ–‡ä»¶å¹¶ä¿®æ”¹pod ç½‘æ®µåœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬çš„podçš„ç½‘æ®µå’Œé…ç½®æ–‡ä»¶ä¸ä¸€æ · # ä¸‹è½½å®¢æˆ·ç«¯èµ„æºæ–‡ä»¶ curl -LO https://raw.githubusercontent.com/projectcalico/calico/v3.27.2/manifests/custom-resources.yaml # ä¿®æ”¹podçš„ç½‘æ®µåœ°å€ podSubnet sed -i 's/cidr: 192.168.0.0/cidr: 10.244.0.0/g' custom-resources.yaml kubectl create -f custom-resources.yaml æŸ¥çœ‹é›†ç¾¤ calico pod åˆ›å»ºè¿‡ç¨‹ï¼Œå¤§çº¦ä¼šè€—æ—¶ä¸‰åˆ†é’Ÿ,éƒ¨ç½²æˆåŠŸåï¼Œæ‰€æœ‰node èŠ‚ç‚¹ä¸ºReady çŠ¶æ€ watch kubectl get all -o wide -n calico-system æŠ€å·§\rä»¥ä¸Šæ–¹æ³•æ˜¯åœ¨dockerhub ç½‘ç»œä»“åº“æ­£å¸¸è®¿é—®æƒ…å†µä¸‹æ‰§è¡Œçš„ï¼Œå¦‚æœdockerhub ç½‘ç»œä»“åº“è®¿é—®å¼‚å¸¸å¯ä»¥ä½¿ç”¨ç¦»çº¿éƒ¨ç½²çš„æ–¹å¼ 2024.6 æœˆä»½docker hub è¢«å¢™äº†åï¼Œå°±ä¸èƒ½æ–¹ä¾¿çš„ä¸‹è½½ docker é•œåƒäº†ï¼Œè¿™é‡Œä½¿ç”¨ç¦»çº¿çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ã€‚ calico v3.27 ç›¸å…³é•œåƒåˆ—è¡¨ docker.io/calico/cni:v3.27.2 docker.io/calico/kube-controllers:v3.27.2 docker.io/calico/node:v3.27.2 docker.io/calico/pod2daemon-flexvol:v3.27.2 docker.io/calico/typha:v3.27.2 # ä¸‹é¢ä¸‰ä¸ªé•œåƒ release-v3.27.2 æ²¡æœ‰åŒ…å«è¿›æ¥ docker.io/calico/csi:v3.27.2 docker.io/calico/apiserver:v3.27 docker.io/calico/node-driver-registrar:v3.27.2 æ‰‹åŠ¨é•œåƒå¯¼å…¥ sudo ctr -n k8s.io images ls|grep calico sudo ctr -n k8s.io images import calico-cni.tar sudo ctr -n k8s.io images import calico-dikastes.tar sudo ctr -n k8s.io images import calico-flannel-migration-controller.tar sudo ctr -n k8s.io images import calico-kube-controllers.tar sudo ctr -n k8s.io images import calico-node.tar sudo ctr -n k8s.io images import calico-pod2daemon.tar sudo ctr -n k8s.io images import calico-typha.tar # # ä¸‹é¢ä¸‰ä¸ªé•œåƒ release-v3.27.2 æ²¡æœ‰åŒ…å«è¿›æ¥,éœ€è¦æ‰‹åŠ¨å¯¼å…¥ sudo ctr -n k8s.io images import csi.tar sudo ctr -n k8s.io images import apiserver.tar sudo ctr -n k8s.io images import node-driver-registrar.tar å‚è€ƒï¼šcalico_3.27 quick install å®˜ç½‘ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:6:1","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"5. éƒ¨ç½²nginx éªŒè¯k8s é›†ç¾¤å¯ç”¨æ€§ nginx-deploy yaml æ–‡ä»¶ cat \u003c\u003c EOF \u003e nginx-deploy.yaml apiVersion: apps/v1 kind: Deployment metadata: labels: app: nginx-deploy name: nginx-deploy spec: replicas: 1 selector: matchLabels: app: nginx-deploy template: metadata: labels: app: nginx-deploy spec: containers: - image: registry.cn-shenzhen.aliyuncs.com/xiaohh-docker/nginx:1.25.4 name: nginx ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: labels: app: nginx-deploy name: nginx-svc spec: ports: - port: 80 protocol: TCP targetPort: 80 nodePort: 30080 selector: app: nginx-deploy type: NodePort EOF ç”Ÿæ•ˆ kubectl apply -f nginx-deploy.yaml # ç„¶åè®¿é—®ä½ ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„IPåœ°å€åŠ ä¸Šnodeport 30080å°±å¯ä»¥è®¿é—®è¿™ä¸ªéƒ¨ç½²çš„nginx kubectl get service -o wide æµè§ˆå™¨è®¿é—®http://192.168.1.11:30080 æç¤º Welcome to nginx! è¡¨ç¤ºç”Ÿæ•ˆæˆåŠŸ ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:7:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"6. éƒ¨ç½²crictl(optional) crictl æ˜¯Kubeletå®¹å™¨æ¥å£ï¼ˆCRIï¼‰çš„CLIå’ŒéªŒè¯å·¥å…·: è¿™é‡Œéƒ¨ç½²ä»¥ä¸‹ containerdå®¢æˆ·ç«¯crictl $ VERSION=\"v1.28.0\" $ wget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz $ sudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin $ rm -f crictl-$VERSION-linux-amd64.tar.gz $ cat \u003e /etc/crictl.yaml \u003c\u003cEOF runtime-endpoint: unix:///var/run/containerd/containerd.sock image-endpoint: unix:///var/run/containerd/containerd.sock timeout: 10 debug: true EOF # æµ‹è¯• $ crictl pods $ crictl images å†…å®¹ docker.io/calico/apiserver v3.27.2 5d4a0194d5324 94MB docker.io/calico/cni v3.27.2 bbf4b051c5078 195MB docker.io/calico/csi v3.27.2 b2c0fe47b0708 17.4MB docker.io/calico/dikastes v3.27.2 236c3ef9745d9 40.5MB docker.io/calico/flannel-migration-controller v3.27.2 99b8d3ea2440b 125MB docker.io/calico/kube-controllers v3.27.2 849ce09815546 75.6MB docker.io/calico/node-driver-registrar v3.27.2 73ddb59b21918 22.6MB docker.io/calico/node v3.27.2 50df0b2eb8ffe 346MB docker.io/calico/pod2daemon-flexvol v3.27.2 ea79f2d96a361 15.4MB docker.io/calico/typha v3.27.2 2ec97bc370c17 68.4MB .... ","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:8:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"å®Œæ•´éƒ¨ç½²è„šæœ¬ ä»¥ä½œå‚è€ƒ,ç¯å¢ƒä¸åŒï¼Œç›¸åº”å‚æ•°éœ€è¦æ‰‹åŠ¨è°ƒæ•´ #ï¼/bin/bash # æœ¬æœºåç§° HOST_NAME=k8s-master01 # ipv4 åœ°å€ HOST_IP=192.168.1.11 HOST_NODE_IP=192.168.1.7 # è®¾ç½®é™æ€ä¸»æœºip,æ‰‹åŠ¨å¤„ç† https://cloud.tencent.com/developer/article/1933335 function ch0_set_static_ip() { echo \"main ch0_set_static_ip start\" sudo apt install net-tools -y ifconfig route -n sudo cp /etc/netplan/00-installer-config.yaml /etc/netplan/00-installer-config.yaml_before cat \u003c\u003c EOF \u003e /etc/netplan/00-installer-config.yaml # This is the network config written by 'subiquity' network: ethernets: ens33: addresses: - 192.168.1.11/16 nameservers: addresses: - 114.114.114.114 - 8.8.8.8 search: [] routes: - to: default via: 192.168.1.1 version: 2 EOF # ä½¿é…ç½®ç”Ÿæ•ˆ sudo netplan apply echo \"main ch0_set_static_ip start\" } # 1ã€k8s é›†ç¾¤ä¸»æœºå‡†å¤‡ function ch1_config_hosts(){ echo \"main ch1_config_hosts start\" # éƒ¨ç½²æ–‡ä»¶ç›®å½• mkdir ${HOME}/kubernetes_install cd ${HOME}/kubernetes_install # 1.1 è®¾ç½®ä¸»æœºåç§° hostnamectl set-hostname ${HOST_NAME} # 1.2 æ‰€æœ‰è®¾å¤‡å…è®¸ root ç”¨æˆ· cat \u003e\u003e /etc/ssh/sshd_config \u003c\u003c EOF PermitRootLogin yes PasswordAuthentication yes EOF # 1.3 å…³é—­swap åˆ†åŒº swapoff -a sed -i '/swap/ s/^\\(.*\\)$/#\\1/g' /etc/fstab # 1.4 ä¸»æœºåå’Œip åœ°å€è§£æé…ç½® sed -i \"2a ${HOST_IP} ${HOST_NAME}\" /etc/hosts sed -i \"3a ${HOST_NODE_IP} k8s-node01\" /etc/hosts # 1.5 æ—¶é—´åŒæ­¥é…ç½®,æ—¶åŒº cp /etc/chrony/chrony.conf /etc/chrony/chrony.conf_bak cat \u003e /etc/chrony/chrony.conf \u003c\u003c EOF confdir /etc/chrony/conf.d server ntp.aliyun.com iburst allow 192.168.1.1/24 sourcedir /run/chrony-dhcp sourcedir /etc/chrony/sources.d keyfile /etc/chrony/chrony.keys driftfile /var/lib/chrony/chrony.drift ntsdumpdir /var/lib/chrony logdir /var/log/chrony maxupdateskew 100.0 rtcsync makestep 1 3 leapsectz right/UTC EOF timedatectl set-timezone Asia/Shanghai apt install ntpdate chrony -y ntpdate time2.aliyun.com systemctl start chrony systemctl status chrony systemctl enable chrony # æŸ¥çœ‹ chronyd æ—¶é—´åŒæ­¥æœåŠ¡çš„æºçš„ç»Ÿè®¡ä¿¡æ¯ chronyc sourcestats -v # 1.6 é…ç½®å†…æ ¸è½¬å‘åŠç½‘æ¡¥è¿‡æ»¤ # è½¬å‘IPv4å¹¶è®©iptablesçœ‹åˆ°æ¡¥æ¥æµé‡ sudo cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF # æ‰‹åŠ¨åŠ è½½ modprobe overlay modprobe br_netfilter # æ£€æµ‹æ˜¯å¦åŠ è½½ lsmod | egrep \"overlay\" lsmod | egrep \"br_netfilter\" # æ·»åŠ ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®,è®¾ç½®æ‰€éœ€çš„sysctlå‚æ•°ï¼Œå‚æ•°åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ sudo cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF #æ£€æŸ¥sysctlæ˜¯å¦æˆåŠŸåº”ç”¨ï¼š sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward # æ‰‹åŠ¨åŠ è½½ #sudo sysctl -p /etc/sysctl.d/k8s.conf # or sudo sysctl --system # 1.7 å®‰è£…ipset åŠipvsadm apt install ipset ipvsadm -y # é…ç½®ipvsadm å†…æ ¸æ¨¡å—åŠ è½½ cat \u003c\u003c EOF \u003e /etc/modules-load.d/ipvs.conf ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh nf_conntrack EOF # æ‰‹åŠ¨åŠ è½½æ¨¡å— modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack # 1.8 å…³é—­é˜²ç«å¢™ #æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo systemctl status ufw #å…³é—­é˜²ç«å¢™ sudo systemctl stop ufw #ç¦æ­¢é˜²ç«å¢™å¼€æœºå¯åŠ¨ sudo systemctl disable ufw echo \"main ch1_config_hosts end\" } # 2ã€k8s é›†ç¾¤ containerd å‡†å¤‡ function ch2_containerd_init(){ echo \"main ch2_containerd_init start\" # éƒ¨ç½² containerd wget https://github.com/containerd/containerd/releases/download/v1.7.11/cri-containerd-static-1.7.11-linux-amd64.tar.gz #tar Czxvf /usr/local/ cri-containerd-static-1.7.11-linux-amd64.tar.gz sudo tar -zxvf cri-containerd-cni-1.7.11-linux-amd64.tar.gz -C / mkdir -p /etc/containerd containerd config default \u003e /etc/containerd/config.toml sed -i 's/registry.k8s.io\\/pause:3.8/registry.cn-hangzhou.aliyuncs.com\\/google_containers\\/pause:3.9/g' /etc/containerd/config.toml sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml sed -i 's/disabled_plugins/#disabled_plugins/g' /etc/containerd/config.toml # ä½¿ç”¨systemdæ‰˜ç®¡containerd # ç”Ÿæˆsystem serviceæ–‡ä»¶ cat\u003c\u003cEOF|tee /etc/systemd/system/containerd.service [Unit] Description=containerd container runtime Documentation=https://containerd.io After=network.target local-fs.target [Service] ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/containerd Type=notify Delegate=yes Ki","date":"2024-06-20","objectID":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/:9:0","tags":["Kubernetes"],"title":"Ubuntu-serveréƒ¨ç½²k8s1.28(containerdç‰ˆæœ¬)é›†ç¾¤","uri":"/ubuntu-server%E9%83%A8%E7%BD%B2k8s1.28containerd%E7%89%88%E6%9C%AC%E9%9B%86%E7%BE%A4/"},{"categories":["Kubernetes"],"content":"å‰è¨€ åœ¨äº†è§£RBAC ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹Kubernetes API å¯¹è±¡ï¼ŒRBAC æœ€ç»ˆæ“ä½œçš„å¯¹è±¡è¿˜æ˜¯Kubernetes API å¯¹è±¡ï¼Œæœ¬è´¨è¿˜æ˜¯å¯¹Kubernetes APIçš„è®¿é—®æ§åˆ¶ï¼Œå¦‚ä¸‹RBAC æ˜¯åœ¨ Api Server ä¸­æ˜¯é€šè¿‡æˆæƒæ’ä»¶é»˜è®¤å¼•å…¥çš„ã€‚ /etc/kubernetes/manifests/kube-apiserver.yaml spec: containers: - command: - kube-apiserver - --advertise-address=192.168.1.11 - --secure-port=6443 # api server ç›‘å¬çš„å®‰å…¨ç«¯å£(https åè®®) - --allow-privileged=true - --authorization-mode=Node,RBAC # å¯ç”¨RBAC å’ŒNode æˆæƒæ’ä»¶ - --client-ca-file=/etc/kubernetes/pki/ca.crt # å¯åŠ¨x509 æ•°å­—è¯ä¹¦éªŒè¯ - --enable-admission-plugins=NodeRestriction # é¢å¤–å¯ç”¨çš„å‡†å…¥æ§åˆ¶å™¨åˆ—è¡¨ - --enable-bootstrap-token-auth=true # å¯ç”¨bootstrap çš„token è®¤è¯ - --requestheader-extra-headers-prefix=X-Remote-Extra- # ä»£ç†è®¤è¯ç›¸å…³çš„é…ç½® - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt - --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key - ... - --service-account-key-file=/etc/kubernetes/pki/sa.pub # æŒ‡å®šç”¨äºç­¾ç½²æ‰¿è½½ä»¤ç‰Œçš„ç§˜é’¥æ–‡ä»¶ ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:1:0","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"Kubernetes API æ¦‚å¿µ Kubernetes API æ˜¯é€šè¿‡ HTTP æä¾›çš„åŸºäºèµ„æº (RESTful) çš„ç¼–ç¨‹æ¥å£ã€‚ å®ƒæ”¯æŒé€šè¿‡æ ‡å‡† HTTP åŠ¨è¯ï¼ˆPOSTã€PUTã€PATCHã€DELETEã€GETï¼‰æ£€ç´¢ã€åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ä¸»è¦èµ„æºã€‚ å¯¹äºæŸäº›èµ„æºï¼ŒAPI åŒ…æ‹¬é¢å¤–çš„å­èµ„æºï¼Œå…è®¸ç»†ç²’åº¦æˆæƒï¼ˆä¾‹å¦‚ï¼šå°† Pod çš„è¯¦ç»†ä¿¡æ¯ä¸æ£€ç´¢æ—¥å¿—åˆ†å¼€ï¼‰ï¼Œ ä¸ºäº†æ–¹ä¾¿æˆ–è€…æé«˜æ•ˆç‡ï¼Œå¯ä»¥ä»¥ä¸åŒçš„è¡¨ç¤ºå½¢å¼æ¥å—å’ŒæœåŠ¡è¿™äº›èµ„æºã€‚ ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:1:1","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"èµ„æº URI /api/v1/namespaces /api/v1/pods /api/v1/namespaces/my-namespace/pods /apis/apps/v1/deployments /apis/apps/v1/namespaces/my-namespace/deployments /apis/apps/v1/namespaces/my-namespace/deployments/my-deployment kubectl get --rawå‘½ä»¤æŸ¥çœ‹ # kubectl get --raw / { \"paths\": [ \"/.well-known/openid-configuration\", \"/api\", \"/api/v1\", \"/apis\", \"/apis/\", \"/apis/admissionregistration.k8s.io\", \"/apis/admissionregistration.k8s.io/v1\", \"/apis/apiextensions.k8s.io\", ... } ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:1:2","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"å¯åŠ¨ä»£ç† ä»£ç†ä¸€ä¸ªæœ¬åœ°çš„api server æ¥å£ # kubectl proxy Starting to serve on 127.0.0.1:8001 ç„¶åå°±å¯ä»¥ç›´æ¥è®¿é—®api server äº†ï¼Œå¦‚æ–°å¼€ä¸€ä¸ªä¼šè¯æŸ¥çœ‹é›†ç¾¤ä¸­çš„daemonset èµ„æºä¿¡æ¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæµ‹è¯•ï¼Œæ­£å¸¸çš„å¼€å‘ä¸ä¼šé€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼Œè€Œæ˜¯æœ‰ä¸“é—¨çš„sdk å¦‚client-go curl http://127.0.0.1:8001/apis/apps/v1/daemonsets æŸ¥çœ‹kubenetes api èµ„æºç±»å‹ï¼Œèµ„æºç±»å‹æ˜¯å¦namespaced è¿˜æ˜¯é›†ç¾¤èŒƒå›´çš„ $ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev .... ä¸‹é¢å°±è¿›å…¥æ­£ä½“RBAC,ä»¥ä¸Šçš„ä»‹ç»å°±æ˜¯ä¸ºäº†è¯´æ˜RBAC æœ€ç»ˆçš„æ“ä½œè¿˜æ˜¯kubernetes api å¯¹è±¡ï¼Œå½“ç„¶ä¹Ÿä¸æ­¢æ˜¯kubernetes api å„ç±»èµ„æºå¯¹è±¡ï¼Œè¿˜æœ‰éèµ„æºç±»å‹çš„URL. ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:1:3","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"RBAC æˆæƒæ¨¡å‹ kubernetes ç³»ç»Ÿçš„RBAC æˆæƒæ’ä»¶å°†è§’è‰²åˆ†ä¸ºRoleå’ŒClusterRoleä¸¤ç±»ï¼Œå®ƒä»¬éƒ½æ˜¯kubernetes å†…ç½®æ”¯æŒçš„API èµ„æºç±»å‹ï¼Œå…¶ä¸­role ä½œç”¨äºåç§°ç©ºé—´çº§åˆ«ï¼Œç”¨äºæ‰¿è½½åç§°ç©ºé—´å†…çš„èµ„æºæƒé™é›†åˆï¼Œè€Œclusterrole åˆ™èƒ½å¤ŸåŒæ—¶æ‰¿è½½åç§°ç©ºé—´å’Œé›†ç¾¤çº§åˆ«çš„èµ„æºæƒé™é›†åˆã€‚ åˆ©ç”¨Role å’ŒClusterRole ä¸¤ç±»è§’è‰²è¿›è¡Œèµ‹æƒæ—¶ï¼Œéœ€è¦ç”¨åˆ°å¦å¤–ä¸¤ç§èµ„æºRoleBindingå’ŒClusterRoleBinding,å®ƒä»¬åŒæ ·æ˜¯ç”±Apiserverå†…ç½®æ”¯æŒçš„èµ„æºç±»å‹ã€‚ ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:0","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"Kubernetes RBAC æ˜¯ä»€ä¹ˆï¼Ÿ RBAC æ˜¯ä¸€ä¸ªç‰¹å®šçš„æƒé™ç®¡ç†æ¨¡å‹ï¼Œå®ƒæŠŠå¯ä»¥æ–½åŠ åœ¨\"èµ„æºå¯¹è±¡\"ä¸Šçš„\"åŠ¨ä½œâ€™â€˜ç§°ä¸º\"è®¸å¯æƒé™\",è¿™äº›è®¸å¯æƒé™èƒ½æŒ‰éœ€ç»„åˆåœ¨ä¸€èµ·æ„å»ºå‡º\"è§’è‰²\"åŠå…¶èŒèƒ½ï¼Œå¹¶é€šè¿‡ä¸º\"ç”¨æˆ·è´¦æˆ·å’Œç»„è´¦æˆ·\"åˆ†é…åˆ°ä¸€ä¸ªåˆ°å¤šä¸ªè§’è‰²å®Œæˆæƒé™å§”æ´¾ã€‚è¿™äº›èƒ½å¤Ÿå‘å‡ºåŠ¨ä½œçš„ç”¨æˆ·åœ¨RBACä¸­ç§°ä¸º\"ä¸»ä½“(subject)\" RBACä¸­çš„ç”¨æˆ·ã€è§’è‰²ã€æƒé™\rç®€å•æ¥è¯´ï¼ŒRBAC å°±æ˜¯ä¸€ç§è®¿é—®æ§åˆ¶æ¨¡å‹ï¼Œå®ƒä»¥è§’è‰²ä¸ºä¸­å¿ƒç•Œå®š\"è°\"(subject)èƒ½å¤Ÿ\"æ“ä½œ\"(verb)å“ªä¸ªæˆ–å“ªç±»\"å¯¹è±¡\"(object)ã€‚ åŠ¨ä½œå‘å‡ºè€…å³\"ä¸»ä½“\"ï¼Œé€šå¸¸ä»¥\"è´¦å·\"ä¸ºè½½ä½“ï¼Œåœ¨kubernetes ä¸­ï¼Œå®ƒå¯ä»¥æ˜¯æ™®é€šè´¦æˆ·(user),ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡è´¦æˆ·(service account).â€œåŠ¨ä½œ\"è¡¨ç¤ºè¦æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹å’ŒæŸ¥çœ‹ç­‰è¡Œä¸ºï¼Œå¯¹äºAPI Serveræ¥è¯´ï¼Œå³PUTã€POSTã€DELETEã€GETç­‰è¯·æ±‚æ–¹æ³•ã€‚è€Œ\"å¯¹è±¡\"åˆ™æ˜¯æŒ‡ç®¡ç†æ“ä½œèƒ½å¤Ÿæ–½åŠ çš„ç›®æ ‡å®ä½“ï¼Œå¯¹ kubernetes API æ¥è¯´ä¸»è¦æŒ‡å„ç±»èµ„æºå¯¹è±¡ä»¥åŠéèµ„æºç±»å‹URL. ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:1","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"ä¸ºä»€ä¹ˆRBACå¾ˆé‡è¦ï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿? RBACæ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ˜¯ä¸€ç§åŸºäºä¸ªäººç”¨æˆ·çš„è§’è‰²æ¥ç®¡ç†å¯¹è®¡ç®—æœºæˆ–ç½‘ç»œèµ„æºçš„è®¿é—®çš„æ–¹æ³•ã€‚ ç›¸å¯¹äºå…¶ä»–æˆæƒæ¨¡å¼ï¼ŒRBACå…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š å¯¹é›†ç¾¤ä¸­çš„èµ„æºå’Œéèµ„æºæƒé™å‡æœ‰å®Œæ•´çš„è¦†ç›–ã€‚ æ•´ä¸ªRBACå®Œå…¨ç”±å‡ ä¸ªAPIå¯¹è±¡å®Œæˆï¼Œ åŒå…¶ä»–APIå¯¹è±¡ä¸€æ ·ï¼Œ å¯ä»¥ç”¨kubectlæˆ–APIè¿›è¡Œæ“ä½œã€‚ å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œæ— é¡»é‡æ–°å¯åŠ¨API Serverã€‚ kubernetes è®¿é—®æ§åˆ¶ ç”¨æˆ·ã€æœåŠ¡è´¦æˆ·ã€è®¤è¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶\r","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:2","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"è®¾è®¡ RBAC Design\r","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:3","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"RBAC åŸºç¡€æ¦‚å¿µæœ¯è¯­ æœ¯è¯­ Subjects: ä¸»ä½“ï¼Œè°å¯ä»¥è®¿é—®kubernetes API. Resources: å“ªäº› kubernetes API èµ„æºå¯¹è±¡å¯ä»¥è¢«è®¿é—®. Verbs: å¯ä»¥å¯¹è¿™äº› Kubernetes API åšå“ªäº›æ“ä½œ(CRUD) å¯ä»¥ç®€å•çš„è¯´RBACæ˜¯ä¸€ç§èº«ä»½å’Œè®¿é—®ç®¡ç†å½¢å¼ï¼Œå®ƒæ¶‰åŠä¸€ç»„æƒé™æˆ–æ¨¡æ¿ï¼Œè¿™äº›æƒé™æˆ–æ¨¡æ¿å†³å®šè°(Subjects)å¯ä»¥æ‰§è¡Œä»€ä¹ˆ(Verbs)ï¼Œä»¥åŠåœ¨å“ªé‡Œ(å‘½åç©ºé—´æˆ–é›†ç¾¤)ã€‚ è¡¥å……ï¼š Subject:ä¸»ä½“ï¼Œå¯¹åº”é›†ç¾¤ä¸­å°è¯•æ“ä½œçš„å¯¹è±¡ï¼Œé›†ç¾¤ä¸­å®šä¹‰äº† 3 ç§ç±»å‹çš„ä¸»ä½“èµ„æº: User Account:ç”¨æˆ·ï¼Œè¿™æ˜¯æœ‰å¤–éƒ¨ç‹¬ç«‹æœåŠ¡è¿›è¡Œç®¡ç†çš„ï¼Œç®¡ç†å‘˜è¿›è¡Œç§é’¥çš„åˆ†é…ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨KeyStone æˆ–è€… Goolge å¸å·ï¼Œç”šè‡³ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶åˆ—è¡¨ä¹Ÿå¯ä»¥ã€‚å¯¹äºç”¨æˆ·çš„ç®¡ç†é›†ç¾¤å†…éƒ¨æ²¡æœ‰ä¸€ä¸ªå…³è”çš„èµ„æºå¯¹è±¡ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸èƒ½é€šè¿‡é›†ç¾¤å†…éƒ¨çš„ API æ¥è¿›è¡Œç®¡ç† Group:ç»„ï¼Œè¿™æ˜¯ç”¨æ¥å…³è”å¤šä¸ªè´¦æˆ·çš„ï¼Œé›†ç¾¤ä¸­æœ‰ä¸€äº›é»˜è®¤åˆ›å»ºçš„ç»„ï¼Œæ¯”å¦‚ cluster-admin Service Account: æœåŠ¡å¸å· Service Account ServiceAccount ä¸º Pod ä¸­è¿è¡Œçš„è¿›ç¨‹æä¾›äº†ä¸€ä¸ªèº«ä»½ï¼ŒPod å†…çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨å…¶å…³è”æœåŠ¡è´¦å·çš„èº«ä»½ï¼Œå‘é›†ç¾¤çš„ APIServer è¿›è¡Œèº«ä»½è®¤è¯ã€‚ é€šè¿‡ä¸‹å›¾å¯ä»¥äº†è§£Service Account çš„ä½ç½®å’Œä½œç”¨ Service Account\rRole å’Œ ClusterRole Kubernetes ç³»ç»Ÿçš„RBAC æˆæƒæ’ä»¶å°†è§’è‰²åˆ†ä¸ºRole å’Œ ClusterRole ä¸¤ç±»ï¼Œå®ƒä»¬éƒ½æ˜¯kubernetes å†…ç½®æ”¯æŒçš„API èµ„æºç±»å‹ï¼Œå…¶ä¸­Role ç”¨ä½œäºç©ºé—´çº§åˆ«ï¼Œç”¨äºæ‰¿è½½åç§°ç©ºé—´å†…çš„èµ„æºæƒé™é›†åˆï¼Œè€ŒClusterRoleåˆ™èƒ½å¤ŸåŒæ—¶æ‰¿è½½åç§°ç©ºé—´å’Œé›†ç¾¤çº§åˆ«çš„èµ„æºæƒé™é›†åˆã€‚ Role æ— æ³•æ‰¿è½½é›†ç¾¤çº§åˆ«çš„èµ„æºç±»å‹çš„æ“ä½œæƒé™ï¼Œè¿™ç±»çš„èµ„æºåŒ…æ‹¬é›†ç¾¤çº§åˆ«çš„èµ„æº(ä¾‹å¦‚Node)ã€éèµ„æºç±»å‹çš„ç«¯ç‚¹(ä¾‹å¦‚/healthz),ä»¥åŠä½œç”¨äºæ‰€æœ‰åç§°ç©ºé—´çš„èµ„æº(ä¾‹å¦‚è·¨åç§°ç©ºé—´è·å–ä»»ä½•èµ„æºçš„æƒé™)ç­‰ã€‚ æŸ¥çœ‹ä¸å±äºä»»ä½•ç‰¹å®šçš„å‘½åç©ºé—´ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ç®¡ç†å’Œé…ç½®çš„API èµ„æºå¯¹è±¡ $ kubectl api-resources --namespaced=false Rule è§„åˆ™ï¼Œè§„åˆ™æ˜¯ä¸€ç»„å±äºä¸åŒ API Group èµ„æºä¸Šçš„ä¸€ç»„æ“ä½œçš„é›†åˆ,åœ¨Role å’Œ ClusterRoleèµ„æºä¸Šå®šä¹‰çš„rule ä¹Ÿç§°ä¸ºPolicyRule,å³ç­–ç•¥è§„åˆ™ï¼Œå®ƒå¯ä»¥å†…åµŒçš„å­—æ®µæœ‰å¦‚ä¸‹å‡ ä¸ª apiGroups resources resourceNames nonResourceURLs verbs RoleBinding å’Œ ClusterRoleBinding åˆ©ç”¨Role å’Œ ClusterRole è¿›è¡Œè§’è‰²èµ‹æƒæ—¶ï¼Œéœ€è¦ç”¨åˆ°å¦å¤–ä¸¤ç§èµ„æºRoleBindingå’ŒClusterRoleBinding,å®ƒä»¬åŒæ ·æ˜¯API Server å†…ç½®çš„æ”¯æŒçš„èµ„æºç±»å‹ã€‚ RoleBinding ç”¨äºå°†Role ç»‘å®šåˆ°ä¸€ä¸ªæˆ–ä¸€ç»„ç”¨æˆ·ä¹‹ä¸Šï¼Œå®ƒéš¶å±äºä¸”ä»…èƒ½ä½œç”¨äºå…¶æ‰€åœ¨çš„å•ä¸ªåç§°ç©ºé—´ã€‚ RoleBinding å¯ä»¥å¼•ç”¨åŒä¸€åç§°ç©ºé—´ä¸­çš„role,ä¹Ÿå¯ä»¥å¼•ç”¨é›†ç¾¤çº§åˆ«çš„ClusterRole,ä½†æ˜¯å¼•ç”¨ClusterRoleçš„è®¸å¯æƒé™ä¼šé™çº§åˆ°ä»…èƒ½åœ¨Rolebingdingæ‰€åœ¨çš„åç§°ç©ºé—´ç”Ÿæ•ˆã€‚ ClusterRoleBinding åˆ™ç”¨äºå°†ClusterRole ç»‘å®šåˆ°ç”¨æˆ·å’Œç»„ï¼Œå®ƒä½œç”¨äºé›†ç¾¤å…¨å±€ï¼Œä¸”ä»…èƒ½å¤Ÿå¼•ç”¨ClusterRole. ç®€å•æ¥è¯´å°±æ˜¯æŠŠå£°æ˜çš„Subject å’Œæˆ‘ä»¬çš„ Role è¿›è¡Œç»‘å®šçš„è¿‡ç¨‹(ç»™æŸä¸ªç”¨æˆ·ç»‘å®šä¸Šæ“ä½œçš„æƒé™)ï¼ŒäºŒè€…çš„åŒºåˆ«ä¹Ÿæ˜¯ä½œç”¨èŒƒå›´çš„åŒºåˆ«:RoleBinding åªä¼šå½±å“åˆ°å½“å‰ namespace ä¸‹é¢çš„èµ„æºæ“ä½œæƒé™ï¼Œè€ŒClusterRoleBinding ä¼šå½±å“åˆ°æ‰€æœ‰çš„ namespaceã€‚ å››è€…å…³ç³»å¦‚å›¾ï¼š Roleã€RoleBindingã€ClusterRoleå’ŒClusterRoleBinding\rService Account å’Œ token ä»¤ç‰Œ æ³¨ï¼šsa æ˜¯service account çš„ç¼©å†™ kubernetes \u003c= 1.20 ç‰ˆæœ¬ sa åˆ›å»ºåä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªsecret,è¯¥secret ä¼šåŒ…å«ä¸€ä¸ªtoken,è¿™ä¸ªtoken å°±æ˜¯serviceaccountçš„ä»¤ç‰Œï¼Œè€Œä¸”æ˜¯æ°¸ä¹…æœ‰æ•ˆçš„ kubernetes \u003e= 1.21 \u0026\u0026 \u003c= 1.23 ç‰ˆæœ¬ sa åˆ›å»ºåä¾ç„¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªsecret,ä½†æ˜¯pod é‡Œé¢ä½¿ç”¨çš„sa tokenä¸æ˜¯è¯¥secreté‡Œé¢åŒ…å«çš„ä»¤ç‰Œäº†ï¼Œè€Œæ˜¯kubelet å»tokenrequest api è¯·æ±‚çš„æœ‰æ—¶é—´é™åˆ¶çš„token kubernetes \u003e= 1.24 sa åˆ›å»ºåä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªsecret è¿›è¡Œå…³è”ï¼Œç„¶åå’Œå‰é¢è¿™ä¸ªæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡tokenrequest api è¯·æ±‚tokenï¼Œæ¯ä¸ªä¸€å°æ—¶ä¼šè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ä»¤ç‰Œï¼Œpod å®¹å™¨å†…ä»¤ç‰Œè·¯å¾„ä¸º/var/run/secrets/kubernetes.io/serviceaccount/token $ kubectl exec -it nginx-deploy-5947669f9-9h9vg -- cat /var/run/secrets/kubernetes.io/serviceaccount/token eyJhbGciOiJSUzI1NiIsImtpZCI6IjlsalZmUVpQLXEzRjhLSk9hMnpOV0FKWEJMT2RGam15MDIyR1BlMXNkSjAifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzUyMjIxMTQ1LCJpYXQiOjE3MjA2ODUxNDUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueC1kZXBsb3ktNTk0NzY2OWY5LTloOXZnIiwidWlkIjoiMThlODJmZTUtNzFjZS00ZTBmLWEwYTItNTNlYWJhYjRjNzgxIn0sInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkZWZhdWx0IiwidWlkIjoiNzFlYjM5MzEtMWU5Ny00MGI0LWFmNTItODdiZWYwZjQ2MjVhIn0sIndhcm5hZnRlciI6MTcyMDY4ODc1Mn0sIm5iZiI6MTcyMDY4NTE0NSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6ZGVmYXVsdCJ9.0VZaQGqg1bCxzBIaRMXQ3doYWsu6g4PYsnTPoIDjCuF4IufFq-eG9YppkhjR21cfg-SJpV4h1maW1axB3yevpf9PYFxuEDRrLY4_qpkJW5UR-r_nz0D99iiQCisb2znrDSjChGFpUnStQ1TMgQfkejPgRh08RqKLNJE1QhQ6dncebALBmWeXEdi2vWkXUOT9KlvZxP7Bk2gYaQH39PhxiHb_b2nLSPwfiVNvK0Lpxe54oCQE4WH3qSWTg0GQ0nLn74E0fgSkyegBJhmPzyPcJ-iR8Je5qL6SKyNjHftu1m49q40RrNkeh0ogLBcD0qobpMWWw-XvtiK-bcwQt1qgLA $ é€šè¿‡jwtä»¤ç‰Œè§£ææŸ¥çœ‹ Service Account å’Œ Token\ræœ€æ–°ç‰ˆæœ¬çš„ä»¤ç‰Œæ˜¯ä¸€å°æ—¶åˆ·æ–°ä¸€æ¬¡ï¼Œå¹¶ä¸”exp æ˜¯ä¸€å¹´ååˆ°æœŸï¼Œå¦‚æœåˆ›å»ºçš„ServiceAcccount è®¾ç½®ä¸è‡ªåŠ¨æŒ‚è½½å¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½® apiVersion: v1 kind: ServiceAccount metadata: name: no-access-sa automountServiceAccountToken: false for pod apiVersion: v1 kind: Pod metadata: name: test-pod spec: serviceAccountName: no-access-sa automountServiceAccountToken: false ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:4","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"Kubernetes RBAC å®ä¾‹ Create a Service Account $ kubectl create sa sa-demo serviceaccount/sa-demo created $ kubectl create sa sa2 serviceaccount/sa2 created å¦‚æœåˆ›å»ºä¸€ä¸ªPod èµ„æºï¼Œä¸ç»‘å®šserviceaccount åˆ™ä½¿ç”¨namesapceå‘½åç©ºé—´ä¸‹çš„é»˜è®¤çš„serviceaccount ä¹Ÿå°±æ˜¯default $ kubectl get pod nginx-deploy-5947669f9-9h9vg -o yaml|grep -i serviceAccount - mountPath: /var/run/secrets/kubernetes.io/serviceaccount serviceAccount: default serviceAccountName: default Role and ClusterRole Role In RBAC åœ¨default åç§°ç©ºé—´ä¸­å®šä¹‰ä¸€ä¸ªåç§°ä¸ºpod-readerçš„Role èµ„æºï¼Œä¸”åªèƒ½è®¿é—®defaultåå­—ç©ºé—´ä¸‹çš„secretsèµ„æºï¼Œå¯¹è¯¥èµ„æºåªèƒ½åš\"getâ€, â€œwatch\"å’Œ\"listâ€ æ“ä½œ pod-reader_role.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: default name: pod-reader rules: - apigroups: [\"\"] # è¡¨ç¤ºæ ¸å¿ƒAPI ç¾¤ç»„ resources: [\"pods\"] verbs: [\"get\", \"watch\", \"list\"] # ä¹Ÿå¯ä»¥ä½¿ç”¨['*'] read_secret_role.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: read-secret namespace: default rules: - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\", \"watch\", \"list\"] Cluster Role In RBAC Roles in RBAC æ˜¯ç”¨æ¥è®¿é—®æŒ‡å®šæŸä¸€ä¸ªå‘½åç©ºé—´ä¸‹çš„èµ„æºï¼Œå¦‚æœæƒ³è¦æå‡åˆ°é›†ç¾¤çº§åˆ«é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ClusterRole secret-reader-clusterole.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: secret-reader rules: - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\", \"watch\", \"list\"] RoleBinding and ClusterRoleBinding Role Binding In RBAC Role Binding In RBAC\rread_pod_rolebinding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: read-pods namespace: default subjects: - kind: ServiceAccount name: sa-demo namespace: default roleRef: # \"roleRef\" æŒ‡å®šå…³è”æ˜¯ Role / ClusterRole kind: Role # è¿™é‡Œ å¿…é¡»æŒ‡å®š Role or ClusterRole name: pod-reader # è¿™é‡Œç»‘å®šä½ æƒ³åŒ¹é…çš„ Role or ClusterRole çš„åç§° apiGroup: rbac.authorization.k8s.io read_secret_rolebinding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: read-secret namespace: default subjects: - kind: ServiceAccount name: sa2 namespace: default roleRef: kind: Role name: read-secret apiGroup: rbac.authorization.k8s.io Cluster Role Binding In RBAC Cluster Role Binding in RBAC ç”¨æ¥èµ‹äºˆsubject é›†ç¾¤çº§åˆ«çš„æƒé™ï¼Œå¯¹æ‰€æœ‰çš„åå­—ç©ºé—´éƒ½æœ‰è®¿é—®çš„æƒé™ Cluster Role Binding In RBAC\rsecret-reader-ClusterRoleBinding.yaml apiVersion: rbac.authorization.k8s.io/v1 # å…è®¸ä»»ä½•äººåœ¨\"manager\"ç»„ä¸­éƒ½å¯ä»¥è®¿é—®ä»»ä½•namespace ä¸‹çš„secrets api å¯¹è±¡ kind: ClusterRoleBinding metadata: name: read-secrets-global subjects: - kind: ServiceAccount name: sa2 namespace: default roleRef: kind: ClusterRole name: secret-reader apiGroup: rbac.authorization.k8s.io æƒé™æ£€æŸ¥ æ£€æŸ¥ç”¨æˆ·æˆ–è€…æœåŠ¡è´¦æˆ·æ˜¯å¦æœ‰å¯¹åº”çš„æƒé™ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤kubectl auth can-i ä¾‹å¦‚ï¼š æ£€æŸ¥ service account sa-demo åœ¨namespace â€œdefaultâ€ æ˜¯å¦æœ‰æŸ¥çœ‹secrets çš„æƒé™ $ kubectl auth can-i get secrets -n default --as=system:serviceaccount:default:sa-demo yes åå­—ç©ºé—´ä¸‹æ£€æŸ¥ä¸¤ä¸ªservice account çš„æƒé™ $ kubectl auth can-i get pods -n default --as=system:serviceaccount:default:sa-demo yes $ kubectl auth can-i get secrets -n default --as=system:serviceaccount:default:sa-demo no $ kubectl auth can-i get pods -n default --as=system:serviceaccount:default:sa2 no $ kubectl auth can-i get secrets -n default --as=system:serviceaccount:default:sa2 yes é›†ç¾¤çº§åˆ«æ£€æŸ¥service account sa çš„æƒé™ $ kubectl auth can-i get secrets -n default --as=system:serviceaccount:default:sa2 $ kubectl auth can-i get secrets -n kube-system --as=system:serviceaccount:default:sa2 yes $ kubectl auth can-i get daemonsets -n kube-system --as=system:serviceaccount:default:sa2 no åªèƒ½è®¿é—®æŸä¸ª namespace çš„æ™®é€šç”¨æˆ· åˆ›å»ºä¸€ä¸ªUser Accountï¼Œåªèƒ½è®¿é—® kube-system è¿™ä¸ªå‘½åç©ºé—´ï¼Œå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š username: lushuan group: ikubernetes åˆ›å»ºç”¨æˆ·å‡­è¯ æˆ‘ä»¬å‰é¢å·²ç»æåˆ°è¿‡ï¼ŒKubernetes æ²¡æœ‰ User Account çš„ API å¯¹è±¡ï¼Œä¸è¿‡è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¸å·çš„è¯ä¹Ÿæ˜¯æŒºç®€å•çš„ï¼Œåˆ©ç”¨ç®¡ç†å‘˜åˆ†é…ç»™ä½ çš„ä¸€ä¸ªç§é’¥å°±å¯ä»¥åˆ›å»ºäº†ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­çš„æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ä½¿ç”¨ 0penssL è¯ä¹¦æ¥åˆ›å»ºä¸€ä¸ª Userï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„ cfssl å·¥å…·æ¥åˆ›å»º:ç»™ç”¨æˆ· lushuan åˆ›å»ºä¸€ä¸ªç§é’¥ï¼Œå‘½åæˆ lushuan.key: $ openssl genrsa -out lushuan.key 2048 ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ç§é’¥åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶:lushuan.csrï¼Œè¦æ³¨æ„éœ€è¦ç¡®ä¿åœ¨-subjå‚æ•°ä¸­æŒ‡å®šç”¨æˆ·åå’Œç»„(CN è¡¨ç¤ºç”¨æˆ·åï¼Œ0è¡¨ç¤ºç»„): $ openssl req -new -key lushuan.key -out lushuan.csr -subj \"/CN=lushuan/O=ikubernetes\" ç„¶åæ‰¾åˆ°æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤çš„ CA è¯ä¹¦ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ kubeadm å®‰è£…çš„é›†ç¾¤ï¼ŒCA ç›¸å…³è¯ä¹¦ä½äº/etc/kubernetes/pki/ ç›®å½•ä¸‹é¢ï¼Œå¦‚æœä½ æ˜¯äºŒè¿›åˆ¶æ–¹å¼æ­å»ºçš„ï¼Œä½ åº”è¯¥åœ¨æœ€å¼€å§‹æ­å»ºé›†ç¾¤çš„æ—¶å€™å°±å·²ç»æŒ‡å®šå¥½äº† CA çš„ç›®å½•ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨è¯¥ç›®å½•ä¸‹é¢çš„ca.crtå’Œ ca.keyä¸¤ä¸ªæ–‡ä»¶æ¥æ‰¹","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:2:5","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"æ€»ç»“ Role å’Œ RoleBinding ç”¨äºåŒä¸€ä¸ªnamespace RoleBindings å¯ä»¥å­˜åœ¨äºä¸åŒçš„å‘½åç©ºé—´ï¼Œä»¥æˆäºˆæœåŠ¡è´¦æˆ·æƒé™ã€‚ RoleBinding å¯ä»¥å¼•ç”¨åŒä¸€åç§°ç©ºé—´ä¸­çš„role,ä¹Ÿå¯ä»¥å¼•ç”¨é›†ç¾¤çº§åˆ«çš„ClusterRole,ä½†æ˜¯å¼•ç”¨ClusterRoleçš„è®¸å¯æƒé™ä¼šé™çº§åˆ°ä»…èƒ½åœ¨Rolebingdingæ‰€åœ¨çš„åç§°ç©ºé—´ç”Ÿæ•ˆã€‚ ClusterRoleBinding åˆ™ç”¨äºå°†ClusterRole ç»‘å®šåˆ°ç”¨æˆ·å’Œç»„ï¼Œå®ƒä½œç”¨äºé›†ç¾¤å…¨å±€ï¼Œå¯ä»¥è®¿é—®é›†ç¾¤æ‰€æœ‰èµ„æºï¼Œä½†æ˜¯ä»…èƒ½å¤Ÿå¼•ç”¨ClusterRole. ClusterRoleBinding ä¸å¯ä»¥å¼•ç”¨Role ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:3:0","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["Kubernetes"],"content":"å‚è€ƒ https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/ https://kubernetes.io/zh-cn/docs/reference/using-api/api-concepts/ https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/certificates/#openssl ä»€ä¹ˆæ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ï¼Ÿ RBACæƒé™ç³»ç»Ÿåˆ†æã€è®¾è®¡ä¸å®ç° ","date":"2024-04-27","objectID":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/:4:0","tags":["Kubernetes"],"title":"ä¸€æ–‡äº†è§£ Kubernetes RBAC æœºåˆ¶å’Œå®è·µ","uri":"/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3kubernetes-rbac/"},{"categories":["DevOps","English Article"],"content":"\rdevops\rIn recent years, DevOps has emerged as a critical discipline that merges software development (Dev) with IT operations (Ops). It aims to shorten the development lifecycle and provide continuous delivery with high software quality. As the demand for faster development cycles and more reliable software increases, professionals in the field constantly seek tools and practices to enhance their efficiency and effectiveness. Enter the realm of free and open-source tools â€“ a goldmine for DevOps practitioners looking to stay ahead of the curve. This article is designed for DevOps professionals, whether youâ€™re just starting or looking to refine your craft. Weâ€™ve curated a list of ten essential free and open-source tools that have proven themselves and stand out for their effectiveness and ability to streamline the DevOps process. These tools cover a range of needs, from continuous integration and delivery (CI/CD) to infrastructure as code (IaC), monitoring, and more, ensuring you have the resources to tackle various challenges head-on. Additionally, these tools have become essential for every DevOps engineer to know and use. Getting the hang of them can boost your career in the field. So, based on our hands-on industry experience, weâ€™ve compiled this list for you. But before we go further, letâ€™s address a fundamental question. Devops Periodic Table\r","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:0:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"What is DevOps? DevOps is a set of practices and methodologies that brings together the development (those who create software) and operations (those who deploy and maintain software) teams. Instead of working in separate silos, these teams collaborate closely throughout the entire software lifecycle, from design through the development process to production support. But what exactly does it mean, and why is it so important? Letâ€™s break it down in an easy-to-understand way. Imagine youâ€™re part of a team creating a puzzle. The developers are those who design and make the puzzle pieces, while the operations team is responsible for putting the puzzle together and making sure it looks right when completed. In traditional settings, these teams might work separately, leading to miscommunication, delays, and a final product that doesnâ€™t fit perfectly. DevOps ensures everyone works together from the start, shares responsibilities, and communicates continuously to solve problems faster and more effectively. Itâ€™s the bridge that connects the creation and operation of software into a cohesive, efficient, and productive workflow. In other words, DevOps is the practice that ensures both teams are working in tandem and using the same playbook. The end game is to improve software quality and reliability and speed up the time it takes to deliver software to the end users. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:1:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"Key Components of DevOps Continuous Integration (CI): This practice involves developers frequently merging their code changes into a central repository, where automated builds and tests are run. The idea is to catch and fix integration errors quickly. Continuous Delivery (CD): Following CI, continuous delivery automates the delivery of applications to selected infrastructure environments. This ensures that the software can be deployed at any time with minimal manual intervention. Automation: Automation is at the heart of DevOps. It applies to testing, deployment, and even infrastructure provisioning, helping reduce manual work, minimize errors, and speed up processes. Monitoring and Feedback: Constant application and infrastructure performance monitoring is crucial. It helps quickly identify and address issues. Feedback loops allow for continuous improvement based on real user experiences. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:2:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"DevOps Life Cycle Grasping the various stages of the DevOps life cycle is key to fully comprehending the essence of the DevOps methodology. So, if youâ€™re just entering this field, weâ€™ve broken them down below to clarify things. DevOps Life Cycle\rPlan: In this initial stage, the team decides on the softwareâ€™s features and capabilities. Itâ€™s like laying out a blueprint for what needs to be built. Code: Developers write code to create the software once the plan is in place. This phase involves turning ideas into tangible products using programming languages and tools. Build: After coding, the next step is to compile the code into a runnable application, which involves converting source code into an executable program. Test: Testing is crucial for ensuring the quality and reliability of the software. In this phase, automated tests are run to find and fix bugs or issues before the software is released to users. Deploy \u0026 Run: Once the software passes all tests, itâ€™s time to release it and run it into the production environment where users can access it. Deployment should be automated for frequent and reliable releases with minimal human intervention. Monitor: Monitoring involves collecting, analyzing, and using data about the softwareâ€™s performance and usage to identify issues, trends, or areas for improvement. Improve: The final stage closes the loop, where feedback from monitoring and end-user experiences is used to make informed decisions on future improvements or changes. However, to make this happen, we need specific software tools. The good news is that the top ones in the DevOps ecosystem are open-source! Here they are. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:3:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"Linux: The DevOpsâ€™ Backbone Linux\rWeâ€™ve left Linux out of the numbered list below of the key DevOps tools, not because itâ€™s unimportant, but because calling it just a â€˜toolâ€™ doesnâ€™t do it justice. Linux is the backbone of all DevOps activities, making everything possible. In simple terms, DevOps as we know it wouldnâ€™t exist without Linux. Itâ€™s like the stage where all the DevOps magic happens. Weâ€™re highlighting this to underline how crucial it is to have Linux skills if youâ€™re planning to dive into the DevOps world. Understanding the basics of how the Linux operating system works is fundamental. Without this knowledge, achieving high expertise and success in DevOps can be quite challenging. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"1. Docker Docker\rDocker and container technology have become foundational to the DevOps methodology. They have revolutionized how developers build, ship, and run applications, unprecedentedly bridging the gap between code and deployment. Containers allow a developer to package an application with all of its needed parts, such as libraries and other dependencies, and ship it as one package. This consistency significantly reduces the â€œit works on my machineâ€ syndrome, streamlining the development lifecycle and enhancing productivity. At the same time, the Docker containers can be started and stopped in seconds, making it easier to manage peak loads. This flexibility is crucial in todayâ€™s agile development processes and continuous delivery cycles, allowing teams to push updates to production faster and more reliably. Letâ€™s not forget that containers also provide isolation between applications, ensuring that each application and its runtime environment can be secured separately. This helps minimize conflict between running applications and enhances security by limiting the surface area for potential attacks. Even though containers were around before Docker arrived, it made them popular and set them up as a key standard widely used in the IT industry. These days, Docker remains the top choice for working with containers, making it an essential skill for all DevOps professionals. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:1","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"2. Kubernetes Kubernetes\rWeâ€™ve already discussed containers. Now, letâ€™s discuss the main tool for managing them, known as the â€˜orchestratorâ€™ in the DevOps ecosystem. While there are other widely used alternatives in the container world, such as Podman, LXC, etc., when we talk about container orchestration, one name stands out as the ultimate solution â€“ Kubernetes. As a powerful, open-source platform for automating the deployment, scaling, and management of containerized applications, Kubernetes has fundamentally changed how development and operations teams work together to deliver applications quickly and efficiently by automating the distribution of applications across a cluster of machines. It also enables seamless application scaling in response to fluctuating demand, ensuring optimal resource utilization and performance. Abstracting the complexity of managing infrastructure, Kubernetes allows developers to focus on writing code and operations teams to concentrate on governance and automation. Moreover, Kubernetes integrates well with CI/CD pipelines, automating the process from code check-in to deployment, enabling teams to release new features and fixes rapidly and reliably. In simple terms, knowing how to use Kubernetes is essential for every professional in the DevOps field. If youâ€™re in this industry, learning Kubernetes is a must. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:2","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"3. Python Python\rAt the heart of DevOps is the need for automation. Pythonâ€˜s straightforward syntax and extensive library ecosystem allow DevOps engineers to write scripts that automate deployments, manage configurations, and streamline the software development lifecycle. Its wide adoption and support have led to the development of numerous modules and tools specifically designed to facilitate DevOps processes. Whether itâ€™s Ansible for configuration management, Docker for containerization, or Jenkins for continuous integration, Python serves as the glue that integrates these tools into a cohesive workflow, enabling seamless operations across different platforms and environments. Moreover, it is pivotal in the IaC (Infrastructure as Code) paradigm, allowing teams to define and provision infrastructure through code. Libraries such as Terraform and CloudFormation are often used with Python scripts to automate the setup and management of servers, networks, and other cloud resources. We can continue by saying that Pythonâ€™s data analysis and visualization capabilities are invaluable for monitoring performance, analyzing logs, and identifying bottlenecks. Tools like Prometheus and Grafana, often integrated with Python, enable DevOps teams to maintain high availability and performance. Even though many other programming languages, such as Golang, Java, Ruby, and more, are popular in the DevOps world, Python is still the top choice in the industry. This is supported by the fact that, according to GitHub, the biggest worldwide code repository, Python has been the most used language over the past year. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:3","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"4. Git Git\rGit, a distributed version control system, has become indispensable for DevOps professionals. First and foremost, it enables team collaboration by allowing multiple developers to work on the same project simultaneously without stepping on each otherâ€™s toes. It provides a comprehensive history of project changes, making it easier to track progress, revert errors, and understand the evolution of a codebase. This capability is crucial for maintaining the speed and quality of development that DevOps aims for. Moreover, Git integrates seamlessly with continuous integration/continuous deployment (CI/CD) pipelines, a core component of DevOps practices. Understanding Git also empowers DevOps professionals to implement and manage code branching strategies effectively, such as the popular Git flow. A lot of what DevOps teams do begins with a simple Git command. It kicks off a series of steps in the CI/CD process, ultimately leading to a completed software product, a functioning service, or a settled IT infrastructure. In conclusion, for industry professionals, commands like â€œpull,â€ â€œpush,â€ â€œcommit,â€ and so on are the DevOps alphabet. Therefore, getting better and succeeding in this field depends on being skilled with Git. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:4","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"5. Ansible Ansible\rAnsible is at the heart of many DevOps practices, an open-source automation tool that plays a pivotal role in infrastructure as code, configuration management, and application deployment. Mastery of Ansible skills has become increasingly important for professionals in the DevOps field, and hereâ€™s why. Ansible allows teams to automate software provisioning, configuration management, and application deployment processes. This automation reduces the potential for human error and significantly increases efficiency, allowing teams to focus on more strategic tasks rather than repetitive manual work. One of Ansibleâ€™s greatest strengths is its simplicity. Its use of YAML for playbook writing makes it accessible to those who may not have a strong background in scripting or programming, bridging the gap between development and operations teams. In addition, what sets Ansible apart is that itâ€™s agentless. This means thereâ€™s no need to install additional software on the nodes or servers it manages, reducing overhead and complexity. Instead, Ansible uses SSH for communication, further simplifying the setup and execution of tasks. It also boasts a vast ecosystem of modules and plugins, making it compatible with a wide range of operating systems, cloud platforms, and software applications. This versatility ensures that DevOps professionals can manage complex, heterogeneous environments efficiently. While itâ€™s not mandatory for a DevOps engineer, like containers, Kubernetes, and Git are, youâ€™ll hardly find a job listing for a DevOps role that doesnâ€™t ask for skills to some level in Ansible or any of the other alternative automation tools, such as Chief, Puppet, etc. Thatâ€™s why proficiency is more than advisable. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:5","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"6. Jenkins Jenkins\rJenkins is an open-source automation server that facilitates continuous integration and continuous delivery (CI/CD) practices, allowing teams to build, test, and deploy applications more quickly and reliably. It works by monitoring a version control system for changes, automatically running tests on new code, and facilitating the deployment of passing builds to production environments. Due to these qualities, just as Kubernetes is the go-to choice for container orchestration, Jenkins has become the go-to tool for CI/CD processes, automating the repetitive tasks involved in the software development lifecycle, such as building code, running tests, and deploying to production. By integrating with a multitude of development, testing, and deployment tools, Jenkins serves as the backbone of a streamlined CI/CD pipeline. It enables developers to integrate changes to the project and makes it easier for teams to detect issues early on. Proficiency in Jenkins is highly sought after in the DevOps field. As organizations increasingly adopt DevOps practices, the demand for professionals skilled in Jenkins and similar technologies continues to rise. Mastery of it can open doors to numerous opportunities, from roles focused on CI/CD pipeline construction and maintenance to DevOps engineering positions. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:6","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"7. Terraform / OpenTofu Terraform\rIn recent years, Terraform has emerged as a cornerstone for DevOps professionals. But what exactly is Terraform? Simply put, itâ€™s a tool created by HashiCorp that allows you to define and provision infrastructure through code. It allows developers and IT professionals to define their infrastructure using a high-level configuration language, enabling them to script the setup and provisioning of servers, databases, networks, and other IT resources. By doing so, Terraform introduces automation, repeatability, and consistency into the often complex infrastructure management process. This approach, called Infrastructure as Code (IaC), allows infrastructure management to be automated and integrated into the development process, making it more reliable, scalable, and transparent. With Terraform, DevOps professionals can seamlessly manage multiple cloud services and providers, deploying entire infrastructures with a single command. This capability is crucial in todayâ€™s multi-cloud environments, as it ensures flexibility, avoids vendor lock-in, and saves time and resources. Moreover, it integrates very well with distributed version control systems such as Git, allowing teams to track and review changes to the infrastructure in the same way they manage application code. However, HashiCorp recently updated Terraformâ€™s licensing, meaning itâ€™s no longer open source. The good news is that the Linux Foundation has introduced OpenTofu, a Terraform fork thatâ€™s fully compatible and ready for production use. We highly recommend putting your time and effort into OpenTofu. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:7","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"8. Argo CD Argo\rArgo CD emerges as a beacon for modern DevOps practices. At its core, itâ€™s a declarative GitOps continuous delivery tool for Kubernetes, where Git repositories serve as the source of truth for defining applications and their environments. When developers push changes to a repository, Argo CD automatically detects these updates and synchronizes the changes to the specified environments, ensuring that the actual state in the cluster matches the desired state stored in Git, significantly reducing the potential for human error. Mastery of Argo CD equips professionals with the ability to manage complex deployments efficiently at scale. This proficiency leads to several key benefits, the main one being enhanced automation. By tying deployments to the version-controlled configuration in Git, Argo CD ensures consistency across environments. Moreover, it automates the deployment process, reducing manual errors and freeing up valuable time for DevOps teams to focus on more strategic tasks. Furthermore, as applications and infrastructure grow, Argo CDâ€™s capabilities allow teams to manage deployments across multiple Kubernetes clusters easily, supporting scalable operations without compromising control or security. For professionals in the DevOps field, mastering Argo CD means being at the forefront of the industryâ€™s move towards more automated, reliable, and efficient deployment processes. And last but not least, investing efforts in mastering Argo CD can significantly boost your career trajectory. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:8","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"9. Prometheus Prometheus\rLetâ€™s start with a short explanation of what Prometheus is and why it is crucial for DevOps professionals. Prometheus is an open-source monitoring and alerting toolkit that has gained widespread adoption for its powerful and dynamic service monitoring capabilities. At its core, it collects and stores metrics in real-time as time series data, allowing users to query this data using its PromQL language. This capability enables DevOps teams to track everything from CPU usage and memory to custom metrics that can be defined by the user, providing insights into the health and performance of their systems. How does it work? Prometheus works by scraping metrics from configured targets at specified intervals, evaluating rule expressions, displaying the results, and triggering alerts if certain conditions are met. This design makes it exceptionally well-suited for environments with complex requirements for monitoring and alerting. Overall, Prometheus is a critical skill for anyone in the DevOps field. Its ability to provide detailed, real-time insights into system performance and health makes it indispensable for modern, dynamic infrastructure management. As systems become complex, the demand for skilled professionals who can leverage Prometheus effectively will only increase, making it a key competency for any DevOps career path. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:9","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"10. Grafana Grafana\rGrafana allows teams to visualize and analyze metrics from various sources, such as Prometheus, Elasticsearch, Loki, and many others, in comprehensive, easy-to-understand dashboards. By transforming this numerical data into visually compelling graphs and charts, Grafana enables teams to monitor their IT infrastructure and services, providing real-time insights into application performance, system health, and more. But why are Grafanaâ€™s skills so crucial in the DevOps field? Above all, they empower DevOps professionals to keep a vigilant eye on the system, identifying and addressing issues before they escalate, ensuring smoother operations and better service reliability. Moreover, with Grafana, data from various sources can be aggregated and visualized in a single dashboard, making it a central monitoring location for all your systems. On top of that, Grafanaâ€™s extensive customization options allow DevOps professionals to tailor dashboards to their specific needs. This flexibility is crucial in a field where requirements can vary greatly from one project to another. In conclusion, mastering Grafana equips DevOps professionals with the skills to monitor, analyze, and optimize their systems effectively. Because of this, the ability to harness Grafanaâ€™s power will continue to be a valuable asset in any DevOps professionalâ€™s toolkit. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:4:10","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["DevOps","English Article"],"content":"Conclusion This list, reflects the industryâ€™s best practices and highlights the essential tools that every DevOps engineer should be familiar with to achieve professional success in todayâ€™s dynamic technological landscape. Whether you are a newcomer or an experienced professional looking to enhance your skills, mastering these tools can significantly boost the trajectory of your DevOps career. ","date":"2024-02-17","objectID":"/10-must-know-free-devops-tools-for-professional-success/:5:0","tags":["DevOps","English Article"],"title":"10 Must-Know Free DevOps Tools for Professional Success","uri":"/10-must-know-free-devops-tools-for-professional-success/"},{"categories":["Kubernetes"],"content":"K8S ä¹‹è¿æ¥å¼‚å¸¸â€”â€”ã€é›†ç¾¤æ•…éšœã€‘ Podé—®é¢˜æ€è€ƒæ€è·¯ Kubernetesé›†ç¾¤ä¸­Podä¸€èˆ¬å“ªäº›æ–¹é¢å®¹æ˜“å‡ºç°é—®é¢˜å‘¢ï¼Ÿ Kubernetesèµ„æºé…ç½®é”™è¯¯ï¼šä¾‹å¦‚åœ¨éƒ¨ç½²Deploymentå’ŒStatefulsetæ—¶ï¼Œèµ„æºæ¸…å•ä¹¦å†™æœ‰é—®é¢˜ï¼Œå¯¼è‡´Podæ— æ³•æ­£å¸¸åˆ›å»º ä»£ç é—®é¢˜ï¼šåº”ç”¨ç¨‹åºä»£ç åœ¨å®¹å™¨å¯åŠ¨åå¤±è´¥ï¼Œé‚£å°±éœ€è¦é€šè¿‡æ’æŸ¥ä»£ç æŸ¥æ‰¾é”™è¯¯ ç½‘ç»œé—®é¢˜ï¼šç½‘ç»œæ’ä»¶éƒ¨ç½²æœ‰é—®é¢˜ï¼Œå¯¼è‡´Podå¯åŠ¨ä¹‹åæ— æ³•ç›¸äº’é€šä¿¡ å­˜å‚¨é—®é¢˜ï¼šPodæŒ‚è½½å­˜å‚¨ï¼Œä½†æ˜¯éœ€è¦å…±äº«çš„å­˜å‚¨è¿æ¥ä¸ä¸Šå¯¼è‡´Podå¯åŠ¨å¼‚å¸¸ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:0","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"Pod çŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›† Running Pending Waiting ContainerCreating ImagePullBackOff CrashLoopBackOff Error Terminating Unknown Evicted å¦‚ä½•æŸ¥çœ‹podçŠ¶æ€ï¼š kubectl get pods \u003cpod name\u003e #æŸ¥çœ‹podè¿è¡ŒçŠ¶æ€ kubectl describe pods \u003cpod name\u003e #æŸ¥çœ‹podè¯¦ç»†ä¿¡æ¯ PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥æ€è·¯ ä¸€èˆ¬æ¥è¯´ï¼Œæ— è®º Pod å¤„äºä»€ä¹ˆå¼‚å¸¸çŠ¶æ€ï¼Œéƒ½å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ Pod çš„çŠ¶æ€ï¼š æŸ¥çœ‹Podçš„é…ç½®æ˜¯å¦æ­£ç¡® kubectl get pod \u003cpod-name\u003e -o yaml æŸ¥çœ‹ Pod çš„è¯¦ç»†ä¿¡æ¯ kubectl describe pod \u003cpod-name\u003e æŸ¥çœ‹Podé‡Œå¯¹åº”å®¹å™¨çš„æ—¥å¿— kubectl logs \u003cpod-name\u003e [-c \u003ccontainer-name\u003e] ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:1","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•å¯åŠ¨Podï¼šContainerCreatingçŠ¶æ€ è¯Šæ–­æ–¹æ³• æŸ¥çœ‹pod kubectl get pods -o wide | grep tomcat NAME READY STATUS RESTARTS AGE IP NODE tomcat 0/1 ContainerCreating 0 106s 10.244.1.4 k8s-node1 æŸ¥çœ‹pod è¯¦æƒ…ä¿¡æ¯ kubectl describe pods tomcat æ˜¾ç¤º error: code = Unknown desc = failed to set up sandbox container \"3f25ce8c6599a8b7824f8f9ba9cf2c078d9496dd840fb2305bf415929879f107\" network for pod â€œtomcat\": NetworkPlugin cni failed to set up pod â€œtomcat\" network: failed to set bridge addr: \"cni0\" already has an IP address different from 10.244.1.4/24 æ€»ç»“ï¼špod å¼‚å¸¸éœ€è¦é€šè¿‡ describe æŸ¥çœ‹å…·ä½“æŠ¥é”™ä¿¡æ¯ï¼Œæ ¹æ®å…·ä½“æŠ¥é”™ä¿¡æ¯å†è¿›è¡Œå¤„ç†ï¼Œä»¥ä¸Šæ˜¯é‡åˆ°åŒç±»é—®é¢˜çš„ä¸€ç§æ’æŸ¥æ€è·¯ï¼Œé—®é¢˜å„ç§å„æ ·ï¼Œæ’æŸ¥é—®é¢˜çš„æ€è·¯ç¡®æ˜¯å¯ä»¥æœ‰è¿¹å¯å¾ªçš„ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:2","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›†-pendingçŠ¶æ€æ’æŸ¥æ€è·¯ Pendingæ˜¯æŒ‚èµ·çŠ¶æ€ï¼šè¡¨ç¤ºåˆ›å»ºçš„Podæ‰¾ä¸åˆ°å¯ä»¥è¿è¡Œå®ƒçš„ç‰©ç†èŠ‚ç‚¹ï¼Œä¸èƒ½è°ƒåº¦åˆ°ç›¸åº”çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µå¦‚ä½•å»æ’æŸ¥å‘¢ï¼Ÿå¯ä»¥ä»ä¸¤ä¸ªå±‚é¢åˆ†æé—®é¢˜ï¼š 1. ç‰©ç†èŠ‚ç‚¹å±‚é¢åˆ†æ æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µï¼šå¦‚free -mæŸ¥çœ‹å†…å­˜ã€topæŸ¥çœ‹CPUä½¿ç”¨ç‡ã€df â€“hæŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œè¿™æ ·å°±å¯ä»¥å¿« é€Ÿå®šä½èŠ‚ç‚¹èµ„æºæƒ…å†µï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯èŠ‚ç‚¹æœ‰é—®é¢˜ æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹ï¼škubectl describe nodes master1ï¼ˆæ§åˆ¶èŠ‚ç‚¹åå­—ï¼‰ï¼Œå¦‚æœèŠ‚ç‚¹å®šä¹‰äº†æ±¡ç‚¹ï¼Œé‚£ä¹ˆPodä¸èƒ½å®¹ å¿æ±¡ç‚¹ï¼Œå°±ä¼šå¯¼è‡´è°ƒåº¦å¤±è´¥ï¼Œå¦‚ä¸‹ï¼š Taints: node-role.kubernetes.io/master:NoSchedule è¿™ä¸ªçœ‹åˆ°çš„æ˜¯æ§åˆ¶èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼Œè¡¨ç¤ºä¸å…è®¸Podè°ƒåº¦ï¼ˆå¦‚æœPodå®šä¹‰å®¹å¿åº¦ï¼Œåˆ™å¯ä»¥å®ç°è°ƒåº¦ï¼‰ **1. Pod æœ¬èº«åˆ†æ ** åœ¨å®šä¹‰podæ—¶ï¼Œå¦‚æœæŒ‡å®šäº†nodeNameæ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹Ÿä¼šè°ƒåº¦å¤±è´¥ åœ¨å®šä¹‰Podæ—¶ï¼Œå¦‚æœå®šä¹‰çš„èµ„æºè¯·æ±‚æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´ç‰©ç†èŠ‚ç‚¹èµ„æºä¸å¤Ÿä¹Ÿæ˜¯ä¸ä¼šè°ƒåº¦çš„ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:3","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›†- ImagePullBackOffçŠ¶æ€ é—®é¢˜åˆ†æ æ‹‰å–é•œåƒæ—¶é—´é•¿å¯¼è‡´è¶…æ—¶ é…ç½®çš„é•œåƒæœ‰é”™è¯¯ï¼šå¦‚é•œåƒåå­—ä¸å­˜åœ¨ç­‰ é…ç½®çš„é•œåƒæ— æ³•è®¿é—®ï¼šå¦‚ç½‘ç»œé™åˆ¶æ— æ³•è®¿é—®hubä¸Šçš„é•œåƒ é…ç½®çš„ç§æœ‰é•œåƒä»“åº“å‚æ•°é”™è¯¯ï¼šå¦‚imagePullSecretæ²¡æœ‰é…ç½®æˆ–è€…é…ç½®é”™è¯¯ dockerfileæ‰“åŒ…çš„é•œåƒä¸å¯ç”¨ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:4","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›†- CrashLoopBackOffçŠ¶æ€ K8sä¸­çš„podæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯é‡Œé¢çš„å®¹å™¨å¯èƒ½é€€å‡ºæˆ–è€…å¤šæ¬¡é‡å¯æˆ–è€…å‡†å¤‡åˆ é™¤ï¼Œå¯¼è‡´å‡ºç°è¿™ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å…·æœ‰å¶å‘æ€§ï¼Œå¯èƒ½ä¸Šä¸€ç§’è¿˜æ˜¯runningçŠ¶æ€ï¼Œä½†æ˜¯çªç„¶å°±å˜æˆCrashLoopBackOffçŠ¶æ€äº†ã€‚ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:5","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›†- ErrorçŠ¶æ€ è¿™ç§çŠ¶æ€ä¸»è¦æ˜¯Podå¯åŠ¨è¿‡ç¨‹ä¼šå‡ºç°ï¼š åŸå› åˆ†æï¼š 1ï¼‰ä¾èµ–çš„ConfigMapã€Secretã€PVã€StorageClassç­‰ä¸å­˜åœ¨ï¼› 2ï¼‰è¯·æ±‚çš„èµ„æºè¶…è¿‡äº†ç®¡ç†å‘˜è®¾ç½®çš„é™åˆ¶ï¼Œæ¯”å¦‚è¶…è¿‡äº†limitsç­‰ï¼› 3ï¼‰æ— æ³•æ“ä½œé›†ç¾¤å†…çš„èµ„æºï¼Œæ¯”å¦‚å¼€å¯RBACåï¼Œéœ€è¦ä¸ºServiceAccounté…ç½®æƒé™ã€‚ æ’æŸ¥æ€è·¯ï¼š # 1. describe #æŸ¥çœ‹podè¯¦ç»†ä¿¡æ¯ kubectl describe pods \u003cpod\u003e # 2. logs #æŸ¥çœ‹podæ—¥å¿— kubectl logs \u003cpod\u003e -c \u003ccontainer\u003e # 3. journalctl #æŸ¥çœ‹kubeletæ—¥å¿— journalctl -f -u kubelet # 4. tail â€“f #æŸ¥çœ‹ä¸»æœºæ—¥å¿— tailf /var/log/messages ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:6","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"PodçŠ¶æ€å¼‚å¸¸æ’æŸ¥é—®é¢˜é›†- Terminatingæˆ–UnknownçŠ¶æ€ åŸå› ï¼šTerminatedæ˜¯å› ä¸ºå®¹å™¨é‡Œçš„åº”ç”¨æŒ‚äº†ã€‚ ä»k8s v1.5å¼€å§‹ï¼ŒKubernetesä¸ä¼šå› ä¸ºNodeå¤±è”è€Œåˆ é™¤å…¶ä¸Šæ­£åœ¨è¿è¡Œçš„Podï¼Œè€Œæ˜¯å°†å…¶æ ‡è®°ä¸ºTerminating æˆ– Unknown çŠ¶æ€ã€‚æƒ³è¦åˆ é™¤è¿™äº›çŠ¶æ€çš„Podæœ‰ 3 ç§æ–¹æ³•ï¼š æ‰‹åŠ¨åˆ é™¤node: æ‰‹åŠ¨åˆ é™¤kubectl delete nodes nodeèŠ‚ç‚¹åå­— æ¢å¤æ­£å¸¸å¯é€‰æ‹©æ€§åˆ é™¤: è‹¥nodeæ¢å¤æ­£å¸¸ï¼Œkubeletä¼šé‡æ–°è·Ÿkube-apiserveré€šä¿¡ ç¡®è®¤è¿™äº›Podçš„æœŸå¾…çŠ¶æ€ï¼Œè¿›è€Œå†å†³å®šåˆ é™¤æˆ–è€…ç»§ç»­è¿è¡Œè¿™äº›Podï¼Œå¦‚æœåˆ é™¤å¯ä»¥é€šè¿‡kubectl delete pods pod-name â€“grace-period=0 â€“forceå¼ºåˆ¶åˆ é™¤ ä½¿ç”¨å‚æ•°é‡å»ºå®¹å™¨ Podè¡Œä¸ºå¼‚å¸¸ï¼ŒPodæ²¡æœ‰æŒ‰é¢„æœŸçš„è¡Œä¸ºæ‰§è¡Œï¼Œæ¯”å¦‚æ²¡æœ‰è¿è¡ŒpodSpecé‡Œé¢è®¾ç½®çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™ä¸€èˆ¬æ˜¯podSpec yamlæ–‡ä»¶å†…å®¹æœ‰è¯¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ validate å‚æ•°é‡å»ºå®¹å™¨ï¼Œ æ¯”å¦‚ï¼ˆkubectl delete pod mypod å’Œ kubectl create â€“ validate -f mypod.yamlï¼‰ï¼›ä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ›å»ºåçš„ podSpec æ˜¯å¦æ˜¯å¯¹çš„ï¼Œæ¯”å¦‚ï¼ˆkubectl get pod mypod -o yamlï¼‰ Unknownæ˜¯podçŠ¶æ€ä¸èƒ½é€šè¿‡kubeletæ±‡æŠ¥ç»™apiserverï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹ï¼ˆMasterå’ŒKubeletï¼‰é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ã€‚ è§£å†³æ€è·¯: æŸ¥çœ‹kubectl çŠ¶æ€ æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ æŸ¥çœ‹apiserveræ˜¯å¦å¼‚å¸¸ æŸ¥çœ‹ kubelet æ—¥å¿— ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:7","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"Podå¥åº·æ£€æŸ¥ï¼šå­˜æ´»æ€§æ¢æµ‹\u0026å°±ç»ªæ€§æ¢æµ‹ ä¸ºä»€ä¹ˆéœ€è¦æ¢é’ˆï¼Ÿ å¦‚æœæ²¡æœ‰æ¢é’ˆï¼Œk8sæ— æ³•çŸ¥é“åº”ç”¨æ˜¯å¦è¿˜æ´»ç€ï¼Œåªè¦podè¿˜åœ¨è¿è¡Œï¼Œk8såˆ™è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·çš„ã€‚ä½†å®é™…ä¸Šï¼Œpodè™½ç„¶è¿è¡Œäº†ï¼Œä½†é‡Œé¢å®¹å™¨ä¸­çš„åº”ç”¨å¯èƒ½è¿˜æ²¡æä¾›æœåŠ¡ï¼Œé‚£å°±éœ€è¦åšå¥åº·æ£€æŸ¥ï¼Œå¥åº·æ£€æŸ¥å°±éœ€è¦æ¢é’ˆï¼Œå¸¸è§çš„æ¢é’ˆæœ‰å¦‚ä¸‹å‡ ç§ï¼š httGet å¯¹å®¹å™¨çš„ipåœ°å€(æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„)æ‰§è¡Œhttp getè¯·æ±‚ å¦‚æœæ¢æµ‹å™¨æ”¶åˆ°å“åº”ï¼Œå¹¶ä¸”å“åº”ç æ˜¯2xx,åˆ™è®¤ä¸ºæ¢æµ‹æˆåŠŸã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å“åº”æˆ–è€…è¿”å›é”™è¯¯å“ åº”ç åˆ™è¯´æ˜æ¢æµ‹å¤±è´¥ï¼Œå®¹å™¨å°†é‡å¯ã€‚ tcpSock æ¢é’ˆä¸å®¹å™¨æŒ‡å®šç«¯å£å»ºç«‹tcpè¿æ¥ï¼Œå¦‚æœè¿æ¥å»ºç«‹åˆ™æ¢æµ‹æˆåŠŸï¼Œå¦åˆ™æ¢æµ‹å¤±è´¥å®¹å™¨é‡å¯ã€‚ exec åœ¨å®¹å™¨å†…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥å‘½ä»¤é€€å‡ºçŠ¶æ€ç ï¼Œå¦‚æœçŠ¶æ€ç ä¸º0ï¼Œåˆ™æ¢æµ‹æˆåŠŸï¼Œå¦åˆ™æ¢æµ‹å¤±è´¥ å®¹å™¨é‡å¯ LivenessProbeå’ŒReadinessProbeåŒºåˆ«ï¼š LivenessProbeå†³å®šæ˜¯å¦é‡å¯å®¹å™¨ ReadinessProbeä¸»è¦æ¥ç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å°±ç»ªï¼š åªæœ‰å½“Podé‡Œçš„å®¹å™¨éƒ¨ç½²çš„åº”ç”¨éƒ½å¤„äºå°±ç»ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯podçš„Readyä¸ºtrueï¼ˆ1/1ï¼‰æ—¶ï¼Œæ‰ä¼šå°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:8","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"corednsæˆ–è€…kube-dnsç»å¸¸é‡å¯å’ŒæŠ¥é”™ é—®é¢˜æè¿°ï¼š åœ¨k8sä¸­éƒ¨ç½²æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´æ— æ³•é€šè¿‡dnsè§£æï¼Œcorednsä¸€ç›´å¤„äºCrashLoopBackOffçŠ¶æ€ æŸ¥çœ‹æ—¥å¿—ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š plugin/loop: Loop (127.0.0.1:44222 -\u003e :53) detected for zone è§£å†³æ€è·¯ï¼š corednsä¸»è¦å’Œresolv.confæ‰“äº¤é“ï¼Œä¼šè¯»å–å®¿ä¸»æœºçš„/etc/resolv.confä¸­çš„nameserverå†…å®¹ï¼ŒæŸ¥è¯¢ resolv.confæ–‡ä»¶ï¼Œå¦‚æœé‡Œé¢å­˜åœ¨æœ¬åœ°å›ç¯å¦‚127.0.0.1æˆ–è€…127.0.0.53é‚£ä¹ˆå°±å®¹æ˜“é€ æˆæ­»å¾ªç¯ è§£å†³æ­¥éª¤ï¼š ä¿®æ”¹resolv.confæ–‡ä»¶ï¼š å°†nameserverä¸´æ—¶ä¿®æ”¹ä¸º114.114.114.114ä¹‹åï¼škubectl edit deployment coredns -n kube-system å°†replicatesæ”¹ä¸º0ï¼Œä»è€Œåœæ­¢å·²ç»å¯åŠ¨çš„coredns pod å†å°†replicatesæ”¹ä¸º2ï¼Œ è¿™æ ·ä¼šè§¦å‘corednsé‡æ–°è¯»å–ç³»ç»Ÿé…ç½®ï¼Œæ­¤æ—¶æœåŠ¡çš„çŠ¶æ€ä¸ºRunning ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:9","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"kubectlæ‰§è¡Œå¼‚å¸¸ï¼šæ— æƒé™é—®é¢˜å®šä½ æè¿° $ kubectl get node \u003e The connection to the server localhost:8080 was refused - did you specify the right host or port? è¿™æ˜¯å› ä¸ºå®‰è£…k8sä¹‹åï¼Œé»˜è®¤æ˜¯æ²¡æœ‰æƒé™æ“ä½œk8sèµ„æºçš„ï¼Œå¯ç”¨å¦‚ä¸‹æ–¹æ³•è§£å†³ mkdir -p $HOME/.kube sudo cp -ifr /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:1:10","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"K8S ä¹‹ç»Ÿä¿¡å¼‚å¸¸â€”â€”ã€ç½‘ç»œæ•…éšœã€‘ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:2:0","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"ç½‘ç»œæ•…éšœåŸå›  Kubernetesä¸­çš„ç½‘ç»œæ˜¯éå¸¸é‡è¦çš„ï¼Œæ•´ä¸ªk8sé›†ç¾¤çš„é€šä¿¡è°ƒåº¦éƒ½æ˜¯é€šè¿‡ç½‘ç»œæ’ä»¶å®ç°çš„ï¼Œkubernetesä¹‹ä¸Šçš„ç½‘è·¯é€šä¿¡ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š å®¹å™¨é—´çš„é€šä¿¡: åŒä¸€ä¸ªpodå†…çš„å¤šä¸ªå®¹å™¨é—´çš„é€šä¿¡ï¼Œlo pod é€šä¿¡ï¼š ä»ä¸€ä¸ªpod Ipåˆ°å¦ä¸€ä¸ªpod Ip Podä¸serviceé€šä¿¡ï¼š pod ip åˆ° cluster ip å¤–éƒ¨é€šä¿¡ï¼š Serviceä¸é›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šä¿¡ é€šä¿¡éœ€è¦ä¾èµ–ç½‘ç»œæ’ä»¶ï¼Œå¦‚calicoã€flannelã€canelç­‰ï¼Œé€šä¿¡è¿‡ç¨‹æœ€å¸¸è§çš„æ•…éšœå¦‚ä¸‹ Pod è‡ªèº«ç½‘ç»œæ•…éšœ Pod é—´é€šä¿¡æ•…éšœ Pod å’Œç‰©ç†èŠ‚ç‚¹é€šä¿¡æ•…éšœ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:2:1","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"K8S ä¹‹å†…éƒ¨å¼‚å¸¸â€”â€”ã€èŠ‚ç‚¹æ•…éšœã€‘ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:3:0","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹å¼‚å¸¸1: é›†ç¾¤èŠ‚ç‚¹NotReady ä¸€èˆ¬æ˜¯è¯¥èŠ‚ç‚¹ä¸Šçš„kubelet æŒ‚æ‰äº†ï¼ŒæŸ¥çœ‹kubelet çŠ¶æ€ systemctl status kubelet å¦‚æœæŒ‚æ‰éœ€è¦é‡å¯ä¸€ä¸‹kubelet æ‰©å±•ï¼šä¸ºä»€ä¹ˆè¦é‡å¯kubeletï¼Ÿ ç›‘è§†åˆ†é…ç»™è¯¥NodeèŠ‚ç‚¹çš„pods æŒ‚è½½podæ‰€éœ€è¦çš„volumes ä¸‹è½½podçš„secret é€šè¿‡docker/rktæ¥è¿è¡Œpodä¸­çš„å®¹å™¨ å‘¨æœŸçš„æ‰§è¡Œpodä¸­ä¸ºå®¹å™¨å®šä¹‰çš„livenessæ¢é’ˆ ä¸ŠæŠ¥podçš„çŠ¶æ€ç»™ç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶ ä¸ŠæŠ¥Nodeçš„çŠ¶æ€ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:3:1","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹å¼‚å¸¸2: podè°ƒåº¦å¤±è´¥æ•…éšœæ’æŸ¥ åœ¨k8sé›†ç¾¤ä¸­ï¼Œpodæ˜¯æœ€å°å•å…ƒï¼Œéœ€è¦è°ƒåº¦åˆ°å…·ä½“çš„ç‰©ç†èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆä¸ºäº†æ›´å¥½æ’æŸ¥é—®é¢˜ï¼Œäº†è§£podçš„è°ƒåº¦æµç¨‹æ˜¯é‡ä¸­ä¹‹é‡ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸‹podå·¥ä½œå’Œè°ƒåº¦æµç¨‹ï¼š åˆ›å»ºpodè¿‡ç¨‹ï¼š 1ã€ç”¨æˆ·åˆ›å»ºpodçš„ä¿¡æ¯é€šè¿‡API Serverå­˜å‚¨åˆ°etcdä¸­ï¼Œetcdè®°å½•podçš„å…ƒä¿¡æ¯å¹¶å°†ç»“æœè¿”å›API Server 2ã€API Serverå‘ŠçŸ¥è°ƒåº¦å™¨è¯·æ±‚èµ„æºè°ƒåº¦åˆ†é…ï¼Œè°ƒåº¦å™¨é€šè¿‡è®¡ç®—ï¼Œå°†ä¼˜å…ˆçº§é«˜çš„nodeä¸podç»‘å®šå¹¶å‘ŠçŸ¥API Server 3ã€API Serverå°†æ­¤ä¿¡æ¯å†™å…¥etcdï¼Œå¾—åˆ°etcdå›å¤åè°ƒç”¨kubeletåˆ›å»ºpod 4ã€kubeletä½¿ç”¨docker runåˆ›å»ºpodå†…çš„å®¹å™¨ï¼Œå¾—åˆ°åé¦ˆä¿¡æ¯åå°†å®¹å™¨ä¿¡æ¯å‘ŠçŸ¥API Server 5ã€API Serverå°†æ”¶åˆ°çš„ä¿¡æ¯å†™å…¥etcdå¹¶å¾—åˆ°å›é¦ˆ 6ã€æ­¤æ—¶ä½¿ç”¨kubectl get podå°±å¯ä»¥æŸ¥çœ‹åˆ°ä¿¡æ¯äº† è°ƒåº¦æ–¹å¼ï¼š 1ã€å½“æˆ‘ä»¬å‘é€è¯·æ±‚åˆ›å»ºPodï¼Œè°ƒåº¦å™¨å°±ä¼šæŠŠpodè°ƒåº¦åˆ°åˆé€‚çš„ç‰©ç†èŠ‚ç‚¹ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹è¿‡ç¨‹ï¼š Scheduleræ ¹æ®é¢„é€‰ç­–ç•¥å’Œä¼˜é€‰å‡½æ•°ï¼Œé€‰é¢åˆé€‚çš„noedèŠ‚ç‚¹è°ƒåº¦ 2ã€å¯ä»¥é€šè¿‡å®šä¹‰nodeNameå’ŒnodeSelectorè¿›è¡Œè°ƒåº¦ 3ã€å¯ä»¥é€šè¿‡èŠ‚ç‚¹äº²å’Œæ€§è¿›è¡Œè°ƒåº¦ Podåœ¨è°ƒåº¦çš„æ—¶å€™ä¼šæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¦‚æœèŠ‚ç‚¹èµ„æºä¸è¶³ï¼›podå®šä¹‰äº†æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œä½†æ˜¯æŒ‡å®šçš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæˆ–è€…podå®šä¹‰äº†äº²å’Œæ€§ï¼Œä½†æ˜¯èŠ‚ç‚¹æ²¡æœ‰æ»¡è¶³çš„æ¡ä»¶ï¼Œéƒ½ä¼šå¯¼è‡´è°ƒåº¦å¤±è´¥ã€‚ æ’æŸ¥æ€è·¯ describe pod æŸ¥çœ‹æ˜¯å¦èŠ‚ç‚¹åŠ äº†æ±¡ç‚¹ï¼Œpod æ— æ³•å®¹å¿ï¼Œå½“ç„¶è¿˜è¦æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿›è¡Œå®šä½ æŸ¥çœ‹ç›®æ ‡èŠ‚ç‚¹ kubelet æœåŠ¡çš„çŠ¶æ€ podè°ƒåº¦å¤±è´¥å†…ç½®æ±¡ç‚¹ å½“æŸäº›æ¡ä»¶ä¸ºçœŸæ—¶ï¼ŒèŠ‚ç‚¹æ§åˆ¶å™¨ä¼šè‡ªåŠ¨ä¸ºèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹ï¼š node.kubernetes.io/ NoScheduleï¼šå¦‚æœä¸€ä¸ªpodæ²¡æœ‰å£°æ˜å®¹å¿è¿™ä¸ªTaintï¼Œåˆ™ç³»ç»Ÿä¸ä¼šæŠŠè¯¥Podè°ƒåº¦åˆ°æœ‰è¿™ä¸ªTaintçš„nodeä¸Š node.kubernetes.io/NoExecuteï¼šå®šä¹‰podçš„é©±é€è¡Œä¸ºï¼Œä»¥åº”å¯¹èŠ‚ç‚¹æ•…éšœã€‚ node.kubernetes.io/not-readyï¼šèŠ‚ç‚¹å°šæœªå‡†å¤‡å¥½ã€‚è¿™å¯¹åº”äºNodeConditionReadyä¸ºFalseã€‚ node.kubernetes.io/unreachableï¼šæ— æ³•ä»èŠ‚ç‚¹æ§åˆ¶å™¨è®¿é—®èŠ‚ç‚¹ã€‚è¿™å¯¹åº”äºNodeConditionReadyä¸ºUnknownã€‚ node.kubernetes.io/out-of-diskï¼šèŠ‚ç‚¹ç£ç›˜ä¸è¶³ã€‚ node.kubernetes.io/memory-pressureï¼šèŠ‚ç‚¹æœ‰å†…å­˜å‹åŠ›ã€‚ node.kubernetes.io/disk-pressureï¼šèŠ‚ç‚¹æœ‰ç£ç›˜å‹åŠ›ã€‚ node.kubernetes.io/network-unavailableï¼šèŠ‚ç‚¹çš„ç½‘ç»œä¸å¯ç”¨ã€‚ node.kubernetes.io/unschedulableï¼šèŠ‚ç‚¹ä¸å¯è°ƒåº¦ã€‚ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:3:2","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹èµ„æºä¸è¶³ï¼šPodè¶…è¿‡èŠ‚ç‚¹èµ„æºé™åˆ¶ Podè¶…è¿‡èŠ‚ç‚¹èµ„æºé™åˆ¶åˆ†ä¸¤ç§æƒ…å†µï¼š æƒ…å†µä¸€ï¼šPodæ•°é‡å¤ªå¤šè¶…è¿‡ç‰©ç†èŠ‚ç‚¹é™åˆ¶ï¼Œè¾ƒå°‘è§ æƒ…å†µäºŒï¼šPodèµ„æºè¶…è¿‡ç‰©ç†èŠ‚ç‚¹èµ„æºé™åˆ¶ï¼Œç›¸å¯¹é¢‘ç¹ä¸€äº›ï¼Œrequests èµ„æºç”³è¯·è¿‡å¤š ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:3:3","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"K8Sä¹‹å†…éƒ¨å¼‚å¸¸ ã€èŠ‚ç‚¹æ•…éšœã€‘ æ’æŸ¥æ€è·¯æ€»ç»“ èŠ‚ç‚¹çŠ¶æ€æŸ¥è¯¢ï¼škubectl get nodes å¸¸è§å¼‚å¸¸ç°è±¡ï¼š1ã€èŠ‚ç‚¹çŠ¶æ€NotReady 2ã€è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹çš„podæ˜¾ç¤ºUnkonwnã€Pendingç­‰ å¸¸è§æ•…éšœï¼škubeletè¿›ç¨‹å¼‚å¸¸ã€æœªå®‰è£…cniç½‘ç»œæ’ä»¶ã€dockerå¼‚å¸¸ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€å†…å­˜ä¸è¶³ã€cpuä¸è¶³ æ’æŸ¥æ’æŸ¥ï¼š kubectl describe nodes æŸ¥çœ‹nodeèŠ‚ç‚¹ä¿¡æ¯ kubectl describe pods \u003cpod åå­—\u003e æŸ¥çœ‹podèŠ‚ç‚¹ä¿¡æ¯ systemctl status æŸ¥çœ‹kubeletçŠ¶æ€ JournalctlæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— freeæŸ¥çœ‹å†…å­˜ topæŸ¥çœ‹cpu ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:3:4","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"K8S ä¹‹åº”ç”¨æ•…éšœâ€”â€”ã€åº”ç”¨æ•…éšœã€‘ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:4:0","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"æ•…éšœæ’æŸ¥ï¼šServiceè®¿é—®å¼‚å¸¸ Serviceæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå®¹æ˜“å‡ºç°é—®é¢˜ï¼Ÿ åœ¨kubernetesä¸­ï¼ŒPodæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå¦‚æœPodé‡å¯IPå¾ˆæœ‰å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœæˆ‘ä»¬çš„æœåŠ¡éƒ½æ˜¯å°†Podçš„IPåœ°å€å†™æ­»ï¼ŒPodçš„æŒ‚æ‰æˆ–è€…é‡å¯ï¼Œå’Œåˆšæ‰é‡å¯çš„podç›¸å…³è”çš„å…¶ä»–æœåŠ¡å°†ä¼šæ‰¾ä¸åˆ°å®ƒæ‰€å…³è”çš„Podï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨kubernetesä¸­å®šä¹‰äº†serviceèµ„æºå¯¹è±¡ï¼ŒService å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡è®¿é—®çš„å…¥å£ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªå…¥å£å³å¯è®¿é—®æœåŠ¡èƒŒåçš„åº”ç”¨é›†ç¾¤å®ä¾‹ï¼ŒServiceæ˜¯ä¸€ç»„Podçš„é€»è¾‘é›†åˆï¼Œè¿™ä¸€ç»„ Pod èƒ½å¤Ÿè¢« Service è®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡ Label Selectorå®ç°çš„ã€‚ service label selector\ræƒ…å†µä¸€ï¼š service å’Œ pod labels æ²¡æœ‰åŒ¹é… æƒ…å†µäºŒï¼šservice å’Œ pod æ­£ç¡®å…³è”ï¼Œkube-proxy å¼‚å¸¸ kube-proxy å¯¼è‡´Service è®¿é—®å¼‚å¸¸ kube-proxy æ˜¯ä»€ä¹ˆï¼Ÿ service ä¸ºä¸€ç»„ç›¸åŒçš„ pod æä¾›äº†ç»Ÿä¸€çš„å…¥å£ï¼Œèµ·åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚service å…·æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œæ­£æ˜¯ kube-proxy çš„åŠŸåŠ³ï¼Œkube-proxyæ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®‰è£…åœ¨æ¯ä¸€ä¸ªk8sèŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬æš´éœ²ä¸€ä¸ª service çš„æ—¶å€™ï¼Œkube-proxy ä¼šåœ¨iptablesä¸­è¿½åŠ ä¸€äº›è§„åˆ™ï¼Œä¸ºæˆ‘ä»¬å®ç°è·¯ç”±ä¸è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚ èƒŒæ™¯ï¼šæŸ¥çœ‹ Serviceã€podã€endpoint æ˜¯å¦æ­£å¸¸å…³è” $kubectl describe svc myapp-v1-service Name: myapp-v1-service Namespace: default Selector: app=myapp,version=v1 Type: NodePort IP: 10.98.1.137 Port: \u003cunset\u003e 80/TCP TargetPort: 80/TCP NodePort: \u003cunset\u003e 30080/TCP Endpoints: 10.244.1.233:80,10.244.1.234:80 æŸ¥çœ‹iptables æ˜¯å¦æ­£å¸¸åˆ›å»ºè§„åˆ™ iptables -t nat -L|grep 10.98.1.137 KUBE-MARK-MASQ tcp -- !10.244.0.0/16 10.98.1.137 /* default/myapp-v1-service cluster IP */ tcp dpt:http KUBE-SVC-J2PKJ4NHOU6XHVIG tcp -- anywhere 10.98.1.137 /* default/myapp-v1-service cluster IP */ tcp dpt:http é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹åˆ°ä¹‹å‰åˆ›å»ºçš„serviceï¼Œä¼šé€šè¿‡kube-proxyåœ¨iptablesä¸­ç”Ÿæˆä¸€ä¸ªè§„åˆ™ï¼Œæ¥å®ç°æµé‡è·¯ç”±ã€‚ é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ç³»åˆ—ç›®æ ‡ä¸º KUBE-SVC-xxx é“¾çš„è§„åˆ™ï¼Œæ¯æ¡è§„åˆ™éƒ½ä¼šåŒ¹é…æŸä¸ªç›®æ ‡ ip ä¸ç«¯å£ã€‚ä¹Ÿå°±æ˜¯è¯´è®¿é—®æŸä¸ª ip:port çš„è¯·æ±‚ä¼šç”± KUBE-SVC-xxx é“¾æ¥å¤„ç†ã€‚è¿™ä¸ªç›®æ ‡ IP å…¶å®å°±æ˜¯service ipã€‚ $ iptables -t nat -L|grep KUBE-SVC-J2PKJ4NHOU6XHVIG KUBE-SVC-J2PKJ4NHOU6XHVIG tcp -- anywhere anywhere /* default/myapp-v1-service */ tcp dpt:30080 KUBE-SVC-J2PKJ4NHOU6XHVIG tcp -- anywhere 10.98.1.137 /* default/myapp-v1-service cluster IP */ tcp dpt:http $ iptables -t nat -L|grep KUBE-MARK-MASQ | grep 10.244.1.233 KUBE-MARK-MASQ all -- 10.244.1.233 anywhere /* default/myapp-v1-service */ $ iptables -t nat -L|grep KUBE-MARK-MASQ | grep 10.244.1.234 KUBE-MARK-MASQ all -- 10.244.1.234 anywhere /* default/myapp-v1-service */ é€šè¿‡ä¸Šé¢åˆ†æå¯ä»¥çŸ¥é“ï¼Œkube-proxyåœ¨serviceè¯·æ±‚ä¸­èµ·åˆ°æµé‡è·¯ç”±è½¬å‘çš„ä½œç”¨ï¼š kube-proxy ä¼šä¸ºæˆ‘ä»¬æš´éœ²çš„serviceè¿½åŠ iptablesè§„åˆ™ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š æ‰€æœ‰è¿›å‡ºè¯·æ±‚éƒ½ä¼šç»è¿‡ KUBE-SERVICES é“¾ KUBE-SERVICES é“¾æœ‰æˆ‘ä»¬å‘å¸ƒçš„æ¯ä¸€ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„é“¾ä¼šå¯¹åº”åˆ° DNAT åˆ° service çš„ endpoint KUBE-SERVICES é“¾æœ€åçš„æ˜¯ KUBE-NODEPORTS é“¾ï¼Œä¼šåŒ¹é…è¯·æ±‚æœ¬ä¸»æœºçš„ä¸€äº›ç«¯å£ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬é€šè¿‡ NODEPORT ç±»å‹å‘å¸ƒæœåŠ¡èƒ½åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®çš„åŸå› ã€‚ ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œserviceå’Œpodæ­£ç¡®å…³è”ï¼Œpodä¹Ÿå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œé‚£è¯·æ±‚serviceè¿˜æ˜¯è®¿é—®ä¸åˆ°podï¼Œ90%å°±æ˜¯kube-proxyå¼•èµ·çš„ã€‚æŸ¥çœ‹kube-proxyæ˜¯å¦åœ¨æœºå™¨ä¸Šæ­£å¸¸è¿è¡Œã€‚ kube-proxyå¦‚æœåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸‹ä¸€æ­¥ï¼Œç¡®è®¤å®ƒæœ‰æ²¡æœ‰å‡ºç°å…¶ä»–å¼‚å¸¸ï¼Œæ¯”å¦‚è¿æ¥ä¸»èŠ‚ç‚¹å¤±è´¥ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»æŸ¥çœ‹æ—¥å¿—ï¼šå¦‚ /var/log/messagesæˆ–è€…/var/log/kube-proxy.log(äºŒè¿›åˆ¶å®‰è£…çš„æ—¶å€™å¯ä»¥æŒ‡å®šçš„)ï¼Œä¹Ÿä½¿ç”¨ journalctl è®¿é—®æ—¥å¿—ã€kube-proxyå¦‚æœæ˜¯åœ¨k8sä¸­ä»¥podå½¢å¼è¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡kubectl logs æŸ¥çœ‹æ—¥å¿—ã€‚ æ ¹æ®æ—¥å¿—æŠ¥é”™ä¿¡æ¯å†è¿›è¡Œè¿›ä¸€æ­¥çš„æ’æŸ¥ ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:4:1","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"æ•…éšœæ’æŸ¥ï¼šPodåˆ é™¤å¤±è´¥ æ•…éšœæè¿°ï¼šåœ¨k8sä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šåƒåœ¾podï¼Œä¹Ÿå°±æ˜¯æœ‰äº›podè™½ç„¶æ˜¯runningçŠ¶æ€ï¼Œå¯æ˜¯å…¶æ‰€è°ƒåº¦åˆ°çš„k8s nodeèŠ‚ç‚¹å·²ç»ä»k8sé›†ç¾¤åˆ é™¤äº†ï¼Œä½†æ˜¯podè¿˜æ˜¯åœ¨è¿™ä¸ªnodeä¸Šï¼Œæ²¡æœ‰è¢«é©±é€ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µå°±éœ€è¦æŠŠpodåˆ é™¤ã€‚ åˆ é™¤podçš„å‡ ç§æ–¹æ³•ï¼š åˆ é™¤podæ‰€åœ¨çš„namespace å¦‚æœpodæ˜¯é€šè¿‡æ§åˆ¶å™¨ç®¡ç†çš„ï¼Œå¯ä»¥åˆ é™¤æ§åˆ¶å™¨èµ„æº å¦‚æœpodæ˜¯è‡ªä¸»å¼ç®¡ç†ï¼Œç›´æ¥åˆ é™¤podèµ„æºå°±å¯ä»¥äº† ä½†æ˜¯æˆ‘ä»¬å¸¸å¸¸é‡è§è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨åˆ é™¤podèµ„æºçš„æ—¶å€™ï¼Œpodä¼šä¸€ç›´terminateçŠ¶æ€ï¼Œå¾ˆé•¿æ—¶é—´æ— æ³•åˆ é™¤ è§£å†³æ–¹æ¡ˆï¼š å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¼ºåˆ¶åˆ é™¤ï¼š åŠ å‚æ•° --force --grace-period=0ï¼Œgrace-periodè¡¨ç¤ºè¿‡æ¸¡å­˜æ´»æœŸï¼Œé»˜è®¤ 30sï¼Œåœ¨åˆ é™¤PODä¹‹å‰å…è®¸PODæ…¢æ…¢ç»ˆæ­¢å…¶ä¸Šçš„å®¹å™¨è¿›ç¨‹ï¼Œä»è€Œä¼˜é›…é€€å‡ºï¼Œ0è¡¨ç¤ºç«‹å³ç»ˆæ­¢POD kubectl delete pod \u003cpodåå­—\u003e -n --force --grace-period=0 ","date":"2024-01-13","objectID":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/:4:2","tags":["Kubernetesæ’éšœ"],"title":"k8s å¸¸è§æ•…éšœå’Œè§£å†³æ€è·¯åŠæ–¹æ³•","uri":"/k8s-%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%96%B9%E6%B3%95/"},{"categories":["Kubernetes"],"content":"\rKubernetes æŠ€èƒ½å›¾è°±\r","date":"2023-10-13","objectID":"/kubernetes-%E6%8A%80%E8%83%BD%E5%9B%BE%E8%B0%B1/:0:0","tags":["Kubernetes"],"title":"Kubernetes æŠ€èƒ½å›¾è°±","uri":"/kubernetes-%E6%8A%80%E8%83%BD%E5%9B%BE%E8%B0%B1/"},{"categories":["Kubernetes"],"content":"é—®é¢˜æè¿° é—®é¢˜\råœ¨é«˜å¯ç”¨çš„k8sé›†ç¾¤ä¸­ï¼Œå½“NodeèŠ‚ç‚¹æŒ‚æ‰ï¼Œkubeletæ— æ³•æä¾›å·¥ä½œçš„æ—¶å€™ï¼Œpodå°†ä¼šè‡ªåŠ¨è°ƒåº¦åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šå»ï¼Œ è€Œè°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šçš„æ—¶é—´éœ€è¦æˆ‘ä»¬æ…é‡è€ƒé‡ï¼Œå› ä¸ºå®ƒå†³å®šäº†ç”Ÿäº§çš„ç¨³å®šæ€§ã€å¯é æ€§ï¼Œæ›´å¿«çš„è¿ç§»å¯ä»¥å‡å°‘æˆ‘ä»¬ä¸šåŠ¡çš„å½±å“æ€§ï¼Œ ä½†æ˜¯æœ‰å¯èƒ½ä¼šå¯¹é›†ç¾¤é€ æˆä¸€å®šçš„å‹åŠ›ï¼Œä»è€Œé€ æˆé›†ç¾¤å´©æºƒã€‚\r","date":"2023-09-09","objectID":"/%E8%B0%83%E6%95%B4%E8%8A%82%E7%82%B9pod%E9%A9%B1%E9%80%90%E6%97%B6%E9%97%B4/:1:0","tags":["Kubernetes"],"title":"è°ƒæ•´èŠ‚ç‚¹podé©±é€æ—¶é—´","uri":"/%E8%B0%83%E6%95%B4%E8%8A%82%E7%82%B9pod%E9%A9%B1%E9%80%90%E6%97%B6%E9%97%B4/"},{"categories":["Kubernetes"],"content":"Kubelet çŠ¶æ€æ›´æ–°çš„åŸºæœ¬æµç¨‹ kubelet è‡ªèº«ä¼šå®šæœŸæ›´æ–°çŠ¶æ€åˆ° apiserverï¼Œé€šè¿‡å‚æ•°â€“node-status-update-frequencyæŒ‡å®šä¸ŠæŠ¥é¢‘ç‡ï¼Œé»˜è®¤æ˜¯ 10s ä¸ŠæŠ¥ä¸€æ¬¡ã€‚ kube-controller-manager ä¼šæ¯éš”â€“node-monitor-periodæ—¶é—´å»æ£€æŸ¥ kubelet çš„çŠ¶æ€ï¼Œé»˜è®¤æ˜¯ 5sã€‚ å½“ node å¤±è”ä¸€æ®µæ—¶é—´åï¼Œkubernetes åˆ¤å®š node ä¸º notready çŠ¶æ€ï¼Œè¿™æ®µæ—¶é•¿é€šè¿‡â€“node-monitor-grace-periodå‚æ•°é…ç½®ï¼Œé»˜è®¤ 40sã€‚ å½“ node å¤±è”ä¸€æ®µæ—¶é—´åï¼Œkubernetes åˆ¤å®š node ä¸º unhealthy çŠ¶æ€ï¼Œè¿™æ®µæ—¶é•¿é€šè¿‡â€“node-startup-grace-periodå‚æ•°é…ç½®ï¼Œé»˜è®¤ 1m0sã€‚ å½“ node å¤±è”ä¸€æ®µæ—¶é—´åï¼Œkubernetes å¼€å§‹åˆ é™¤åŸ node ä¸Šçš„ podï¼Œè¿™æ®µæ—¶é•¿æ˜¯é€šè¿‡â€“pod-eviction-timeoutå‚æ•°é…ç½®ï¼Œé»˜è®¤ 5m0sã€‚ kube-controller-manager å’Œ kubelet æ˜¯å¼‚æ­¥å·¥ä½œçš„ï¼Œè¿™æ„å‘³ç€å»¶è¿Ÿå¯èƒ½åŒ…æ‹¬ä»»ä½•çš„ç½‘ç»œå»¶è¿Ÿã€apiserver çš„å»¶è¿Ÿã€etcd å»¶è¿Ÿï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„è´Ÿè½½å¼•èµ·çš„å»¶è¿Ÿç­‰ç­‰ã€‚å› æ­¤ï¼Œå¦‚æœâ€“node-status-update-frequencyè®¾ç½®ä¸º5sï¼Œé‚£ä¹ˆå®é™…ä¸Š etcd ä¸­çš„æ•°æ®å˜åŒ–ä¼šéœ€è¦ 6-7sï¼Œç”šè‡³æ›´é•¿æ—¶é—´ã€‚ å¦‚æœä¸šåŠ¡ç”Ÿäº§è®¤ä¸ºé»˜è®¤çš„é©±é€æ—¶é—´ä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„åŠæ—¶æ€§ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹é©±é€æ—¶é—´ã€‚ åœ¨masterèŠ‚ç‚¹æ“ä½œï¼š ä¿®æ”¹/etc/systemd/system/kube-controller-manager.serviceæ–‡ä»¶ å¢åŠ ä¸€è¡Œâ€“pod-eviction-timeout=1m ï¼ˆè¿™é‡Œæ˜¯è°ƒæ•´ä¸º1åˆ†é’Ÿï¼Œå…·ä½“æ•°å€¼å¯ä»¥æ ¹æ®ä¸šåŠ¡é‡è¦å®é™…æƒ…å†µä¿®æ”¹ï¼‰ ","date":"2023-09-09","objectID":"/%E8%B0%83%E6%95%B4%E8%8A%82%E7%82%B9pod%E9%A9%B1%E9%80%90%E6%97%B6%E9%97%B4/:2:0","tags":["Kubernetes"],"title":"è°ƒæ•´èŠ‚ç‚¹podé©±é€æ—¶é—´","uri":"/%E8%B0%83%E6%95%B4%E8%8A%82%E7%82%B9pod%E9%A9%B1%E9%80%90%E6%97%B6%E9%97%B4/"},{"categories":["docker"],"content":"CGroupsä¸Namespaces æ‘˜è¦\räº†è§£ä¸‹å®¹å™¨èƒŒåçš„ä¸¤å¤§æ ¸å¿ƒæŠ€æœ¯ï¼šCGroups å’Œ Namespaceã€‚\r","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:0:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"CGroups æ¦‚è¿° CGroups å…¨ç§°ä¸º Linux Control Groupï¼Œå…¶ä½œç”¨æ˜¯é™åˆ¶ä¸€ç»„è¿›ç¨‹ä½¿ç”¨çš„èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ä¸Šé™ï¼ŒCGroups ä¹Ÿæ˜¯ Containerd å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒå®ç°åŸç†ä¹‹ä¸€ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ª CGroups çš„åŸºæœ¬æ¦‚å¿µï¼š Task: åœ¨ cgroup ä¸­ï¼Œtask å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†è¿™é‡Œçš„è¿›ç¨‹å’Œä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸å¤ªä¸€æ ·ï¼Œå®é™…ä¸Šæ˜¯è¿›ç¨‹ ID å’Œçº¿ç¨‹ ID åˆ—è¡¨ã€‚ CGroup: å³æ§åˆ¶ç»„ï¼Œä¸€ä¸ªæ§åˆ¶ç»„å°±æ˜¯ä¸€ç»„æŒ‰ç…§æŸç§æ ‡å‡†åˆ’åˆ†çš„ Tasksï¼Œå¯ä»¥ç†è§£ä¸ºèµ„æºé™åˆ¶æ˜¯ä»¥è¿›ç¨‹ç»„ä¸ºå•ä½å®ç°çš„ï¼Œä¸€ä¸ªè¿›ç¨‹åŠ å…¥åˆ°æŸä¸ªæ§åˆ¶ç»„åï¼Œå°±ä¼šå—åˆ°ç›¸åº”é…ç½®çš„èµ„æºé™åˆ¶ã€‚ Hierarchy: cgroup çš„å±‚çº§ç»„ç»‡å…³ç³»ï¼Œcgroup ä»¥æ ‘å½¢å±‚çº§ç»„ç»‡ï¼Œæ¯ä¸ª cgroup å­èŠ‚ç‚¹é»˜è®¤ç»§æ‰¿å…¶çˆ¶ cgroup èŠ‚ç‚¹çš„é…ç½®å±æ€§ï¼Œè¿™æ ·æ¯ä¸ª Hierarchy åœ¨åˆå§‹åŒ–ä¼šæœ‰ root cgroupã€‚ Subsystem: å³å­ç³»ç»Ÿï¼Œå­ç³»ç»Ÿè¡¨ç¤ºå…·ä½“çš„èµ„æºé…ç½®ï¼Œå¦‚ CPU ä½¿ç”¨ï¼Œå†…å­˜å ç”¨ç­‰ï¼ŒSubsystem é™„åŠ åˆ° Hierarchy ä¸Šåå¯ç”¨ CGroups æ”¯æŒçš„å­ç³»ç»ŸåŒ…å«ä»¥ä¸‹å‡ ç±»ï¼Œå³ä¸ºæ¯ç§å¯ä»¥æ§åˆ¶çš„èµ„æºå®šä¹‰äº†ä¸€ä¸ªå­ç³»ç»Ÿ: cpuset: ä¸º cgroup ä¸­çš„è¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPU èŠ‚ç‚¹ï¼Œå³å¯ä»¥ç»‘å®šåˆ°ç‰¹å®šçš„ CPU cpu: é™åˆ¶ cgroup ä¸­è¿›ç¨‹çš„ CPU ä½¿ç”¨ä»½é¢ cpuacct: ç»Ÿè®¡ cgroup ä¸­è¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µ memory: é™åˆ¶ cgroup ä¸­è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨,å¹¶èƒ½æŠ¥å‘Šå†…å­˜ä½¿ç”¨æƒ…å†µ devices: æ§åˆ¶ cgroup ä¸­è¿›ç¨‹èƒ½è®¿é—®å“ªäº›æ–‡ä»¶è®¾å¤‡(è®¾å¤‡æ–‡ä»¶çš„åˆ›å»ºã€è¯»å†™) freezer: æŒ‚èµ·æˆ–æ¢å¤ cgroup ä¸­çš„ task net_cls: å¯ä»¥æ ‡è®° cgroups ä¸­è¿›ç¨‹çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ tc æ¨¡å—(traffic contro)å¯¹æ•°æ®åŒ…è¿›è¡Œæ§åˆ¶ blkio: é™åˆ¶ cgroup ä¸­è¿›ç¨‹çš„å—è®¾å¤‡ IO perf_event: ç›‘æ§ cgroup ä¸­è¿›ç¨‹çš„ perf æ—¶é—´ï¼Œå¯ç”¨äºæ€§èƒ½è°ƒä¼˜ hugetlb: hugetlb çš„èµ„æºæ§åˆ¶åŠŸèƒ½ pids: é™åˆ¶ cgroup ä¸­å¯ä»¥åˆ›å»ºçš„è¿›ç¨‹æ•° net_prio: å…è®¸ç®¡ç†å‘˜åŠ¨æ€çš„é€šè¿‡å„ç§åº”ç”¨ç¨‹åºè®¾ç½®ç½‘ç»œä¼ è¾“çš„ä¼˜å…ˆçº§ é€šè¿‡ä¸Šé¢çš„å„ä¸ªå­ç³»ç»Ÿï¼Œå¯ä»¥çœ‹å‡ºä½¿ç”¨ CGroups å¯ä»¥æ§åˆ¶çš„èµ„æºæœ‰: CPUã€å†…å­˜ã€ç½‘ç»œã€IOã€æ–‡ä»¶è®¾å¤‡ç­‰ã€‚CGroups å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š CGroups çš„ API ä»¥ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆ/sys/fs/cgroup/ï¼‰çš„å®ç°æ–¹å¼ï¼Œç”¨æˆ·çš„ç¨‹åºå¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿå®ç° CGroups çš„ç»„ä»¶ç®¡ç† CGroups çš„ç»„ä»¶ç®¡ç†æ“ä½œå•å…ƒå¯ä»¥ç»†ç²’åº¦åˆ°çº¿ç¨‹çº§åˆ«ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºå’Œé”€æ¯ CGroupsï¼Œä»è€Œå®ç°èµ„æºè½½åˆ†é…å’Œå†åˆ©ç”¨ æ‰€æœ‰èµ„æºç®¡ç†çš„åŠŸèƒ½éƒ½ä»¥å­ç³»ç»Ÿï¼ˆcpuã€cpuset è¿™äº›ï¼‰çš„æ–¹å¼å®ç°ï¼Œæ¥å£ç»Ÿä¸€å­ä»»åŠ¡åˆ›å»ºä¹‹åˆä¸å…¶çˆ¶ä»»åŠ¡å¤„äºåŒä¸€ä¸ª CGroups çš„æ§åˆ¶ç»„ æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ /proc/cgroups æ–‡ä»¶æ¥æŸ¥æ‰¾å½“å‰ç³»ç»Ÿæ”¯æŒçš„ CGroups å­ç³»ç»Ÿ: $ cat /proc/cgroups #subsys_name hierarchy num_cgroups enabled cpuset 5 153 1 cpu 8 478 1 cpuacct 8 478 1 memory 3 478 1 devices 9 478 1 freezer 4 153 1 net_cls 6 153 1 blkio 10 478 1 perf_event 2 153 1 hugetlb 7 153 1 pids 11 478 1 net_prio 6 153 åœ¨ä½¿ç”¨ CGroups æ—¶éœ€è¦å…ˆæŒ‚è½½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ df -h | grep cgroup å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹: $ df -h | grep cgroup tmpfs 7.8G 0 7.8G 0% /sys/fs/cgroup å¯ä»¥çœ‹åˆ°è¢«æŒ‚è½½åˆ°äº† /sys/fs/cgroupï¼Œcgroup å…¶å®æ˜¯ä¸€ç§æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡æ–‡ä»¶æ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mount â€“type cgroupå‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»ŸæŒ‚è½½äº†å“ªäº› cgroupï¼š $ mount --type cgroup cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd) cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event) cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory) cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer) cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls) cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb) cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu) cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices) cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio) cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids) /sys/fs/cgroup ç›®å½•ä¸‹çš„æ¯ä¸ªå­ç›®å½•å°±å¯¹åº”ç€ä¸€ä¸ªå­ç³»ç»Ÿï¼Œcgroup æ˜¯ä»¥ç›®å½•å½¢å¼ç»„ç»‡çš„ï¼Œ/ æ˜¯ cgroup çš„æ ¹ç›®å½•ï¼Œä½†æ˜¯è¿™ä¸ªæ ¹ç›®å½•å¯ä»¥è¢«æŒ‚è½½åˆ°ä»»æ„ç›®å½•ï¼Œä¾‹å¦‚ CGroups çš„ memory å­ç³»ç»Ÿçš„æŒ‚è½½ç‚¹æ˜¯ /sys/fs/cgroup/memoryï¼Œé‚£ä¹ˆ /sys/fs/cgroup/memory/ å¯¹åº” memory å­ç³»ç»Ÿçš„æ ¹ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºè¯¥ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼š $ ll /sys/fs/cgroup/memory/ total 0 -rw-r--r-- 1 root root 0 Aug 8 2022 cgroup.clone_children --w--w--w- 1 root root 0 Aug 8 2022 cgroup.event_control -rw-r--r-- 1 root root 0 Aug 8 2022 cgroup.procs -r--r--r-- 1 root root 0 Aug 8 2022 cgroup.sane_behavior drwxr-xr-x 5 root root 0 Aug 28 14:38 docker drwxr-xr-x 5 root root 0 Sep 6 14:01 kubepods -rw-r--r-- 1 root root 0 Aug 8 2022 memory.failcnt --w------- 1 root root 0 Aug 8 2022 memory.force_empty -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.failcnt -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.limit_in_bytes -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.max_usage_in_bytes -r--r--r-- 1 root root 0 Aug 8 2022 memory.kmem.slabinfo -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.tcp.failcnt -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.tcp.limit_in_bytes -rw-r--r-- 1 root root 0 Aug 8 2022 memory.kmem.tcp.max_usage_in_bytes -r--r--r-- 1 root root 0 Aug 8 2022 memory.kmem.tcp.usage_in_bytes -r--r--r-- 1 ","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:1:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"CGroup æµ‹è¯• æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å°è¯•æ‰‹åŠ¨è®¾ç½®ä¸‹ cgroupï¼Œä»¥ CPU è¿™ä¸ªå­ç³»ç»Ÿä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨ /sys/fs/cgroup/cpu ç›®å½•ä¸‹é¢åˆ›å»ºä¸€ä¸ªåä¸º ydzs.test çš„ç›®å½•ï¼š $ mkdir -p /sys/fs/cgroup/cpu/ydzs.test $ ls /sys/fs/cgroup/cpu/ydzs.test/ cgroup.clone_children cpuacct.stat cpu.cfs_period_us cpu.rt_runtime_us notify_on_release cgroup.event_control cpuacct.usage cpu.cfs_quota_us cpu.shares tasks cgroup.procs cpuacct.usage_percpu cpu.rt_period_us cpu.stat æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å½•åˆ›å»ºå®Œæˆåï¼Œä¸‹é¢å°±ä¼šå·²ç»è‡ªåŠ¨åˆ›å»º cgroup çš„ç›¸å…³æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ cpu.cfs_period_us å’Œ cpu.cfs_quota_us è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‰é¢ä¸€ä¸ªæ˜¯ç”¨æ¥é…ç½® CPU æ—¶é—´å‘¨æœŸé•¿åº¦çš„ï¼Œé»˜è®¤ä¸º 100000usï¼Œåè€…ç”¨æ¥è®¾ç½®åœ¨æ­¤æ—¶é—´å‘¨æœŸé•¿åº¦å†…æ‰€èƒ½ä½¿ç”¨çš„ CPU æ—¶é—´æ•°ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¡¨ç¤ºä¸å—æ—¶é—´é™åˆ¶ã€‚ $ cat /sys/fs/cgroup/cpu/ydzs.test/cpu.cfs_period_us 100000 $ cat /sys/fs/cgroup/cpu/ydzs.test/cpu.cfs_quota_us -1 ç°åœ¨æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ Python è„šæœ¬æ¥æ¶ˆè€— CPUï¼š # cgroup.py while True: pass ç›´æ¥æ‰§è¡Œè¿™ä¸ªæ­»å¾ªç¯è„šæœ¬å³å¯ï¼š $ python cgroup.py \u0026 [1] 2113 ä½¿ç”¨ top å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿›ç¨‹å· 2113 çš„ CPU ä½¿ç”¨ç‡è¾¾åˆ°äº† 100% ç°åœ¨æˆ‘ä»¬å°†è¿™ä¸ªè¿›ç¨‹ ID å†™å…¥åˆ° /sys/fs/cgroup/cpu/ydzs.test/tasks æ–‡ä»¶ä¸‹é¢å»ï¼Œç„¶åè®¾ç½® /sys/fs/cgroup/cpu/ydzs.test/cpu.cfs_quota_us ä¸º 10000usï¼Œå› ä¸º cpu.cfs_period_us é»˜è®¤å€¼ä¸º 100000usï¼Œæ‰€ä»¥è¿™è¡¨ç¤ºæˆ‘ä»¬è¦é™åˆ¶ CPU ä½¿ç”¨ç‡ä¸º 10%ï¼š $ echo 2113 \u003e /sys/fs/cgroup/cpu/ydzs.test/tasks $ echo 10000 \u003e /sys/fs/cgroup/cpu/ydzs.test/cpu.cfs_quota_us è®¾ç½®å®Œè¿‡åä¸Šé¢æˆ‘ä»¬çš„æµ‹è¯•è¿›ç¨‹ CPU å°±ä¼šè¢«é™åˆ¶åœ¨ 10% å·¦å³äº†ï¼Œå†æ¬¡ä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹è¯¥è¿›ç¨‹å¯ä»¥éªŒè¯ã€‚ å¦‚æœè¦é™åˆ¶å†…å­˜ç­‰å…¶ä»–èµ„æºçš„è¯ï¼ŒåŒæ ·å»å¯¹åº”çš„å­ç³»ç»Ÿä¸‹é¢è®¾ç½®èµ„æºï¼Œå¹¶å°†è¿›ç¨‹ ID åŠ å…¥ tasks ä¸­å³å¯ã€‚å¦‚æœè¦åˆ é™¤è¿™ä¸ª cgroupï¼Œç›´æ¥åˆ é™¤æ–‡ä»¶å¤¹æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦ä½¿ç”¨ libcgroup å·¥å…·ï¼š $ yum install libcgroup libcgroup-tools $ cgdelete cpu:ydzs.test $ ls /sys/fs/cgroup/cpu/ydzs.test ls: cannot access /sys/fs/cgroup/cpu/ydzs.test: No such file or directory ","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:2:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"åœ¨å®¹å™¨ä¸­ä½¿ç”¨ CGroups ä¸Šé¢æˆ‘ä»¬æµ‹è¯•äº†ä¸€ä¸ªæ™®é€šåº”ç”¨å¦‚ä½•é…ç½® cgroupï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ Containerd çš„å®¹å™¨ä¸­æ¥ä½¿ç”¨ cgroupï¼Œæ¯”å¦‚ä½¿ç”¨ nerdctl å¯åŠ¨ä¸€ä¸ª nginx å®¹å™¨ï¼Œå¹¶é™åˆ¶å…¶ä½¿ç”¨å†…å­˜ä¸º 50M: $ nerdctl run -d -m 50m --name nginx nginx:alpine 8690c7dba4ffe03d63983555c594e2784c146b5f9939de1195a9626339c9129c $ nerdctl ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 8690c7dba4ff docker.io/library/nginx:alpine \"/docker-entrypoint.â€¦\" 53 seconds ago Up nginx åœ¨ä½¿ç”¨ nerdctl run å¯åŠ¨å®¹å™¨çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ -m æˆ– â€“memory å‚æ•°æ¥é™åˆ¶å†…å­˜ï¼Œå¯åŠ¨å®Œæˆåè¯¥å®¹å™¨çš„ cgroup ä¼šå‡ºç°åœ¨ åä¸º default çš„ç›®å½•ä¸‹é¢ï¼Œæ¯”å¦‚æŸ¥çœ‹å†…å­˜å­ç³»ç»Ÿçš„ç›®å½•ï¼š $ ll /sys/fs/cgroup/memory/default/ total 0 drwxr-xr-x 2 root root 0 Oct 21 15:01 8690c7dba4ffe03d63983555c594e2784c146b5f9939de1195a9626339c9129c -rw-r--r-- 1 root root 0 Oct 21 15:01 cgroup.clone_children --w--w--w- 1 root root 0 Oct 21 15:01 cgroup.event_control -rw-r--r-- 1 root root 0 Oct 21 15:01 cgroup.procs ...... ä¸Šé¢æˆ‘ä»¬å¯åŠ¨çš„ nginx å®¹å™¨ ID çš„ç›®å½•ä¼šå‡ºç°åœ¨ /sys/fs/cgroup/memory/default/ ä¸‹é¢ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹é¢æœ‰å¾ˆå¤šå’Œå†…å­˜ç›¸å…³çš„ cgroup é…ç½®æ–‡ä»¶ï¼Œè¦è¿›è¡Œç›¸å…³çš„é…ç½®å°±éœ€è¦åœ¨è¯¥ç›®å½•ä¸‹å¯¹åº”çš„æ–‡ä»¶ä¸­å»æ“ä½œï¼š $ ll /sys/fs/cgroup/memory/default/8690c7dba4ffe03d63983555c594e2784c146b5f9939de1195a9626339c9129c total 0 -rw-r--r-- 1 root root 0 Oct 21 15:01 cgroup.clone_children --w--w--w- 1 root root 0 Oct 21 15:01 cgroup.event_control -rw-r--r-- 1 root root 0 Oct 21 15:01 cgroup.procs -rw-r--r-- 1 root root 0 Oct 21 15:01 memory.failcnt --w------- 1 root root 0 Oct 21 15:01 memory.force_empty -rw-r--r-- 1 root root 0 Oct 21 15:01 memory.kmem.failcnt æˆ‘ä»¬è¿™é‡Œéœ€è¦å…³å¿ƒçš„æ˜¯ memory.limit_in_bytes æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯ç”¨æ¥è®¾ç½®å†…å­˜å¤§å°çš„ï¼Œæ­£å¸¸åº”è¯¥æ˜¯ 50M çš„å†…å­˜é™åˆ¶ï¼š $ cat /sys/fs/cgroup/memory/default/8690c7dba4ffe03d63983555c594e2784c146b5f9939de1195a9626339c9129c/memory.limit_in_bytes 52428800 åŒæ ·æˆ‘ä»¬çš„ nginx å®¹å™¨è¿›ç¨‹ ID ä¹Ÿä¼šå‡ºç°åœ¨ä¸Šé¢çš„ tasks æ–‡ä»¶ä¸­ï¼š $ cat /sys/fs/cgroup/memory/default/8690c7dba4ffe03d63983555c594e2784c146b5f9939de1195a9626339c9129c/tasks 2686 2815 2816 2817 2818 æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿‡æ»¤è¯¥è¿›ç¨‹å·ï¼Œå¯ä»¥çœ‹å‡ºç¬¬ä¸€è¡Œçš„ 2686 å°±æ˜¯ nginx è¿›ç¨‹åœ¨ä¸»æœºä¸Šçš„è¿›ç¨‹ IDï¼Œä¸‹é¢å‡ ä¸ªæ˜¯è¿™ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹ï¼š $ ps -ef | grep 2686 root 2686 2656 0 15:01 ? 00:00:00 nginx: master process nginx -g daemon off; 101 2815 2686 0 15:01 ? 00:00:00 nginx: worker process 101 2816 2686 0 15:01 ? 00:00:00 nginx: worker process 101 2817 2686 0 15:01 ? 00:00:00 nginx: worker process 101 2818 2686 0 15:01 ? 00:00:00 nginx: worker process root 2950 1976 0 15:36 pts/0 00:00:00 grep --color=auto 2686 æˆ‘ä»¬åˆ é™¤è¿™ä¸ªå®¹å™¨åï¼Œ/sys/fs/cgroup/memory/default/ ç›®å½•ä¸‹çš„å®¹å™¨ ID æ–‡ä»¶å¤¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ã€‚ ","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:3:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"Namespaces namespace ä¹Ÿç§°å‘½åç©ºé—´ï¼Œæ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºéš”ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•ã€‚åœ¨æ—¥å¸¸ä½¿ç”¨ä¸ªäºº PC æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿è¡Œå¤šä¸ªå®Œå…¨åˆ†ç¦»çš„æœåŠ¡å™¨çš„éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›æœåŠ¡å…¶å®ä¼šç›¸äº’å½±å“çš„ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½èƒ½çœ‹åˆ°å…¶ä»–æœåŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œä¸€æ—¦æœåŠ¡å™¨ä¸Šçš„æŸä¸€ä¸ªæœåŠ¡è¢«å…¥ä¾µï¼Œé‚£ä¹ˆå…¥ä¾µè€…å°±èƒ½å¤Ÿè®¿é—®å½“å‰æœºå™¨ä¸Šçš„æ‰€æœ‰æœåŠ¡å’Œæ–‡ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒæœåŠ¡èƒ½åšåˆ°å®Œå…¨éš”ç¦»ï¼Œå°±åƒè¿è¡Œåœ¨å¤šå°ä¸åŒçš„æœºå™¨ä¸Šä¸€æ ·ã€‚è€Œæˆ‘ä»¬è¿™é‡Œçš„å®¹å™¨å…¶å®å°±é€šè¿‡ Linux çš„ Namespaces æŠ€æœ¯æ¥å®ç°çš„å¯¹ä¸åŒçš„å®¹å™¨è¿›è¡Œéš”ç¦»ã€‚ linux å…±æœ‰ 6(7)ç§å‘½åç©ºé—´: ipc namespace: ç®¡ç†å¯¹ IPC èµ„æºï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼ˆä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ï¼‰çš„è®¿é—® net namespace: ç½‘ç»œè®¾å¤‡ã€ç½‘ç»œæ ˆã€ç«¯å£ç­‰éš”ç¦» mnt namespace: æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹éš”ç¦» pid namespace: ç”¨äºè¿›ç¨‹éš”ç¦» user namespace: ç”¨æˆ·å’Œç”¨æˆ·ç»„éš”ç¦»ï¼ˆ3.8 ä»¥åçš„å†…æ ¸æ‰æ”¯æŒï¼‰ uts namespace: ä¸»æœºå’ŒåŸŸåéš”ç¦» cgroup namespaceï¼šç”¨äº cgroup æ ¹ç›®å½•éš”ç¦»ï¼ˆ4.6 ä»¥åç‰ˆæœ¬çš„å†…æ ¸æ‰æ”¯æŒï¼‰ æˆ‘ä»¬å¯ä»¥é€šè¿‡ lsns å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå·²ç»åˆ›å»ºçš„å‘½åç©ºé—´ï¼š # lsns|more NS TYPE NPROCS PID USER COMMAND 4026531836 pid 600 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026531837 user 946 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026531838 uts 629 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026531839 ipc 600 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026531840 mnt 591 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026531856 mnt 1 88 root kdevtmpfs 4026531956 net 643 1 root /usr/lib/systemd/systemd --switched-root --system --deserialize 22 4026532450 mnt 1 6635 chrony /usr/sbin/chronyd 4026532451 mnt 1 6660 root /usr/sbin/NetworkManager --no-daemon è¦æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹æ‰€å±çš„å‘½åç©ºé—´ä¿¡æ¯ï¼Œå¯ä»¥åˆ° /proc//ns ç›®å½•ä¸‹æŸ¥çœ‹ï¼š # ps -ef|grep chronyd chrony 6635 1 0 May11 ? 00:00:50 /usr/sbin/chronyd root 17096 25474 0 17:38 pts/1 00:00:00 grep --color=auto chronyd # ll /proc/6635/ns total 0 lrwxrwxrwx 1 root root 0 Sep 11 17:23 ipc -\u003e ipc:[4026531839] lrwxrwxrwx 1 root root 0 Sep 11 17:23 mnt -\u003e mnt:[4026532450] lrwxrwxrwx 1 root root 0 Sep 11 17:23 net -\u003e net:[4026531956] lrwxrwxrwx 1 root root 0 Sep 11 17:23 pid -\u003e pid:[4026531836] lrwxrwxrwx 1 root root 0 Sep 11 17:23 user -\u003e user:[4026531837] lrwxrwxrwx 1 root root 0 Sep 11 17:23 uts -\u003e uts:[4026531838] è¿™äº› namespace éƒ½æ˜¯é“¾æ¥æ–‡ä»¶, æ ¼å¼ä¸º namespaceType:[inode number]ï¼Œinode number ç”¨æ¥æ ‡è¯†ä¸€ä¸ª namespaceï¼Œå¯ä»¥ç†è§£ä¸º namespace idï¼Œå¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„æŸä¸ªå‘½åç©ºé—´çš„é“¾æ¥æ–‡ä»¶æŒ‡å‘åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå…¶ç›¸å…³èµ„æºåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œä¹Ÿå°±æ²¡æœ‰éš”ç¦»äº†ã€‚æ¯”å¦‚åŒæ ·é’ˆå¯¹ä¸Šé¢è¿è¡Œçš„ nginx å®¹å™¨ï¼Œæˆ‘ä»¬æŸ¥çœ‹å…¶å‘½åç©ºé—´ï¼š # lsns |grep nginx 4026533147 mnt 17 25233 10000 nginx: master process nginx -g daemon off 4026533148 uts 17 25233 10000 nginx: master process nginx -g daemon off 4026533149 ipc 17 25233 10000 nginx: master process nginx -g daemon off 4026533150 pid 17 25233 10000 nginx: master process nginx -g daemon off 4026533152 net 17 25233 10000 nginx: master process nginx -g daemon off 4026533313 mnt 17 25604 10000 nginx: master process nginx -g daemon off 4026533314 uts 17 25604 10000 nginx: master process nginx -g daemon off 4026533315 ipc 17 25604 10000 nginx: master process nginx -g daemon off 4026533316 pid 17 25604 10000 nginx: master process nginx -g daemon off 4026533318 net 17 25604 10000 nginx: master process nginx -g daemon off å¯ä»¥çœ‹å‡º nginx å®¹å™¨å¯åŠ¨åï¼Œå·²ç»ä¸ºè¯¥å®¹å™¨è‡ªåŠ¨åˆ›å»ºäº†å•ç‹¬çš„ mtnã€utsã€ipcã€pidã€net å‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå®¹å™¨åœ¨è¿™äº›æ–¹é¢æ˜¯ç‹¬ç«‹éš”ç¦»çš„ï¼Œå…¶ä»–å®¹å™¨æƒ³è¦å’Œè¯¥å®¹å™¨å…±äº«æŸä¸€ä¸ªå‘½åç©ºé—´ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‡å‘åŒä¸€ä¸ªå‘½åç©ºé—´ã€‚ ","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:4:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"å‚è€ƒ https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/ https://www.infoq.cn/article/docker-resource-management-cgroups/ ","date":"2023-06-26","objectID":"/cgroups%E4%B8%8Enamespaces/:5:0","tags":["docker"],"title":"CGroupsä¸Namespaces","uri":"/cgroups%E4%B8%8Enamespaces/"},{"categories":["docker"],"content":"ä»‹ç» Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„ æŒ‡ä»¤(Instruction)ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤ æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚ ä¸€ä¸ªç®€å•Dockerfileæ–‡ä»¶ # VERSION 0.0.1 FROM ubuntu MAINTAINER James Turnbull \"james@example.com\" RUN echo \"deb http://archive.ubuntu.com/ubuntu precise main â†© universe\" \u003e /etc/apt/sources.list RUN apt-get update RUN apt-get install -y openssh-server RUN mkdir /var/run/sshd RUN echo \"root:password\" | chpasswd EXPOSE 22 å¯ä»¥çœ‹çš„å‡ºæ¥Dockerfile åŒ…å«ä¸€ç³»åˆ—å‘½ä»¤å¹¶é™„ä¸Šå‚æ•° æ¯ä¸ªå‘½ä»¤éƒ½æ˜¯å¤§å†™å¼€å¤´ï¼Œåé¢æ˜¯è·Ÿç€å‚æ•° ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:0:0","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"Dockerfile å‘½ä»¤ å‘½ä»¤ è§£é‡Š FROM æŒ‡å®šåŸºç¡€é•œåƒ RUN Dockerfileä¸­çš„æ¯ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ CMD åœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ EXPOSE æš´éœ²ç«¯å£ ENV è®¾ç½®ç¯å¢ƒå˜é‡ COPY æ‹·è´æœ¬åœ°æ–‡ä»¶å’Œç›®å½•è‡³é•œåƒ ADD åŠŸèƒ½æ›´ä¸°å¯Œçš„æ·»åŠ æ‹·è´æŒ‡ä»¤ï¼ŒCOPYä¼˜å…ˆäºADD ENTRYPOINT ENTRYPOINTæŒ‡ä»¤å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼ŒENTRYPOINTæ˜¯ä¸€ä¸ªè„šæœ¬ VOLUME å®šä¹‰é•œåƒä¸­çš„æŸä¸ªç›®å½•ä¸ºå®¹å™¨å·ï¼Œä¼šéšæœºç”Ÿæˆä¸€ä¸ªå®¹å™¨å·å WORKDIR æŒ‡å®šå·¥ä½œç›®å½• ARG å®šä¹‰äº†å¯ä»¥é€šè¿‡docker build â€“build-argå‘½ä»¤ä¼ é€’å¹¶åœ¨Dockerfileä¸­ä½¿ç”¨çš„å˜é‡ã€‚ ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:1:0","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"Dockerfile å°å»ºè®® è¦ä½¿ç”¨ tagï¼Œä½†ä¸è¦ latestã€‚ Debian æŒºå¥½çš„ï¼Œä¸è¦æ€» Ubuntuã€‚ apt-get update åœ¨å‰ï¼Œrm -rf /var/lib/apt/lists/* åœ¨åã€‚ yum installï¼Œä¸å¿˜ yum cleanã€‚ å¤š RUN è¦åˆå¹¶ï¼Œæ¥å‡å°‘å±‚æ•°ã€‚ æ— ç”¨çš„è½¯ä»¶ï¼Œä¸è¦ä¹±å®‰è£…ã€‚ COPY æ”¾æœ€åï¼Œç¼“å­˜å¾ˆå¼€å¿ƒã€‚ å–„ç”¨ dockerignoreï¼Œä¸æµªè´¹ä¼ è¾“ã€‚ ä¸å¿˜ MAINTAINERï¼Œè¿™éƒ½æ˜¯æˆ‘çš„ã€‚ å®¹å™¨åªè¿è¡Œä¸€ä¸ªåº”ç”¨ æ‘˜è¦\rå°ç»“ï¼š ï¼ˆFROMï¼‰é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ(alpineç‰ˆæœ¬æœ€å¥½) (RUN)åœ¨å®‰è£…æ›´æ–°æ—¶å‹¿å¿˜åˆ é™¤ç¼“å­˜å’Œå®‰è£…åŒ…ï¼Œ å¤šä¸ªå‘½ä»¤èšåˆåœ¨ä¸€èµ·å‡å°‘æ„å»ºæ—¶çš„å±‚æ•°ï¼Œç”¨ä¸åˆ°çš„è½¯ä»¶ä¸è¦å®‰è£… (ADDå’ŒCOPY)é€‰COPY ï¼ˆLABELï¼‰æ·»åŠ é•œåƒå…ƒæ•°æ®ï¼Œ (MAINTAINER)è®©æˆ‘çŸ¥é“æ˜¯è°ç»´æŠ¤æˆ‘ (ENV)è®¾ç½®é»˜è®¤çš„ç¯å¢ƒå˜é‡ ï¼ˆEXPOSEï¼‰è¯´ä¸€ä¸‹æš´éœ²çš„æ˜ å°„ç«¯å£\r","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:2:0","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"è§„çº¦ å„å›¢é˜Ÿå°½é‡ä½¿ç”¨ç»Ÿä¸€çš„åŸºç¡€é•œåƒã€‚æˆ‘ä»¬å»ºç«‹å¹¶ç»´æŠ¤å…¬å¸ç»Ÿä¸€çš„åŸºç¡€é•œåƒåˆ—è¡¨ï¼Œè¯·å‚è§: javaåº”ç”¨ä½¿ç”¨çš„åŸºç¡€é•œåƒ å‡å°‘Dockerfileçš„è¡Œæ•°ï¼Œä½¿ç”¨\u0026\u0026è¿æ¥å¤šä¸ªå‘½ä»¤ï¼Œå› ä¸ºæ¯ä¸€è¡Œå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ å°†å¢åŠ æ–‡ä»¶å’Œæ¸…ç†æ–‡ä»¶çš„åŠ¨ä½œæ”¾åˆ°ä¸€è¡Œé‡Œé¢ï¼Œæ¯”å¦‚yum installå’Œyum clean allï¼Œå¦‚æœåˆ†ä¸ºä¸¤è¡Œï¼Œç¬¬äºŒæ¡æ¸…ç†åŠ¨ä½œå°±æ— æ³•çœŸæ­£åˆ é™¤æ–‡ä»¶ åªå¤åˆ¶éœ€è¦çš„æ–‡ä»¶ï¼Œå¦‚æœæ•´ä¸ªç›®å½•å¤åˆ¶ï¼Œä¸€å®šè¦ä»”ç»†æ£€æŸ¥ç›®å½•ä¸‹æ˜¯å¦æœ‰éšè—æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ç­‰ä¸éœ€è¦çš„å†…å®¹ å®¹å™¨é•œåƒè‡ªèº«æœ‰å‹ç¼©æœºåˆ¶ï¼Œå› æ­¤æŠŠæ–‡ä»¶å‹ç¼©æˆå‹ç¼©æ–‡ä»¶ç„¶åæ‰“å…¥å®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ—¶è§£å‹çš„æ–¹æ³•å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆæ•ˆæœ é¿å…å‘ç”Ÿäº§é•œåƒæ‰“å…¥ä¸€äº›ä¸å¿…è¦çš„å·¥å…·ï¼Œæ¯”å¦‚æœ‰çš„å›¢é˜Ÿæ‰“å…¥äº†sshdï¼Œä¸åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œå¢åŠ å®‰å…¨é£é™© å°½é‡ç²¾ç®€å®‰è£…çš„å†…å®¹ï¼Œæ¯”å¦‚åªå®‰è£…å·¥å…·çš„è¿è¡Œæ—¶ï¼Œæ— é¡»å¸¦ä¸Šå¸®åŠ©æ–‡æ¡£ã€æºç ã€æ ·ä¾‹ç­‰ç­‰ ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:3:0","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"ç¤ºä¾‹ ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:4:0","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"nginx FROM centos MAINTAINER xianchao RUN yum install wget -y RUN yum install nginx -y # COPY index.html /usr/share/nginx/html/ EXPOSE 80 ENTRYPOINT [\"/usr/sbin/nginx\",\"-g\",\"daemon off;\"] ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:4:1","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"tomcat FROM centos MAINTAINER xianchao RUN yum install wget -y ADD jdk-8u45-linux-x64.rpm /usr/local/ ADD apache-tomcat-8.0.26.tar.gz /usr/local/ RUN cd /usr/local \u0026\u0026 rpm -ivh jdk-8u45-linux-x64.rpm RUN mv /usr/local/apache-tomcat-8.0.26 /usr/local/tomcat8 ENTRYPOINT /usr/local/tomcat8/bin/startup.sh \u0026\u0026 tail -F /usr/local/tomcat8/logs/catalina.out EXPOSE 8080 ","date":"2023-06-26","objectID":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/:4:2","tags":["docker"],"title":"Dockerfileä»‹ç»åŠä¼˜åŒ–","uri":"/dockerfile%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["docker"],"content":"å¹³æ—¶è¾ƒå¤šä½¿ç”¨çš„æ˜¯dockeré¡¹ç›®å°†å®¹å™¨è¿è¡Œæ—¶è¿ç§»è‡³äº†containerdï¼Œè¿™é‡Œæ•´ç†ä¸‹ç›¸å…³çš„æ“ä½œå‘½ä»¤ ","date":"2023-06-26","objectID":"/%E4%BB%8Edocker%E8%87%B3containerd/:0:0","tags":["docker","containerd"],"title":"ä»Dockerè‡³Containerd","uri":"/%E4%BB%8Edocker%E8%87%B3containerd/"},{"categories":["docker"],"content":"å¸¸ç”¨æŒ‡ä»¤å¯¹æ¯” ctræ˜¯containerdè‡ªå¸¦çš„å·¥å…·ï¼Œæœ‰å‘½åç©ºé—´çš„æ¦‚å¿µ crictlæ˜¯k8sç¤¾åŒºçš„ä¸“ç”¨CLIå·¥å…·ï¼Œæ‰€æœ‰æ“ä½œéƒ½åœ¨å‘½åç©ºé—´k8s.io æ‰€ä»¥ä½¿ç”¨ctræ“ä½œæ—¶æ³¨æ„æŒ‡å®š-n k8s.io Docker vs Containerd\r","date":"2023-06-26","objectID":"/%E4%BB%8Edocker%E8%87%B3containerd/:1:0","tags":["docker","containerd"],"title":"ä»Dockerè‡³Containerd","uri":"/%E4%BB%8Edocker%E8%87%B3containerd/"},{"categories":["docker"],"content":"æ¸…ç†æœªè¢«ä½¿ç”¨çš„é•œåƒï¼Œä¸€èˆ¬ç”¨äºé‡Šæ”¾æœ¬åœ°ç©ºé—´ docker åœºæ™¯ docker image prune -a containerdåœºæ™¯ï¼ˆéœ€è¦é«˜ç‰ˆæœ¬crictlï¼‰ crictl rmi --prune ","date":"2023-06-26","objectID":"/%E4%BB%8Edocker%E8%87%B3containerd/:2:0","tags":["docker","containerd"],"title":"ä»Dockerè‡³Containerd","uri":"/%E4%BB%8Edocker%E8%87%B3containerd/"},{"categories":["docker"],"content":"æœ¬åœ°æ–‡ä»¶å’Œå®¹å™¨å†…æ–‡ä»¶é—´æ‹·è´ docker åœºæ™¯ docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|- docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH ä½¿ç”¨kubectl cp Copy files and directories to and from containers. Examples: # !!!Important Note!!! # Requires that the 'tar' binary is present in your container # image. If 'tar' is not present, 'kubectl cp' will fail. # Copy /tmp/foo_dir local directory to /tmp/bar_dir in a remote pod in the default namespace kubectl cp /tmp/foo_dir \u003csome-pod\u003e:/tmp/bar_dir # Copy /tmp/foo local file to /tmp/bar in a remote pod in a specific container kubectl cp /tmp/foo \u003csome-pod\u003e:/tmp/bar -c \u003cspecific-container\u003e # Copy /tmp/foo local file to /tmp/bar in a remote pod in namespace \u003csome-namespace\u003e kubectl cp /tmp/foo \u003csome-namespace\u003e/\u003csome-pod\u003e:/tmp/bar # Copy /tmp/foo from a remote pod to /tmp/bar locally kubectl cp \u003csome-namespace\u003e/\u003csome-pod\u003e:/tmp/foo /tmp/bar Options: -c, --container='': Container name. If omitted, the first container in the pod will be chosen --no-preserve=false: The copied file/directory's ownership and permissions will not be preserved in the container Usage: kubectl cp \u003cfile-spec-src\u003e \u003cfile-spec-dest\u003e [options] Use \"kubectl options\" for a list of global command-line options (applies to all commands). ","date":"2023-06-26","objectID":"/%E4%BB%8Edocker%E8%87%B3containerd/:3:0","tags":["docker","containerd"],"title":"ä»Dockerè‡³Containerd","uri":"/%E4%BB%8Edocker%E8%87%B3containerd/"},{"categories":["Kubernetes"],"content":"k8s namespace æ— æ³•åˆ é™¤è®°å½• åå­—ç©ºé—´yaml æ–‡ä»¶ kind: Namespace apiVersion: v1 metadata: name: kube-logging åˆ é™¤å¡ä½ $ sudo kubectl delete -f kube-logging.yaml --wait=true namespace \"kube-logging\" deleted # é•¿ä¹…çš„ç­‰å¾… å¼ºåˆ¶åˆ é™¤ï¼ˆæ— æ•ˆæœï¼‰ sudo kubectl delete ns kube-logging --grace-period=0 --force æ’æŸ¥æ€è·¯ æŸ¥çœ‹å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰èµ„æº kubectl api-resources -o name --verbs=list --namespaced | xargs -n 1 kubectl get --show-kind --ignore-not-found -n kube-logging è¾“å‡ºç»“æœè¯¥å‘½åç©ºé—´ä¸‹æ— å…³è”çš„ç›¸å…³èµ„æº ","date":"2023-05-27","objectID":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/:0:0","tags":["Kubernetesæ’éšœ"],"title":"K8såˆ é™¤Namesapceä¸€ç›´å¤„äºTerminatingçŠ¶æ€å¤„ç†","uri":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/"},{"categories":["Kubernetes"],"content":"è§£å†³æ–¹å¼ ä¸€è¡Œå‘½ä»¤è§£å†³ï¼Œæ³¨æ„æ›¿æ¢ä¸¤å¤„å¾…åˆ å‘½åç©ºé—´å­—æ · kubectl get namespace \"å¾…åˆ å‘½åç©ºé—´\" -o json \\ | tr -d \"\\n\" | sed \"s/\\\"finalizers\\\": \\[[^]]\\+\\]/\\\"finalizers\\\": []/\" \\ | kubectl replace --raw /api/v1/namespaces/å¾…åˆ å‘½åç©ºé—´/finalize -f - ","date":"2023-05-27","objectID":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/:0:1","tags":["Kubernetesæ’éšœ"],"title":"K8såˆ é™¤Namesapceä¸€ç›´å¤„äºTerminatingçŠ¶æ€å¤„ç†","uri":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/"},{"categories":["Kubernetes"],"content":"æ€»ç»“ åˆ›å»ºnamesapceæ—¶æ³¨å…¥finalizersä¼šå¯¼è‡´namespaceæ— æ³• å¯ä»¥é€šè¿‡edit ns çš„æ–¹å¼å°†finalizers ç½®ç©ºæˆ–è€…ä¸Šé¢çš„ä¸€è¡Œå‘½ä»¤è§£å†³çš„æ–¹å¼ï¼Œæœ¬è´¨æ˜¯ä¸€è‡´çš„ ","date":"2023-05-27","objectID":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/:0:2","tags":["Kubernetesæ’éšœ"],"title":"K8såˆ é™¤Namesapceä¸€ç›´å¤„äºTerminatingçŠ¶æ€å¤„ç†","uri":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/"},{"categories":["Kubernetes"],"content":"è¡¥å…… K8s Finalizers Finalizers å­—æ®µå±äº Kubernetes GC åƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯ä¸€ç§åˆ é™¤æ‹¦æˆªæœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æ§åˆ¶å™¨å®ç°å¼‚æ­¥çš„åˆ é™¤å‰ï¼ˆPre-deleteï¼‰å›è°ƒã€‚å…¶å­˜åœ¨äºä»»ä½•ä¸€ä¸ªèµ„æºå¯¹è±¡çš„ Meta[1] ä¸­ï¼Œåœ¨ k8s æºç ä¸­å£°æ˜ä¸º []stringï¼Œè¯¥ Slice çš„å†…å®¹ä¸ºéœ€è¦æ‰§è¡Œçš„æ‹¦æˆªå™¨åç§°ã€‚ å¯¹å¸¦æœ‰ Finalizer çš„å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåˆ é™¤è¯·æ±‚ä¼šä¸ºå…¶ metadata.deletionTimestamp è®¾ç½®ä¸€ä¸ªå€¼ï¼Œä½†ä¸ä¼šçœŸçš„åˆ é™¤å¯¹è±¡ã€‚ä¸€æ—¦æ­¤å€¼è¢«è®¾ç½®ï¼Œfinalizers åˆ—è¡¨ä¸­çš„å€¼å°±åªèƒ½è¢«ç§»é™¤ã€‚ å½“ metadata.deletionTimestamp å­—æ®µè¢«è®¾ç½®æ—¶ï¼Œè´Ÿè´£ç›‘æµ‹è¯¥å¯¹è±¡çš„å„ä¸ªæ§åˆ¶å™¨ä¼šé€šè¿‡è½®è¯¢å¯¹è¯¥å¯¹è±¡çš„æ›´æ–°è¯·æ±‚æ¥æ‰§è¡Œå®ƒä»¬æ‰€è¦å¤„ç†çš„æ‰€æœ‰ Finalizerã€‚å½“æ‰€æœ‰ Finalizer éƒ½è¢«æ‰§è¡Œè¿‡ï¼Œèµ„æºè¢«åˆ é™¤ã€‚ metadata.deletionGracePeriodSeconds çš„å–å€¼æ§åˆ¶å¯¹æ›´æ–°çš„è½®è¯¢å‘¨æœŸ å½“ finalizers å­—æ®µä¸ºç©ºæ—¶ï¼Œk8s è®¤ä¸ºåˆ é™¤å·²å®Œæˆã€‚ ","date":"2023-05-27","objectID":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/:0:3","tags":["Kubernetesæ’éšœ"],"title":"K8såˆ é™¤Namesapceä¸€ç›´å¤„äºTerminatingçŠ¶æ€å¤„ç†","uri":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/"},{"categories":["Kubernetes"],"content":"å‚è€ƒ k8s å¦‚ä½•è®© ns æ— æ³•åˆ é™¤ kubernetes_Namespaceæ— æ³•åˆ é™¤çš„è§£å†³æ–¹æ³• K8Sä»æ‡µåœˆåˆ°ç†Ÿç»ƒ - æˆ‘ä»¬ä¸ºä»€ä¹ˆä¼šåˆ é™¤ä¸äº†é›†ç¾¤çš„å‘½åç©ºé—´ï¼Ÿ k8sé—®é¢˜è§£å†³ - åˆ é™¤å‘½åç©ºé—´é•¿æ—¶é—´å¤„äºterminatingçŠ¶æ€ ç†Ÿæ‚‰åˆé™Œç”Ÿçš„ k8s å­—æ®µï¼šfinalizers ","date":"2023-05-27","objectID":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/:1:0","tags":["Kubernetesæ’éšœ"],"title":"K8såˆ é™¤Namesapceä¸€ç›´å¤„äºTerminatingçŠ¶æ€å¤„ç†","uri":"/k8s%E5%88%A0%E9%99%A4namesapce%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86/"},{"categories":["Kubernetes"],"content":"æ•…éšœæè¿° è­¦å‘Š\rPVC æ˜¾ç¤ºåˆ›å»ºä¸æˆåŠŸï¼škubectl get pvc -n efk æ˜¾ç¤º Pendingï¼Œè¿™æ˜¯ç”±äºç‰ˆæœ¬å¤ªé«˜å¯¼è‡´çš„ã€‚k8sv1.20 ä»¥ä¸Šç‰ˆæœ¬é»˜è®¤ç¦æ­¢ä½¿ç”¨ selfLinkã€‚ (selfLinkï¼šé€šè¿‡ API è®¿é—®èµ„æºè‡ªèº«çš„ URLï¼Œä¾‹å¦‚ä¸€ä¸ª Pod çš„ link å¯èƒ½æ˜¯ /api/v1/namespaces/ns36aa8455/pods/sc-cluster-test-1-6bc58d44d6-r8hld)ã€‚\r","date":"2023-05-23","objectID":"/k8s_v1.20.x%E5%88%9B%E5%BB%BApvc%E6%8A%A5%E9%94%99/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes v1.20åˆ›å»ºPVCæŠ¥é”™","uri":"/k8s_v1.20.x%E5%88%9B%E5%BB%BApvc%E6%8A%A5%E9%94%99/"},{"categories":["Kubernetes"],"content":"æ•…éšœè§£å†³ $ vi /etc/kubernetes/manifests/kube-apiserver.yaml apiVersion: v1 Â·Â·Â· - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key - --feature-gates=RemoveSelfLink=false # æ·»åŠ è¿™ä¸ªé…ç½® é‡å¯ä¸‹kube-apiserver.yaml # å¦‚æœæ˜¯äºŒè¿›åˆ¶å®‰è£…çš„ k8sï¼Œæ‰§è¡Œ systemctl restart kube-apiserver # å¦‚æœæ˜¯ kubeadm å®‰è£…çš„ k8s $ ps aux|grep kube-apiserver $ kill -9 [Pid] $ kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml ... $ kubectl get pvc # æŸ¥çœ‹ pvc æ˜¾ç¤º Bound NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE my-pvc Bound pvc-ae9f6d4b-fc4c-4e19-8854-7bfa259a3a04 1Gi RWX example-nfs 13m ","date":"2023-05-23","objectID":"/k8s_v1.20.x%E5%88%9B%E5%BB%BApvc%E6%8A%A5%E9%94%99/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes v1.20åˆ›å»ºPVCæŠ¥é”™","uri":"/k8s_v1.20.x%E5%88%9B%E5%BB%BApvc%E6%8A%A5%E9%94%99/"},{"categories":["Jenkins"],"content":"åœ¨äº†è§£Jenkins ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹CI\u0026CD ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:0:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"cicd ä»‹ç» æŒç»­é›†æˆ(Continous Intergrations) å’ŒæŒç»­éƒ¨ç½²(Continuous Deployment)çš„åŒºåˆ« æŒç»­é›†æˆ(Continous Intergrations) å’ŒæŒç»­éƒ¨ç½²(Continuous Deployment)æ˜¯DevOpsä¸­åŸŸè½¯ä»¶äº¤ä»˜å’Œ éƒ¨ç½²ç›¸å…³çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µ å°½ç®¡ä»–ä»¬çš„ç›®æ ‡æ˜¯ç±»ä¼¼çš„ï¼Œä½†åœ¨å…·ä½“å«ä¹‰ä¸Šå­˜åœ¨ä¸€äº›åŒºåˆ« ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:1:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"æŒç»­é›†æˆCI æŒç»­é›†æˆ(Continous Intergrations) æ˜¯ä¸€ç§å¼€å‘å®è·µï¼Œé€šè¿‡å°†æ¯æ¬¡çš„ä»£ç æ”¹åŠ¨é¢‘ç¹åœ°é›†æˆåˆ° å…±äº«ä»£ç åº“ä¸­ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿å›¢é˜Ÿå¼€å‘çš„ä»£ç èƒ½å¤Ÿå¿«é€Ÿä¸”æ— è¯¯åœ°é›†æˆåœ¨ä¸€èµ· æŒç»­é›†æˆçš„ç›®æ ‡æ˜¯é€šè¿‡é¢‘ç¹çš„é›†æˆä»£ç æ¥å¿«é€Ÿå‘ç°å’Œè§£å†³é›†æˆé—®é¢˜ï¼Œå‡å°‘å†²çªå’Œé”™è¯¯ï¼Œæä¾›å¼€å‘æ•ˆç‡å’Œ ä»£ç è´¨é‡ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:1:1","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"æŒç»­éƒ¨ç½²CD æŒç»­éƒ¨ç½²(Continuous Deployment)æ˜¯åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šæ›´è¿›ä¸€æ­¥ï¼ŒæŒ‡çš„æ˜¯å°†ç»è¿‡ æŒç»­é›†æˆå’Œæµ‹è¯•çš„ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿæˆç¯å¢ƒä¸­ï¼Œä½¿å…¶å¯ä»¥ç«‹å³æä¾›ç”¨æˆ·ä½¿ç”¨ æŒç»­éƒ¨ç½²å¼ºè°ƒè‡ªåŠ¨åŒ–çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å’ŒéªŒè¯ç¡®ä¿ä»£ç çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œ ä½¿æ–°åŠŸèƒ½ã€ä¿®å¤æˆ–è€…æ”¹è¿›èƒ½å¤Ÿå®æ—¶äº¤ä»˜ç»™ç”¨æˆ· ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:1:2","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"Jenkins ä»‹ç» Jenkinsæ˜¯ä¸€æ¬¾å¼€æº CI\u0026CD è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚ Jenkins æ”¯æŒå„ç§è¿è¡Œæ–¹å¼ï¼Œå¯é€šè¿‡ç³»ç»ŸåŒ…ã€Docker æˆ–è€…é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„ Java ç¨‹åºã€‚ è¯´æ˜ Jenkins æ˜¯CI\u0026CD å®ç°æ–¹å¼çš„ä¸€ç§ï¼Œè¿˜æœ‰å…¶å®ƒå¾ˆå¤šç§ç±»ä¼¼çš„å·¥å…·,ä¸è¿‡ä½¿ç”¨äºç‰¹å®šçš„åœºæ™¯ï¼Œåªä¸è¿‡åœ¨ä¸šç•Œ Jenkins æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:2:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"Jenkins åŒç±»CICDå·¥å…·äº†è§£ GitLab CI/CD: GitLab çš„é›†æˆ CI/CD åŠŸèƒ½ï¼Œå¯ä»¥ä¸ GitLab ä»£ç ä»“åº“ç´§å¯†é›†æˆï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹ã€‚å®ƒå…·æœ‰æ˜“ç”¨æ€§å’Œé…ç½®ç®€å•çš„ä¼˜ç‚¹ã€‚ CircleCI: CircleCI æ˜¯ä¸€ä¸ªæ‰˜ç®¡çš„æŒç»­é›†æˆå’Œéƒ¨ç½²æœåŠ¡ï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œæ¡†æ¶ã€‚å®ƒé€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆYAMLï¼‰å®šä¹‰æ„å»ºæµæ°´çº¿ï¼Œå¹¶æä¾›ä¸°å¯Œçš„æ’ä»¶å’Œé›†æˆæ”¯æŒã€‚ Travis CI: Travis CI æ˜¯ä¸€ä¸ªé¢å‘å¼€æºé¡¹ç›®çš„æŒç»­é›†æˆæœåŠ¡ï¼Œæ”¯æŒ GitHub å’Œ GitLab ç­‰ä»£ç æ‰˜ç®¡å¹³å°ã€‚å®ƒä½¿ç”¨ .travis.yml æ–‡ä»¶å®šä¹‰æ„å»ºæ­¥éª¤å’Œç¯å¢ƒè®¾ç½®ã€‚ TeamCity: JetBrains çš„ TeamCity æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æŒç»­é›†æˆå’Œéƒ¨ç½²æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§é¡¹ç›®ç±»å‹å’Œå¤æ‚çš„æ„å»ºæµç¨‹é…ç½®ã€‚å®ƒå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œé›†æˆèƒ½åŠ›ã€‚ GitHub Actions: GitHub Actions æ˜¯ GitHub æä¾›çš„ä¸€ç§åŸºäºäº‹ä»¶çš„è‡ªåŠ¨åŒ–å·¥ä½œæµæœåŠ¡ï¼Œå¯ä»¥å®ç°ä»£ç æ£€æŸ¥ã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰æ“ä½œã€‚å®ƒä¸ GitHub ä»“åº“ç´§å¯†é›†æˆï¼Œæ”¯æŒè‡ªå®šä¹‰çš„å·¥ä½œæµç¨‹å®šä¹‰ã€‚ Bamboo: Atlassian çš„ Bamboo æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„æŒç»­é›†æˆå’Œéƒ¨ç½²å·¥å…·ï¼Œæ”¯æŒæ„å»ºå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€éƒ¨ç½²åˆ°å¤šç§ç¯å¢ƒç­‰ã€‚å®ƒä¸å…¶ä»– Atlassian äº§å“ï¼ˆå¦‚ Jira å’Œ Bitbucketï¼‰é›†æˆè‰¯å¥½ã€‚ Drone: Drone æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æŒç»­é›†æˆå’Œäº¤ä»˜å¹³å°ï¼Œæ”¯æŒ Docker å®¹å™¨åŒ–æ„å»ºï¼Œå¹¶æä¾›æ˜“ç”¨çš„é…ç½®æ–‡ä»¶å’Œæ’ä»¶ç³»ç»Ÿã€‚å®ƒé€‚åˆäºåŸºäºå®¹å™¨çš„é¡¹ç›®å’Œå¾®æœåŠ¡æ¶æ„ã€‚ Buildkite: Buildkite æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æŒç»­é›†æˆå’Œäº¤ä»˜å¹³å°ï¼Œæ³¨é‡äºçµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒé€šè¿‡ä»£ç†æœºåˆ¶å®ç°æ„å»ºä½œä¸šçš„å¹¶è¡Œæ‰§è¡Œï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å’Œå¤æ‚çš„æ„å»ºæµç¨‹ã€‚ æ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·é€šå¸¸å–å†³äºé¡¹ç›®çš„å…·ä½“éœ€æ±‚ã€å›¢é˜Ÿçš„æŠ€æœ¯æ ˆå’Œé¢„ç®—ç­‰å› ç´ ã€‚ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:2:1","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"å®‰è£… åœ¨å®˜ç½‘çš„ç”¨æˆ·æ‰‹å†Œä¸Šæä¾›äº†å¤šç§éƒ¨ç½²Jenkinsçš„æ–¹å¼ï¼Œä¸‹é¢æä¾›ä¸€ä¸‹åŸºäºKubernetes éƒ¨ç½²çš„Jenkins jenkins-deploy.yaml --- apiVersion: apps/v1 kind: Deployment metadata: name: jenkins namespace: kube-ops spec: selector: matchLabels: app: jenkins template: metadata: labels: app: jenkins spec: #hostNetwork: true # è§£å†³ updates.jenkins.io å¼‚å¸¸é—®é¢˜ terminationGracePeriodSeconds: 10 serviceAccount: jenkins initContainers: - name: fix-permissions image: docker.io/library/busybox:latest # busybox:1.35.0 imagePullPolicy: IfNotPresent command: ['sh', '-c', 'chown -R 1000:1000 /var/jenkins_home'] securityContext: privileged: true volumeMounts: - name: jenkinshome mountPath: /var/jenkins_home containers: - name: jenkins image: localhost/jenkins/jenkins:2.452.2 #v1 -\u003e v2.297 #jenkins/jenkins:lts ç”Ÿæˆä½¿ç”¨ lts ç¨³å®šç‰ˆæœ¬ imagePullPolicy: IfNotPresent ports: - containerPort: 8080 name: web protocol: TCP - containerPort: 50000 name: agent protocol: TCP resources: limits: cpu: 1000m memory: 1Gi requests: cpu: 500m memory: 512Mi livenessProbe: httpGet: path: /login port: 8080 initialDelaySeconds: 60 timeoutSeconds: 5 failureThreshold: 12 readinessProbe: httpGet: path: /login port: 8080 initialDelaySeconds: 60 timeoutSeconds: 5 failureThreshold: 12 volumeMounts: - name: jenkinshome subPath: jenkins mountPath: /var/jenkins_home securityContext: fsGroup: 1000 volumes: - name: jenkinshome hostPath: path: /opt/jenkins #volumes: #- name: jenkinshome # persistentVolumeClaim: # claimName: opspvc --- apiVersion: v1 kind: Service metadata: name: jenkins namespace: kube-ops labels: app: jenkins spec: selector: app: jenkins type: NodePort ports: - name: web port: 8080 targetPort: web nodePort: 30002 - name: agent port: 50000 targetPort: agent jenkins-rbac.yaml apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: kube-ops --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: jenkins rules: - apiGroups: [\"extensions\", \"apps\"] resources: [\"deployments\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"services\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: jenkins namespace: kube-ops roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins subjects: - kind: ServiceAccount name: jenkins namespace: kube-ops åœ¨k8s ä¸­éƒ¨ç½²çš„å‘½ä»¤ mkdir /opt/jenkins sudo chown -R 1000:1000 /opt/jenkins sudo chmod -R 755 /opt/jenkins kubectl create namespace kube-ops kubectl -n kube-ops create -f rbac.yaml kubectl -n kube-ops create -f jenkins-deploy.yaml kubectl -n kube-ops get pod æ³¨æ„\rè¿™ç§æ˜¯é€šè¿‡ç›´æ¥æŒ‚è½½ç›®å½•çš„å½¢å¼å®ç°çš„ï¼Œç”Ÿäº§ç¯å¢ƒæ˜¯å¤šmaster èŠ‚ç‚¹ï¼Œå»ºè®®ä½¿ç”¨ nfs çš„ pvc çš„æ–¹å¼è¿›è¡ŒæŒ‚è½½\rå…¶å®ƒæ–¹å¼å®‰è£…Jenkins-å®˜ç½‘ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:3:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"ä¿®æ”¹é•œåƒæº ç”±äºå›½å†…å¢™çš„åŸå› ï¼Œä¸‹è½½ä¸€äº›æ’ä»¶ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹é•œåƒæº ç³»ç»Ÿç®¡æ§-\u003e æ’ä»¶ç®¡ç†-\u003e é«˜çº§é…ç½® ä»£ç†é•œåƒæºä¿¡æ¯ï¼š https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json Jenkins\rå¯¹åº”æœåŠ¡å™¨ä¸Šé…ç½®æ–‡ä»¶ root@k8s-master01:/opt/jenkins/jenkins# cat hudson.model.UpdateCenter.xml \u003c?xml version='1.1' encoding='UTF-8'?\u003e \u003csites\u003e \u003csite\u003e \u003cid\u003edefault\u003c/id\u003e \u003curl\u003ehttps://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\u003c/url\u003e \u003c/site\u003e ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:4:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"ä¿®æ”¹ Jenkins é…ç½® ä¸ºäº†æ–¹ä¾¿çš„ä½¿ç”¨Jenkinsï¼Œéœ€è¦å®‰è£…ä¸€å†™å¸¸ç”¨çš„æ’ä»¶ï¼Œä»¥ä¸‹åˆ—çš„æœ‰ç‚¹å¤šï¼Œæ ¹æ®éœ€è¦å®‰è£…å¸¸ç”¨çš„æ’ä»¶ï¼Œä»¥ä¸‹åŸºæœ¬ä¸Šéƒ½ä¼šç”¨å¾—åˆ°çš„ï¼Œä¸äº†è§£çš„æ’ä»¶å¯ä»¥åˆ°æ’ä»¶å¸‚åœºä¸Š æœç´¢ä¸€ä¸‹çœ‹ä¸‹ä»‹ç»ã€‚ Locale Localization: Chinese Git Git Parameter Git Pipeline for blue Ocean Gitlab Kubernetes Kubernetes CLI Kubernetes Credentials Image Tag Parameter Active Choices Credentials Credentials Binding Blue Ocean (Jenkins å¤–éƒ¨UIçš„é¡µé¢) Blue Ocean Pineline Editor Blue Ocean Core Js Pipeline SCM API for Blue Ocean Dashboard for Blue Ocean Build with Parameters Dynamic Extended Choice Parameter Extended Choice Parameter List Git Branches Parameter Pipeline Pipelinie: Declarative Publish Over SSH SonarQube Scanner Localization: Chinese(Simplified) Dingtalk Gitlab Plugin (jenkinså’ŒGitlab å»ºç«‹å®‰å…¨è®¤è¯) Timestamper AnsiColor SSH SSH Pipeline Steps Jenkins æ’ä»¶å®˜ç½‘ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:5:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Jenkins"],"content":"å‚è€ƒ https://www.jenkins.io/zh/doc/ ","date":"2023-04-18","objectID":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/:6:0","tags":["Jenkins"],"title":"Jenkins å…¥é—¨ä»‹ç»","uri":"/jenkins-%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"},{"categories":["Helm"],"content":"Helm ä½¿ç”¨ä¸€ç§åä¸º charts çš„åŒ…æ ¼å¼ï¼Œä¸€ä¸ª chart æ˜¯æè¿°ä¸€ç»„ç›¸å…³çš„ Kubernetes èµ„æºçš„æ–‡ä»¶é›†åˆï¼Œå•ä¸ª chart å¯èƒ½ç”¨äºéƒ¨ç½²ç®€å•çš„åº”ç”¨ï¼Œæ¯”å¦‚ memcached podï¼Œæˆ–è€…å¤æ‚çš„åº”ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå¸¦æœ‰ HTTP æœåŠ¡ã€æ•°æ®åº“ã€ç¼“å­˜ç­‰ç­‰åŠŸèƒ½çš„å®Œæ•´ web åº”ç”¨ç¨‹åºã€‚ Charts æ˜¯åˆ›å»ºåœ¨ç‰¹å®šç›®å½•ä¸‹é¢çš„æ–‡ä»¶é›†åˆï¼Œç„¶åå¯ä»¥å°†å®ƒä»¬æ‰“åŒ…åˆ°ä¸€ä¸ªç‰ˆæœ¬åŒ–çš„å­˜æ¡£ä¸­æ¥éƒ¨ç½²ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ä½¿ç”¨ Helm æ„å»º charts çš„ä¸€äº›åŸºæœ¬æ–¹æ³•ã€‚ ","date":"2023-04-17","objectID":"/helm_charts-%E4%BB%8B%E7%BB%8D/:0:0","tags":["Helm"],"title":"Helm Charts ä»‹ç»","uri":"/helm_charts-%E4%BB%8B%E7%BB%8D/"},{"categories":["Helm"],"content":"æ–‡ä»¶ç»“æ„ chart è¢«ç»„ç»‡ä¸ºä¸€ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶é›†åˆï¼Œç›®å½•åç§°å°±æ˜¯ chart çš„åç§°ï¼ˆä¸åŒ…å«ç‰ˆæœ¬ä¿¡æ¯ï¼‰ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª WordPress çš„ chartï¼Œä¼šè¢«å­˜å‚¨åœ¨ wordpress/ ç›®å½•ä¸‹é¢ï¼ŒåŸºæœ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š wordpress/ Chart.yaml # åŒ…å«å½“å‰ chart ä¿¡æ¯çš„ YAML æ–‡ä»¶ LICENSE # å¯é€‰ï¼šåŒ…å« chart çš„ license çš„æ–‡æœ¬æ–‡ä»¶ README.md # å¯é€‰ï¼šä¸€ä¸ªå¯è¯»æ€§é«˜çš„ README æ–‡ä»¶ values.yaml # å½“å‰ chart çš„é»˜è®¤é…ç½® values values.schema.json # å¯é€‰: ä¸€ä¸ªä½œç”¨åœ¨ values.yaml æ–‡ä»¶ä¸Šçš„ JSON æ¨¡å¼ charts/ # åŒ…å«è¯¥ chart ä¾èµ–çš„æ‰€æœ‰ chart çš„ç›®å½• crds/ # Custom Resource Definitions templates/ # æ¨¡æ¿ç›®å½•ï¼Œä¸ values ç»“åˆä½¿ç”¨æ—¶ï¼Œå°†æ¸²æŸ“ç”Ÿæˆ Kubernetes èµ„æºæ¸…å•æ–‡ä»¶ templates/NOTES.txt # å¯é€‰: åŒ…å«ç®€çŸ­ä½¿ç”¨ä½¿ç”¨çš„æ–‡æœ¬æ–‡ä»¶ ","date":"2023-04-17","objectID":"/helm_charts-%E4%BB%8B%E7%BB%8D/:1:0","tags":["Helm"],"title":"Helm Charts ä»‹ç»","uri":"/helm_charts-%E4%BB%8B%E7%BB%8D/"},{"categories":["Helm"],"content":"Chart.yaml æ–‡ä»¶ å¯¹äºä¸€ä¸ª chart åŒ…æ¥è¯´ Chart.yaml æ–‡ä»¶æ˜¯å¿…é¡»çš„ï¼Œå®ƒåŒ…å«ä¸‹é¢çš„è¿™äº›å­—æ®µï¼š apiVersion: chart API ç‰ˆæœ¬ (å¿…é¡») name: chart å (å¿…é¡») version: SemVer 2ç‰ˆæœ¬ (å¿…é¡») kubeVersion: å…¼å®¹çš„ Kubernetes ç‰ˆæœ¬ (å¯é€‰) description: ä¸€å¥è¯æè¿° (å¯é€‰) type: chart ç±»å‹ (å¯é€‰) keywords: - å½“å‰é¡¹ç›®å…³é”®å­—é›†åˆ (å¯é€‰) home: å½“å‰é¡¹ç›®çš„ URL (å¯é€‰) sources: - å½“å‰é¡¹ç›®æºç  URL (å¯é€‰) dependencies: # chart ä¾èµ–åˆ—è¡¨ (å¯é€‰) - name: chart åç§° (nginx) version: chart ç‰ˆæœ¬ (\"1.2.3\") repository: ä»“åº“åœ°å€ (\"https://example.com/charts\") maintainers: # (å¯é€‰) - name: ç»´æŠ¤è€…åå­— (å¯¹æ¯ä¸ª maintainer æ˜¯å¿…é¡»çš„) email: ç»´æŠ¤è€…çš„ email (å¯é€‰) url: ç»´æŠ¤è€… URL (å¯é€‰) icon: chart çš„ SVG æˆ–è€… PNG å›¾æ ‡ URL (å¯é€‰). appVersion: åŒ…å«çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ (å¯é€‰). ä¸éœ€è¦ SemVer ç‰ˆæœ¬ deprecated: chart æ˜¯å¦å·²è¢«å¼ƒç”¨ (å¯é€‰, boolean) ","date":"2023-04-17","objectID":"/helm_charts-%E4%BB%8B%E7%BB%8D/:2:0","tags":["Helm"],"title":"Helm Charts ä»‹ç»","uri":"/helm_charts-%E4%BB%8B%E7%BB%8D/"},{"categories":["Helm"],"content":"TEMPLATES å’Œ VALUES Helm Chart æ¨¡æ¿æ˜¯ç”¨ Go template è¯­è¨€ è¿›è¡Œç¼–å†™çš„ï¼Œå¦å¤–è¿˜é¢å¤–å¢åŠ äº†(ã€Sprigã€‘](https://github.com/Masterminds/sprig)åº“ä¸­çš„50ä¸ªå·¦å³çš„é™„åŠ æ¨¡æ¿å‡½æ•°å’Œä¸€äº›å…¶ä»–ä¸“ç”¨å‡½æ•°ã€‚ æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ chart çš„ templates/ ç›®å½•ä¸‹é¢ï¼Œå½“ Helm æ¸²æŸ“ charts çš„æ—¶å€™ï¼Œå®ƒå°†é€šè¿‡æ¨¡æ¿å¼•æ“ä¼ é€’è¯¥ç›®å½•ä¸­çš„æ¯ä¸ªæ–‡ä»¶ã€‚æ¨¡æ¿çš„ Values å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾›ï¼š Chart å¼€å‘äººå‘˜å¯ä»¥åœ¨ chart å†…éƒ¨æä¾›ä¸€ä¸ªåä¸º values.yaml çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥åŒ…å«é»˜è®¤çš„ values å€¼å†…å®¹ã€‚ Chart ç”¨æˆ·å¯ä»¥æä¾›åŒ…å« values å€¼çš„ YAML æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ helm install æ¥æŒ‡å®šè¯¥æ–‡ä»¶ å½“ç”¨æˆ·æä¾›è‡ªå®šä¹‰ values å€¼çš„æ—¶å€™ï¼Œè¿™äº›å€¼å°†è¦†ç›– chart ä¸­ values.yaml æ–‡ä»¶ä¸­çš„ç›¸åº”çš„å€¼ã€‚ ","date":"2023-04-17","objectID":"/helm_charts-%E4%BB%8B%E7%BB%8D/:3:0","tags":["Helm"],"title":"Helm Charts ä»‹ç»","uri":"/helm_charts-%E4%BB%8B%E7%BB%8D/"},{"categories":["Kubernetes"],"content":"èƒŒæ™¯ k8s å®¹å™¨è¿è¡Œæ—¶æ˜¯dockerå’Œcontainerdç»“åˆä½¿ç”¨ï¼Œä¸”ç”Ÿäº§ç¯å¢ƒæ˜¯ç¦»çº¿ç¯å¢ƒå°†éœ€è¦çš„containerdå’Œdockerç‰ˆæœ¬ç›¸å…³çš„rpmåŒ…é€šè¿‡yum è¿›è¡Œå‡çº§ï¼Œå‡çº§è¿‡ç¨‹æ¶‰åŠåˆ°dockerçš„é‡å¯ï¼Œdockerå®¹å™¨å°†ä¼šå¯¼è‡´æ‰€æœ‰çš„å®¹å™¨è¿›è¡Œé‡å¯ï¼Œæ•…å‡çº§å‰éœ€è¦å°†k8sè¯¥èŠ‚ç‚¹å…ˆè®¾ç½®æˆç»´æŠ¤çŠ¶æ€ï¼Œå¾…å‡çº§ç»“æŸå†è§£é™¤ï¼Œæœ¬æ–‡å¯¹ç¦»çº¿è¿è¡Œæ—¶å‡çº§è¿›è¡Œä¸€ä¸ªè®°å½•ï¼Œè‡³äºä¸ºä»€ä¹ˆéœ€è¦å°†Dockerå’Œcontainerdè¿›è¡Œç»“åˆä½¿ç”¨å‚è€ƒä¸‹é¢è¡¥å……ä»‹ç» ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:1:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§å‰æå’Œå½±å“ docker ç‰ˆæœ¬ä½äº 19.03.xx containerd ç‰ˆæœ¬ä½äº 1.3.9 å‡çº§åçš„ç‰ˆæœ¬ $ sudo docker version Client: Docker Engine - Community Version: 19.03.11 API version: 1.40 Go version: go1.13.10 Git commit: 42e35e61f3 Built: Mon Jun 1 09:13:48 2020 OS/Arch: linux/amd64 Experimental: false Server: Docker Engine - Community Engine: Version: 19.03.11 API version: 1.40 (minimum version 1.12) Go version: go1.13.10 Git commit: 42e35e61f3 Built: Mon Jun 1 09:12:26 2020 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1.3.9 GitCommit: ea765aba0d05254012b0b9e595e995c09186427f runc: Version: 1.0.0-rc10 GitCommit: dc9208a3303feef5b3839f4323d9beb36df0a9dd docker-init: Version: 0.18.0 GitCommit: fec3683 $ containerd --version containerd containerd.io 1.3.9 ea765aba0d05254012b0b9e595e995c09186427f ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:2:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§æ“ä½œ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:3:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"è·å–å‡çº§å‰é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ $ kubectl get nodes \u003e before-update-node-status.txt ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:3:1","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§è¿‡ç¨‹ å‡çº§åŸåˆ™ï¼Œå‡çº§ 1 ä¸ªï¼Œæ£€æŸ¥ OK åï¼Œå†å‡çº§å¦å¤– 1 ä¸ªèŠ‚ç‚¹ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:3:2","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§å‰æ“ä½œ å°†å‡†å¤‡çš„å‡çº§ä»‹è´¨ä¸Šä¼ è‡³yumæº # rpm åŒ…æŒ‡å®šæ–‡ä»¶å¤¹ /repos/zcm-custom/centos/7/x86_64/ mv docker-ce-19.03.11.tar.gz /repos/zcm-custom/centos/7/x86_64/ cd /repos/zcm-custom/centos/7/x86_64/ tar zxvf docker-ce-19.03.11.tar.gz cd /repos/zcm-custom/centos/7/ createrepo --update x86_64/ # æ›´æ–°yumæºä»“åº“ yum makecache # #é‡æ–°ç”Ÿæˆç¼“å­˜ yum list docker-ce æ£€æŸ¥ $ sudo yum list docker-ce Loaded plugins: product-id, search-disabled-repos Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast Installed Packages docker-ce.x86_64 3:19.03.11-3.el7 @zcm-custom èƒ½çœ‹åˆ° 19.03.11 è¯´æ˜ yum æºæ›´æ–°æˆåŠŸ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:3:3","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§æ­¥éª¤ å°†è¢«å‡çº§èŠ‚ç‚¹ç½®ä¸ºéè°ƒåº¦çŠ¶æ€ï¼›å¯¹è¢«å‡çº§èŠ‚ç‚¹æ‰§è¡Œé©±é€æ“ä½œï¼Œå°†è¯¥èŠ‚ç‚¹ä¸Šçš„ä¸šåŠ¡å®¹å™¨é£˜åˆ°å…¶å®ƒèŠ‚ç‚¹ $ /usr/local/bin/kubectl cordon 10.45.80.44 $ /usr/local/bin/kubectl drain 10.45.80.44 --ignore-daemonsets åœæ­¢ kubelet æœåŠ¡ã€åœæ­¢ kube-proxy æœåŠ¡ $ sudo systemctl stop kube-proxy $ sudo systemctl stop kubelet åœæ­¢ docker/containerd æœåŠ¡ $ sudo systemctl stop docker $ sudo systemctl stop containerd $ sudo ps aux | grep docker # æ£€æŸ¥è¯¥æœºå™¨ä¸Šæ‰€æœ‰ä¸ docker ç›¸å…³çš„è¿›ç¨‹ # å¦‚æœå­˜åœ¨ï¼Œåˆ™ kill æ‰ $ sudo ps -ef|grep docker|grep -v dockerd|awk '{print $2}'|xargs kill -9 containerd å‡çº§ $ yum install -y containerd å¯åŠ¨å‡çº§åçš„ docker/containerd æœåŠ¡ $ sudo systemctl start containerd $ sudo systemctl start docker $ sudo systemctl enable docker $ sudo systemctl enable containerd å¯åŠ¨ kubelet æœåŠ¡ã€å¯åŠ¨ kube-proxy æœåŠ¡ $ sudo systemctl start kube-proxy $ sudo systemctl start kubelet ç™»å½• master èŠ‚ç‚¹å°†å‡çº§èŠ‚ç‚¹çŠ¶æ€è®¾ç½®ä¸ºå…è®¸è°ƒåº¦çŠ¶æ€ $ sudo kubectl get nodes $ sudo kubectl uncordon 10.45.80.44 è¢«å‡çº§èŠ‚ç‚¹çš„çŠ¶æ€æ£€æŸ¥ æ£€æŸ¥è¢«å‡çº§èŠ‚ç‚¹çš„çŠ¶æ€ åœ¨ k8s master èŠ‚ç‚¹ä¸Šï¼Œæ‰§è¡Œ kubectl get nodes |grep è¢«å‡çº§èŠ‚ç‚¹çš„ IP çœ‹çœ‹æ˜¯å¦å¤„äº Ready çŠ¶æ€ã€‚ æ£€æŸ¥è¢«å‡çº§èŠ‚ç‚¹çš„å®¹å™¨ç½‘ç»œï¼Œåœ¨å‡çº§å®Œåçš„èŠ‚ç‚¹ä¸Š ping ä¸€ä¸‹å…¶å®ƒæœºå™¨ä¸Šçš„å®¹å™¨ IPï¼Œping é€šçš„è¯ï¼Œå®¹å™¨ç½‘ç»œæ­£å¸¸ è¯¥èŠ‚ç‚¹å‡çº§å®Œæˆ ä¾æ¬¡å‡çº§å…¶å®ƒèŠ‚ç‚¹ï¼ŒæŒ‰å‰é¢çš„å‡çº§æ­¥éª¤ä½æ¬¡å‡çº§åç»­çš„èŠ‚ç‚¹ï¼Œåœ¨å‡çº§åç»­èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œä¸šåŠ¡å®¹å™¨ä¼šåœ¨å‰é¢å‡çº§å®Œæˆåçš„èŠ‚ç‚¹ä¸Šè°ƒåº¦ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:3:4","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‡çº§åçš„èŠ‚ç‚¹çŠ¶æ€æ£€æŸ¥ $ kubectl get nodes ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:4:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"è¡¥å……-ä¸ºä»€ä¹ˆè¦å°†Dockerå’Œcontainerdè¿›è¡Œç»“åˆä½¿ç”¨ï¼Ÿ æ›´è½»é‡çº§ï¼šcontainerdæ˜¯ä¸€ä¸ªæ›´è½»é‡çº§ä¸”ä¸“æ³¨äºå®¹å™¨æ“ä½œçš„è¿è¡Œæ—¶å·¥å…·ï¼Œç›¸æ¯”äºDockerå…·æœ‰æ›´å°çš„å†…å­˜å ç”¨å’Œæ›´å¿«çš„å¯åŠ¨æ—¶é—´ã€‚ æ›´ç¨³å®šå’Œå¯é ï¼šcontainerdæ˜¯ç”±Dockerå¼€æºç¤¾åŒºå¼€å‘å’Œç»´æŠ¤çš„ï¼Œå› æ­¤å¯ä»¥å—ç›ŠäºDockerç¤¾åŒºçš„ç»éªŒå’Œåé¦ˆï¼Œä»è€Œè·å¾—æ›´ç¨³å®šå’Œå¯é çš„å®¹å™¨æŠ€æœ¯ã€‚ æ›´çµæ´»çš„é›†æˆï¼šcontainerdè¢«è®¾è®¡ä¸ºæ¨¡å—åŒ–çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ä¸å…¶ä»–å®¹å™¨ç”Ÿæ€ç³»ç»Ÿä¸­çš„å·¥å…·å’ŒæœåŠ¡é›†æˆï¼Œä¾‹å¦‚Kubernetesã€CRI-Oç­‰ã€‚ æ›´é«˜æ€§èƒ½ï¼šç”±äºcontainerdæ¯”Dockeræ›´è½»é‡çº§ï¼Œå› æ­¤å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚å®ƒå¯ä»¥å¿«é€Ÿåˆ›å»ºå’Œé”€æ¯å®¹å™¨ï¼Œå¹¶æä¾›æ›´ä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„ååé‡ã€‚ å…¼å®¹æ€§ï¼šé€šè¿‡ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨é•œåƒæ ¼å¼ï¼Œcontainerdèƒ½å¤Ÿä¸Dockerç”Ÿæ€ç³»ç»Ÿä¸­çš„å·¥å…·å’ŒæœåŠ¡æ— ç¼é›†æˆï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨Dockerå’Œcontainerdç»“åˆå¯ä»¥æä¾›æ›´è½»é‡çº§ã€æ›´ç¨³å®šå¯é ã€æ›´çµæ´»é›†æˆã€æ›´é«˜æ€§èƒ½å’Œæ›´å¥½çš„å…¼å®¹æ€§ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å®¹å™¨è¿è¡Œæ—¶ç»„åˆï¼Œé€‚ç”¨äºå„ç§ä¸åŒçš„å®¹å™¨åŒ–åœºæ™¯ã€‚ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:5:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Kubernetes"],"content":"å‚è€ƒ Docker ä¸ Containerd å¹¶ç”¨é…ç½® æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºLinuxç¦»çº¿YUMæºç¯å¢ƒ ","date":"2023-04-17","objectID":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/:6:0","tags":["Kubernetes"],"title":"k8så®¹å™¨è¿è¡Œæ—¶ containerd ç‰ˆæœ¬å‡çº§","uri":"/k8s%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6containerd%E5%8D%87%E7%BA%A7/"},{"categories":["Jenkins"],"content":"è¦å®ç°åœ¨ Jenkins ä¸­çš„æ„å»ºå·¥ä½œï¼Œå¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨æ¯”è¾ƒå¸¸ç”¨çš„ Pipeline è¿™ç§æ–¹å¼ã€‚ Pipelineï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€å¥—è¿è¡Œåœ¨ Jenkins ä¸Šçš„å·¥ä½œæµæ¡†æ¶ï¼Œå°†åŸæ¥ç‹¬ç«‹è¿è¡Œäºå•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡è¿æ¥èµ·æ¥ï¼Œå®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„å¤æ‚æµç¨‹ç¼–æ’å’Œå¯è§†åŒ–çš„å·¥ä½œã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:0:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineæ˜¯ä»€ä¹ˆï¼Ÿ Pipelineæ˜¯Jenkinsçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›ä¸€ç»„å¯æ‰©å±•çš„å·¥å…·ã€‚ é€šè¿‡Pipeline çš„DSLè¯­æ³•å¯ä»¥å®Œæˆä»ç®€å•åˆ°å¤æ‚çš„äº¤ä»˜æµæ°´çº¿å®ç°ã€‚ jenkinsçš„Pipelineæ˜¯é€šè¿‡Jenkinsfileï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰æ¥å®ç°çš„ã€‚ è¿™ä¸ªæ–‡ä»¶å¯ä»¥å®šä¹‰Jenkinsçš„æ‰§è¡Œæ­¥éª¤ï¼Œä¾‹å¦‚æ£€å‡ºä»£ç ã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:1:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Jenkins file Jenkinsfileä½¿ç”¨ä¸¤ç§è¯­æ³•è¿›è¡Œç¼–å†™ï¼Œåˆ†åˆ«æ˜¯å£°æ˜å¼å’Œè„šæœ¬å¼ã€‚ å£°æ˜å¼å’Œè„šæœ¬å¼çš„æµæ°´çº¿ä»æ ¹æœ¬ä¸Šæ˜¯ä¸åŒçš„ã€‚ å£°æ˜å¼æ˜¯jenkinsæµæ°´çº¿æ›´å‹å¥½çš„ç‰¹æ€§ã€‚ è„šæœ¬å¼çš„æµæ°´çº¿è¯­æ³•ï¼Œæä¾›æ›´ä¸°å¯Œçš„è¯­æ³•ç‰¹æ€§ã€‚ å£°æ˜å¼æµæ°´çº¿ä½¿ç¼–å†™å’Œè¯»å–æµæ°´çº¿ä»£ç æ›´å®¹æ˜“è®¾è®¡ã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:2:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Pipeline? æœ¬è´¨ä¸Šï¼Œjenkinsæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ƒæ”¯æŒè®¸å¤šè‡ªåŠ¨æ¨¡å¼ã€‚æµæ°´çº¿å‘Jenkinsæ·»åŠ äº†ä¸€ç»„å¼ºå¤§çš„å·¥å…·ï¼Œæ”¯æŒç”¨ä¾‹ã€ç®€å•çš„æŒç»­é›†æˆåˆ°å…¨é¢çš„æŒç»­äº¤ä»˜æµæ°´çº¿ã€‚ é€šè¿‡å¯¹ä¸€ç³»åˆ—çš„å‘å¸ƒä»»åŠ¡å»ºç«‹æ ‡å‡†çš„æ¨¡æ¿ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨æ›´å¤šæµæ°´çº¿çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š ä»£ç åŒ–: æµæ°´çº¿æ˜¯åœ¨ä»£ç ä¸­å®ç°çš„ï¼Œé€šå¸¸ä¼šå­˜æ”¾åˆ°æºä»£ç æ§åˆ¶ï¼Œä½¿å›¢é˜Ÿå…·æœ‰ç¼–è¾‘ã€å®¡æŸ¥å’Œæ›´æ–°ä»–ä»¬é¡¹ç›®çš„äº¤ä»˜æµæ°´çº¿çš„èƒ½åŠ›ã€‚ è€ç”¨æ€§ï¼šæµæ°´çº¿å¯ä»¥ä»Jenkinsçš„masterèŠ‚ç‚¹é‡å¯åç»§ç»­è¿è¡Œã€‚ å¯æš‚åœçš„ï¼šæµæ°´çº¿å¯ä»¥ç”±äººåŠŸè¾“å…¥æˆ–æ‰¹å‡†ç»§ç»­æ‰§è¡Œæµæ°´çº¿ã€‚ è§£å†³å¤æ‚å‘å¸ƒï¼š æ”¯æŒå¤æ‚çš„äº¤ä»˜æµç¨‹ã€‚ä¾‹å¦‚å¾ªç¯ã€å¹¶è¡Œæ‰§è¡Œã€‚ å¯æ‰©å±•æ€§ï¼š æ”¯æŒæ‰©å±•DSLå’Œå…¶ä»–æ’ä»¶é›†æˆã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:3:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Jenkins Pipeline å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µ Nodeï¼šèŠ‚ç‚¹ï¼Œä¸€ä¸ª Node å°±æ˜¯ä¸€ä¸ª Jenkins èŠ‚ç‚¹ï¼ŒMaster æˆ–è€… Agentï¼Œæ˜¯æ‰§è¡Œ Step çš„å…·ä½“è¿è¡Œç¯å¢ƒ Stageï¼šé˜¶æ®µï¼Œä¸€ä¸ª Pipeline å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª Stageï¼Œæ¯ä¸ª Stage ä»£è¡¨ä¸€ç»„æ“ä½œï¼Œæ¯”å¦‚ï¼šBuildã€Testã€Deployï¼ŒStage æ˜¯ä¸€ä¸ªé€»è¾‘åˆ†ç»„çš„æ¦‚å¿µï¼Œå¯ä»¥è·¨å¤šä¸ª Node Stepï¼šæ­¥éª¤ï¼ŒStep æ˜¯æœ€åŸºæœ¬çš„æ“ä½œå•å…ƒï¼Œå¯ä»¥æ˜¯æ‰“å°ä¸€å¥è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æ„å»ºä¸€ä¸ª Docker é•œåƒï¼Œç”±å„ç±» Jenkins æ’ä»¶æä¾›ï¼Œæ¯”å¦‚å‘½ä»¤ï¼šsh â€˜makeâ€™ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬å¹³æ—¶ shell ç»ˆç«¯ä¸­æ‰§è¡Œ make å‘½ä»¤ä¸€æ ·ã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:4:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"åˆ›å»ºJenkins Pipeline Pipeline è„šæœ¬æ˜¯ç”± Groovy è¯­è¨€å®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡å¿…è¦å•ç‹¬å»å­¦ä¹  Groovyï¼Œå½“ç„¶ä½ ä¼šçš„è¯æœ€å¥½ Pipeline æ”¯æŒä¸¤ç§è¯­æ³•ï¼šDeclarative(å£°æ˜å¼)å’Œ Scripted Pipeline(è„šæœ¬å¼)è¯­æ³• Pipeline ä¹Ÿæœ‰ä¸¤ç§åˆ›å»ºæ–¹æ³•ï¼šå¯ä»¥ç›´æ¥åœ¨ Jenkins çš„ Web UI ç•Œé¢ä¸­è¾“å…¥è„šæœ¬ï¼›ä¹Ÿå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª Jenkinsfile è„šæœ¬æ–‡ä»¶æ”¾å…¥é¡¹ç›®æºç åº“ä¸­ Jenkins\rä¸€èˆ¬æˆ‘ä»¬éƒ½æ¨èåœ¨ Jenkins ä¸­ç›´æ¥ä»æºä»£ç æ§åˆ¶(SCMD)ä¸­ç›´æ¥è½½å…¥ Jenkinsfile Pipeline è¿™ç§æ–¹æ³•ï¼Œæ­£å¸¸é¡¹ç›®ä¸­ä¼šå°† Jenkinsfile æµæ°´çº¿æ–‡ä»¶æ”¾åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œå¯ä»¥é€‰æ‹©Pipeline script from SCM Jenkins\rå‚è€ƒé¡¹ç›® ","date":"2023-04-16","objectID":"/jenkins-pipeline/:5:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipeline æ¨¡æ¿ å¯ä»¥æ ¹æ®ä»¥ä¸‹æ¨¡æ¿è¿›è¡ŒåŠ¨æ€çš„å¡«å……å’Œä¿®æ”¹ // æ‰€æœ‰çš„è„šæ­¥å‘½ä»¤éƒ½æ”¾åœ¨pipeline ä¸­ pipeline{ // åœ¨ä»»ä¸€èŠ‚ç‚¹éƒ½å¯ä»¥ä½¿ç”¨ agent any // parameters { // string{name:'DEPLOY_ENV',defaultValue:'staging',description:''}, // booleanParam{name:'DEBUG_BUID',defaultValue:true,description:''} // } // å®šä¹‰å…¨å±€å˜é‡ environment{ key = 'value' } options { //timestamps() // æ—¥å¿—ä¼šæœ‰æ—¶é—´ï¼Œä¾èµ–Timestamper æ’ä»¶ // skipDefaultCheckout() // åˆ é™¤éšå¼checkout scm è¯­å¥ disableConcurrentBuilds() // ç¦æ­¢å¹¶è¡Œ timeout(time: 1,unit:'HOURS') // æµæ°´çº¿è¶…æ—¶è®¾ç½®1h } stages{ // Example stage('Input äº¤æ¢çš„æ–¹å¼'){ steps { timeout(time:5,unit:\"MINUTES\"){ script{ echo \"nice to meet you\" //input id: 'Id', message: 'message', ok: 'æ˜¯å¦ç»§ç»­', parameters: [choice(choices: ['a', 'b', 'c'], name: 'abc')], submitter: 'lushuan,admin' println(\"hello\") } } } } // ä¸‹è½½ä»£ç  stage('æ‹‰å–git ä»“åº“ä»£ç '){ steps { timeout(time:5,unit:\"MINUTES\"){ echo 'æ‹‰å–ä»£ç æˆåŠŸ-SUCCESS' } } } stage('é€šè¿‡mavenæ„å»ºé¡¹ç›®'){ steps { timeout(time:20,unit:\"MINUTES\"){ sh \"/var/jenkins_home/maven/bin/mvn clean package -DskipTests\" } } } stage('é€šè¿‡SnoarQubeåšä»£ç è´¨é‡æ£€æµ‹'){ steps { timeout(time:30,unit:\"MINUTES\"){ echo 'é€šè¿‡SnoarQubeåšä»£ç è´¨é‡æ£€æµ‹-SUCCESSS' } } } stage('é€šè¿‡Dockeråˆ¶ä½œè‡ªå®šä¹‰é•œåƒ'){ steps { timeout(time:10,unit:\"MINUTES\"){ //sh \"docker build -t my-spring-boot-app:latest .\" sshPublisher(publishers: [sshPublisherDesc(configName: 'mytest', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '''cd /opt/jenkins/jenkins/workspace/mytest docker build -t my-spring-boot-app:latest . docker stop mytest docker rm mytest docker run -it -d --name mytest -p 8080:8080 my-spring-boot-app:latest''', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '', remoteDirectorySDF: false, removePrefix: '', sourceFiles: '')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)]) echo 'é€šè¿‡Dockeråˆ¶ä½œè‡ªå®šä¹‰é•œåƒ-SUCCESSS' } } } stage('å°†è‡ªå®šä¹‰é•œåƒæ¨é€è‡³Harbor'){ steps { timeout(time:10,unit:\"MINUTES\"){ echo 'å°†è‡ªå®šä¹‰é•œåƒæ¨é€è‡³Harbor-SUCCESSS' } } } stage('é€šè¿‡Publish Over SSH é€šçŸ¥ç›®æ ‡æœåŠ¡å™¨'){ steps { timeout(time:10,unit:\"MINUTES\"){ echo 'é€šè¿‡Publish Over SSH é€šçŸ¥ç›®æ ‡æœåŠ¡å™¨-SUCCESSS' } } } } // æ„å»ºåæ“ä½œ post { // æ— è®ºæˆåŠŸå¤±è´¥æ€»æ˜¯æ‰§è¡Œ always{ script{ println(\"always\") } } success { script{ currentBuild.description += \"\\n æ„å»ºæˆåŠŸ!\" } // éœ€è¦å®‰è£… dingtalk æ’ä»¶ // dingtalk( // robot: \"é’‰é’‰è‡ªå®šä¹‰åç§°\", // type: 'MARKDOWN', // title: \"success: ${JOB_NAME}\" // text: [\"- æˆåŠŸæ„å»º:${JOB_NAME}! \\n-ç‰ˆæœ¬:${tag} \\n-æŒç»­æ—¶é—´:${currentBuild.durationString}\"] // ) } failure { script{ currentBuild.description += \"\\n æ„å»ºå¤±è´¥!\" } // dingtalk( // robot: \"é’‰é’‰è‡ªå®šä¹‰åç§°\", // type: 'MARKDOWN', // title: \"failure: ${JOB_NAME}\" // text: [\"- å¤±è´¥æ„å»º:${JOB_NAME}! \\n-ç‰ˆæœ¬:${tag} \\n-æŒç»­æ—¶é—´:${currentBuild.durationString}\"] // ) } aborted { script{ currentBuild.description += \"\\n æ„å»ºå–æ¶ˆ!\" } } } } ","date":"2023-04-16","objectID":"/jenkins-pipeline/:6:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"æµæ°´çº¿åŸºç¡€è¯­æ³• ä»¥ä¸‹æ˜¯ç®€è¦çš„å¯¹æµæ°´çº¿è¯­æ³•è¿›è¡Œç²—æµ…çš„äººç”Ÿï¼Œæ›´è¯¦ç»†çš„è¯·ç™»å½•å®˜ç½‘æµæ°´çº¿è¯­æ³•å‚è€ƒè¿›è¡ŒæŸ¥çœ‹ ç®€ä»‹pipeline åŸºç¡€è¯­æ³•ï¼Œå£°æ˜å¼è„šæ­¥å¼ï¼ŒèŠ‚ç‚¹æ­¥éª¤ å®‰è£…å£°æ˜å¼æ’ä»¶ Pipeline: Declarative Jenkinsfile ç»„æˆ æŒ‡å®šnode èŠ‚ç‚¹/workspace æŒ‡å®šè¿è¡Œé€‰é¡¹ æŒ‡å®šstages é˜¶æ®µ æŒ‡å®šæ„å»ºåæ“ä½œ Pipeline çš„è¯­æ³•åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å£°æ˜å¼çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯è„šæ­¥å¼çš„ï¼Œå£°æ˜å¼ç¼–å†™æ›´åŠ å‹å¥½ï¼Œå£°æ˜å¼å†…å¯ä»¥åµŒå…¥è„šæœ¬å¼ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineå®šä¹‰- post æŒ‡å®šæ„å»ºåæ“ä½œ ä»‹ç» always{}: æ€»æ˜¯æ‰§è¡Œè„šæœ¬ç‰‡æ®µ success{}: æˆåŠŸåæ‰§è¡Œ failure{}: å¤±è´¥åæ‰§è¡Œ aborted{}: å–æ¶ˆåæ‰§è¡Œ changed åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µå®ŒæˆçŠ¶æ€ä¸ä¹‹å‰ä¸åŒæ—¶ unstable åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µçŠ¶æ€ä¸º\"unstableè¿è¡Œ\"ï¼Œä¾‹å¦‚æµ‹è¯•å¤±è´¥ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:1","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- agent agent æŒ‡å®šäº†æµæ°´çº¿çš„æ‰§è¡ŒèŠ‚ç‚¹ å‚æ•°ï¼š - any åœ¨ä»»ä½•å¯ç”¨çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œpipeling - none æ²¡æœ‰æŒ‡å®šagent çš„æ—¶å€™é»˜è®¤ - lable åœ¨æŒ‡å®šçš„æ ‡ç­¾ä¸Šçš„èŠ‚ç‚¹ä¸Šè¿è¡ŒPipeline - node å…è®¸é¢å¤–çš„é€‰é¡¹ ä¸¤ç§æ˜¯ä¸€æ ·çš„\ragent { node {label 'labelname'}}\ragent { label 'labelname'}\r","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:2","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- option buildDiscarder:ä¸ºæœ€è¿‘çš„æµæ°´çº¿è¿è¡Œçš„ç‰¹å®šæ•°é‡ä¿å­˜ç»„ä»¶å’Œæ§åˆ¶å°è¾“å‡ºã€‚ disableConcurrentBuilds:ä¸å…è®¸åŒæ—¶æ‰§è¡Œæµæ°´çº¿ã€‚å¯è¢«ç”¨æ¥é˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ overridelndexTriggers: å…è®¸è¦†ç›–åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨çš„é»˜è®¤å¤„ç†ã€‚ skipDefaultCheckout: åœ¨agent æŒ‡ä»¤ä¸­,è·³è¿‡ä»æºä»£ç æ§åˆ¶ä¸­æ£€å‡ºä»£ç çš„é»˜è®¤æƒ…å†µã€‚ skipStagesAfterUnstable:ä¸€æ—¦æ„å»ºçŠ¶æ€å˜å¾—UNSTABLE,è·³è¿‡è¯¥é˜¶æ®µã€‚ checkoutToSubdirectory: åœ¨å·¥ä½œç©ºé—´çš„å­ç›®å½•ä¸­è‡ªåŠ¨åœ°æ‰§è¡Œæºä»£ç æ§åˆ¶æ£€å‡ºã€‚ timeout: è®¾ç½®æµæ°´çº¿è¿è¡Œçš„è¶…æ—¶æ—¶é—´,åœ¨æ­¤ä¹‹å,Jenkinså°†ä¸­æ­¢æµæ°´çº¿ã€‚ retry:åœ¨å¤±è´¥æ—¶,é‡æ–°å°è¯•æ•´ä¸ªæµæ°´çº¿çš„æŒ‡å®šæ¬¡æ•°ã€‚ timestamps é¢„æµ‹æ‰€æœ‰ç”±æµæ°´çº¿ç”Ÿæˆçš„æ§åˆ¶å°è¾“å‡º,ä¸è¯¥æµæ°´çº¿å‘å‡ºçš„æ—¶é—´ä¸€è‡´ã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:3","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- parameters æ·»åŠ å‚æ•°æ—¶ï¼Œå¯ä»¥åœ¨jenkins è„šæœ¬ä¸­è·å–åˆ° parameters { string{name:'DEPLOY_ENV',defaultValue:'staging',description:''}, booleanParam{name:'DEBUG_BUID',defaultValue:true,description:''} } ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:4","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- trigger è§¦å‘å™¨ triggers { cron('H */4 * * 1-5') } ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:5","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- tool ä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šå…¨å±€å·¥å…· tools { maven 'apache-maven-3.0.1' } å¦‚åœ¨pipeline ä¸­é›†æˆmavenæ—¶ä½¿ç”¨ stage(\"build\"){ mvHome=\"/usr/local/apache-maven-3.5.0/bin\" sh \"${mvHome}/mvn clean package\" } // æˆ–è€…é€šè¿‡ tool å¼•ç”¨ stage(\"build\"){ mvHome = tool 'M3' // M3: /usr/local/apache-maven-3.5.0/bin sh \"${mvHome}/mvn clean package\" } ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:6","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- input input ç”¨æˆ·åœ¨æ‰§è¡Œå„ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œç”±äººå·¥ç¡®è®¤æ˜¯å¦ç»§ç»­æ‰§è¡Œ message å‘ˆç°ç»™ç”¨æˆ·çš„æç¤ºä¿¡æ¯ã€‚ id å¯é€‰,é»˜è®¤ä¸ºstageåç§°ã€‚ ok é»˜è®¤è¡¨å•ä¸Šçš„okæ–‡æœ¬ã€‚ submitter å¯é€‰çš„,ä»¥é€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨æˆ–å…è®¸æäº¤çš„å¤–éƒ¨ç»„åã€‚é»˜è®¤å…è®¸ä»»ä½•ç”¨æˆ·ã€‚ submitterParameterç¯å¢ƒå˜é‡çš„å¯é€‰åç§°ã€‚å¦‚æœå­˜åœ¨,ç”¨submitter åç§°è®¾ç½®ã€‚ parameters æç¤ºæäº¤è€…æä¾›çš„ä¸€ä¸ªå¯é€‰çš„å‚æ•°åˆ—è¡¨ã€‚ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:7","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- when when æŒ‡ä»¤å…è®¸æµæ°´çº¿æ ¹æ®ç»™å®šçš„æ¡ä»¶å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œé˜¶æ®µã€‚when æŒ‡ä»¤å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ã€‚å¦‚æœwhen æŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œæ‰€æœ‰çš„æ¡ä»¶å¿…é¡»è¿”å›Trueï¼Œé˜¶æ®µæ‰èƒ½æ‰§è¡Œã€‚ è¯­æ³•å’Œåœ¨stage å¹³çº§ å†…ç½®æ¡ä»¶ branch: å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸æ¨¡å¼ç»™å®šçš„åˆ†æ”¯åŒ¹é…æ˜¯ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µï¼Œè¿™åªé€‚ç”¨äºå¤šåˆ†æ”¯æµæ°´çº¿ä¾‹å¦‚ï¼š when { branch 'master'} environment:å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡æ˜¯ç»™å®šçš„å€¼æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªæ­¥éª¤ï¼Œä¾‹å¦‚ï¼š when { environment name:'DEPLOY_TO',value: 'production'} not å½“åµŒå¥—çš„æ¡ä»¶é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ when { not {branch 'master'}} anyof when { anyof {branch 'master';branch 'staging'}} ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:8","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"Pipelineè¯­æ³•- parallel å¹¶è¡Œ å£°æ˜å¼æµæ°´çº¿çš„é˜¶æ®µå¯ä»¥åœ¨ä»–ä»¬å†…éƒ¨å£°æ˜å¤šéš”åµŒå¥—é˜¶æ®µ, å®ƒä»¬å°†å¹¶è¡Œæ‰§è¡Œã€‚ å¦å¤–, é€šè¿‡æ·»åŠ  failFast true åˆ°åŒ…å«parallelçš„ stageä¸­ï¼Œ å½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹å¤±è´¥æ—¶ï¼Œå¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„ parallel é˜¶æ®µéƒ½è¢«ç»ˆæ­¢ã€‚ pipeline { agent any stages { stage('Non-Parallel Stage') { steps { echo 'This stage will be executed first.' } } stage('Parallel Stage') { when { branch 'master' } failFast true parallel { stage('Branch A') { agent { label \"for-branch-a\" } steps { echo \"On Branch A\" } } stage('Branch B') { agent { label \"for-branch-b\" } steps { echo \"On Branch B\" } } } } } } ","date":"2023-04-16","objectID":"/jenkins-pipeline/:7:9","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"å‚è€ƒ Jenkins æµæ°´çº¿ ","date":"2023-04-16","objectID":"/jenkins-pipeline/:8:0","tags":["Jenkins"],"title":"Jenkins Pipeline","uri":"/jenkins-pipeline/"},{"categories":["Jenkins"],"content":"ä»€ä¹ˆæ˜¯ Blue Ocean? Blue Ocean æ˜¯Jenkinsçš„å¼€æºå­é¡¹ç›®ï¼Œåœ¨ä¿è¯åŸæœ‰å¼ºå¤§çš„åŠŸèƒ½ä¸å˜çš„åŸºç¡€ä¸‹ï¼Œå¯¹æŒç»­äº¤ä»˜(CD)Pipelineè¿‡ç¨‹çš„å¯è§†åŒ–æ–¹é¢ç›¸è¾ƒäºJenkins ä¹‹å‰çš„ç»å…¸ç•Œé¢æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚ Blue Ocean é‡æ–°æ€è€ƒJenkinsçš„ç”¨æˆ·ä½“éªŒï¼Œä»å¤´å¼€å§‹è®¾è®¡Jenkins Pipeline, ä½†ä»ç„¶ä¸è‡ªç”±å¼ä½œä¸šå…¼å®¹ï¼ŒBlue Oceanå‡å°‘äº†æ··ä¹±è€Œä¸”è¿›ä¸€æ­¥æ˜ç¡®äº†å›¢é˜Ÿä¸­æ¯ä¸ªæˆå‘˜ Blue Ocean çš„ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š æŒç»­äº¤ä»˜(CD)Pipelineçš„ å¤æ‚å¯è§†åŒ– ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿç›´è§‚åœ°ç†è§£ç®¡é“çŠ¶æ€ã€‚ Pipeline ç¼–è¾‘å™¨ - å¼•å¯¼ç”¨æˆ·é€šè¿‡ç›´è§‚çš„ã€å¯è§†åŒ–çš„è¿‡ç¨‹æ¥åˆ›å»ºPipelineï¼Œä»è€Œä½¿Pipelineçš„åˆ›å»ºå˜å¾—å¹³æ˜“è¿‘äººã€‚ ä¸ªæ€§åŒ– ä»¥é€‚åº”å›¢é˜Ÿä¸­æ¯ä¸ªæˆå‘˜ä¸åŒè§’è‰²çš„éœ€æ±‚ã€‚ åœ¨éœ€è¦å¹²é¢„å’Œ/æˆ–å‡ºç°é—®é¢˜æ—¶ ç²¾ç¡®å®šä½ ã€‚ Blue Ocean å±•ç¤º Pipelineä¸­éœ€è¦å…³æ³¨çš„åœ°æ–¹ï¼Œ ç®€åŒ–å¼‚å¸¸å¤„ç†ï¼Œæé«˜ç”Ÿäº§åŠ› æœ¬åœ°é›†æˆåˆ†æ”¯å’Œåˆå¹¶è¯·æ±‚, åœ¨ä¸GitHub å’Œ Bitbucketä¸­çš„å…¶ä»–äººåä½œç¼–ç æ—¶å®ç°æœ€å¤§ç¨‹åº¦çš„å¼€å‘äººå‘˜ç”Ÿäº§åŠ›ã€‚ ","date":"2023-04-14","objectID":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/:1:0","tags":["Jenkins"],"title":"ä½¿ç”¨Blue Oceanåˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿","uri":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/"},{"categories":["Jenkins"],"content":"è®¿é—®Blue Ocean åœ¨ç³»ç»Ÿç®¡ç†\u003eæ’ä»¶ç®¡ç†\u003eå¯é€‰æ’ä»¶ä¸­æœç´¢ Blue Ocean \u003eå®‰è£…,å®‰è£…æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥åœ¨é¡µé¢ä¸Šçœ‹åˆ°Blue Oceançš„å›¾æ ‡,æ‰“å¼€åæ³¨å†Œgit ä»“åº“åœ°å€ è®¤è¯åå°±å¯ä»¥åˆ›å»ºæµæ°´çº¿äº†ã€‚ Blue Ocean\r","date":"2023-04-14","objectID":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/:2:0","tags":["Jenkins"],"title":"ä½¿ç”¨Blue Oceanåˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿","uri":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/"},{"categories":["Jenkins"],"content":"åˆ›å»ºæµæ°´çº¿ åˆ›å»ºæµæ°´çº¿å‰éœ€è¦å…ˆå®‰è£…å¯¹åº”çš„æ’ä»¶ Blue Ocean è¿™è¾¹ä½¿ç”¨çš„git ä»“åº“æ˜¯giteeï¼Œä½¿ç”¨gitlab ä¹Ÿæ˜¯ä¸€æ ·çš„æ–¹å¼ï¼Œæœ‰ä¸¤ç§è®¤è¯çš„æ–¹å¼ é€šè¿‡è´¦å·å£ä»¤ é€šè¿‡ç”Ÿæˆ ssh å…¬é’¥åœ¨gitlab æˆ–è€…gitee ä»“åº“ä¸Šè¿›è¡Œæ³¨å†Œ Blue Ocean\ré¦–å…ˆå…ˆè¿›è¡Œè¯ä¹¦è®¤è¯ï¼Œç„¶åå†åˆ›å»ºæµæ°´çº¿ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ Jenkinsfile æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¹¶é»˜è®¤æ¨åˆ° master åˆ†æ”¯ã€‚ ","date":"2023-04-14","objectID":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/:3:0","tags":["Jenkins"],"title":"ä½¿ç”¨Blue Oceanåˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿","uri":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/"},{"categories":["Jenkins"],"content":"åœ¨Blue Ocean æŸ¥çœ‹ä»»åŠ¡è¿›åº¦è§†å›¾ ç‚¹å‡»å¯¹åº”çš„å·¥ä½œèŠ‚ç‚¹ï¼Œå¯ä»¥æŸ¥è¯¢ä»»åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ—¥å¿—è¯¦æƒ… Blue Ocean\rblue ocean åå‘ç”Ÿæˆçš„pipeline ä»£ç  pipeline { agent any stages { stage('gitlab pull code') { parallel { stage('gitlab pull code') { steps { sh 'echo \\'gitlab pull code\\'' } } stage('code test') { steps { sh 'echo \\'code test\\'' } } } } stage('docker build') { parallel { stage('docker build') { steps { sh 'echo \\'docker build\\'' } } stage('docker test') { steps { sh 'echo \\'docker test\\'' } } } } stage('deployment') { steps { sh 'echo \\'deployment\\'' } } stage('sanity test') { steps { sh 'echo \\'sanity test\\'' } } } } ","date":"2023-04-14","objectID":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/:3:1","tags":["Jenkins"],"title":"ä½¿ç”¨Blue Oceanåˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿","uri":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/"},{"categories":["Jenkins"],"content":"å‚è€ƒ https://www.jenkins.io/zh/doc/book/blueocean/ ","date":"2023-04-14","objectID":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/:4:0","tags":["Jenkins"],"title":"ä½¿ç”¨Blue Oceanåˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿","uri":"/%E4%BD%BF%E7%94%A8blue-ocean%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF/"},{"categories":["Kubernetes"],"content":"ç°è±¡ k8s æŸå°ä¸»æœºçš„/var/lib/kubeletç›®å½•å­˜å‚¨ä½¿ç”¨ç‡è¶…è¿‡80% ä½¿ç”¨äº†40å¤šGå­˜å‚¨ ","date":"2023-04-04","objectID":"/kubelet%E7%9B%AE%E5%BD%95%E6%BB%A1%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/:1:0","tags":["Kubernetes"],"title":"kubeletç›®å½•æ»¡é—®é¢˜è®°å½•","uri":"/kubelet%E7%9B%AE%E5%BD%95%E6%BB%A1%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"categories":["Kubernetes"],"content":"åˆ†æ ç”³è¯·rootæƒé™ cd /var/lib/kubelet æ‰§è¡Œdu -h -d 1 å‘ç° podç›®å½•å æ®å¤§é‡å­˜å‚¨ cd pod ç»§ç»­æ‰§è¡Œdu -h -d 1 å®šä½åˆ°pod 2753dcf9-4113-4e65-a944-278bcbd8d6d8 æŒ‰ä¸Šé¢æ–¹æ³•ç»§ç»­æ‰§è¡Œ å‘ç°æœ€ç»ˆè·¯å¾„ä¸º /var/lib/kubelet/pods/2753dcf9-4113-4e65-a944-278bcbd8d6d8/volumes/kubernetes.io~empty-dir/storage-volume docker ps|grep 2753dcf9-4113-4e65-a944-278bcbd8d6d8 å®šä½å®¹å™¨ä¸ºprometheus docker inspect 122ec2fbbd1e kubelet\rè¯¥å®¹å™¨ä½¿ç”¨äº†empty-diræŒ‚è½½å†…éƒ¨çš„/data ","date":"2023-04-04","objectID":"/kubelet%E7%9B%AE%E5%BD%95%E6%BB%A1%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/:2:0","tags":["Kubernetes"],"title":"kubeletç›®å½•æ»¡é—®é¢˜è®°å½•","uri":"/kubelet%E7%9B%AE%E5%BD%95%E6%BB%A1%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"categories":["Kubernetes"],"content":"kube-dnsåˆ‡æ¢ä¸ºcoredns k8sç‰ˆæœ¬åŠå…¶dnsé€‚é…ç‰ˆæœ¬ k8sç‰ˆæœ¬ corednsç‰ˆæœ¬ é•œåƒ é•œåƒyaml 1.17 1.6.7 coredns-1.6.7.tar.gz coredns-1.6.7.yaml 1.22 1.8.4 coredns-1.8.4.tar.gz coredns-1.8.4.yaml coredns/coredns:1.6.7/1.8.4 ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:1:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"æ“ä½œ æ ¹æ®ç‰ˆæœ¬é€‰æ‹©å¯¹åº”çš„dnsé•œåƒä»¥åŠyamlæ–‡ä»¶ä¸Šä¼ åˆ°å…¶ä¸­ä¸€å°masterä¸»æœºï¼Œä»¥1.8.4 ç‰ˆæœ¬ä¸ºä¾‹ å¦‚æœæ˜¯å†…ç½‘åˆ™å°†coredns-1.6.7/1.8.4.tar.gz å‹ç¼©åŒ…è¿›è¡Œè§£å‹å¹¶ä¸Šä¼ è‡³ç°åœºçš„harborä»“åº“ï¼Œå¦‚æœå¯ä»¥è¿æ¥å¤–ç½‘åˆ™ç›´æ¥ä¿®æ”¹ coredns-1.8.4.yaml æ–‡ä»¶ï¼Œå°†ç«™ä½ç¬¦{{ image_address }} è¿›è¡Œä¿®æ”¹ ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:2:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"å°†åŸæœ‰çš„ kube-dns åœæ­¢ $ kubectl scale deploy kube-dns --replicas=0 -n kube-system $ kubectl scale deploy kube-dns-autoscaler --replicas=0 -n kube-system ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:3:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"éƒ¨ç½²coredns $ kubectl apply -f coredns.yaml ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:4:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"è¡¥å……: kube-dns vs CoreDNS CoreDNSå’Œkube-dnséƒ½æ˜¯ç”¨äºKubernetesé›†ç¾¤ä¸­çš„DNSè§£ææœåŠ¡ï¼Œå®ƒä»¬åœ¨ä¸åŒæ–¹é¢æœ‰ä¸€äº›åŒºåˆ«ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹é¢æ˜¯æ—©æœŸç‰ˆæœ¬çš„ kube-dns åœ¨ Kubernetes ä¸­ä¸»è¦æ”¯æŒ IPv4ã€‚IPv6 çš„æ”¯æŒä¸å¦‚ CoreDNS å®Œå–„ï¼Œå¹¶ä¸”åœ¨å®é™…åº”ç”¨ä¸­å¯èƒ½ä¼šé‡åˆ°é™åˆ¶ã€‚ CoreDNSï¼š CoreDNSæ˜¯ä¸€ä¸ªå¼€æºçš„ã€è½»é‡çº§çš„ã€çµæ´»çš„DNSæœåŠ¡å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€šç”¨çš„DNSæœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨äºå„ç§ä¸åŒçš„ç¯å¢ƒå’Œåœºæ™¯ï¼Œä¸ä»…é™äºKubernetesé›†ç¾¤ã€‚ CoreDNSæ˜¯ä¸€ä¸ªæ’ä»¶é©±åŠ¨çš„DNSæœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶çš„æ–¹å¼æ”¯æŒå„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€DNSSECç­‰ã€‚ CoreDNSåœ¨Kubernetesé›†ç¾¤ä¸­å¯ä»¥ä½œä¸ºé›†ç¾¤çš„é»˜è®¤DNSæ’ä»¶ï¼Œç”¨äºæä¾›å†…éƒ¨æœåŠ¡å‘ç°å’Œå¤–éƒ¨åŸŸåè§£æã€‚å®ƒå¯ä»¥åŠ¨æ€åœ°è§£æKubernetesé›†ç¾¤å†…éƒ¨çš„æœåŠ¡å’ŒPodï¼Œå¹¶æä¾›DNSè®°å½•ã€‚ kube-dnsï¼š kube-dnsæ˜¯Kubernetesé›†ç¾¤ä¸­çš„é»˜è®¤DNSè§£ææœåŠ¡ï¼Œæ˜¯ä¸€ç§åŸºäºSkyDNSçš„æ’ä»¶ï¼Œä¸Kubernetesç´§å¯†é›†æˆã€‚ kube-dnsä½¿ç”¨äº†ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„DNSæœåŠ¡å™¨å’Œä¸€ä¸ªå¤–éƒ¨çš„DNSæœåŠ¡å™¨é…åˆå·¥ä½œã€‚é›†ç¾¤å†…éƒ¨çš„DNSæœåŠ¡å™¨è´Ÿè´£è§£æé›†ç¾¤å†…çš„æœåŠ¡å’ŒPodï¼Œå¹¶æä¾›DNSè®°å½•ã€‚å¤–éƒ¨çš„DNSæœåŠ¡å™¨è´Ÿè´£è§£æé›†ç¾¤å¤–çš„åŸŸåï¼Œå¹¶æä¾›DNSè®°å½•ã€‚ kube-dnsçš„ä¼˜ç‚¹æ˜¯å®ƒæ˜¯Kubernetesçš„é»˜è®¤è§£æå™¨ï¼Œæ˜“äºé…ç½®å’Œä½¿ç”¨ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åŸºæœ¬çš„æœåŠ¡å‘ç°å’ŒåŸŸåè§£æéœ€æ±‚ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒCoreDNSé€‚ç”¨äºæ›´é€šç”¨çš„ç¯å¢ƒå’Œåœºæ™¯ï¼Œå¯ä»¥æ»¡è¶³æ›´å¤šçš„åŠŸèƒ½éœ€æ±‚ï¼Œè€Œkube-dnsæ˜¯Kubernetesé›†ç¾¤ä¸­çš„é»˜è®¤è§£æå™¨ï¼Œé€‚ç”¨äºåŸºæœ¬çš„æœåŠ¡å‘ç°å’ŒåŸŸåè§£æéœ€æ±‚ã€‚å…·ä½“ä½¿ç”¨å“ªä¸ªå–å†³äºç‰¹å®šçš„éœ€æ±‚å’Œåœºæ™¯ã€‚ ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:5:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"å‚è€ƒ ã€kubernetesã€‘éƒ¨ç½²-CoreDNS-æœåŠ¡ ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:6:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"coredns-1.6.7.yaml apiVersion: v1 kind: ServiceAccount metadata: name: coredns namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: kubernetes.io/bootstrapping: rbac-defaults name: system:coredns rules: - apiGroups: - \"\" resources: - endpoints - services - pods - namespaces verbs: - list - watch --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \"true\" labels: kubernetes.io/bootstrapping: rbac-defaults name: system:coredns roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:coredns subjects: - kind: ServiceAccount name: coredns namespace: kube-system --- apiVersion: v1 kind: ConfigMap metadata: name: coredns namespace: kube-system data: Corefile: | .:53 { errors health { lameduck 5s } ready kubernetes cluster.local in-addr.arpa ip6.arpa { fallthrough in-addr.arpa ip6.arpa } template ANY AAAA { rcode NXDOMAIN } prometheus :9153 forward . /etc/resolv.conf cache 30 loop reload loadbalance } --- apiVersion: apps/v1 kind: Deployment metadata: name: coredns namespace: kube-system labels: k8s-app: kube-dns kubernetes.io/name: \"CoreDNS\" spec: # replicas: not specified here: # 1. Default is 1. # 2. Will be tuned in real time if DNS horizontal auto-scaling is turned on. strategy: type: RollingUpdate rollingUpdate: maxUnavailable: 1 selector: matchLabels: k8s-app: kube-dns template: metadata: labels: k8s-app: kube-dns spec: priorityClassName: system-cluster-critical serviceAccountName: coredns tolerations: - key: \"CriticalAddonsOnly\" operator: \"Exists\" - key: node.kubernetes.io/unschedulable effect: NoSchedule nodeSelector: kubernetes.io/role: master affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 100 podAffinityTerm: labelSelector: matchExpressions: - key: k8s-app operator: In values: [\"kube-dns\"] topologyKey: kubernetes.io/hostname containers: - name: coredns image: {{ image_address }}/coredns/coredns:1.6.7 imagePullPolicy: IfNotPresent resources: limits: memory: 170Mi requests: cpu: 100m memory: 70Mi args: [ \"-conf\", \"/etc/coredns/Corefile\" ] volumeMounts: - name: config-volume mountPath: /etc/coredns readOnly: true ports: - containerPort: 53 name: dns protocol: UDP - containerPort: 53 name: dns-tcp protocol: TCP - containerPort: 9153 name: metrics protocol: TCP securityContext: allowPrivilegeEscalation: false capabilities: add: - NET_BIND_SERVICE drop: - all readOnlyRootFilesystem: true livenessProbe: httpGet: path: /health port: 8080 scheme: HTTP initialDelaySeconds: 60 timeoutSeconds: 5 successThreshold: 1 failureThreshold: 5 readinessProbe: httpGet: path: /ready port: 8181 scheme: HTTP dnsPolicy: Default volumes: - name: config-volume configMap: name: coredns items: - key: Corefile path: Corefile --- apiVersion: v1 kind: Service metadata: name: kube-dns namespace: kube-system annotations: prometheus.io/port: \"9153\" prometheus.io/scrape: \"true\" labels: k8s-app: kube-dns kubernetes.io/cluster-service: \"true\" kubernetes.io/name: \"CoreDNS\" spec: selector: k8s-app: kube-dns clusterIP: 10.254.0.2 ports: - name: dns port: 53 protocol: UDP - name: dns-tcp port: 53 protocol: TCP - name: metrics port: 9153 protocol: TCP ","date":"2023-03-29","objectID":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/:7:0","tags":["Kubernetes"],"title":"kube-dnsåˆ‡æ¢ä¸ºcorednså®è·µ","uri":"/kube-dns%E5%88%87%E6%8D%A2%E4%B8%BAcoredns%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":" å½“Kubernetesåˆ›å»ºPodæ—¶å‘ç”Ÿäº†ä»€ä¹ˆ-å…¨æ™¯å›¾ https://github.com/jamiehannaford/what-happens-when-k8s/tree/master/zh-cn what-happens-when-k8s\r","date":"2023-03-26","objectID":"/%E5%BD%93-kubernetes-%E5%88%9B%E5%BB%BA-pod-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/:0:0","tags":["Kubernetes"],"title":"å½“ Kubernetes åˆ›å»º Pod æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ","uri":"/%E5%BD%93-kubernetes-%E5%88%9B%E5%BB%BA-pod-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"},{"categories":["Helm"],"content":"é¢„ç½®æ¡ä»¶ é€‚ç”¨äºKubernetes v1.12.1åŠä»¥ä¸Šï¼ŒHelm v3.4.2åŠä»¥ä¸Šã€‚ ä»¥test-cmdbåº”ç”¨ä¸ºä¾‹è¿›è¡Œè¯´æ˜,test-cmdbä¸ºéƒ¨ç½²åœ¨k8sä¸­çš„web åº”ç”¨ ","date":"2023-03-20","objectID":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/:1:0","tags":["Helm"],"title":"Helm charts ç¼–å†™æ¨¡æ¿è¯´æ˜","uri":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/"},{"categories":["Helm"],"content":"ç›®å½•ç»“æ„ test-cmdb â”œâ”€â”€ Chart.yaml â”œâ”€â”€ files â”‚Â â””â”€â”€ application.properties â”œâ”€â”€ templates â”‚Â â”œâ”€â”€ configmap.yaml â”‚Â â”œâ”€â”€ deployment.yaml â”‚Â â”œâ”€â”€ _helpers.tpl â”‚Â â”œâ”€â”€ ingress.yaml â”‚Â â”œâ”€â”€ NOTES.txt â”‚Â â””â”€â”€ service.yaml â””â”€â”€ values.yaml â€‹ 2 directories, 9 files ç›®å½•åŠæ–‡ä»¶æè¿°ï¼š ç±»å‹ åç§° æè¿° D test-cmdb åº”ç”¨åç§°ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡åº”ç”¨è¿›è¡Œå‘½åã€‚ F Chart.yaml æ–‡ä»¶åŒ…å«äº†è¯¥chartçš„æè¿°ã€‚ D files é…ç½®æ–‡ä»¶ç›®å½• F application.properties é…ç½®æ–‡ä»¶ D templates ç›®å½•åŒ…æ‹¬äº†æ¨¡æ¿æ–‡ä»¶ã€‚å½“Helmè¯„ä¼°chartæ—¶ï¼Œä¼šé€šè¿‡æ¨¡æ¿æ¸²æŸ“å¼•æ“å°†æ‰€æœ‰æ–‡ä»¶å‘é€åˆ°templates/ç›®å½•ä¸­ã€‚ ç„¶åæ”¶é›†æ¨¡æ¿çš„ç»“æœå¹¶å‘é€ç»™Kubernetesã€‚ F configmap.yaml configmapæ¨¡æ¿ F deployment.yaml deploymentæ¨¡æ¿ F _helpers.tpl æ”¾ç½®å¯ä»¥é€šè¿‡chartå¤ç”¨çš„æ¨¡æ¿è¾…åŠ©å¯¹è±¡ F ingress.yaml ingressæ¨¡æ¿ã€‚ F NOTES.txt chartçš„\"å¸®åŠ©æ–‡æœ¬\"ã€‚ä¼šåœ¨ç”¨æˆ·æ‰§è¡Œhelm installæ—¶å±•ç¤ºã€‚ F service.yaml serviceæ¨¡æ¿ã€‚ F values.yaml chartçš„é»˜è®¤å€¼ã€‚ä¼šåœ¨ç”¨æˆ·æ‰§è¡Œhelm install æˆ– helm upgradeæ—¶è¢«è¦†ç›–ã€‚ å…¶ä¸­ï¼Œç±»å‹ï¼šDï¼Œç›®å½•ï¼›Fï¼Œæ–‡ä»¶ã€‚ ","date":"2023-03-20","objectID":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/:2:0","tags":["Helm"],"title":"Helm charts ç¼–å†™æ¨¡æ¿è¯´æ˜","uri":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/"},{"categories":["Helm"],"content":"é…ç½®èµ„æº ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨éƒ¨ç½²é€šå¸¸ç”±åº”ç”¨åç§°ã€é•œåƒåç§°åŠtagã€ç¯å¢ƒå˜é‡ã€èµ„æºé™é¢ã€ç«¯å£ç›‘å¬ã€ç«¯å£æ˜ å°„ã€ç›®å½•/æ–‡ä»¶æŒ‚è½½ã€é…ç½®æ–‡ä»¶ã€ç½‘å…³è§„åˆ™ç­‰ç»„æˆã€‚é€šè¿‡helmå°†åº”ç”¨æ¨¡æ¿åŒ–ï¼Œä»…éœ€è¦ç®€å•é…ç½®äº›è®¸åœ°æ–¹å³å¯ã€‚ åº”ç”¨åç§° æ–‡ä»¶å key Chart.yaml name values.yaml fullnameOverride é•œåƒåç§°åŠtag æ–‡ä»¶å key values.yaml image.repository values.yaml image.tag å½“å‰çš„æ¨¡æ¿é»˜è®¤æ˜¯ä»¥é•œåƒåç§°ä¸åº”ç”¨åç§°ä¿æŒä¸€è‡´ä¸ºå‰æçš„ï¼Œå¦‚é•œåƒ10.45.80.1/iplatform/test-cmdb:C_20220214144619çš„åç§°ä¸ºtest-cmdbä¸åº”ç”¨åç§°test-cmdbä¿æŒä¸€è‡´ã€‚å‡å¦‚å®é™…çš„åº”ç”¨åä¸é•œåƒåç§°ä¸ä¸€è‡´ï¼Œè¯·è‡ªè¡Œä¿®æ”¹_helpers.tplä¸­çš„fullimageéƒ¨åˆ†ã€‚ ä¿®æ”¹å‰ {{- define \"zcm-tpl.fullimage\" -}} {{- .Values.global.repository }}/{{ .Values.image.repository }}:{{ index .Values .Chart.Name \"image\" \"tag\" | default .Chart.AppVersion }} {{- end }} ä¿®æ”¹å {{- define \"zcm-tpl.fullimage\" -}} {{- .Values.global.repository }}/{{ .Values.image.repository }}:{{ index .Values \"name-template\" \"image\" \"tag\" | default .Chart.AppVersion }} {{- end }} å…¶ä¸­ï¼Œname-templateä¸ºå®é™…çš„é•œåƒåç§°ï¼Œè¯¥é•œåƒä¿¡æ¯é…ç½®åœ¨$HELM_PATH/charts/values.yamlä¸­ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸­æ²¡æœ‰åŒ¹é…çš„ä¿¡æ¯ï¼Œå½“åœ¨éƒ¨ç½²æ—¶ä¼šæç¤ºå¼‚å¸¸ã€‚ ç¯å¢ƒå˜é‡ æ–‡ä»¶å key values.yaml env.name values.yaml env.value values.yaml env.valueFrom.configMapKeyRef.name values.yaml env.valueFrom.configMapKeyRef.key èµ„æºé™é¢ æ–‡ä»¶å key values.yaml resources.requests.cpu values.yaml resources.requests.memory values.yaml resources.limits.cpu values.yaml resources.limits.memory ç«¯å£ç›‘å¬ æ–‡ä»¶å key values.yaml ports.containerPort values.yaml ports.protocol values.yaml ports.name ç«¯å£æ˜ å°„ æ–‡ä»¶å key values.yaml service.ports.name values.yaml service.ports.port values.yaml service.ports.targetPort ç›®å½•/æ–‡ä»¶æŒ‚è½½ æ–‡ä»¶å key values.yaml volumeMounts.name values.yaml volumeMounts.mountPath values.yaml volumeMounts.readOnly values.yaml volumeMounts.subPath values.yaml volumes.name values.yaml volumes.hostpath.path é…ç½®æ–‡ä»¶ æ–‡ä»¶å key values.yaml cm.name values.yaml cm.configmap.name ç½‘å…³è§„åˆ™ æ–‡ä»¶å key values.yaml ingress.annotations values.yaml ingress.tls values.yaml ingress.hosts.paths.path values.yaml ingress.hosts.paths.pathType values.yaml ingress.hosts.paths.port ","date":"2023-03-20","objectID":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/:3:0","tags":["Helm"],"title":"Helm charts ç¼–å†™æ¨¡æ¿è¯´æ˜","uri":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/"},{"categories":["Helm"],"content":"éƒ¨ç½²æµ‹è¯• å°†å‡†å¤‡å¥½çš„chartæ”¾åˆ°ZCMéƒ¨ç½²ä¸»æœº$HELM_PATH/chartsç›®å½•ä¸‹ï¼Œé•œåƒæ¨é€åˆ°å¯¹åº”ç¯å¢ƒçš„é•œåƒä»“åº“ä¸­ï¼Œå¹¶åœ¨$HELM_PATH/charts/values.yamlä¸­é…ç½®é•œåƒä¿¡æ¯ï¼Œ å¦‚é•œåƒ10.45.80.1/iplatform/zcm-crms:T_20220411015401ï¼Œéœ€é…ç½®å¯¹åº”çš„ä¿¡æ¯å¦‚ä¸‹ï¼š zcm-crms: image: tag: T_20220411015401 æ‰§è¡Œéƒ¨ç½²æ“ä½œ cd $HELM_PATH/charts helm install zcm-crms ./zcm-crms -f values.yaml -n backend ä¹Ÿå¯æ‰§è¡Œå…¶ä»–ç›¸å…³æ“ä½œ å‡çº§ helm upgrade zcm-crms ./zcm-crms -f values.yaml -n backend å¸è½½ helm uninstall zcm-crms -n backend ","date":"2023-03-20","objectID":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/:4:0","tags":["Helm"],"title":"Helm charts ç¼–å†™æ¨¡æ¿è¯´æ˜","uri":"/helm_charts%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF%E8%AF%B4%E6%98%8E/"},{"categories":["Kubernetes"],"content":"è®°å½•ä¸€ä¸‹kuberntes é‡åˆ°çš„é—®é¢˜åœºæ™¯åŠæ’æŸ¥æ–¹å‘ ","date":"2022-09-28","objectID":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/:0:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes ç½‘ç»œæ’éšœ","uri":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/"},{"categories":["Kubernetes"],"content":"DNS è§£æå¼‚å¸¸ 5 ç§’å»¶æ—¶ å¦‚æœDNSæŸ¥è¯¢ç»å¸¸å»¶æ—¶5ç§’æ‰è¿”å›ï¼Œé€šå¸¸æ˜¯é‡åˆ°å†…æ ¸ conntrack å†²çªå¯¼è‡´çš„ä¸¢åŒ… ","date":"2022-09-28","objectID":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes ç½‘ç»œæ’éšœ","uri":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/"},{"categories":["Kubernetes"],"content":"è§£æè¶…æ—¶ å¦‚æœå®¹å™¨å†…æŠ¥ DNS è§£æè¶…æ—¶ï¼Œå…ˆæ£€æŸ¥ä¸‹é›†ç¾¤ DNS æœåŠ¡ (kube-dns/coredns) çš„ Pod æ˜¯å¦ Readyï¼Œå¦‚æœä¸æ˜¯ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ã€‚å¦‚æœè¿è¡Œæ­£å¸¸ï¼Œå†å…·ä½“çœ‹ä¸‹è¶…æ—¶ç°è±¡ã€‚ ","date":"2022-09-28","objectID":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/:1:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes ç½‘ç»œæ’éšœ","uri":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/"},{"categories":["Kubernetes"],"content":"Service æ— æ³•è§£æ é›†ç¾¤ DNS æ²¡æœ‰æ­£å¸¸è¿è¡Œ(kube-dnsæˆ–CoreDNS) æ£€æŸ¥é›†ç¾¤ DNS æ˜¯å¦è¿è¡Œæ­£å¸¸: kubelet å¯åŠ¨å‚æ•° â€“cluster-dns å¯ä»¥çœ‹åˆ° dns æœåŠ¡çš„ cluster ip: $ ps -ef | grep kubelet ... /usr/bin/kubelet --cluster-dns=172.16.14.217 ... æˆ–è€…æ”¾ç½®é…ç½®æ–‡ä»¶ä¸­ $ cat /var/lib/kubelet/config.yaml|grep clusterDNS -A 2 clusterDNS: - 172.16.0.10 clusterDomain: cluster.local æ‰¾åˆ° dns çš„ service: $ kubectl get svc -n kube-system | grep 172.16.14.217 kube-dns ClusterIP 172.16.14.217 \u003cnone\u003e 53/TCP,53/UDP 47d çœ‹æ˜¯å¦å­˜åœ¨ endpoint: $ kubectl -n kube-system describe svc kube-dns | grep -i endpoints Endpoints: 172.16.0.156:53,172.16.0.167:53 Endpoints: 172.16.0.156:53,172.16.0.167:53 æ£€æŸ¥ endpoint çš„ å¯¹åº” pod æ˜¯å¦æ­£å¸¸: $ kubectl -n kube-system get pod -o wide | grep 172.16.0.156 kube-dns-898dbbfc6-hvwlr 3/3 Running 0 8d 172.16.0.156 10.0.0.3 ","date":"2022-09-28","objectID":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes ç½‘ç»œæ’éšœ","uri":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/"},{"categories":["Kubernetes"],"content":"Pod ä¸ DNS æœåŠ¡ä¹‹é—´ç½‘ç»œä¸é€š æ£€æŸ¥ä¸‹ pod æ˜¯å¦è¿ä¸ä¸Š dns æœåŠ¡ï¼Œå¯ä»¥åœ¨ pod é‡Œ telnet ä¸€ä¸‹ dns çš„ 53 ç«¯å£: # è¿ dns service çš„ cluster ip $ telnet 172.16.14.217 53 å¦‚æœæ£€æŸ¥åˆ°æ˜¯ç½‘ç»œä¸é€šï¼Œå°±éœ€è¦æ’æŸ¥ä¸‹ç½‘ç»œè®¾ç½®: æ£€æŸ¥èŠ‚ç‚¹çš„å®‰å…¨ç»„è®¾ç½®ï¼Œéœ€è¦æ”¾å¼€é›†ç¾¤çš„å®¹å™¨ç½‘æ®µ æ£€æŸ¥æ˜¯å¦è¿˜æœ‰é˜²ç«å¢™è§„åˆ™ï¼Œæ£€æŸ¥ iptables ","date":"2022-09-28","objectID":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/:2:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes ç½‘ç»œæ’éšœ","uri":"/kubernetes-%E7%BD%91%E7%BB%9C%E6%8E%92%E9%94%99/"},{"categories":["prometheus"],"content":"\rPromQL\r","date":"2022-08-29","objectID":"/promql/:0:0","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"ä»‹ç» PromQL æ˜¯ Prometheus å†…ç½®çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå…¶æä¾›å¯¹æ—¶é—´åºåˆ—æ•°æ®ä¸°å¯Œçš„æŸ¥è¯¢ï¼Œèšåˆä»¥åŠé€»è¾‘è¿ç®—èƒ½åŠ›çš„æ”¯æŒã€‚ å¹¶ä¸”è¢«å¹¿æ³›åº”ç”¨åœ¨ Prometheus çš„æ—¥å¸¸åº”ç”¨å½“ä¸­ï¼ŒåŒ…æ‹¬å¯¹æ•°æ®æŸ¥è¯¢ã€å¯è§†åŒ–ã€å‘Šè­¦å¤„ç†ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼ŒPromQL æ˜¯ Prometheus æ‰€æœ‰åº”ç”¨åœºæ™¯çš„åŸºç¡€ï¼Œç†è§£å’ŒæŒæ¡ PromQL æ˜¯æˆ‘ä»¬ä½¿ç”¨ Prometheus å¿…å¤‡çš„æŠ€èƒ½ã€‚ ","date":"2022-08-29","objectID":"/promql/:1:0","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"PromQL ç®€ä»‹ Prometheus Query Language (PromQL) æ˜¯ä¸€ä¸ªä¸“ä¸ºPrometheusç›‘æ§ç³»ç»Ÿè®¾è®¡çš„å¼ºå¤§æŸ¥è¯¢è¯­è¨€ï¼Œ å®ƒå…è®¸ç”¨æˆ·å¯¹æ”¶é›†çš„æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œé«˜æ•ˆã€çµæ´»çš„æŸ¥è¯¢å’Œåˆ†æã€‚PromQLçš„è®¾è®¡å“²å­¦åœ¨äºæä¾›ç®€æ´è€Œå¼ºå¤§çš„è¯­æ³•ï¼Œä»¥æ”¯æŒå¤æ‚çš„æ•°æ®æ£€ç´¢å’Œå®æ—¶ç›‘æ§åœºæ™¯ Prometheuså’ŒPromQLçš„å…³ç³» Prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„ç³»ç»Ÿç›‘æ§å’Œè­¦æŠ¥å·¥å…·åŒ…ï¼Œå¹¿æ³›ç”¨äºäº‘åŸç”Ÿç¯å¢ƒä¸­ã€‚å®ƒé€šè¿‡æ”¶é›†å’Œå­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ï¼Œæ”¯æŒå®æ—¶ç›‘æ§å’Œè­¦æŠ¥ã€‚ PromQLä½œä¸ºPrometheusçš„æ ¸å¿ƒç»„ä»¶ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ£€ç´¢å’Œåˆ†æã€‚æ— è®ºæ˜¯ç®€å•çš„æ•°æ®æŸ¥çœ‹è¿˜æ˜¯å¤æ‚çš„æ€§èƒ½åˆ†æï¼Œ PromQLéƒ½èƒ½å¤Ÿæä¾›å¿…è¦çš„å·¥å…·æ¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚ PromQLçš„è®¾è®¡å“²å­¦ PromQLçš„è®¾è®¡å“²å­¦å›´ç»•ç€å‡ ä¸ªå…³é”®ç‚¹ï¼šçµæ´»æ€§ã€è¡¨ç°åŠ›å’Œæ€§èƒ½ã€‚å®ƒæ—¨åœ¨æä¾›è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œä»¥æ”¯æŒä»ç®€å•åˆ°å¤æ‚çš„å„ç§æŸ¥è¯¢éœ€æ±‚ï¼Œ åŒæ—¶ä¿æŒæŸ¥è¯¢è¡¨è¾¾å¼çš„ç®€æ´æ€§ã€‚æ­¤å¤–ï¼ŒPromQLç»è¿‡ä¼˜åŒ–ä»¥æ”¯æŒé«˜æ•ˆçš„æ•°æ®å¤„ç†å’Œæ£€ç´¢ï¼Œè¿™å¯¹äºå®æ—¶ç›‘æ§ç³»ç»Ÿæ¥è¯´è‡³å…³é‡è¦ã€‚ ","date":"2022-08-29","objectID":"/promql/:1:1","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"PromQLåŸºç¡€æ¦‚å¿µ ","date":"2022-08-29","objectID":"/promql/:2:0","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"æ•°æ®ç±»å‹å’Œç»“æ„ åœ¨PromQLä¸­ï¼Œä¸»è¦æ“ä½œä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š å³æ—¶å‘é‡ï¼ˆInstant Vectorï¼‰ å³æ—¶å‘é‡æ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šçš„ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œæ¯ä¸ªæ—¶é—´åºåˆ—å…·æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡ç­¾é›†åˆå’Œä¸€ä¸ªæ•°å€¼ã€‚å®ƒé€šå¸¸ç”¨äºè¡¨ç¤ºæŸä¸€ç¬é—´çš„ç³»ç»ŸçŠ¶æ€ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„CPUä½¿ç”¨ç‡çš„æ—¶é—´åºåˆ—ï¼Œå…¶æŸ¥è¯¢è¡¨è¾¾å¼å¯èƒ½å¦‚ä¸‹ï¼š cpu_usage{host=\"server01\"} è¯¥æŸ¥è¯¢è¿”å›â€œserver01â€ä¸»æœºä¸Šæœ€æ–°çš„CPUä½¿ç”¨ç‡æ•°æ®ã€‚ åŒºé—´å‘é‡ï¼ˆRange Vectorï¼‰ åŒºé—´å‘é‡æ˜¯åœ¨ä¸€æ®µæ—¶é—´èŒƒå›´å†…çš„ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ†ææ—¶é—´åºåˆ—çš„å˜åŒ–è¶‹åŠ¿æˆ–è®¡ç®—æ—¶é—´åºåˆ—çš„ç§»åŠ¨å¹³å‡ç­‰ã€‚ è¦æŸ¥è¯¢è¿‡å»5åˆ†é’Ÿå†…server01ä¸»æœºçš„CPUä½¿ç”¨ç‡æ•°æ®ï¼š cpu_usage{host=\"server01\"}[5m] æ ‡é‡ï¼ˆScalarï¼‰ æ ‡é‡æ˜¯ä¸€ä¸ªç®€å•çš„æ•°å€¼ç±»å‹ï¼Œå®ƒä¸å¸¦æœ‰æ—¶é—´æˆ³ï¼Œé€šå¸¸ç”¨äºæ•°å­¦è®¡ç®—æˆ–ä¸æ—¶é—´åºåˆ—æ•°æ®çš„æ¯”è¾ƒã€‚ å‡è®¾æˆ‘ä»¬æƒ³è¦å°†server01ä¸»æœºçš„CPUä½¿ç”¨ç‡ä¸ä¸€ä¸ªå›ºå®šé˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼š cpu_usage{host=\"server01\"} \u003e 80 è¿™é‡Œâ€œ80â€å°±æ˜¯ä¸€ä¸ªæ ‡é‡å€¼ã€‚ å­—ç¬¦ä¸²ï¼ˆStringï¼‰ å­—ç¬¦ä¸²ç±»å‹åœ¨PromQLä¸­ç”¨å¾—è¾ƒå°‘ï¼Œä¸»è¦ç”¨äºæ ‡ç­¾å€¼çš„å±•ç¤ºã€‚ ","date":"2022-08-29","objectID":"/promql/:2:1","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰å’ŒæŒ‡æ ‡ï¼ˆMetricsï¼‰ æ—¶é—´åºåˆ— åœ¨æ—¶é—´åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªç‚¹ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰ï¼Œæ ·æœ¬ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š æŒ‡æ ‡(metric)ï¼šmetric name å’Œæè¿°å½“å‰æ ·æœ¬ç‰¹å¾çš„ labelsets æ—¶é—´æˆ³(timestamp)ï¼šä¸€ä¸ªç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³ æ ·æœ¬å€¼(value)ï¼š ä¸€ä¸ª float64 çš„æµ®ç‚¹å‹æ•°æ®è¡¨ç¤ºå½“å‰æ ·æœ¬çš„å€¼ ç¤ºä¾‹ \u003c--------------- metric ---------------------\u003e\u003c-timestamp -\u003e\u003c-value-\u003e http_request_total{status=\"200\", method=\"GET\"}@1434417560938 =\u003e 94355 http_request_total{status=\"200\", method=\"GET\"}@1434417561287 =\u003e 94334 http_request_total{status=\"404\", method=\"GET\"}@1434417560938 =\u003e 38473 http_request_total{status=\"404\", method=\"GET\"}@1434417561287 =\u003e 38544 http_request_total{status=\"200\", method=\"POST\"}@1434417560938 =\u003e 4748 http_request_total{status=\"200\", method=\"POST\"}@1434417561287 =\u003e 4785 æŒ‡æ ‡ç±»å‹ ä»å­˜å‚¨ä¸Šæ¥è®²æ‰€æœ‰çš„ç›‘æ§æŒ‡æ ‡ metric éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„åœºæ™¯ä¸‹è¿™äº› metric åˆæœ‰ä¸€äº›ç»†å¾®çš„å·®å¼‚ã€‚ ä¾‹å¦‚ï¼Œåœ¨ Node Exporter è¿”å›çš„æ ·æœ¬ä¸­æŒ‡æ ‡ node_load1 ååº”çš„æ˜¯å½“å‰ç³»ç»Ÿçš„è´Ÿè½½çŠ¶æ€ï¼Œéšç€æ—¶é—´çš„å˜åŒ–è¿™ä¸ªæŒ‡æ ‡è¿”å›çš„æ ·æœ¬æ•°æ®æ˜¯åœ¨ä¸æ–­å˜åŒ–çš„ã€‚ è€ŒæŒ‡æ ‡ node_cpu_seconds_total æ‰€è·å–åˆ°çš„æ ·æœ¬æ•°æ®å´ä¸åŒï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒç»­å¢å¤§çš„å€¼ï¼Œå› ä¸ºå…¶ååº”çš„æ˜¯ CPU çš„ç´¯è®¡ä½¿ç”¨æ—¶é—´ï¼Œä»ç†è®ºä¸Šè®²åªè¦ç³»ç»Ÿä¸å…³æœºï¼Œè¿™ä¸ªå€¼æ˜¯ä¼šä¸€ç›´å˜å¤§ã€‚ ä¸ºäº†èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·ç†è§£å’ŒåŒºåˆ†è¿™äº›ä¸åŒç›‘æ§æŒ‡æ ‡ä¹‹é—´çš„å·®å¼‚ï¼ŒPrometheus å®šä¹‰äº† 4 ç§ä¸åŒçš„æŒ‡æ ‡ç±»å‹ï¼š Counterï¼ˆè®¡æ•°å™¨ï¼‰ Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰ Histogramï¼ˆç›´æ–¹å›¾ï¼‰ Summaryï¼ˆæ‘˜è¦ï¼‰ åœ¨ node-exporter è¿”å›çš„æ ·æœ¬æ•°æ®ä¸­ï¼Œå…¶æ³¨é‡Šä¸­ä¹ŸåŒ…å«äº†è¯¥æ ·æœ¬çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š # HELP node_cpu_seconds_total Seconds the cpus spent in each mode. # TYPE node_cpu_seconds_total counter node_cpu_seconds_total{cpu=\"cpu0\",mode=\"idle\"} 362812.7890625 Counter Counter (åªå¢ä¸å‡çš„è®¡æ•°å™¨) ç±»å‹çš„æŒ‡æ ‡å…¶å·¥ä½œæ–¹å¼å’Œè®¡æ•°å™¨ä¸€æ ·ï¼Œåªå¢ä¸å‡ã€‚å¸¸è§çš„ç›‘æ§æŒ‡æ ‡ï¼Œå¦‚ http_requests_totalã€node_cpu_seconds_total éƒ½æ˜¯ Counter ç±»å‹çš„ç›‘æ§æŒ‡æ ‡ã€‚ Counter æ˜¯ä¸€ä¸ªç®€å•ä½†åˆå¼ºå¤§çš„å·¥å…·ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®°å½•æŸäº›äº‹ä»¶å‘ç”Ÿçš„æ¬¡æ•°ï¼Œé€šè¿‡ä»¥æ—¶é—´åºåˆ—çš„å½¢å¼å­˜å‚¨è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„äº†è§£è¯¥äº‹ä»¶äº§ç”Ÿçš„é€Ÿç‡å˜åŒ–ã€‚PromQL å†…ç½®çš„èšåˆæ“ä½œå’Œå‡½æ•°å¯ä»¥è®©ç”¨æˆ·å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ rate() å‡½æ•°è·å– HTTP è¯·æ±‚é‡çš„å¢é•¿ç‡ï¼š rate(prometheus_http_requests_total[5m]) or rate(http_requests_total[5m]) Gauge ä¸ Counter ä¸åŒï¼ŒGaugeï¼ˆå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜ï¼‰ç±»å‹çš„æŒ‡æ ‡ä¾§é‡äºååº”ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚å› æ­¤è¿™ç±»æŒ‡æ ‡çš„æ ·æœ¬æ•°æ®å¯å¢å¯å‡ã€‚å¸¸è§æŒ‡æ ‡å¦‚ï¼šnode_memory_MemFree_bytesï¼ˆä¸»æœºå½“å‰ç©ºé—²çš„å†…å­˜å¤§å°ï¼‰ã€node_memory_MemAvailable_bytesï¼ˆå¯ç”¨å†…å­˜å¤§å°ï¼‰éƒ½æ˜¯ Gauge ç±»å‹çš„ç›‘æ§æŒ‡æ ‡ã€‚ é€šè¿‡ Gauge æŒ‡æ ‡ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥æŸ¥çœ‹ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ï¼š node_memory_MemFree_bytes Histogram å’Œ Summary é™¤äº† Counter å’Œ Gauge ç±»å‹çš„ç›‘æ§æŒ‡æ ‡ä»¥å¤–ï¼ŒPrometheus è¿˜å®šä¹‰äº† Histogram å’Œ Summary çš„æŒ‡æ ‡ç±»å‹ã€‚Histogram å’Œ Summary ä¸»ç”¨ç”¨äºç»Ÿè®¡å’Œåˆ†ææ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹äººä»¬éƒ½å€¾å‘äºä½¿ç”¨æŸäº›é‡åŒ–æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œä¾‹å¦‚ CPU çš„å¹³å‡ä½¿ç”¨ç‡ã€é¡µé¢çš„å¹³å‡å“åº”æ—¶é—´ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œä»¥ç³»ç»Ÿ API è°ƒç”¨çš„å¹³å‡å“åº”æ—¶é—´ä¸ºä¾‹ï¼šå¦‚æœå¤§å¤šæ•° API è¯·æ±‚éƒ½ç»´æŒåœ¨ 100ms çš„å“åº”æ—¶é—´èŒƒå›´å†…ï¼Œè€Œä¸ªåˆ«è¯·æ±‚çš„å“åº”æ—¶é—´éœ€è¦ 5sï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æŸäº› WEB é¡µé¢çš„å“åº”æ—¶é—´è½åˆ°ä¸­ä½æ•°ä¸Šï¼Œè€Œè¿™ç§ç°è±¡è¢«ç§°ä¸ºé•¿å°¾é—®é¢˜ã€‚ ä¸ºäº†åŒºåˆ†æ˜¯å¹³å‡çš„æ…¢è¿˜æ˜¯é•¿å°¾çš„æ…¢ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æŒ‰ç…§è¯·æ±‚å»¶è¿Ÿçš„èŒƒå›´è¿›è¡Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡å»¶è¿Ÿåœ¨ 0~10ms ä¹‹é—´çš„è¯·æ±‚æ•°æœ‰å¤šå°‘è€Œ 10~20ms ä¹‹é—´çš„è¯·æ±‚æ•°åˆæœ‰å¤šå°‘ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å¿«é€Ÿåˆ†æç³»ç»Ÿæ…¢çš„åŸå› ã€‚Histogram å’Œ Summary éƒ½æ˜¯ä¸ºäº†èƒ½å¤Ÿè§£å†³è¿™æ ·çš„é—®é¢˜å­˜åœ¨çš„ï¼Œé€šè¿‡ Histogram å’ŒSummary ç±»å‹çš„ç›‘æ§æŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿäº†è§£ç›‘æ§æ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µã€‚ ä¾‹å¦‚ï¼ŒæŒ‡æ ‡ prometheus_tsdb_wal_fsync_duration_seconds çš„æŒ‡æ ‡ç±»å‹ä¸º Summaryã€‚å®ƒè®°å½•äº† Prometheus Server ä¸­ wal_fsync çš„å¤„ç†æ—¶é—´ï¼Œé€šè¿‡è®¿é—® Prometheus Server çš„ /metrics åœ°å€ï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ç›‘æ§æ ·æœ¬æ•°æ®ï¼š # HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync. # TYPE prometheus_tsdb_wal_fsync_duration_seconds summary prometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.5\"} 0.012352463 prometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.9\"} 0.014458005 prometheus_tsdb_wal_fsync_duration_seconds{quantile=\"0.99\"} 0.017316173 prometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002 prometheus_tsdb_wal_fsync_duration_seconds_count 216 ä»ä¸Šé¢çš„æ ·æœ¬ä¸­å¯ä»¥å¾—çŸ¥å½“å‰ Prometheus Server è¿›è¡Œ wal_fsync æ“ä½œçš„æ€»æ¬¡æ•°ä¸º 216 æ¬¡ï¼Œè€—æ—¶ 2.888716127000002sã€‚å…¶ä¸­ä¸­ä½æ•°ï¼ˆquantile=0.5ï¼‰çš„è€—æ—¶ä¸º 0.012352463ï¼Œ9 åˆ†ä½æ•°ï¼ˆquantile=0.9ï¼‰çš„è€—æ—¶ä¸º 0.014458005sã€‚ åœ¨ Prometheus Server è‡ªèº«è¿”å›çš„æ ·æœ¬æ•°æ®ä¸­ï¼Œæˆ‘ä»¬è¿˜èƒ½æ‰¾åˆ°ç±»å‹ä¸º Histogram çš„ç›‘æ§æŒ‡æ ‡prometheus_tsdb_compaction_chunk_range_seconds_bucketï¼š # HELP prometheus_tsdb_compaction_chunk_range_seconds Final time range of chunks on their first compaction # TYPE prometheus_tsdb_compaction_chunk_range_seconds histogram prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"100\"} 71 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"400\"} 71 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"1600\"} 71 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"6400\"} 71 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"25600\"} 405 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"102400\"} 25690 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"409600\"} 71863 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"1.6384e+06\"} 115928 prometheus_tsdb_compaction_chunk_range_seconds_bucket{le=\"6.5536e+06\"} 2.5687892e+07 promet","date":"2022-08-29","objectID":"/promql/:2:2","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"æŸ¥è¯¢ ","date":"2022-08-29","objectID":"/promql/:3:0","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"ç®€å•æŸ¥è¯¢å’Œè¡¨è¾¾å¼ PromQL Web UI çš„ Graph é€‰é¡¹å¡æä¾›äº†ç®€å•çš„ç”¨äºæŸ¥è¯¢æ•°æ®çš„å…¥å£ è¾“å…¥ upï¼Œç„¶åç‚¹å‡» Executeï¼Œå°±èƒ½æŸ¥åˆ°ç›‘æ§æ­£å¸¸çš„ Target é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨è¿‡æ»¤å‡º job ä¸º kubernetes-pods çš„ç›‘æ§ up{job=\"kubernetes-pods\"} æ³¨æ„æ­¤æ—¶æ˜¯ up{job=â€œnode-exporterâ€}å±äºç»å¯¹åŒ¹é…ï¼ŒPromQL ä¹Ÿæ”¯æŒå¦‚ä¸‹è¡¨è¾¾å¼ï¼š !=ï¼šä¸ç­‰äºï¼› =~ï¼šè¡¨ç¤ºç­‰äºç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æŒ‡æ ‡ï¼› !~ï¼šå’Œ=~ç±»ä¼¼ï¼Œ=~è¡¨ç¤ºæ­£åˆ™åŒ¹é…ï¼Œ!~è¡¨ç¤ºæ­£åˆ™ä¸åŒ¹é…ã€‚ å¦‚æœæƒ³è¦æŸ¥çœ‹ä¸»æœºç›‘æ§çš„æŒ‡æ ‡æœ‰å“ªäº›ï¼Œå¯ä»¥è¾“å…¥ nodeï¼Œä¼šæç¤ºæ‰€æœ‰ä¸»æœºç›‘æ§çš„æŒ‡æ ‡ï¼š æŸ¥è¯¢\rå‡ å¦‚ æƒ³ è¦ æŸ¥ è¯¢ Kubernetes é›† ç¾¤ ä¸­ æ¯ ä¸ª å®¿ ä¸» æœº çš„ ç£ ç›˜ æ€» é‡ ï¼Œ å¯ ä»¥ ä½¿ ç”¨node_filesystem_size_bytes æŸ¥è¯¢æŒ‡å®šåˆ†åŒºå¤§å° node_filesystem_size_bytes{mountpoint=\"/\"}ï¼š æˆ–è€…æ˜¯æŸ¥è¯¢åˆ†åŒºä¸æ˜¯/bootï¼Œä¸”ç£ç›˜æ˜¯/dev/å¼€å¤´çš„åˆ†åŒºå¤§å°ï¼ˆç»“æœä¸å†å±•ç¤ºï¼‰ï¼š node_filesystem_size_bytes{device=~\"/dev/.*\", mountpoint!=\"/boot\"} æŸ¥è¯¢ä¸»æœº 192.168.1.11 åœ¨æœ€è¿‘ 5 åˆ†é’Ÿå¯ç”¨çš„ç£ç›˜ç©ºé—´å˜åŒ–ï¼š node_filesystem_size_bytes{mountpoint=\"/\",instance=\"192.168.1.11:9100\"}[5m] ç›®å‰æ”¯æŒçš„èŒƒå›´å•ä½å¦‚ä¸‹ï¼š sï¼šç§’ mï¼šåˆ†é’Ÿ hï¼šå°æ—¶ dï¼šå¤© wï¼šå‘¨ yï¼šå¹´ æŸ¥è¯¢ 10 åˆ†é’Ÿä¹‹å‰ç£ç›˜å¯ç”¨ç©ºé—´ï¼Œåªéœ€è¦æŒ‡å®š offset å‚æ•°å³å¯ node_filesystem_avail_bytes{instance=\"192.168.1.11:9100\", mountpoint=\"/\", device=\"/dev/mapper/centos-root\"} offset 10m æŸ¥è¯¢ 10 åˆ†é’Ÿä¹‹å‰ï¼Œ5 åˆ†é’ŸåŒºé—´çš„ç£ç›˜å¯ç”¨ç©ºé—´çš„å˜åŒ– node_filesystem_avail_bytes{instance=\"192.168.1.11:9100\", mountpoint=\"/\", device=\"/dev/mapper/centos-root\"}[5m] offset 10m ","date":"2022-08-29","objectID":"/promql/:3:1","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorsï¼‰è¿‡æ»¤æ•°æ® å¤šä¸ªæ ‡ç­¾é€šè¿‡é€—å·è¿›è¡Œåˆ†éš” kubelet_http_requests_total{method=\"GET\",path =~ \"metrics.*\"} æŸ¥çœ‹ä¸»æœºè¿‡å»5åˆ†é’Ÿå·²ä½¿ç”¨å†…å­˜ node_memory_Active_bytes[5m] æŸ¥è¯¢ç»“æœ Label Selectors\ræŸ¥çœ‹10.10.192.220ä¸»æœºä¸€å°æ—¶å‰çš„ä½¿ç”¨å†…å­˜ node_memory_Active_bytes{instance=\"10.10.192.220:9100\"} offset 1h ","date":"2022-08-29","objectID":"/promql/:3:2","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["prometheus"],"content":"é«˜çº§æŸ¥è¯¢ ä½¿ç”¨PromQLé™¤äº†èƒ½å¤Ÿæ–¹ä¾¿çš„æŒ‰ç…§æŸ¥è¯¢å’Œè¿‡æ»¤æ—¶é—´åºåˆ—ä»¥å¤–ï¼ŒPromQLè¿˜æ”¯æŒä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™äº›æ“ä½œç¬¦å¯¹è¿›ä¸€æ­¥çš„å¯¹äº‹ä»¶åºåˆ—è¿›è¡ŒäºŒæ¬¡åŠ å·¥ã€‚è¿™äº›æ“ä½œç¬¦åŒ…æ‹¬ï¼šæ•°å­¦è¿ç®—ç¬¦ï¼Œé€»è¾‘è¿ç®—ç¬¦ï¼Œå¸ƒå°”è¿ç®—ç¬¦ç­‰ç­‰ã€‚ æ•°å­¦è¿ç®— ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡æ ‡node_memory_MemFree_bytesè·å–å½“å‰ä¸»æœºå¯ç”¨çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œå…¶æ ·æœ¬å•ä½ä¸ºBytesã€‚è¿™æ˜¯å¦‚æœå®¢æˆ·ç«¯è¦æ±‚ä½¿ç”¨MBä½œä¸ºå•ä½å“åº”æ•°æ®ï¼Œé‚£åªéœ€è¦å°†æŸ¥è¯¢åˆ°çš„æ—¶é—´åºåˆ—çš„æ ·æœ¬å€¼è¿›è¡Œå•ä½æ¢ç®—å³å¯ node_memory_MemFree_bytes / 1024 / 1024 PromQLæ”¯æŒçš„æ‰€æœ‰æ•°å­¦è¿ç®—ç¬¦å¦‚ä¸‹æ‰€ç¤ºï¼š ä½¿ç”¨å¸ƒå°”è¿ç®—è¿‡æ»¤æ—¶é—´åºåˆ— æŸ¥çœ‹free å†…å­˜å€¼å¤§äº512Mçš„ä¸»æœº (node_memory_MemFree_bytes / 1024 / 1024) \u003e 512 ç›®å‰ï¼ŒPrometheusæ”¯æŒä»¥ä¸‹å¸ƒå°”è¿ç®—ç¬¦å¦‚ä¸‹ï¼š != (ä¸ç›¸ç­‰) \u003e (å¤§äº) \u003c (å°äº) \u003e= (å¤§äºç­‰äº) \u003c= (å°äºç­‰äº) ä½¿ç”¨é›†åˆè¿ç®—ç¬¦ ä½¿ç”¨ç¬æ—¶å‘é‡è¡¨è¾¾å¼èƒ½å¤Ÿè·å–åˆ°ä¸€ä¸ªåŒ…å«å¤šä¸ªæ—¶é—´åºåˆ—çš„é›†åˆï¼Œæˆ‘ä»¬ç§°ä¸ºç¬æ—¶å‘é‡ã€‚ é€šè¿‡é›†åˆè¿ç®—ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªç¬æ—¶å‘é‡ä¸ç¬æ—¶å‘é‡ä¹‹é—´è¿›è¡Œç›¸åº”çš„é›†åˆæ“ä½œã€‚ å¦‚æ—¶é’ŸæœªåŒæ­¥å‘Šè­¦ min_over_time(node_timex_sync_status[1m]) == 0 and node_timex_maxerror_seconds \u003e= 16 ç›®å‰ï¼ŒPrometheusæ”¯æŒä»¥ä¸‹é›†åˆè¿ç®—ç¬¦ï¼š and (å¹¶ä¸”) or (æˆ–è€…) unless (æ’é™¤) æ“ä½œç¬¦ä¼˜å…ˆçº§ å¯¹äºå¤æ‚ç±»å‹çš„è¡¨è¾¾å¼ï¼Œéœ€è¦äº†è§£è¿ç®—æ“ä½œçš„è¿è¡Œä¼˜å…ˆçº§ ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ä¸»æœºçš„CPUä½¿ç”¨ç‡ï¼Œå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼š 100-(avg(irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) by(instance,job)* 100) \u003e 80 å…¶ä¸­irateæ˜¯PromQLä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºè®¡ç®—åŒºé—´å‘é‡ä¸­æ—¶é—´åºåˆ—æ¯ç§’çš„å³æ—¶å¢é•¿ç‡ã€‚ å†…ç½®å‡½æ•° Prometheusè¿˜æä¾›äº†ä¸‹åˆ—å†…ç½®çš„èšåˆæ“ä½œç¬¦ï¼Œè¿™äº›æ“ä½œç¬¦ä½œç”¨åŸŸç¬æ—¶å‘é‡ã€‚å¯ä»¥å°†ç¬æ—¶è¡¨è¾¾å¼è¿”å›çš„æ ·æœ¬æ•°æ®è¿›è¡Œèšåˆï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ã€‚ sum (æ±‚å’Œ) min (æœ€å°å€¼) max (æœ€å¤§å€¼) avg (å¹³å‡å€¼) stddev (æ ‡å‡†å·®) stdvar (æ ‡å‡†å·®å¼‚) count (è®¡æ•°) count_values (å¯¹valueè¿›è¡Œè®¡æ•°) bottomk (ånæ¡æ—¶åº) topk (å‰næ¡æ—¶åº) quantile (åˆ†å¸ƒç»Ÿè®¡) ä½¿ç”¨èšåˆæ“ä½œçš„è¯­æ³•å¦‚ä¸‹ï¼š \u003caggr-op\u003e([parameter,] \u003cvector expression\u003e) [without|by (\u003clabel list\u003e)] å…¶ä¸­åªæœ‰count_values, quantile, topk, bottomkæ”¯æŒå‚æ•°(parameter) withoutç”¨äºä»è®¡ç®—ç»“æœä¸­ç§»é™¤åˆ—ä¸¾çš„æ ‡ç­¾ï¼Œè€Œä¿ç•™å…¶å®ƒæ ‡ç­¾ã€‚ byåˆ™æ­£å¥½ç›¸åï¼Œç»“æœå‘é‡ä¸­åªä¿ç•™åˆ—å‡ºçš„æ ‡ç­¾ï¼Œå…¶ä½™æ ‡ç­¾åˆ™ç§»é™¤ã€‚é€šè¿‡withoutå’Œbyå¯ä»¥æŒ‰ç…§æ ·æœ¬çš„é—®é¢˜å¯¹æ•°æ®è¿›è¡Œèšåˆã€‚ ä¾‹å¦‚ï¼š sum(http_requests_total) without (instance) ç­‰ä»·äº sum(http_requests_total) by (code,handler,job,method) å¦‚æœåªéœ€è¦è®¡ç®—æ•´ä¸ªåº”ç”¨çš„HTTPè¯·æ±‚æ€»é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨è¾¾å¼ï¼š sum(http_requests_total) count_valuesç”¨äºæ—¶é—´åºåˆ—ä¸­æ¯ä¸€ä¸ªæ ·æœ¬å€¼å‡ºç°çš„æ¬¡æ•°ã€‚count_valuesä¼šä¸ºæ¯ä¸€ä¸ªå”¯ä¸€çš„æ ·æœ¬å€¼è¾“å‡ºä¸€ä¸ªæ—¶é—´åºåˆ—ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªæ—¶é—´åºåˆ—åŒ…å«ä¸€ä¸ªé¢å¤–çš„æ ‡ç­¾ã€‚ ä¾‹å¦‚ï¼š count_values(\"count\", http_requests_total) topkå’Œbottomkåˆ™ç”¨äºå¯¹æ ·æœ¬å€¼è¿›è¡Œæ’åºï¼Œè¿”å›å½“å‰æ ·æœ¬å€¼å‰nä½ï¼Œæˆ–è€…ånä½çš„æ—¶é—´åºåˆ—ã€‚ è·å–HTTPè¯·æ±‚æ•°å‰5ä½çš„æ—¶åºæ ·æœ¬æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼š topk(5, http_requests_total) quantileç”¨äºè®¡ç®—å½“å‰æ ·æœ¬æ•°æ®å€¼çš„åˆ†å¸ƒæƒ…å†µquantile(Ï†, express)å…¶ä¸­0 â‰¤ Ï† â‰¤ 1ã€‚ ä¾‹å¦‚ï¼Œå½“Ï†ä¸º0.5æ—¶ï¼Œå³è¡¨ç¤ºæ‰¾åˆ°å½“å‰æ ·æœ¬æ•°æ®ä¸­çš„ä¸­ä½æ•°ï¼š quantile(0.5, http_requests_total) ","date":"2022-08-29","objectID":"/promql/:3:3","tags":["prometheus"],"title":"PromQL","uri":"/promql/"},{"categories":["Kubernetes"],"content":"ä½¿ç”¨ kubernetes ç»å¸¸ä¼šç”¨åˆ°å‘½ä»¤è¡Œï¼Œè¿™é‡Œå¯¹å‘½ä»¤è¡Œè¿›è¡Œåˆ†ç±»æ•´ç† é›†ç¾¤ç®¡ç† kubectl cluster-info kubectl config kubectl version kubectl api-versions æŸ¥çœ‹å½“å‰é›†ç¾¤æ”¯æŒçš„apiç‰ˆæœ¬ kubectl get node kubectl get pod kubectl get service kubectl cordon å‘½ä»¤ï¼šç”¨äºæ ‡è®°æŸä¸ªèŠ‚ç‚¹ä¸å¯è°ƒåº¦ kubectl uncordon å‘½ä»¤ï¼šç”¨äºæ ‡ç­¾èŠ‚ç‚¹å¯ä»¥è°ƒåº¦ kubectl drain å‘½ä»¤ï¼š ç”¨äºåœ¨ç»´æŠ¤æœŸé—´æ’é™¤èŠ‚ç‚¹ã€‚ kubectl taint å‘½ä»¤ï¼šç”¨äºç»™æŸä¸ªNodeèŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹ Pod ç®¡ç† kubectl create pod kubectl get pod kubectl get pod pod_name â€“show-labels kubectl describe pod kubectl logs kubectl exec kubectl delete pod èµ„æºç›‘æµ‹ kubectl top node kubectl top pods kubectl get quota kubectl describe Serviceç®¡ç† kubectl create service kubectl get service kubectl expose kubectl describe service kubectl delete service kubectl port-forwad é…ç½®å’ŒåŠ å¯† kubectl create configmap kubectl get configmap kubectl create secret kubectl get secret kubectl describe configmap kubectl describe secret Deploymentç®¡ç† kubectl create deployment kubectl get deployment kubectl scale deployment sudo kubectl scale deployment deploy-name â€“replicas=0 ä¸åˆ é™¤åº”ç”¨æš‚åœæœåŠ¡ kubectl autoscale deployment kubectl rollout status kubectl rollout history kubectl delete deployment åå­—ç©ºé—´ç®¡ç† kubectl create namespace kubectl get namespace kubectl describe namespace kubectl delete namespace kubectl apply -n kubectl switch -n kubeadmç®¡ç† kubeadm init å¯åŠ¨å¼•å¯¼ä¸€ä¸ª Kubernetes ä¸»èŠ‚ç‚¹ kubeadm join å¯åŠ¨å¼•å¯¼ä¸€ä¸ª Kubernetes å·¥ä½œèŠ‚ç‚¹å¹¶ä¸”å°†å…¶åŠ å…¥åˆ°é›†ç¾¤ kubeadm upgrade æ›´æ–° Kubernetes é›†ç¾¤åˆ°æ–°ç‰ˆæœ¬ kubeadm config å¦‚æœä½ ä½¿ç”¨ kubeadm v1.7.x æˆ–è€…æ›´ä½ç‰ˆæœ¬ï¼Œä½ éœ€è¦å¯¹ä½ çš„é›†ç¾¤åšä¸€äº›é…ç½®ä»¥ä¾¿ä½¿ç”¨ kubeadm upgrade å‘½ä»¤ kubeadm token ä½¿ç”¨ kubeadm join æ¥ç®¡ç†ä»¤ç‰Œ kubeadm reset è¿˜åŸä¹‹å‰ä½¿ç”¨ kubeadm init æˆ–è€… kubeadm join å¯¹èŠ‚ç‚¹æ‰€ä½œæ”¹å˜ kubeadm version æ‰“å°å‡º kubeadm ç‰ˆæœ¬ kubeadm alpha é¢„è§ˆä¸€ç»„å¯ç”¨çš„æ–°åŠŸèƒ½ä»¥ä¾¿ä»ç¤¾åŒºæœé›†åé¦ˆ kubeadm token create â€“print-join-command åˆ›å»ºnodeåŠ å…¥å£ä»¤ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:0:0","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"å‘½ä»¤è¯´æ˜ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:0","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"1. kubectl expose å’Œ kubectl port-forwad çš„åŒºåˆ« kubectl expose å’Œ kubectl port-forward æ˜¯ä¸¤ä¸ªä¸åŒçš„å‘½ä»¤ï¼Œå®ƒä»¬åœ¨ Kubernetes ä¸­æœ‰ä¸åŒçš„ä½œç”¨å’Œç”¨æ³•ã€‚ kubectl expose å‘½ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ Service å¯¹è±¡æ¥æš´éœ² Deploymentã€ReplicationController æˆ– ReplicaSet ç­‰å…¶ä»–èµ„æºã€‚å®ƒä¼šä¸ºæŒ‡å®šçš„èµ„æºåˆ›å»ºä¸€ä¸ªæ–°çš„ ClusterIP ç±»å‹çš„ Serviceï¼Œåœ¨é›†ç¾¤å†…éƒ¨é€šè¿‡ Service IP å’Œç«¯å£å·æ¥è®¿é—®æš´éœ²çš„èµ„æºã€‚è¿™ä¸ª Service å¯¹è±¡å¯ä»¥æ˜¯ä¸´æ—¶çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ°¸ä¹…çš„ï¼Œå®ƒæ ¹æ®æŒ‡å®šçš„å‚æ•°è®¾ç½®æ¥æ§åˆ¶å…¶è¡Œä¸ºã€‚ kubectl port-forward å‘½ä»¤ç”¨äºåœ¨æœ¬åœ°æœºå™¨å’Œ Kubernetes é›†ç¾¤ä¹‹é—´å»ºç«‹ä¸€ä¸ªä¸´æ—¶çš„åè®®è½¬å‘ï¼Œå°†æœ¬åœ°çš„ç«¯å£ä¸ Kubernetes Pod æˆ– Service çš„ç«¯å£è¿›è¡Œç»‘å®šã€‚è¿™æ ·å¯ä»¥ç›´æ¥é€šè¿‡æœ¬åœ°æœºå™¨ä¸Šçš„ç«¯å£æ¥è®¿é—® Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡æˆ–åº”ç”¨ã€‚è¯¥å‘½ä»¤é€šå¸¸ç”¨äºå¼€å‘å’Œè°ƒè¯•ï¼Œæ¯”å¦‚åœ¨æœ¬åœ°æœºå™¨ä¸Šç›´æ¥è®¿é—®è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡çš„æ—¥å¿—ã€‚ æ€»ç»“æ¥è¯´ï¼Œkubectl expose ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ Service å¯¹è±¡æ¥æš´éœ² Kubernetes èµ„æºï¼Œè€Œ kubectl port-forward åˆ™ç”¨äºå»ºç«‹æœ¬åœ°ä¸é›†ç¾¤ä¹‹é—´çš„ä¸´æ—¶ç«¯å£è½¬å‘ï¼Œæ–¹ä¾¿æœ¬åœ°æœºå™¨è®¿é—®é›†ç¾¤ä¸­çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:1","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"2. kubectl apply å’Œ kubectl switch çš„åŒºåˆ« kubectl apply ç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²æˆ–æ›´æ–°èµ„æºå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œå£°æ˜ã€‚å®ƒä¼šè¯»å–æ–‡ä»¶ä¸­çš„èµ„æºå®šä¹‰ï¼Œå¹¶åœ¨é›†ç¾¤ä¸­åˆ›å»ºæˆ–æ›´æ–°ç›¸åº”çš„èµ„æºå¯¹è±¡ã€‚kubectl switch æ˜¯ä¸€ä¸ªéå®˜æ–¹çš„æ’ä»¶ï¼Œç”¨äºåˆ‡æ¢å½“å‰ä¸Šä¸‹æ–‡çš„é›†ç¾¤ã€‚Kubernetes é›†ç¾¤å…è®¸å­˜åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡å¯¹åº”ä¸€ä¸ªé›†ç¾¤ã€‚ kubectl switch å¯ä»¥æ–¹ä¾¿åœ°åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åˆ‡æ¢ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨ä¸åŒçš„é›†ç¾¤ä¹‹é—´è¿›è¡Œæ“ä½œã€‚å› æ­¤ï¼Œkubectl apply ç”¨äºéƒ¨ç½²å’Œæ›´æ–°èµ„æºå¯¹è±¡ï¼Œè€Œ kubectl switch ç”¨äºåˆ‡æ¢å½“å‰æ“ä½œçš„é›†ç¾¤ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å‘½ä»¤ï¼Œç”¨é€”å’ŒåŠŸèƒ½ä¸åŒã€‚ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:2","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"3. kubectl scale å’Œ kubectl autoscaleçš„åŒºåˆ« kubectl scaleå’Œkubectl autoscaleæ˜¯ç”¨äºæ‰©å®¹æˆ–ç¼©å®¹Kubernetes Deploymentæˆ–ReplicaSetçš„å‘½ä»¤ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ã€‚ kubectl scaleå‘½ä»¤å…è®¸é€šè¿‡æ‰‹åŠ¨æŒ‡å®šå‰¯æœ¬æ•°é‡æ¥æ›´æ–°Deploymentæˆ–ReplicaSetçš„å‰¯æœ¬æ•°é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å‰¯æœ¬æ•°é‡è®¾ç½®ä¸º3ï¼š kubectl scale deployment/my-deployment --replicas=3 kubectl autoscaleå‘½ä»¤åˆ™æ˜¯æ ¹æ®æŒ‡å®šçš„CPUä½¿ç”¨ç‡æ¥è‡ªåŠ¨æ‰©å®¹æˆ–ç¼©å®¹Deploymentã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªHorizontalPodAutoscaler(HPA)å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šæ ¹æ®CPUçš„ä½¿ç”¨æƒ…å†µåŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘Podçš„å‰¯æœ¬æ•°é‡ä»¥æ»¡è¶³æŒ‡å®šçš„CPUç›®æ ‡ä½¿ç”¨ç‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†Podçš„å‰¯æœ¬æ•°é‡è‡ªåŠ¨è°ƒæ•´ä¸ºè‡³å°‘2ä¸ªï¼Œå½“CPUä½¿ç”¨ç‡è¶…è¿‡50%æ—¶ï¼š kubectl autoscale deployment/my-deployment --min=2 --max=10 --cpu-percent=50 æ€»ç»“èµ·æ¥ï¼Œkubectl scaleç”¨äºæ‰‹åŠ¨æŒ‡å®šå‰¯æœ¬æ•°é‡æ¥æ›´æ–°Deploymentæˆ–ReplicaSetçš„å‰¯æœ¬æ•°é‡ï¼Œè€Œkubectl autoscaleç”¨äºæ ¹æ®CPUä½¿ç”¨ç‡è‡ªåŠ¨æ‰©å®¹æˆ–ç¼©å®¹Podçš„å‰¯æœ¬æ•°é‡ã€‚ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:3","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"4. kubectl execå’Œkubectl attach çš„åŒºåˆ« kubectl execå’Œkubectl attachæ˜¯ç”¨äºä¸æ­£åœ¨è¿è¡Œçš„Podè¿›è¡Œäº¤äº’çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬åœ¨ä½¿ç”¨æ–¹å¼å’ŒåŠŸèƒ½ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚ kubectl execå‘½ä»¤ç”¨äºåœ¨æ­£åœ¨è¿è¡Œçš„Podä¸­æ‰§è¡Œå‘½ä»¤ã€‚å®ƒå¯ä»¥è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¹¶åœ¨å®¹å™¨ä¸­æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨åä¸ºmy-podçš„Podä¸­æ‰§è¡Œechoå‘½ä»¤ï¼š kubectl exec -it my-pod -- echo \"Hello, World!\" kubectl attachå‘½ä»¤ç”¨äºå°†æœ¬åœ°ç»ˆç«¯è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„Podä¸­çš„æŸä¸ªå®¹å™¨çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµã€‚å®ƒå¯ä»¥ä¸å®¹å™¨å»ºç«‹äº¤äº’å¼ä¼šè¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æœ¬åœ°ç»ˆç«¯è¿æ¥åˆ°åä¸ºmy-podçš„Podä¸­çš„ç¬¬ä¸€ä¸ªå®¹å™¨ï¼š kubectl attach -it my-pod æ€»ç»“èµ·æ¥ï¼Œkubectl attachå‘½ä»¤ç±»ä¼¼äºkubectl execï¼Œä½†å®ƒé™„åŠ åˆ°å®¹å™¨ä¸­è¿è¡Œçš„ä¸»è¿›ç¨‹ï¼Œè€Œä¸æ˜¯è¿è¡Œé¢å¤–çš„è¿›ç¨‹ã€‚ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:4","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Kubernetes"],"content":"5. kubectl patchå’Œkubectl replaceçš„åŒºåˆ« kubectl patchå’Œkubectl replaceæ˜¯ç”¨äºéƒ¨åˆ†æ›´æ–°å’Œæ›¿æ¢æ›´æ–°Kubernetesèµ„æºçš„å‘½ä»¤ï¼Œä½†å®ƒä»¬åœ¨æ›´æ–°æ–¹å¼å’Œè¡Œä¸ºä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚ kubectl patchå‘½ä»¤ç”¨äºéƒ¨åˆ†æ›´æ–°Kubernetesèµ„æºçš„ç‰¹å®šå­—æ®µã€‚å®ƒå¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªJSONæˆ–YAMLæ–‡ä»¶ã€ä¸€ä¸ªJSONæˆ–YAMLå­—ç¬¦ä¸²ï¼Œæˆ–è€…ä½¿ç”¨ç‰¹å®šçš„æ“ä½œç±»å‹ï¼ˆå¦‚addã€removeã€replaceç­‰ï¼‰æ¥æ›´æ–°èµ„æºçš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†åä¸ºmy-deploymentçš„Deploymentèµ„æºçš„labelså­—æ®µæ·»åŠ ä¸€ä¸ªæ–°çš„æ ‡ç­¾ï¼š kubectl patch deployment/my-deployment -p '{\"spec\":{\"template\":{\"metadata\":{\"labels\":{\"new-label\":\"value\"}}}}}' kubectl replaceå‘½ä»¤ç”¨äºæ›¿æ¢æ›´æ–°æ•´ä¸ªKubernetesèµ„æºã€‚å®ƒä¼šåŸºäºæä¾›çš„é…ç½®æ–‡ä»¶å®Œå…¨æ›¿æ¢ç°æœ‰èµ„æºçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†åä¸ºmy-deploymentçš„Deploymentèµ„æºæ›¿æ¢ä¸ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼š kubectl replace -f new-deployment.yaml æ€»ç»“èµ·æ¥ï¼Œkubectl patchç”¨äºéƒ¨åˆ†æ›´æ–°Kubernetesèµ„æºçš„ç‰¹å®šå­—æ®µï¼Œè€Œkubectl replaceç”¨äºå®Œå…¨æ›¿æ¢æ›´æ–°æ•´ä¸ªKubernetesèµ„æºã€‚ ","date":"2022-08-20","objectID":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/:1:5","tags":["Kubernetes"],"title":"kuberneteså¸¸ç”¨å‘½ä»¤æ•´ç†","uri":"/kubernetes%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"},{"categories":["Grafana"],"content":"Grafanaç®€ä»‹ Grafana æ˜¯ä¸€ä¸ªç›‘æ§ä»ªè¡¨ç³»ç»Ÿï¼Œå®ƒæ˜¯ç”± Grafana Labs å…¬å¸å¼€æºçš„çš„ä¸€ä¸ªç³»ç»Ÿç›‘æµ‹ (System Monitoring) å·¥å…·ã€‚å®ƒå¯ä»¥å¤§å¤§å¸®åŠ©ä½ ç®€åŒ–ç›‘æ§çš„å¤æ‚åº¦ï¼Œä½ åªéœ€è¦æä¾›ä½ éœ€è¦ç›‘æ§çš„æ•°æ®ï¼Œå®ƒå°±å¯ä»¥å¸®ä½ ç”Ÿæˆå„ç§å¯è§†åŒ–ä»ªè¡¨ã€‚åŒæ—¶å®ƒè¿˜æœ‰æŠ¥è­¦åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶é€šçŸ¥ä½ ã€‚ Grafana æœ¬èº«æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œä¸ä¼šå ç”¨å¤§é‡èµ„æºï¼Œæ­¤å¤– Grafana éœ€è¦ä¸€ä¸ªæ•°æ®åº“æ¥å­˜å‚¨å…¶é…ç½®æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ã€æ•°æ®æºå’Œä»ªè¡¨ç›˜ç­‰ï¼Œç›®å‰ Grafana æ”¯æŒ SQLiteã€MySQLã€PostgreSQL 3 ç§æ•°æ®åº“ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ SQLiteï¼Œè¯¥æ•°æ®åº“æ–‡ä»¶ä¼šå­˜å‚¨åœ¨ Grafana çš„å®‰è£…ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦å¯¹ Grafana çš„å®‰è£…ç›®å½•è¿›è¡ŒæŒä¹…åŒ–ã€‚ å½“ç„¶å¦‚æœæˆ‘ä»¬æƒ³è¦éƒ¨ç½²ä¸€ä¸ªé«˜å¯ç”¨ç‰ˆæœ¬çš„ Grafana çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨ SQLite æ•°æ®åº“å°±ä¸è¡Œäº†ï¼Œéœ€è¦åˆ‡æ¢åˆ° MySQL æˆ–è€… PostgreSQLï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Grafana é…ç½®çš„ [database] éƒ¨åˆ†æ‰¾åˆ°æ•°æ®åº“çš„ç›¸å…³é…ç½®ï¼ŒGrafana ä¼šå°†æ‰€æœ‰é•¿æœŸæ•°æ®ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åéƒ¨ç½²å¤šä¸ª Grafana å®ä¾‹ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“å³å¯å®ç°é«˜å¯ç”¨ã€‚ ","date":"2022-08-17","objectID":"/grafana/:1:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"Grafanaçš„æ ¸å¿ƒåŠŸèƒ½å’Œæ¶æ„ Grafanaæä¾›äº†ä¸€ä¸ªä¸°å¯Œçš„å›¾è¡¨åº“ï¼ŒåŒ…æ‹¬æ—¶åºæ•°æ®å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ç­‰å¤šç§ç±»å‹ï¼Œä½¿å…¶èƒ½å¤Ÿå±•ç¤ºå„ç§æŒ‡æ ‡æ•°æ®ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡æ‹–æ”¾çš„æ–¹å¼è‡ªå®šä¹‰ä»ªè¡¨æ¿ï¼Œå®ç°å¯¹æ•°æ®çš„å®æ—¶ç›‘æ§å’Œåˆ†æã€‚Grafanaçš„å‰ç«¯ç•Œé¢ä½¿ç”¨AngularJSå’ŒReactæ„å»ºï¼Œåç«¯åˆ™ä¸»è¦é‡‡ç”¨Goè¯­è¨€å¼€å‘ï¼Œç¡®ä¿äº†å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§ã€‚ ","date":"2022-08-17","objectID":"/grafana/:1:1","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"Grafanaçš„å®‰è£…ä¸åˆæ­¥é…ç½® Grafanaæ”¯æŒå¤šç§å®‰è£…æ–¹å¼ï¼ŒåŒ…æ‹¬Dockerå®¹å™¨ã€é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…ã€æºä»£ç ç¼–è¯‘ç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚ ","date":"2022-08-17","objectID":"/grafana/:2:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"Docker å®‰è£… ä½¿ç”¨Dockerå®‰è£…Grafanaæ˜¯ä¸€ç§å¿«é€Ÿè€Œä¾¿æ·çš„æ–¹æ³•ã€‚ç”¨æˆ·åªéœ€è¦å‡†å¤‡ä¸€ä¸ªDockerç¯å¢ƒï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š docker run -d --name grafana -p 3000:3000 grafana/grafana:9.2.20 æ­¤å‘½ä»¤ä¼šä¸‹è½½Grafanaçš„Dockeré•œåƒï¼Œå¹¶åœ¨å®¹å™¨ä¸­å¯åŠ¨GrafanaæœåŠ¡ï¼Œç›‘å¬æœ¬åœ°çš„3000ç«¯å£ã€‚ å®‰è£…å®Œæˆåï¼Œéœ€è¦å¯¹Grafanaè¿›è¡Œåˆæ­¥é…ç½®ï¼ŒåŒ…æ‹¬è®¾ç½®ç›‘å¬ç«¯å£ã€é…ç½®æ•°æ®åº“ç­‰ã€‚è¿™äº›é…ç½®å¯ä»¥åœ¨Grafanaçš„é…ç½®æ–‡ä»¶grafana.iniä¸­è¿›è¡Œã€‚ ","date":"2022-08-17","objectID":"/grafana/:2:1","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"kubernetes å®‰è£… kubernetes éƒ¨ç½²å¹¶åˆ‡æ¢æ•°æ®æºä¸ºMySQL,è¿™æ ·å®¹å™¨é‡å»ºåé…ç½®çš„å¤§å±ä¸ä¼šä¸¢å¤±ä¸”ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥ä½¿ç”¨ï¼Œæ–¹ä¾¿dashboardå¤§å±è„šæœ¬åœ¨æ•°æ®åº“ä¸­çš„ç®¡ç†ã€‚ grafana-configmap.yamlï¼Œæ•°æ®åº“ä¸­é…ç½®MySQL æ•°æ®æºè¿æ¥ä¿¡æ¯ï¼ŒGrafana é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ sqlite3,è¿™é‡Œåšä¸€ä¸‹å˜æ›´ apiVersion: v1 kind: ConfigMap metadata: name: grafana namespace: monitoring data: grafana.ini: | #################################### Database #################################### [database] # You can configure the database connection by specifying type, host, name, user and password # as separate properties or as on string using the url properties. # Either \"mysql\", \"postgres\" or \"sqlite3\", it's your choice type = mysql host = 192.168.1.11:3306 name = grafana user = root # If the password contains # or ; you have to wrap it with triple quotes. Ex \"\"\"#password;\"\"\" password = abc@123A # Use either URL or the previous fields to configure the database # Example: mysql://user:secret@host:port/database url = mysql://root:password@192.168.1.11:3306/grafana grafana-deploy.yaml apiVersion: apps/v1 kind: Deployment metadata: name: grafana namespace: monitoring labels: app: grafana component: core spec: replicas: 1 selector: matchLabels: app: grafana template: metadata: labels: app: grafana component: core spec: containers: - image: grafana/grafana:9.2.20 name: grafana imagePullPolicy: IfNotPresent #securityContext: # runAsUser: 0 # fsGroup: 0 # env: resources: # keep request = limit to keep this container in guaranteed class limits: cpu: 100m memory: 256Mi requests: cpu: 100m memory: 100Mi env: # The following env variables set up basic auth twith the default admin user and admin password. - name: GF_AUTH_BASIC_ENABLED value: \"true\" - name: GF_AUTH_ANONYMOUS_ENABLED value: \"false\" - name: GF_PATHS_DATA value: \"/var/lib/grafana\" - name: GF_PATHS_CONFIG value: \"/etc/grafana/grafana.ini\" # - name: GF_AUTH_ANONYMOUS_ORG_ROLE # value: Admin # does not really work, because of template variables in exported dashboards: # - name: GF_DASHBOARDS_JSON_ENABLED # value: \"true\" readinessProbe: httpGet: path: /login port: 3000 initialDelaySeconds: 30 timeoutSeconds: 1 volumeMounts: # æ•°æ®æŒä¹…åŒ– - name: config-volume mountPath: /etc/grafana # - name: grafana-persistent-storage # mountPath: /var volumes: - name: config-volume configMap: name: grafana #- name: grafana-persistent-storage # hostPath: # path: /grafana-data # type: DirectoryOrCreate #- name: grafana-persistent-storage # emptyDir: {} grafana-service.yaml apiVersion: v1 kind: Service metadata: name: grafana namespace: monitoring labels: app: grafana component: core spec: type: NodePort ports: - port: 3000 targetPort: 3000 nodePort: 30009 selector: app: grafana component: core éƒ¨ç½² kubectl create namespace monitoring kubectl create -f grafana-configmap.yaml kubectl create -f grafana-deploy.yaml kubectl create -f grafana-service.yaml éƒ¨ç½²æˆåŠŸ # kubectl -n monitoring get pod,svc NAME READY STATUS RESTARTS AGE pod/grafana-5d8c7d5c8c-znffb 1/1 Running 0 6m18s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/grafana NodePort 10.110.17.117 \u003cnone\u003e 3000:30009/TCP 11m æˆåŠŸéƒ¨ç½²åï¼Œæ•°æ®åº“ä¼šåå‘ç”Ÿæˆç›¸å…³çš„è¡¨ä¿¡æ¯ grafana\r","date":"2022-08-17","objectID":"/grafana/:2:2","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"è®¿é—®åŠŸèƒ½ç•Œé¢ http://ip:30009 ç™»å½•æ˜¯é»˜è®¤è´¦å·å£ä»¤ä¸ºadmin/admin,ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æç¤ºä¿®æ”¹å¯†ç  grafana\rç™»å½•æˆåŠŸç•Œé¢ grafana\r","date":"2022-08-17","objectID":"/grafana/:3:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"æ•°æ®æºæ·±å…¥é›†æˆ grafana\råœ¨Grafanaä¸­ï¼Œæ•°æ®æºçš„é›†æˆæ˜¯æ„å»ºæœ‰æ•ˆç›‘æ§å’Œåˆ†æç³»ç»Ÿçš„å…³é”®æ­¥éª¤ã€‚Grafanaæ”¯æŒä¼—å¤šæµè¡Œçš„æ•°æ®å­˜å‚¨å’Œç›‘æ§å·¥å…·ä½œä¸ºæ•°æ®æºï¼ŒåŒ…æ‹¬æ—¶åºæ•°æ®åº“Prometheus, InfluxDBï¼Œæ—¥å¿—å’Œæ–‡æ¡£å­˜å‚¨å¦‚Elasticsearchï¼Œä»¥åŠä¼ ç»Ÿçš„SQLæ•°æ®åº“å¦‚MySQLå’ŒPostgreSQLã€‚ ","date":"2022-08-17","objectID":"/grafana/:4:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"å¯¼å…¥ Dashboard ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿå¯¹ç³»ç»Ÿè¿›è¡Œç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¤ç”¨åˆ«äººçš„ Grafana Dashboardï¼Œåœ¨ Grafana çš„å®˜æ–¹ç½‘ç«™ä¸Šå°±æœ‰å¾ˆå¤šéå¸¸ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ Dashboardï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥å¯¼å…¥è¿›æ¥å³å¯ã€‚ æ¯”å¦‚æˆ‘ä»¬æƒ³è¦å¯¹æ‰€æœ‰çš„é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œä¹Ÿå°±æ˜¯ node-exporter é‡‡é›†çš„æ•°æ®è¿›è¡Œå±•ç¤ºï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å¯¼å…¥ https://grafana.com/grafana/dashboards/8919 è¿™ä¸ª Dashboardã€‚ åœ¨ä¾§è¾¹æ ç‚¹å‡» â€œ+\"ï¼Œé€‰æ‹© Importï¼Œåœ¨ Grafana Dashboard çš„æ–‡æœ¬æ¡†ä¸­è¾“å…¥ 8919 å³å¯å¯¼å…¥ï¼š grafana\ræ³¨æ„\råœ¨å¯¼å…¥ä¹‹å‰éœ€è¦å…ˆåˆ›å»ºæ•°æ®æºï¼Œå¤§å±æ˜¯é€‚é…çš„Prometheus æ•°æ®æº\ré€šè¿‡éƒ¨ç½²Prometheus å’Œ Node Exporter é‡‡é›†çš„å®æ—¶æ•°æ®å¤§å± grafana\r","date":"2022-08-17","objectID":"/grafana/:5:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"Grafana ç›¸å…³ç»„ä»¶æ¦‚å¿µäº†è§£ ","date":"2022-08-17","objectID":"/grafana/:6:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"é¢æ¿ä»‹ç» é¢æ¿ï¼ˆPanelï¼‰æ˜¯ Grafana ä¸­åŸºæœ¬å¯è§†åŒ–æ„å»ºå—ï¼Œæ¯ä¸ªé¢æ¿éƒ½æœ‰ä¸€ä¸ªç‰¹å®šäºé¢æ¿ä¸­é€‰æ‹©æ•°æ®æºçš„æŸ¥è¯¢ç¼–è¾‘å™¨ï¼Œæ¯ä¸ªé¢æ¿éƒ½æœ‰å„ç§å„æ ·çš„æ ·å¼å’Œæ ¼å¼é€‰é¡¹ï¼Œé¢æ¿å¯ä»¥åœ¨ä»ªè¡¨æ¿ä¸Šæ‹–æ”¾å’Œé‡æ–°æ’åˆ—ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è°ƒæ•´å¤§å°ã€‚ Panel æ˜¯ Grafana ä¸­æœ€åŸºæœ¬çš„å¯è§†åŒ–å•å…ƒï¼Œæ¯ä¸€ç§ç±»å‹çš„é¢æ¿éƒ½æä¾›äº†ç›¸åº”çš„æŸ¥è¯¢ç¼–è¾‘å™¨(Query Editor)ï¼Œè®©ç”¨æˆ·å¯ä»¥ä»ä¸åŒçš„æ•°æ®æºï¼ˆå¦‚ Prometheusï¼‰ä¸­æŸ¥è¯¢å‡ºç›¸åº”çš„ç›‘æ§æ•°æ®ï¼Œå¹¶ä¸”ä»¥å¯è§†åŒ–çš„æ–¹å¼å±•ç°ï¼ŒGrafana ä¸­æ‰€æœ‰çš„é¢æ¿å‡ä»¥æ’ä»¶çš„å½¢å¼è¿›è¡Œä½¿ç”¨ã€‚ ç›®å‰å†…ç½®æ”¯æŒçš„é¢æ¿åŒ…æ‹¬ï¼šTime seriesï¼ˆæ—¶é—´åºåˆ—ï¼‰æ˜¯é»˜è®¤çš„ä¹Ÿæ˜¯ä¸»è¦çš„å›¾å½¢å¯è§†åŒ–é¢æ¿ã€State timelineï¼ˆçŠ¶æ€æ—¶é—´è¡¨ï¼‰çŠ¶æ€éšæ—¶é—´å˜åŒ– ã€Status historyï¼ˆçŠ¶æ€å†å²è®°å½•ï¼‰ã€Bar chartï¼ˆæ¡å½¢å›¾ï¼‰ã€Histogramï¼ˆç›´æ–¹å›¾ï¼‰ã€Heatmapï¼ˆçƒ­åŠ›å›¾ï¼‰ã€Pie chartï¼ˆé¥¼çŠ¶å›¾ï¼‰ã€Statï¼ˆç»Ÿè®¡æ•°æ®ï¼‰ç­‰ å›¾è¡¨ Time series æ•°æ®ç»Ÿè®¡ stat ä»ªè¡¨ç›˜ gauge è¡¨æ ¼ table é¥¼çŠ¶å›¾ Pie Chart çƒ­å›¾ Heatmap ","date":"2022-08-17","objectID":"/grafana/:6:1","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"å›¾å½¢é¢æ¿ æ•°æ®æºï¼ˆData Sourceï¼‰ æ·»åŠ é¢æ¿ï¼ˆAdd Panelï¼‰ æ·»åŠ å‚æ•°ï¼ˆDashboard settingsï¼‰ ","date":"2022-08-17","objectID":"/grafana/:6:2","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"å›¾å½¢å®šåˆ¶ å¤šä¸ªæŸ¥è¯¢(query editor) è½¬æ¢(Transform) æ¨¡æ¿å˜é‡ ","date":"2022-08-17","objectID":"/grafana/:6:3","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"æ–‡æœ¬é¢æ¿ # è¿™æ˜¯ä¸€çº§æ ‡é¢˜ ## è¿™æ˜¯äºŒçº§æ ‡é¢˜ è¿™æ˜¯æ­£æ–‡å†…å®¹ï¼Œ**æˆ‘æ˜¯åŠ ç²—**ï¼Œ`æˆ‘æ˜¯å¼ºè°ƒ`ã€‚ \u003e è¿˜å¯ä»¥æ·»åŠ å¼•ç”¨çš„å†…å®¹ ![è¿™æ˜¯ä¸€å¼ å›¾ç‰‡](https://p8s.io/docs/assets/img/illustration.png \"grafana\") æ¸²æŸ“åçš„å›¾ç‰‡ grafana\r","date":"2022-08-17","objectID":"/grafana/:6:4","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"å…¶å®ƒ å®‰å…¨ä¸ç»´æŠ¤ ç”¨æˆ·è®¤è¯ä¸æˆæƒ æ•°æ®å¤‡ä»½ä¸æ¢å¤ æ³¨é‡Š Grafana ä¸­æä¾›äº†ä¸€ä¸ª Annotations æ³¨é‡Šçš„æ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹å¼å¯ä»¥åœ¨å›¾å½¢ä¸Šæ ‡è®°ä¸€ä¸ªç‚¹ï¼Œå½“å°†é¼ æ ‡æ‚¬åœåœ¨ä¸Šé¢çš„æ—¶å€™ï¼Œå¯ä»¥è·å¾—è¯¥æ³¨é‡Šçš„å…·ä½“ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Panel é¢æ¿ä¸­æŸä¸€ä¸ªç‚¹æ·»åŠ æ³¨é‡Šï¼Œä¹Ÿå¯ä»¥åœ¨æŸä¸€ä¸ªåŒºåŸŸå†…æ·»åŠ æ³¨é‡Šã€‚ å‘Šè­¦ Grafana é™¤äº†æ”¯æŒä¸°å¯Œçš„æ•°æ®æºå’Œå›¾è¡¨åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜æ”¯æŒå‘Šè­¦åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¹Ÿä½¿å¾— Grafana ä»ä¸€ä¸ªæ•°æ®å¯è§†åŒ–å·¥å…·æˆä¸ºäº†ä¸€ä¸ªçœŸæ­£çš„ç›‘æ§åˆ©å™¨ã€‚Grafana å¯ä»¥é€šè¿‡ Alerting æ¨¡å—çš„é…ç½®æŠŠç›‘æ§æ•°æ®ä¸­çš„å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå‘Šè­¦ï¼Œå‘Šè­¦çš„è§„åˆ™å¯ä»¥ç›´æ¥åŸºäºç°æœ‰çš„æ•°æ®å›¾è¡¨è¿›è¡Œé…ç½®ï¼Œåœ¨å‘Šè­¦çš„æ—¶å€™ä¹Ÿä¼šæŠŠå‡ºç°å¼‚å¸¸çš„å›¾è¡¨è¿›è¡Œé€šçŸ¥ï¼Œä½¿å¾—æˆ‘ä»¬çš„å‘Šè­¦é€šçŸ¥æ›´åŠ å‹å¥½ã€‚ ","date":"2022-08-17","objectID":"/grafana/:6:5","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Grafana"],"content":"å‚è€ƒ Grafana å®˜ç½‘ Grafana Dashboardæ¨¡æ¿-å®˜ç½‘ ","date":"2022-08-17","objectID":"/grafana/:7:0","tags":["Grafana"],"title":"Grafana","uri":"/grafana/"},{"categories":["Helm"],"content":"è®°å½•ä¸€ä¸‹helm åœ¨ç”Ÿäº§ä¸­çš„å®è·µ Helm å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç† Kubernetes åº”ç”¨ç¨‹åº - Helm Charts å¯ä»¥å®šä¹‰ã€å®‰è£…å’Œå‡çº§å¤æ‚çš„ Kubernetes åº”ç”¨ç¨‹åºï¼ŒCharts åŒ…å¾ˆå®¹æ˜“åˆ›å»ºã€ç‰ˆæœ¬ç®¡ç†ã€åˆ†äº«å’Œåˆ†å¸ƒã€‚ Helm å¯¹äº Kubernetes æ¥è¯´å°±ç›¸å½“äº yum å¯¹äº Centos æ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰ yum çš„è¯ï¼Œæˆ‘ä»¬åœ¨ Centos ä¸‹é¢è¦å®‰è£…ä¸€äº›åº”ç”¨ç¨‹åºæ˜¯æåº¦éº»çƒ¦çš„ï¼ŒåŒæ ·çš„ï¼Œå¯¹äºè¶Šæ¥è¶Šå¤æ‚çš„ Kubernetes åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¦‚æœå•çº¯ä¾é æˆ‘ä»¬å»æ‰‹åŠ¨ç»´æŠ¤åº”ç”¨ç¨‹åºçš„ YAML èµ„æºæ¸…å•æ–‡ä»¶æ¥è¯´ï¼Œæˆæœ¬ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:0:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"Helm ä¸ Kubernetes ç‰ˆæœ¬å…¼å®¹æ€§å¯¹ç…§ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:1:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"Helm 3 ç‰ˆæœ¬ä¸ Kubernetes å…¼å®¹æ€§ Helm ç‰ˆæœ¬ æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬èŒƒå›´ é‡è¦è¯´æ˜ Helm 3.13.x 1.25 - 1.28 æœ€æ–°ç¨³å®šç‰ˆ Helm 3.12.x 1.24 - 1.27 Helm 3.11.x 1.23 - 1.26 Helm 3.10.x 1.22 - 1.25 Helm 3.9.x 1.21 - 1.24 Helm 3.8.x 1.20 - 1.23 Helm 3.7.x 1.19 - 1.22 Helm 3.6.x 1.18 - 1.21 Helm 3.5.x 1.17 - 1.20 Helm 3.4.x 1.16 - 1.19 Helm 3.3.x 1.15 - 1.18 Helm 3.2.x 1.14 - 1.17 Helm 3.1.x 1.13 - 1.16 Helm 3.0.x 1.13 - 1.16 åˆå§‹ Helm 3 ç‰ˆæœ¬ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:1:1","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"Helm 2 ç‰ˆæœ¬ä¸ Kubernetes å…¼å®¹æ€§ (å·²å¼ƒç”¨) Helm ç‰ˆæœ¬ æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬èŒƒå›´ çŠ¶æ€ Helm 2.17.x 1.14 - 1.17 å·²å¼ƒç”¨ Helm 2.16.x 1.13 - 1.16 å·²å¼ƒç”¨ â€¦ â€¦ å·²å¼ƒç”¨ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:1:2","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"é‡è¦è¯´æ˜ å‘åå…¼å®¹æ€§ï¼šHelm é€šå¸¸æ”¯æŒå½“å‰ç‰ˆæœ¬å’Œä¹‹å‰å‡ ä¸ªç‰ˆæœ¬çš„ Kubernetesã€‚ä¾‹å¦‚ï¼ŒHelm 3.13.x æ”¯æŒ Kubernetes 1.25-1.28ã€‚ å‘å‰å…¼å®¹æ€§ï¼šè¾ƒæ–°ç‰ˆæœ¬çš„ Helm å¯èƒ½ä¸æ”¯æŒéå¸¸æ—§çš„ Kubernetes é›†ç¾¤ã€‚ æœ€ä½³å®è·µï¼š å°½é‡ä½¿ç”¨ Helm å’Œ Kubernetes çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ ä¿æŒ Helm ç‰ˆæœ¬ä¸ Kubernetes ç‰ˆæœ¬å·®è·ä¸è¶…è¿‡ 2-3 ä¸ªå°ç‰ˆæœ¬ ç”Ÿäº§ç¯å¢ƒé¿å…ä½¿ç”¨è¾¹ç¼˜ç‰ˆæœ¬ç»„åˆ æ£€æŸ¥æ–¹æ³•ï¼š helm version kubectl version å‡çº§å»ºè®®ï¼šå‡çº§ Kubernetes é›†ç¾¤æ—¶ï¼Œåº”è€ƒè™‘åŒæ—¶å‡çº§ Helm åˆ°å…¼å®¹ç‰ˆæœ¬ã€‚ è¯·æ³¨æ„ï¼Œå…·ä½“ Chart å¯èƒ½å¯¹ Kubernetes ç‰ˆæœ¬æœ‰é¢å¤–è¦æ±‚ï¼Œå»ºè®®æŸ¥çœ‹ Chart çš„æ–‡æ¡£æˆ– requirements.yaml æ–‡ä»¶ã€‚ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:1:3","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"å®‰è£… ç”±äº Helm V2 ç‰ˆæœ¬å¿…é¡»åœ¨ Kubernetes é›†ç¾¤ä¸­å®‰è£…ä¸€ä¸ª Tiller æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·å¤§å¤§é™ä½äº†å…¶å®‰å…¨æ€§å’Œå¯ç”¨æ€§ï¼Œæ‰€ä»¥åœ¨ V3 ç‰ˆæœ¬ä¸­ç§»é™¤äº†æœåŠ¡ç«¯ï¼Œé‡‡ç”¨äº†é€šç”¨çš„ Kubernetes CRD èµ„æºæ¥è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±åªéœ€è¦è¿æ¥ä¸Š Kubernetes å³å¯ï¼Œè€Œä¸” V3 ç‰ˆæœ¬å·²ç»å‘å¸ƒäº†ç¨³å®šç‰ˆ è¿™é‡Œä½¿ç”¨çš„æ˜¯helm v3ç‰ˆæœ¬,é“¾æ¥ æ ¹æ®kubernetes ç‰ˆæœ¬é€‰æ‹©å®‰è£…åˆé€‚çš„helm ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå®‰è£…v3.10.0 ç‰ˆæœ¬ # 1. ä¸‹è½½å®‰è£…åŒ… $ wget https://get.helm.sh/helm-v3.10.0-linux-amd64.tar.gz # 2. è§£å‹ $ tar -zxvf helm-v3.10.0-linux-amd64.tar.gz # 3. move $ mv linux-amd64/helm /usr/local/bin/helm ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:2:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"ç¤ºä¾‹ Helm å…¶å®å°±æ˜¯è¯»å–çš„ kubeconfig æ–‡ä»¶æ¥è®¿é—®é›†ç¾¤çš„ã€‚ # æŸ¥çœ‹ç‰ˆæœ¬ $ helm version version.BuildInfo{Version:\"v3.10.0\", GitCommit:\"ce66412a723e4d89555dc67217607c6579ffcb21\", GitTreeState:\"clean\", GoVersion:\"go1.18.6\"} # æ·»åŠ ä¸€ä¸ª chart ä»“åº“ $ helm repo add stable http://mirror.azure.cn/kubernetes/charts/ \"stable\" has been added to your repositories $ helm repo list NAME URL stable http://mirror.azure.cn/kubernetes/charts/ # ç”¨ search å‘½ä»¤æ¥æœç´¢å¯ä»¥å®‰è£…çš„ chart åŒ…ï¼Œå·²ç»é›†æˆäº†å°†è¿‘300ä¸ªå¯å®‰è£…çš„chartåŒ… zoms@crms-10-10-192-220[/tmp]$ helm search repo stable|more NAME CHART VERSION APP VERSION DESCRIPTION stable/acs-engine-autoscaler 2.2.2 2.1.1 DEPRECATED Scales worker nodes within agent pools stable/aerospike 0.3.5 v4.5.0.5 DEPRECATED A Helm chart for Aerospike in Kubern... stable/airflow 7.13.3 1.10.12 DEPRECATED - please use: https://github.com/air... # å®‰è£…ä¹‹å‰å…ˆè¿›è¡Œæ›´æ–° $ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the \"stable\" chart repository Update Complete. âˆHappy Helming!âˆ # å®‰è£…ä¸€ä¸ªmysql åº”ç”¨ helm install stable/mysql --generate-name # äº†è§£ MySQL è¿™ä¸ª chart åŒ…çš„ä¸€äº›ç‰¹æ€§ helm show chart stable/mysql # äº†è§£ MySQL è¿™ä¸ª chart åŒ…æ›´å¤šçš„ç‰¹æ€§ helm show all stable/mysql # æŸ¥çœ‹å·²å®‰è£…çš„release helm ls # åˆ é™¤release helm uninstall mysql-1575619811 # åˆ é™¤release æ—¶ä¿ç•™å†å²è®°å½•ï¼Œæ–¹ä¾¿å–æ¶ˆåˆ é™¤ releaseï¼ˆä½¿ç”¨ helm rollback å‘½ä»¤ï¼‰ helm uninstall mysql-1575619811 --keep-history ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:3:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"å®šåˆ¶ helm show values å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ª chart åŒ…çš„æ‰€æœ‰å¯é…ç½®çš„å‚æ•°é€‰é¡¹ æŸ¥çœ‹æœ¬åœ°chartåŒ…å¯é…ç½®çš„å‚æ•°é€‰é¡¹ $ helm show values ./nms-grafana/ -n zcm9 # Default values for nms-grafana. # This is a YAML-formatted file. # Declare variables to be passed into your templates fullnameOverride: nms-grafana replicaCount: 1 restartPolicy: Always .... æŸ¥çœ‹ä»“åº“chartåŒ…çš„æ‰€æœ‰å¯é…ç½®çš„å‚æ•°é€‰é¡¹,å®‰è£…ä¹‹å‰å…ˆçœ‹ä¸‹é•œåƒæºæ˜¯å¦å¯å…ˆpullä¸‹æ¥ï¼Œä»¥åŠé•œåƒçš„ç‰ˆæœ¬å· $ helm show values stable/mysql ## mysql image version ## ref: https://hub.docker.com/r/library/mysql/tags/ ## image: \"mysql\" imageTag: \"5.7.30\" strategy: type: Recreate busybox: image: \"busybox\" ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯ä»¥ç”¨è‡ªå·±çš„æ•°æ®æ¥è¦†ç›–çš„ï¼Œå¯ä»¥åœ¨å®‰è£…çš„æ—¶å€™é€šè¿‡ YAML æ ¼å¼çš„æ–‡ä»¶æ¥ä¼ é€’è¿™äº›å‚æ•° $ cat config.yaml mysqlUser: user0 mysqlPassword: user0pwd mysqlDatabase: user0db persistence: enabled: false $ helm install -f config.yaml mysql stable/mysql NAME: mysql LAST DEPLOYED: Fri Dec 6 17:46:56 2019 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: MySQL can be accessed via port 3306 on the following DNS name from within your cluster: mysql.default.svc.cluster.local release å®‰è£…æˆåŠŸåæŸ¥çœ‹å¯¹åº”çš„Podä¿¡æ¯ $ kubectl get pod -l release=mysql NAME READY STATUS RESTARTS AGE mysql-ddd798f48-gnrzd 0/1 PodInitializing 0 119s $ kubectl describe pod mysql-ddd798f48-gnrzd ...... Environment: MYSQL_ROOT_PASSWORD: \u003cset to the key 'mysql-root-password' in secret 'mysql'\u003e Optional: false MYSQL_PASSWORD: \u003cset to the key 'mysql-password' in secret 'mysql'\u003e Optional: false MYSQL_USER: user0 MYSQL_DATABASE: user0db ...... å¯ä»¥çœ‹åˆ°ç¯å¢ƒå˜é‡ MYSQL_USER=user0ï¼ŒMYSQL_DATABASE=user0db çš„å€¼å’Œæˆ‘ä»¬ä¸Šé¢é…ç½®çš„å€¼æ˜¯ä¸€è‡´çš„ åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¼ é€’é…ç½®æ•°æ®ï¼š â€“valuesï¼ˆæˆ–è€… -fï¼‰ï¼šæŒ‡å®šä¸€ä¸ª YAML æ–‡ä»¶æ¥è¦†ç›– values å€¼ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªå€¼ï¼Œæœ€åè¾¹çš„æ–‡ä»¶ä¼˜å…ˆ â€“setï¼šåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šè¦†ç›–çš„é…ç½® ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:4:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"æ›´å¤šå®‰è£…æ–¹å¼ helm install å‘½ä»¤å¯ä»¥ä»å¤šä¸ªæºè¿›è¡Œå®‰è£…ï¼š chart ä»“åº“ï¼ˆç±»ä¼¼äºä¸Šé¢æˆ‘ä»¬æåˆ°çš„ï¼‰ æœ¬åœ° chart å‹ç¼©åŒ…ï¼ˆhelm install foo-0.1.1.tgzï¼‰ æœ¬åœ°è§£å‹ç¼©çš„ chart ç›®å½•ï¼ˆhelm install foo path/to/fooï¼‰ åœ¨çº¿çš„ URLï¼ˆhelm install fool https://example.com/charts/foo-1.2.3.tgzï¼‰ ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:5:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Helm"],"content":"å‡çº§å’Œå›æ»š å½“æ–°ç‰ˆæœ¬çš„ chart åŒ…å‘å¸ƒçš„æ—¶å€™ï¼Œæˆ–è€…å½“ä½ è¦æ›´æ”¹ release çš„é…ç½®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ helm upgrade å‘½ä»¤æ¥æ“ä½œã€‚å‡çº§éœ€è¦ä¸€ä¸ªç°æœ‰çš„ releaseï¼Œå¹¶æ ¹æ®æä¾›çš„ä¿¡æ¯å¯¹å…¶è¿›è¡Œå‡çº§ã€‚å› ä¸º Kubernetes charts å¯èƒ½å¾ˆå¤§è€Œä¸”å¾ˆå¤æ‚ï¼ŒHelm ä¼šå°è¯•ä»¥æœ€å°çš„ä¾µå…¥æ€§è¿›è¡Œå‡çº§ï¼Œå®ƒåªä¼šæ›´æ–°è‡ªä¸Šä¸€ç‰ˆæœ¬ä»¥æ¥å‘ç”Ÿçš„å˜åŒ–ï¼š $ helm upgrade -f config.yaml mysql stable/mysql Release \"mysql\" has been upgraded. Happy Helming! NAME: mysql LAST DEPLOYED: Fri Dec 6 21:06:11 2019 NAMESPACE: default STATUS: deployed REVISION: 2 ... æŸ¥çœ‹å‡çº§åçš„æ–°è®¾ç½®æ˜¯å¦ç”Ÿæ•ˆ $ helm get values mysql USER-SUPPLIED VALUES: mysqlDatabase: user0db mysqlPassword: user0pwd mysqlRootPassword: passw0rd mysqlUser: user0 persistence: enabled: false å¦å¤–å¦‚ç”Ÿäº§åŸºæœ¬ä¸Šæ˜¯åªæ›¿æ¢é•œåƒtag $ sudo helm get values nms-grafana -n zcm9 USER-SUPPLIED VALUES: global: nodeSelector: aik: zcm9 repository: 10.10.192.220:52800 nms-activemq: image: tag: C_20220628200611 nms-grafana: image: tag: C_20220726192751-v9.0.1 ... æŸ¥çœ‹å½“å‰release å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠæŸ¥çœ‹æŸä¸ªrelease çš„å†å² $ sudo helm -n zcm9 ls NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION minio zcm9 1 2022-08-11 19:27:49.792207699 +0800 CST failed minio-10.0.4 2022.1.8 nms-activemq zcm9 1 2022-11-09 13:31:42.996290693 +0800 CST deployed nms-activemq-0.1.0 9.0.44 nms-grafana zcm9 29 2023-05-04 20:34:46.578214434 +0800 CST deployed nms-grafana-0.1.0 aik ... $ sudo helm -n zcm9 history nms-grafana REVISION UPDATED STATUS CHART APP VERSION DESCRIPTION 20 Thu May 4 19:52:14 2023 superseded nms-grafana-0.1.0 aik Upgrade complete 21 Thu May 4 19:53:14 2023 superseded nms-grafana-0.1.0 aik Upgrade complete 22 Thu May 4 19:58:59 2023 superseded nms-grafana-0.1.0 aik Upgrade complete ... å›æ»š # ä¸Šé¢å¯çŸ¥æœ¬åœ°å®‰è£…çš„åº”ç”¨nms-grafana è¿­ä»£è‡³äº†ç‰ˆæœ¬29,å¦‚æœè¦å›æ»šè‡³æŒ‡å®šç‰ˆæœ¬å¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹å¼ $ helm -n zcm9 rollback nms-grafana 21 ","date":"2022-07-21","objectID":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/:6:0","tags":["Helm"],"title":"Helm ç”Ÿäº§å®è·µè®°å½•","uri":"/helm%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"},{"categories":["Django"],"content":"Docker æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºã€è¿è¡Œå’Œåˆ†å‘åº”ç”¨ç¨‹åºçš„å¹³å°ã€‚å®ƒå…è®¸æ‚¨å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œç„¶åå¯ä»¥åœ¨ä»»ä½•å®‰è£…äº† Docker çš„æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚ è¿™ä½¿å¾— Docker æˆä¸ºéƒ¨ç½² Web åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ï¼Œå› ä¸ºå®ƒå¯ä»¥è½»æ¾åœ°å°†åº”ç”¨ç¨‹åºä»ä¸€ä¸ªç¯å¢ƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªç¯å¢ƒï¼Œè€Œæ— éœ€æ‹…å¿ƒä»»ä½•å…¼å®¹æ€§é—®é¢˜ã€‚ å¦ä¸€æ–¹é¢ï¼ŒDjango æ˜¯ä¸€ä¸ª Python Web æ¡†æ¶ï¼Œå¯ä»¥è½»æ¾åˆ›å»ºå¼ºå¤§ä¸”å¯æ‰©å±•çš„ Web åº”ç”¨ç¨‹åºã€‚ Django æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç”¨æˆ·èº«ä»½éªŒè¯ç³»ç»Ÿã€æ•°æ®åº“æŠ½è±¡å±‚å’Œæ¨¡æ¿å¼•æ“ã€‚ è¿™ä½¿å¾— Django çš„å…¥é—¨å˜å¾—å®¹æ˜“ï¼Œå¹¶ä¸”å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºå¤æ‚çš„ Web åº”ç”¨ç¨‹åºã€‚ Docker åŒ–å’Œéƒ¨ç½² Django åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„è¿‡ç¨‹ã€‚æ¶‰åŠçš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š ä¸ºæ‚¨çš„ Django åº”ç”¨ç¨‹åºåˆ›å»º Dockerfileã€‚ ä» Dockerfile æ„å»º Docker æ˜ åƒã€‚ å°†Dockeré•œåƒéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:0:0","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["Django"],"content":"å‡†å¤‡ åŸºäº Python 3.9ã€Django 3.2ã€docker 20.10.13 ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:1:0","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["Django"],"content":"è½¯ä»¶å®‰è£… Docker Python3 ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:1:1","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["Django"],"content":"åˆ›å»ºDjangoé¡¹ç›® pip install django==3.2 django-admin startproject django-demo è¿™è¡Œä»£ç å°†ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª simplesite ç›®å½• è®©æˆ‘ä»¬çœ‹çœ‹ startproject åˆ›å»ºäº†äº›ä»€ä¹ˆ: django-demo/ manage.py django-demo/ __init__.py settings.py urls.py asgi.py wsgi.py è¿™äº›ç›®å½•å’Œæ–‡ä»¶çš„ç”¨å¤„æ˜¯ï¼š æœ€å¤–å±‚çš„ mysite/ æ ¹ç›®å½•åªæ˜¯ä½ é¡¹ç›®çš„å®¹å™¨ï¼Œ æ ¹ç›®å½•åç§°å¯¹ Django æ²¡æœ‰å½±å“ï¼Œä½ å¯ä»¥å°†å®ƒé‡å‘½åä¸ºä»»ä½•ä½ å–œæ¬¢çš„åç§°ã€‚ manage.py: ä¸€ä¸ªè®©ä½ ç”¨å„ç§æ–¹å¼ç®¡ç† Django é¡¹ç›®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ é‡Œé¢ä¸€å±‚çš„ mysite/ ç›®å½•åŒ…å«ä½ çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯ Python åŒ…ã€‚ mysite/init.pyï¼šä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œå‘Šè¯‰ Python è¿™ä¸ªç›®å½•åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª Python åŒ…ã€‚ mysite/settings.pyï¼šDjango é¡¹ç›®çš„é…ç½®æ–‡ä»¶ã€‚ mysite/urls.pyï¼šDjango é¡¹ç›®çš„ URL å£°æ˜ï¼Œå°±åƒä½ ç½‘ç«™çš„â€œç›®å½•â€ã€‚ mysite/asgi.pyï¼šä½œä¸ºä½ çš„é¡¹ç›®çš„è¿è¡Œåœ¨ ASGI å…¼å®¹çš„ Web æœåŠ¡å™¨ä¸Šçš„å…¥å£ã€‚ mysite/wsgi.pyï¼šä½œä¸ºä½ çš„é¡¹ç›®çš„è¿è¡Œåœ¨ WSGI å…¼å®¹çš„WebæœåŠ¡å™¨ä¸Šçš„å…¥å£ã€‚ å¦‚æœä½ çš„å½“å‰ç›®å½•ä¸æ˜¯å¤–å±‚çš„ mysite ç›®å½•çš„è¯ï¼Œè¯·åˆ‡æ¢åˆ°æ­¤ç›®å½•ï¼Œç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š $ python manage.py runserver ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:1:2","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["Django"],"content":"Dockerfile # ä½¿ç”¨å®˜æ–¹Pythonè¿è¡Œæ—¶ä½œä¸ºçˆ¶é•œåƒ FROM python:3.9-alpine LABEL maintainer=\"lushuan2071@126.com\" # è®¾ç½® python ç¯å¢ƒå˜é‡ ENV PYTHONUNBUFFERED 1 # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å°†ä»£ç å¤åˆ¶åˆ°å®¹å™¨ä¸­ COPY . /app # æ·»åŠ  pip æ¸…åé•œåƒæº RUN pip install pip -U -i https://pypi.tuna.tsinghua.edu.cn/simple # å®‰è£…ä¾èµ– RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple # æš´éœ²ç«¯å£ EXPOSE 8000 # è¿è¡ŒDjangoåº”ç”¨ CMD [\"python\", \"manage.py\", \"runserver\", \"0.0.0.0:8000\"] æ„å»ºé•œåƒ docker build -t mydjangoapp:v1.0 . -f Dockerfile è¿è¡Œå®¹å™¨ docker run --name mydjangoapp -p 8000:8000 -d mydjangoapp:v1.0 æ„å»ºè®°å½• # docker build -t mydjangoapp:v1.0 . -f Dockerfile Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. STEP 1/7: FROM localhost/python:3.9-alpine STEP 2/7: LABEL maintainer=\"lushuan2071@126.com\" --\u003e bf70fc48b6d STEP 3/7: WORKDIR /app --\u003e 45b9db8d767 STEP 4/7: COPY . /app --\u003e 7df5ef439ea STEP 5/7: RUN pip install --no-cache-dir -r requirements.txt Collecting asgiref==3.8.1 Downloading asgiref-3.8.1-py3-none-any.whl (23 kB) Collecting Django==3.2.25 Downloading Django-3.2.25-py3-none-any.whl (7.9 MB) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 7.9/7.9 MB 139.1 kB/s eta 0:00:00 Collecting mysql-connector-python==8.4.0 Downloading mysql_connector_python-8.4.0-py2.py3-none-any.whl (565 kB) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 565.1/565.1 kB 119.1 kB/s eta 0:00:00 Collecting sqlparse==0.5.0 Downloading sqlparse-0.5.0-py3-none-any.whl (43 kB) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 44.0/44.0 kB 124.3 kB/s eta 0:00:00 Collecting typing_extensions==4.11.0 Downloading typing_extensions-4.11.0-py3-none-any.whl (34 kB) Collecting tzdata==2024.1 Downloading tzdata-2024.1-py2.py3-none-any.whl (345 kB) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 345.4/345.4 kB 136.4 kB/s eta 0:00:00 Collecting pytz Downloading pytz-2024.1-py2.py3-none-any.whl (505 kB) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 505.5/505.5 kB 182.8 kB/s eta 0:00:00 Installing collected packages: pytz, tzdata, typing_extensions, sqlparse, mysql-connector-python, asgiref, Django Successfully installed Django-3.2.25 asgiref-3.8.1 mysql-connector-python-8.4.0 pytz-2024.1 sqlparse-0.5.0 typing_extensions-4.11.0 tzdata-2024.1 WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv [notice] A new release of pip is available: 23.0.1 -\u003e 24.1.2 [notice] To update, run: pip install --upgrade pip --\u003e dd901d2c952 STEP 6/7: EXPOSE 8000 --\u003e f1884d94f8e STEP 7/7: CMD [\"python\", \"manage.py\", \"runserver\", \"0.0.0.0:8000\"] COMMIT mydjangoapp:v1.0 --\u003e 9253897f89f Successfully tagged localhost/mydjangoapp:v1.0 9253897f89fa29c91253cdb28e8494453dd2cf330b66a51968ec817e35faf19b # docker images|grep django Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. localhost/mydjangoapp v1.0 9253897f89fa 13 seconds ago 100 MB # docker run --name mydjangoapp -p 8000:8000 -d mydjangoapp:v1.0 Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. 49c212881ab19348ccb12f492a7e6f32f545efeff67daf27df6e2b9c7bf074ee # # docker ps Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 49c212881ab1 localhost/mydjangoapp:v1.0 python manage.py ... 6 seconds ago Up 7 seconds 0.0.0.0:8000-\u003e8000/tcp mydjangoapp # docker ps Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 49c212881ab1 localhost/mydjangoapp:v1.0 python manage.py ... 8 seconds ago Up 8 seconds 0.0.0.0:8000-\u003e8000/tcp mydjangoapp ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:2:0","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["Django"],"content":"å‚è€ƒ Python é•œåƒçš„å…¨æ–¹ä½æŒ‡å— åŸåˆ› ","date":"2022-07-20","objectID":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/:3:0","tags":["Django"],"title":"Django åº”ç”¨å®¹å™¨åŒ–æ„å»º","uri":"/django-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"},{"categories":["linux"],"content":"ç›‘æ§ç³»ç»Ÿèµ„æºå’Œè¿›ç¨‹å·¥å…· top å‘½ä»¤ å¿«æ·é”®åŠä½¿ç”¨åœºæ™¯ 1ï¼šæ˜¾ç¤ºæ¯ä¸ª CPU æ ¸å¿ƒçš„è¯¦ç»†ä¿¡æ¯ã€‚å½“ä½ éœ€è¦æŸ¥çœ‹ç³»ç»Ÿä¸­æ¯ä¸ª CPU æ ¸å¿ƒçš„è´Ÿè½½å’Œä½¿ç”¨æƒ…å†µæ—¶ï¼Œå¯ä»¥æŒ‰ä¸‹ 1 é”®ã€‚ Eï¼šåˆ‡æ¢ç´¯è®¡æ¨¡å¼ï¼ˆCumulative Modeï¼‰ã€‚åœ¨ç´¯è®¡æ¨¡å¼ä¸‹ï¼ŒCPU ä½¿ç”¨ç‡å’Œå†…å­˜å ç”¨ç­‰æŒ‡æ ‡ä¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„ç´¯è®¡å€¼è€Œä¸æ˜¯å•ä¸ªè¿›ç¨‹çš„å€¼ã€‚ Mï¼šæŒ‰å†…å­˜ä½¿ç”¨æ’åºã€‚æŒ‰ä¸‹ M é”®åï¼Œtop å‘½ä»¤ä¼šæŒ‰ç…§å†…å­˜ä½¿ç”¨é‡çš„å¤§å°å¯¹è¿›ç¨‹è¿›è¡Œæ’åºï¼Œå¹¶æ˜¾ç¤ºæœ€é«˜çš„å†…å­˜ä½¿ç”¨è¿›ç¨‹ã€‚ Pï¼šæŒ‰ CPU ä½¿ç”¨æ’åºã€‚æŒ‰ä¸‹ P é”®åï¼Œtop å‘½ä»¤ä¼šæŒ‰ç…§ CPU ä½¿ç”¨ç‡çš„å¤§å°å¯¹è¿›ç¨‹è¿›è¡Œæ’åºï¼Œå¹¶æ˜¾ç¤ºæœ€é«˜çš„ CPU ä½¿ç”¨è¿›ç¨‹ã€‚ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:0:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"å†…å­˜ å†…å­˜ç›¸å…³åè¯é‡Šä¹‰ 1ï¼‰Working Set Size(WSS)æ˜¯æŒ‡ä¸€ä¸ªappä¿æŒæ­£å¸¸è¿è¡Œæ‰€é¡»çš„å†…å­˜ã€‚æ¯”å¦‚ä¸€ä¸ªåº”ç”¨åœ¨åˆå§‹é˜¶æ®µç”³è¯·äº†100Gä¸»å­˜ï¼Œåœ¨å®é™…æ­£å¸¸è¿è¡Œæ—¶æ¯ç§’åªéœ€è¦50Mï¼Œé‚£ä¹ˆè¿™é‡Œçš„50Må°±æ˜¯ä¸€ä¸ªWSS 2ï¼‰RESï¼šresident memory usageã€‚å¸¸é©»å†…å­˜ 3ï¼‰RSS Resident Set Size å®é™…ä½¿ç”¨ç‰©ç†å†…å­˜ï¼Œï¼ˆåŒ…å«å…±äº«åº“å ç”¨çš„å†…å­˜ï¼‰ 4ï¼‰CACHEï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å†…å­˜ï¼Œå› ä¸ºä¸»å†…å­˜é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œç”¨å°‘é‡çš„ç‰¹åˆ«å¿«çš„ä½†ç‰¹åˆ«æ˜‚è´µçš„å†…å­˜æ¥åšç¼“å­˜åŠ é€Ÿ,å°±æ˜¯cacheã€‚ç®€å•æ¥è¯´ï¼Œbufferæ˜¯å³å°†è¦è¢«å†™å…¥ç£ç›˜çš„ï¼Œè€Œcacheæ˜¯è¢«ä»ç£ç›˜ä¸­è¯»å‡ºæ¥çš„ã€‚ 5ï¼‰SWAP äº¤æ¢åŒºé—´ï¼Œå†…å­˜ä¸å¤Ÿç”¨ä½¿ç”¨ç£ç›˜å……å½“å†…å­˜ æŸ¥çœ‹å ç”¨å†…å­˜è¾ƒé«˜çš„10ä¸ªè¿›ç¨‹ ps -aux | sort -k4nr | head æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å° # é€šè¿‡ç«¯å£è·å–è¿›ç¨‹å· netstat -anp|grep 9100 tcp6 0 0 :::9100 :::* LISTEN 5505/node_exporter # é€šè¿‡è¿›ç¨‹idè·å–è¿›ç¨‹å ç”¨å†…å­˜å¤§å° cat /proc/5505/status|grep VmRSS VmRSS: 31500 kB æŠ€å·§\ræ³¨æ„ï¼šVmRSSå¯¹åº”çš„å€¼å°±æ˜¯ç‰©ç†å†…å­˜å ç”¨\r","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:1:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"IO æŸ¥çœ‹ç£ç›˜ioåŠä¼ é€’çŠ¶æ€ iostat -x 1 3 ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:2:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"å¦‚ä½•åˆ¤æ–­ç£ç›˜ io æ€§èƒ½è¾¾åˆ°ç“¶é¢ˆï¼Ÿ iostat æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§ç³»ç»Ÿç£ç›˜IOä½¿ç”¨æƒ…å†µçš„å·¥å…·ï¼Œå¯ä»¥æ˜¾ç¤ºæ¯ä¸ªç£ç›˜çš„IOæ“ä½œã€IOå»¶è¿Ÿå’Œæ•°æ®ååé‡ç­‰ä¿¡æ¯ã€‚å½“ç£ç›˜IOè¾¾åˆ°ç“¶é¢ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡ iostat æ¥åˆ¤æ–­ã€‚ æœ‰ä»¥ä¸‹å‡ ä¸ªæŒ‡æ ‡å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­ç£ç›˜IOæ˜¯å¦è¾¾åˆ°ç“¶é¢ˆï¼š %utilï¼šè¿™æ˜¯ç£ç›˜IOåˆ©ç”¨ç‡çš„ç™¾åˆ†æ¯”ï¼Œè¡¨ç¤ºç£ç›˜æ­£åœ¨å¤„ç†IOè¯·æ±‚æ‰€å ç”¨çš„æ—¶é—´æ¯”ä¾‹ã€‚å½“ %util é«˜äº 80% æˆ– 90% æ—¶ï¼Œç£ç›˜IOå¯èƒ½å·²ç»è¾¾åˆ°ç“¶é¢ˆçŠ¶æ€ã€‚ awaitï¼šè¿™æ˜¯å¹³å‡æ¯ä¸ªIOè¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å¤„ç†çš„æ—¶é—´ï¼Œè¡¨ç¤ºç³»ç»Ÿå¹³å‡IOå“åº”æ—¶é—´ã€‚å½“ await è¾ƒé«˜(é€šå¸¸å¤§äº 10ms)æ—¶ï¼Œè¯´æ˜ç£ç›˜IOè´Ÿè½½è¿‡é‡ï¼Œä¹Ÿå¯èƒ½æ„å‘³ç€ç£ç›˜IOå·²è¾¾åˆ°ç“¶é¢ˆã€‚ svctmï¼šè¿™æ˜¯å¹³å‡æ¯ä¸ªIOè¯·æ±‚çš„æœåŠ¡æ—¶é—´ï¼Œè¡¨ç¤ºç£ç›˜å¤„ç†IOè¯·æ±‚çš„å¹³å‡æ—¶é—´ã€‚å½“ svctm è¾ƒé«˜æ—¶ï¼Œç³»ç»Ÿå¤„ç†IOè¯·æ±‚çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œå¯èƒ½ä»£è¡¨ç£ç›˜IOå·²ç»è¾¾åˆ°ç“¶é¢ˆçŠ¶æ€ã€‚ æ€»ä¹‹ï¼Œå½“ç£ç›˜IOåˆ©ç”¨ç‡é«˜ã€IOç­‰å¾…æ—¶é—´é•¿æˆ–æœåŠ¡æ—¶é—´é•¿æ—¶ï¼Œç£ç›˜IOå¯èƒ½å·²è¾¾åˆ°ç“¶é¢ˆçŠ¶æ€ã€‚é€šå¸¸è¿˜éœ€è¦ç»¼åˆè€ƒè™‘è¯¸å¦‚ç³»ç»Ÿæ€§èƒ½éœ€æ±‚ã€ç£ç›˜ç±»å‹å’Œé…ç½®ç­‰å› ç´ ï¼Œæ‰èƒ½ç¡®å®šæ˜¯å¦å¯¹ç³»ç»Ÿè¿›è¡Œä¼˜åŒ–æˆ–å‡çº§ã€‚ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:2:1","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"æŸ¥çœ‹ç£ç›˜ioå ç”¨è¾ƒé«˜çš„å‡ ä¸ªè¿›ç¨‹ å¯ä»¥ä½¿ç”¨ iotop å‘½ä»¤æ¥æŸ¥çœ‹ç£ç›˜IOå ç”¨è¾ƒé«˜çš„å‡ ä¸ªè¿›ç¨‹ $ iotop -oP Total DISK READ : 577.97 K/s | Total DISK WRITE : 115.06 K/s Actual DISK READ: 64.22 K/s | Actual DISK WRITE: 1934.59 K/s PID PRIO USER DISK READ DISK WRITE SWAPIN IO\u003e COMMAND 574 be/4 root 577.97 K/s 0.00 B/s 0.00 % 8.68 % [xfsaild/dm-0] 73282 be/4 root 0.00 B/s 45.49 K/s 0.00 % 0.47 % influxd 53910 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.02 % [kworker/7:0] 55873 be/4 systemd- 0.00 B/s 2.68 K/s 0.00 % 0.02 % mysqld ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:2:2","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"ç›‘æ§è¿›ç¨‹ä½¿ç”¨æƒ…å†µ pidstat æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§è¿›ç¨‹èµ„æºä½¿ç”¨æƒ…å†µçš„å·¥å…·ï¼Œå¯ä»¥æä¾›æœ‰å…³ CPUã€å†…å­˜ã€ç£ç›˜IOã€ç½‘ç»œå’Œä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰æ–¹é¢çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ pidstat å¸¸ç”¨å‘½ä»¤åŠå…¶ä½¿ç”¨åœºæ™¯ï¼š 1.æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼š pidstat -p è¯¥å‘½ä»¤å¯ç”¨äºç›‘æ§æŒ‡å®š PID çš„è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€ç£ç›˜IOç­‰ã€‚ 2.å®æ—¶ç›‘æ§æ•´ä¸ªç³»ç»Ÿä¸­è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼š pidstat -r è¯¥å‘½ä»¤å¯å®æ—¶æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è™šæ‹Ÿå†…å­˜å¤§å°ã€ç‰©ç†å†…å­˜å¤§å°ã€å…±äº«å†…å­˜å¤§å°ç­‰ã€‚ 3.ç›‘æ§è¿›ç¨‹çš„CPUä½¿ç”¨æƒ…å†µï¼š pidstat -u é€šè¿‡è®¾ç½® å’Œ å‚æ•°ï¼Œè¯¥å‘½ä»¤å¯å®šæœŸæ˜¾ç¤ºè¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ CPU ä½¿ç”¨æ—¶é—´ã€CPU ä½¿ç”¨ç™¾åˆ†æ¯”ç­‰ã€‚ pidstat å‘½ä»¤å¸¸ç”¨äºæ€§èƒ½åˆ†æå’Œèµ„æºç›‘æ§ï¼Œå¯ä»¥å¸®åŠ©å®šä½å’Œè§£å†³ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚å…·ä½“ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š æŸ¥æ‰¾ CPU å¯†é›†å‹è¿›ç¨‹ã€ç›‘æµ‹å†…å­˜æ³„æ¼ã€æ£€æµ‹ç£ç›˜IOç“¶é¢ˆã€åˆ†æç½‘ç»œä¼ è¾“æƒ…å†µç­‰ã€‚ æœ€ä½³å®è·µ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:3:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"æ‰‹åŠ¨æ¸…ç†ç¼“å­˜buffer/cache 1.æ¸…ç†pagecache(é¡µé¢ç¼“å­˜) echo 1 \u003e /proc/sys/vm/drop_caches #æˆ–è€… sysctl -w vm.drop_caches=1 2.æ¸…ç†ç›®å½•ç¼“å­˜ echo 2 \u003e /proc/sys/vm/drop_caches #æˆ–è€… sysctl -w vm.drop_caches=2 3.æ¸…ç†pagecacheã€dentrieså’Œinodes echo 3 \u003e /proc/sys/vm/drop_caches #æˆ–è€… sysctl -w vm.drop_caches=3 ä¸Šé¢ä¸‰ç§æ–¹å¼éƒ½æ˜¯ä¸´æ—¶é‡Šæ”¾ç¼“å­˜çš„æ–¹æ³•ï¼Œæƒ³è¦æ°¸ä¹…é‡Šæ”¾ç¼“å­˜ï¼Œéœ€è¦åœ¨/etc/sysctl.confæ–‡ä»¶ä¸­é…ç½®ï¼š vm.drop_caches=1/2/3,ç„¶åsysctl -pç”Ÿæ•ˆå³å¯ æ¸©é¦¨æç¤ºï¼š ä¸Šé¢æ“ä½œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆä¼¤å®³ï¼Œåªä¼šæœ‰åŠ©äºé‡Šæ”¾ä¸ç”¨çš„å†…å­˜ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:4:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"æŸ¥çœ‹åƒµå°¸è¿›ç¨‹å¹¶killæ‰ æŸ¥çœ‹ ps -ef | grep defunct kill kill -9 çˆ¶è¿›ç¨‹å· åœ¨linuxç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€ï¼Œå®ƒä»¬éšæ—¶å¯èƒ½å¤„äºä»¥ä¸ŠçŠ¶æ€ä¸­çš„ä¸€ç§ï¼š D = ä¸å¯ä¸­æ–­çš„ä¼‘çœ  I = ç©ºé—² R = è¿è¡Œä¸­ S = ä¼‘çœ  T = è¢«è°ƒåº¦ä¿¡å·ç»ˆæ­¢ t = è¢«è°ƒè¯•å™¨ç»ˆæ­¢ Z = åƒµå°¸çŠ¶æ€ æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤ç»ˆç«¯ä¸­é€šè¿‡topå‘½ä»¤æ¥æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹å’Œå®ƒçš„å½“å‰çŠ¶æ€ã€‚ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:4:1","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„çš„ç‰©ç†å†…å­˜å¤§å°æŒ‡ä»¤ cat /proc/`ps -ef|grep grafana|grep -v grep|awk '{print $2}'`/status |grep VmRSS æŒ‡ä»¤åˆ†è§£ # é€šè¿‡å…³é”®è¯xxxç¡®è®¤è¿›ç¨‹idï¼Œè¿›ç¨‹å…³é”®è¯å¦‚grafana $ ps -ef|grep grafana|grep -v grep|awk '{print $2}' 118581 # é€šè¿‡è¿›ç¨‹æ ‡è¯†æŸ¥çœ‹æœåŠ¡å™¨ç‰©ç†å†…å­˜å ç”¨ $ cat /proc/118581/status |grep VmRSS VmRSS: 100788 kB # åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹èµ„æºå ç”¨ top -p 118581 ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:5:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["linux"],"content":"æŸ¥çœ‹TCPè¿æ¥æ•° netstat -n | awk '/^tcp/ {++state[$NF]} END {for(key in state) print key,\"\\t\",state[key]}' æ€»ç»“ Linux æœåŠ¡å™¨æ€§èƒ½èµ„æºæ’æŸ¥æ€è·¯ åœ¨æ’æŸ¥ Linux æœåŠ¡å™¨æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ€è·¯è¿›è¡Œæ“ä½œï¼š 1.ç›‘æµ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼š ä½¿ç”¨å‘½ä»¤ top æˆ– htop å®æ—¶ç›‘è§† CPUã€å†…å­˜å’Œäº¤æ¢ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ df æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ free æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ iostat æŸ¥çœ‹ç£ç›˜IOä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ sar æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“çš„èµ„æºåˆ©ç”¨ç‡ã€‚ 2.æ£€æŸ¥è¿›ç¨‹å’ŒæœåŠ¡ï¼š ä½¿ç”¨å‘½ä»¤ ps æˆ– top æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å’Œå®ƒä»¬çš„èµ„æºå ç”¨æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ systemctl status æ£€æŸ¥æœåŠ¡çš„çŠ¶æ€ã€‚ 3.å®šä½é«˜è´Ÿè½½è¿›ç¨‹ï¼š ä½¿ç”¨å‘½ä»¤ top æˆ– htop æŸ¥çœ‹ CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ï¼Œå¹¶è§‚å¯Ÿå…¶ PID å’Œèµ„æºæ¶ˆè€—æƒ…å†µã€‚ ä½¿ç”¨å‘½ä»¤ pidstat ç›‘æµ‹æŒ‡å®š PID çš„è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚ 4.åˆ†ææ—¥å¿—ä¿¡æ¯ï¼š æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚ /var/log/messagesï¼‰ä»¥äº†è§£ç³»ç»Ÿè¿è¡ŒæœŸé—´å‘ç”Ÿçš„é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µã€‚ æŸ¥çœ‹åº”ç”¨ç¨‹åºæ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯ä¸æ€§èƒ½ç›¸å…³çš„æ—¥å¿—ï¼Œä»¥å¯»æ‰¾å¯èƒ½çš„ç“¶é¢ˆæˆ–é”™è¯¯ã€‚ 5.æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œæµé‡ï¼š ä½¿ç”¨å‘½ä»¤ netstat æˆ– ss æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚ ä½¿ç”¨å‘½ä»¤ iftop æˆ– nethogs å®æ—¶ç›‘æµ‹ç½‘ç»œæµé‡å’Œä½¿ç”¨æƒ…å†µã€‚ 6.è¿›è¡Œæ€§èƒ½è°ƒä¼˜ï¼š è°ƒæ•´ç³»ç»Ÿå†…æ ¸å‚æ•°ï¼Œå¦‚æ–‡ä»¶å¥æŸ„æ•°ã€å†…å­˜åˆ†é…ç­‰ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ ä¼˜åŒ–å…³é”®åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œå¦‚æ•°æ®åº“ã€Web æœåŠ¡å™¨ç­‰ã€‚ 7.ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·ï¼š ä½¿ç”¨å·¥å…·å¦‚ perfã€straceã€tcpdump ç­‰è¿›è¡Œæ›´æ·±å…¥çš„æ€§èƒ½åˆ†æå’Œæ•…éšœæ’æŸ¥ã€‚ è¿™äº›æ­¥éª¤å¯ä»¥å¸®åŠ©ä½ å®šä½æœåŠ¡å™¨çš„æ€§èƒ½é—®é¢˜ï¼Œå¹¶æ‰¾å‡ºæ½œåœ¨çš„ç“¶é¢ˆæˆ–å¼‚å¸¸ã€‚æ ¹æ®å…·ä½“çš„é—®é¢˜ï¼Œä½ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ·±å…¥ç ”ç©¶å’Œåˆ†æï¼Œä»¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚åŒæ—¶ï¼ŒåŠæ—¶å¤‡ä»½æ•°æ®æ˜¯å¿…è¦çš„ï¼Œä»¥å…åœ¨è°ƒä¼˜è¿‡ç¨‹ä¸­å‘ç”Ÿæ•°æ®ä¸¢å¤±æˆ–å…¶ä»–æ„å¤–ã€‚ ","date":"2022-06-29","objectID":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/:6:0","tags":["linux"],"title":"Linux ç³»ç»Ÿæ€§èƒ½é—®é¢˜å®šä½","uri":"/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/"},{"categories":["prometheus"],"content":"ç›‘æ§ç­–ç•¥ ç›®æ ‡ æœåŠ¡å‘ç°æ¨¡å¼ ç›‘æ§æ–¹æ³• æ•°æ®æº ä»é›†ç¾¤å„èŠ‚ç‚¹kubeletç»„ä»¶ä¸­è·å–èŠ‚ç‚¹kubeletçš„åŸºæœ¬è¿è¡ŒçŠ¶æ€çš„ç›‘æ§æŒ‡æ ‡ node ç™½ç›’ç›‘æ§ kubelet ä»é›†ç¾¤å„èŠ‚ç‚¹kubeletå†…ç½®çš„cAdvisorä¸­è·å–ï¼ŒèŠ‚ç‚¹ä¸­è¿è¡Œçš„å®¹å™¨çš„ç›‘æ§æŒ‡æ ‡ node ç™½ç›’ç›‘æ§ kubelet ä»éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹çš„Node Exporterä¸­é‡‡é›†ä¸»æœºèµ„æºç›¸å…³çš„è¿è¡Œèµ„æº node ç™½ç›’ç›‘æ§ node exporter å¯¹äºå†…ç½®äº†Promthuesæ”¯æŒçš„åº”ç”¨ï¼Œéœ€è¦ä»Podå®ä¾‹ä¸­é‡‡é›†å…¶è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ pod ç™½ç›’ç›‘æ§ custom pod è·å–API Serverç»„ä»¶çš„è®¿é—®åœ°å€ï¼Œå¹¶ä»ä¸­è·å–Kubernetesé›†ç¾¤ç›¸å…³çš„è¿è¡Œç›‘æ§æŒ‡æ ‡ endpoints ç™½ç›’ç›‘æ§ api server è·å–é›†ç¾¤ä¸­Serviceçš„è®¿é—®åœ°å€ï¼Œå¹¶é€šè¿‡Blackbox Exporterè·å–ç½‘ç»œæ¢æµ‹æŒ‡æ ‡ service é»‘ç›’ç›‘æ§ blackbox exporter è·å–é›†ç¾¤ä¸­Ingressçš„è®¿é—®ä¿¡æ¯ï¼Œå¹¶é€šè¿‡Blackbox Exporterè·å–ç½‘ç»œæ¢æµ‹æŒ‡æ ‡ ingress é»‘ç›’ç›‘æ§ blackbox exporter ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:1:0","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"k8s æ’ä»¶é‡‡é›†æŒ‡æ ‡è¯´æ˜ åŒ…å«å¤œèºæŒ‡æ ‡åšæ¨ªå‘å¯¹æ¯”å‚è€ƒ ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:0","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"Cadvisor æŒ‡æ ‡è¯´æ˜ cpu æŒ‡æ ‡ æŒ‡æ ‡å å«ä¹‰ prometheus metricsæˆ–è®¡ç®—æ–¹å¼ è¯´æ˜ cpu.util å®¹å™¨cpuä½¿ç”¨å å…¶ç”³è¯·çš„ç™¾åˆ†æ¯” sum (rate (container_cpu_usage_seconds_total[1m])) by( container) /( sum (container_spec_cpu_quota) by(container) /100000) * 100 0-100çš„èŒƒå›´ cpu.idle å®¹å™¨cpuç©ºé—²å å…¶ç”³è¯·çš„ç™¾åˆ†æ¯” 100 - cpu.util 0-100çš„èŒƒå›´ cpu.user å®¹å™¨cpuç”¨æˆ·æ€ä½¿ç”¨å å…¶ç”³è¯·çš„ç™¾åˆ†æ¯” sum (rate (container_cpu_user_seconds_total[1m])) by( container) /( sum (container_spec_cpu_quota) by(container) /100000) * 100 0-100çš„èŒƒå›´ cpu.sys å®¹å™¨cpuå†…æ ¸æ€ä½¿ç”¨å å…¶ç”³è¯·çš„ç™¾åˆ†æ¯” sum (rate (container_cpu_sys_seconds_total[1m])) by( container) /( sum (container_spec_cpu_quota) by(container) /100000) * 100 0-100çš„èŒƒå›´ cpu.cores.occupy å®¹å™¨cpuä½¿ç”¨å ç”¨æœºå™¨å‡ ä¸ªæ ¸ rate(container_cpu_usage_seconds_total[1m]) 0åˆ°æœºå™¨æ ¸æ•°ä¸Šé™,ç»“æœä¸º1å°±æ˜¯å ç”¨1ä¸ªæ ¸ cpu.spec.quota å®¹å™¨çš„CPUé…é¢ container_spec_cpu_quota ä¸ºå®¹å™¨æŒ‡å®šçš„CPUä¸ªæ•°*100000 cpu.throttled.util å®¹å™¨CPUæ‰§è¡Œå‘¨æœŸå—åˆ°é™åˆ¶çš„ç™¾åˆ†æ¯” æœªå½•å…¥ 0-100çš„èŒƒå›´ cpu.periods å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­åº¦è¿‡çš„cpuå‘¨æœŸæ€»æ•° counterå‹æ— éœ€è®¡ç®— ä½¿ç”¨rate/increase æŸ¥çœ‹ cpu.throttled.periods å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­åº¦è¿‡çš„å—é™çš„cpuå‘¨æœŸæ€»æ•° counterå‹æ— éœ€è®¡ç®— ä½¿ç”¨rate/increase æŸ¥çœ‹ cpu.throttled.time å®¹å™¨è¢«èŠ‚æµçš„æ€»æ—¶é—´ ) counterå‹æ— éœ€è®¡ç®— å•ä½(çº³ç§’ mem æŒ‡æ ‡ å¤œèºæŒ‡æ ‡å å«ä¹‰ prometheus metricsæˆ–è®¡ç®—æ–¹å¼ è¯´æ˜ mem.bytes.total å®¹å™¨çš„å†…å­˜é™åˆ¶ æ— éœ€è®¡ç®— å•ä½byte å¯¹åº”pod yamlä¸­resources.limits.memory mem.bytes.used å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬æ‰€æœ‰å†…å­˜ï¼Œæ— è®ºä½•æ—¶è®¿é—® container_memory_rss + container_memory_cache + kernel memory å•ä½byte mem.bytes.used.percent å®¹å™¨å†…å­˜ä½¿ç”¨ç‡ container_memory_usage_bytes/container_spec_memory_limit_bytes *100 èŒƒå›´0-100 mem.bytes.workingset å®¹å™¨çœŸå®ä½¿ç”¨çš„å†…å­˜é‡ï¼Œä¹Ÿæ˜¯limité™åˆ¶æ—¶çš„ oom åˆ¤æ–­ä¾æ® container_memory_max_usage_bytes \u003e container_memory_usage_bytes \u003e= container_memory_working_set_bytes \u003e container_memory_rss å•ä½byte mem.bytes.workingset.percent å®¹å™¨çœŸå®ä½¿ç”¨çš„å†…å­˜é‡ç™¾åˆ†æ¯” container_memory_working_set_bytes/container_spec_memory_limit_bytes *100 èŒƒå›´0-100 mem.bytes.cached å®¹å™¨cacheå†…å­˜é‡ container_memory_cache å•ä½byte mem.bytes.rss å®¹å™¨rsså†…å­˜é‡ container_memory_rss å•ä½byte mem.bytes.swap å®¹å™¨cacheå†…å­˜é‡ container_memory_swap å•ä½byte filesystem \u0026\u0026 disk.io æŒ‡æ ‡ å¤œèºæŒ‡æ ‡å å«ä¹‰ prometheus metricsæˆ–è®¡ç®—æ–¹å¼ è¯´æ˜ disk.bytes.total å®¹å™¨å¯ä»¥ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ€»é‡ container_fs_limit_bytes (å•ä½ï¼šå­—èŠ‚) disk.bytes.used å®¹å™¨å·²ç»ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ€»é‡ container_fs_usage_bytes (å•ä½ï¼šå­—èŠ‚) disk.bytes.used.percent å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ç™¾åˆ†æ¯” container_fs_usage_bytes/container_fs_limit_bytes *100 èŒƒå›´0-100 disk.io.read.bytes å®¹å™¨io.read qps rate(container_fs_reads_bytes_total)[1m] (å•ä½ï¼šbps) disk.io.write.bytes å®¹å™¨io.write qps rate(container_fs_write_bytes_total)[1m] (å•ä½ï¼šbps) network æŒ‡æ ‡ å¤œèºæŒ‡æ ‡å å«ä¹‰ prometheus metricsæˆ–è®¡ç®—æ–¹å¼ è¯´æ˜ net.in.bytes å®¹å™¨ç½‘ç»œæ¥æ”¶æ•°æ®æ€»æ•° rate(container_network_receive_bytes_total)[1m] (å•ä½ï¼šbytes/s) net.out.bytes å®¹å™¨ç½‘ç»œç§¯ä¼ è¾“æ•°æ®æ€»æ•°ï¼‰ rate(container_network_transmit_bytes_total)[1m] (å•ä½ï¼šbytes/s) net.in.pps å®¹å™¨ç½‘ç»œæ¥æ”¶æ•°æ®åŒ…pps rate(container_network_receive_packets_total)[1m] (å•ä½ï¼šp/s) net.out.pps å®¹å™¨ç½‘ç»œå‘é€æ•°æ®åŒ…pps rate(container_network_transmit_packets_total)[1m] (å•ä½ï¼šp/s) net.in.errs å®¹å™¨ç½‘ç»œæ¥æ”¶æ•°æ®é”™è¯¯æ•° rate(container_network_receive_errors_total)[1m] (å•ä½ï¼šbytes/s) net.out.errs å®¹å™¨ç½‘ç»œå‘é€æ•°æ®é”™è¯¯æ•° rate(container_network_transmit_errors_total)[1m] (å•ä½ï¼šbytes/s) net.in.dropped å®¹å™¨ç½‘ç»œæ¥æ”¶æ•°æ®åŒ…drop pps rate(container_network_receive_packets_dropped_total)[1m] (å•ä½ï¼šp/s) net.out.dropped å®¹å™¨ç½‘ç»œå‘é€æ•°æ®åŒ…drop pps rate(container_network_transmit_packets_dropped_total)[1m] (å•ä½ï¼šp/s) container_network_{tcp,udp}_usage_total é»˜è®¤ä¸é‡‡é›†æ˜¯å› ä¸º â€“disable_metrics=tcp, udp ,å› ä¸ºå¼€å¯cpuå‹åŠ›å¤§ system æŒ‡æ ‡ å¤œèºæŒ‡æ ‡å å«ä¹‰ prometheus metricsæˆ–è®¡ç®—æ–¹å¼ è¯´æ˜ sys.ps.process.count å®¹å™¨ä¸­runningè¿›ç¨‹ä¸ªæ•° container_processes (å•ä½ï¼šä¸ª) sys.ps.thread.count å®¹å™¨ä¸­è¿›ç¨‹runningçº¿ç¨‹ä¸ªæ•° container_threads (å•ä½ï¼šä¸ª) sys.fd.count.used å®¹å™¨ä¸­æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•° container_file_descriptors (å•ä½ï¼šä¸ª) sys.fd.soft.ulimits å®¹å™¨ä¸­root process Soft ulimit container_ulimits_soft (å•ä½ï¼šä¸ª) sys.socket.count.used å®¹å™¨ä¸­æ‰“å¼€å¥—æ¥å­—ä¸ªæ•° container_sockets (å•ä½ï¼šä¸ª) sys.task.state å®¹å™¨ä¸­task çŠ¶æ€åˆ†å¸ƒ container_tasks_state (å•ä½ï¼šä¸ª) ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:1","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"kube-apiserver metrics æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å ç±»å‹ å«ä¹‰ è¯´æ˜ apiserver_request_total counter å¯¹APIServerä¸åŒè¯·æ±‚çš„è®¡æ•°ã€‚ apiserver_request_duration_seconds_sum gauge ç»Ÿè®¡APIServerå®¢æˆ·ç«¯å¯¹APIServerçš„è®¿é—®æ—¶å»¶ã€‚å¯¹APIServerä¸åŒè¯·æ±‚çš„æ—¶å»¶åˆ†å¸ƒã€‚ apiserver_request_duration_seconds_count gauge è¯·æ±‚å»¶è¿Ÿè®°å½•æ•° è®¡ç®—å¹³å‡å»¶è¿Ÿ:apiserver_request_duration_seconds_sum/apiserver_request_duration_seconds_count apiserver_admission_controller_admission_duration_seconds_bucket Gauge å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controllerï¼‰çš„å¤„ç†å»¶æ—¶ã€‚æ ‡ç­¾åŒ…æ‹¬å‡†å…¥æ§åˆ¶å™¨åå­—ã€æ“ä½œï¼ˆCREATEã€UPDATEã€CONNECTç­‰ï¼‰ã€APIèµ„æºã€æ“ä½œç±»å‹ï¼ˆvalidateæˆ–admitï¼‰å’Œè¯·æ±‚æ˜¯å¦è¢«æ‹’ç»ï¼ˆtrueæˆ–falseï¼‰ã€‚ apiserver_admission_webhook_admission_duration_seconds_bucket Gauge å‡†å…¥Webhookï¼ˆAdmission Webhookï¼‰çš„å¤„ç†å»¶æ—¶ã€‚æ ‡ç­¾åŒ…æ‹¬å‡†å…¥æ§åˆ¶å™¨åå­—ã€æ“ä½œï¼ˆCREATEã€UPDATEã€CONNECTç­‰ï¼‰ã€APIèµ„æºã€æ“ä½œç±»å‹ï¼ˆvalidateæˆ–admitï¼‰å’Œè¯·æ±‚æ˜¯å¦è¢«æ‹’ç»ï¼ˆtrueæˆ–falseï¼‰ã€‚ apiserver_admission_webhook_admission_duration_seconds_count Counter å‡†å…¥Webhookï¼ˆAdmission Webhookï¼‰çš„å¤„ç†è¯·æ±‚ç»Ÿè®¡ã€‚æ ‡ç­¾åŒ…æ‹¬å‡†å…¥æ§åˆ¶å™¨åå­—ã€æ“ä½œï¼ˆCREATEã€UPDATEã€CONNECTç­‰ï¼‰ã€APIèµ„æºã€æ“ä½œç±»å‹ï¼ˆvalidateæˆ–admitï¼‰å’Œè¯·æ±‚æ˜¯å¦è¢«æ‹’ç»ï¼ˆtrueæˆ–falseï¼‰ã€‚ apiserver_response_sizes_sum counter è¯·æ±‚å“åº”å¤§å°è®°å½•å’Œ apiserver_response_sizes_count counter è¯·æ±‚å“åº”å¤§å°è®°å½•æ•° authentication_attempts counter è®¤è¯å°è¯•æ•° authentication_duration_seconds_sum counter è®¤è¯è€—æ—¶è®°å½•å’Œ authentication_duration_seconds_count counter è®¤è¯è€—æ—¶è®°å½•æ•° apiserver_tls_handshake_errors_total counter tlsæ¡æ‰‹å¤±è´¥è®¡æ•° apiserver_client_certificate_expiration_seconds_sum gauge è¯ä¹¦è¿‡æœŸæ—¶é—´æ€»æ•° apiserver_client_certificate_expiration_seconds_count gauge è¯ä¹¦è¿‡æœŸæ—¶é—´è®°å½•ä¸ªæ•° apiserver_client_certificate_expiration_seconds_bucket gauge è¯ä¹¦è¿‡æœŸæ—¶é—´åˆ†å¸ƒ apiserver_current_inflight_requests gauge APIServerå½“å‰å¤„ç†çš„è¯·æ±‚æ•°ã€‚åŒ…æ‹¬ReadOnlyå’ŒMutatingä¸¤ç§ apiserver_current_inqueue_requests gauge æ˜¯ä¸€ä¸ªè¡¨å‘é‡ï¼Œ è®°å½•æœ€è¿‘æ’é˜Ÿè¯·æ±‚æ•°é‡çš„é«˜æ°´ä½çº¿ apiserverè¯·æ±‚é™æµ apiserver_flowcontrol_current_executing_requests gauge è®°å½•åŒ…å«æ‰§è¡Œä¸­ï¼ˆä¸åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼‰è¯·æ±‚çš„ç¬æ—¶æ•°é‡ APF apiçš„QOS APIPriorityAndFairness apiserver_flowcontrol_current_inqueue_requests gauge è®°å½•åŒ…å«æ’é˜Ÿä¸­çš„ï¼ˆæœªæ‰§è¡Œï¼‰è¯·æ±‚çš„ç¬æ—¶æ•°é‡ workqueue_adds_total counter wq å…¥é˜Ÿæ•° workqueue_retries_total counter wq retryæ•° workqueue_longest_running_processor_seconds gauge wqä¸­æœ€é•¿è¿è¡Œæ—¶é—´ workqueue_queue_duration_seconds_sum gauge wqä¸­ç­‰å¾…å»¶è¿Ÿè®°å½•å’Œ workqueue_queue_duration_seconds_count gauge wqä¸­ç­‰å¾…å»¶è¿Ÿè®°å½•æ•° workqueue_work_duration_seconds_sum gauge wqä¸­å¤„ç†å»¶è¿Ÿè®°å½•å’Œ workqueue_work_duration_seconds_count gauge wqä¸­å¤„ç†å»¶è¿Ÿè®°å½•æ•° up Gauge æœåŠ¡å¯ç”¨æ€§ï¼Œ1 è¡¨ç¤ºæœåŠ¡å¯ç”¨ï¼Œ0 è¡¨ç¤ºæœåŠ¡ä¸å¯ç”¨ å…³é”®æŒ‡æ ‡ï¼š $interval è¡¨ç¤ºé—´éš”æ—¶é—´ï¼Œä¾‹å¦‚ 5m $quantile 0 â‰¤ å€¼ â‰¤ 1ï¼Œç”¨äºè®¡ç®—å½“å‰æ ·æœ¬æ•°æ®å€¼çš„åˆ†å¸ƒæƒ…å†µï¼Œå½“å€¼ä¸º 0.5 æ—¶ï¼Œå³è¡¨ç¤ºæ‰¾åˆ°å½“å‰æ ·æœ¬æ•°æ®ä¸­çš„ä¸­ä½æ•° åç§° PromQL è¯´æ˜ API QPS sum (irate(apiserver_request_total[$interval])) APIServeræ€»QPS è¯»è¯·æ±‚æˆåŠŸç‡ sum(irate(apiserver_request_total{code=~â€œ20.*\",verb=~â€œGET|LISTâ€}[$interval]))/sum(irate(apiserver_request_total{verb=~â€œGET|LISTâ€}[$interval])) APIServerè¯»è¯·æ±‚æˆåŠŸç‡ã€‚ å†™è¯·æ±‚æˆåŠŸç‡ sum(irate(apiserver_request_total{code=~â€œ20.*\",verb!~â€œGET|LIST|WATCH|CONNECTâ€}[$interval]))/sum(irate(apiserver_request_total{verb!~â€œGET|LIST|WATCH|CONNECTâ€}[$interval])) APIServerå†™è¯·æ±‚æˆåŠŸç‡ã€‚ åœ¨å¤„ç†è¯»è¯·æ±‚æ•°é‡ sum(apiserver_current_inflight_requests{request_kind=â€œreadOnlyâ€}) æ‰€æœ‰ APIServer å½“å‰åœ¨å¤„ç†è¯»è¯·æ±‚æ•°é‡; ä¸åŠ  sum() æ˜¾ç¤ºæ¯ä¸ª apiserver åœ¨å¤„ç†çš„è¯»è¯·æ±‚æ•°é‡ åœ¨å¤„ç†å†™è¯·æ±‚æ•°é‡ sum(apiserver_current_inflight_requests{request_kind=â€œmutatingâ€}) APIServerå½“å‰åœ¨å¤„ç†å†™è¯·æ±‚æ•°é‡ï¼ˆè€ç‰ˆæœ¬ k8s requestKindï¼‰ GETè¯»è¯·æ±‚æ—¶å»¶ histogram_quantile($quantile, sum(irate(apiserver_request_duration_seconds_bucket{verb=â€œGETâ€,resource!=â€\",subresource!~â€œlog|proxyâ€}[$interval])) by (pod, verb, resource, subresource, scope, le)) å±•ç¤ºGETè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œç»´åº¦åŒ…æ‹¬APIServer Podã€Verb(GET)ã€Resourcesï¼ˆä¾‹å¦‚Configmapsã€Podsã€Leasesç­‰ï¼‰ã€Scopeï¼ˆèŒƒå›´ä¾‹å¦‚Namespaceçº§åˆ«ã€Clusterçº§åˆ«ï¼‰ã€‚ LISTè¯»è¯·æ±‚æ—¶å»¶ histogram_quantile($quantile, sum(irate(apiserver_request_duration_seconds_bucket{verb=â€œLISTâ€}[$interval])) by (pod_name, verb, resource, scope, le)) å±•ç¤ºLISTè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œç»´åº¦åŒ…æ‹¬APIServer Podã€Verb(GET)ã€Resourcesï¼ˆä¾‹å¦‚Configmapsã€Podsã€Leasesç­‰ï¼‰ã€Scopeï¼ˆèŒƒå›´ä¾‹å¦‚Namespaceçº§åˆ«ã€Clusterçº§åˆ«ï¼‰ã€‚ å†™è¯·æ±‚æ—¶å»¶ histogram_quantile($quantile, sum(irate(apiserver_request_duration_seconds_bucket{verb!~â€œGET|WATCH|LIST|CONNECTâ€}[$interval])) by (cluster, pod_name, verb, resource, scope, le)) å±•ç¤ºMutatingè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œç»´åº¦åŒ…æ‹¬APIServer Podã€Verb(GET)ã€Resourcesï¼ˆä¾‹å¦‚Configmapsã€Podsã€Leasesç­‰ï¼‰ã€Scopeï¼ˆèŒƒå›´ä¾‹å¦‚Namespaceçº§åˆ«ã€Clusterçº§åˆ«ï¼‰ã€‚ ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:2","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"etcd metrics æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å ç±»å‹ å«ä¹‰ è¯´æ˜ etcd_db_total_size_in_bytes gauge dbç‰©ç†æ–‡ä»¶å¤§å° etcd_object_counts gauge etcdå¯¹è±¡æŒ‰ç§ç±»è®¡æ•° etcd_request_duration_seconds_sum gauge etcdè¯·æ±‚å»¶è¿Ÿè®°å½•å’Œ etcd_request_duration_seconds_count gauge etcdè¯·æ±‚å»¶è¿Ÿè®°å½•æ•° ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:3","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"kube-scheduler æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å ç±»å‹ å«ä¹‰ è¯´æ˜ scheduler_e2e_scheduling_duration_seconds_sum gauge ç«¯åˆ°ç«¯è°ƒåº¦å»¶è¿Ÿè®°å½•å’Œ scheduler_e2e_scheduling_duration_seconds_count gauge ç«¯åˆ°ç«¯è°ƒåº¦å»¶è¿Ÿè®°å½•æ•° scheduler_pod_scheduling_duration_seconds_sum gauge è°ƒåº¦å»¶è¿Ÿè®°å½•å’Œ åˆ†ææ¬¡æ•° scheduler_pod_scheduling_duration_seconds_count gauge è°ƒåº¦å»¶è¿Ÿè®°å½•æ•° scheduler_pending_pods gauge è°ƒåº¦é˜Ÿåˆ—pending podæ•° scheduler_queue_incoming_pods_total counter è¿›å…¥è°ƒåº¦é˜Ÿåˆ—podæ•° scheduler_scheduling_algorithm_duration_seconds_sum gauge è°ƒåº¦ç®—æ³•å»¶è¿Ÿè®°å½•å’Œ scheduler_scheduling_algorithm_duration_seconds_count gauge è°ƒåº¦ç®—æ³•å»¶è¿Ÿè®°å½•æ•° scheduler_pod_scheduling_attempts_sum gauge æˆåŠŸè°ƒåº¦ä¸€ä¸ªpod çš„å°è¯•æ¬¡æ•°è®°å½•å’Œ scheduler_pod_scheduling_attempts_count gauge æˆåŠŸè°ƒåº¦ä¸€ä¸ªpod çš„å°è¯•æ¬¡æ•°è®°å½•æ•° ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:4","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"coredns æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å ç±»å‹ å«ä¹‰ è¯´æ˜ coredns_dns_requests_total counter è§£æè¯·æ±‚æ•° Aè®°å½•ï¼ŒAAAAè®°å½•ï¼Œotherè®°å½• coredns_dns_responses_total counter è§£æå“åº”æ•° NOERRORï¼ŒNXDOMAINï¼ŒREFUSED coredns_cache_entries gauge ç¼“å­˜è®°å½•æ•° æˆåŠŸæˆ–å¤±è´¥ coredns_cache_hits_total counter ç¼“å­˜å‘½ä¸­æ•° æˆåŠŸæˆ–å¤±è´¥ coredns_cache_misses_total counter ç¼“å­˜æœªå‘½ä¸­æ•° æˆåŠŸæˆ–å¤±è´¥ coredns_dns_request_duration_seconds_sum gauge è§£æå»¶è¿Ÿè®°å½•å’Œ coredns_dns_request_duration_seconds_count gauge è§£æå»¶è¿Ÿè®°å½•æ•° coredns_dns_response_size_bytes_sum gauge è§£æå“åº”å¤§å°è®°å½•å’Œ coredns_dns_response_size_bytes_count gauge è§£æå“åº”å¤§å°è®°å½•æ•° ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:5","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"kube-stats-metrics æŒ‡æ ‡è¯´æ˜ pod metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_pod_status_phase gauge podçŠ¶æ€ç»Ÿè®¡:Pendingï¼ŒSucceededï¼ŒFailedï¼ŒRunningï¼ŒUnknown kube_pod_container_status_waiting counter podå¤„äºwaitingçŠ¶æ€ï¼Œå€¼ä¸º1ä»£è¡¨waiting kube_pod_container_status_waiting_reason gauge podå¤„äºwaitingçŠ¶æ€åŸå› ï¼šContainerCreatingï¼ŒCrashLoopBackOff podå¯åŠ¨å´©æºƒ,å†æ¬¡å¯åŠ¨ç„¶åå†æ¬¡å´©æºƒï¼ŒCreateContainerConfigErrorï¼ŒErrImagePullï¼ŒImagePullBackOffï¼ŒCreateContainerErrorï¼ŒInvalidImageName kube_pod_container_status_terminated gauge podå¤„äºterminatedçŠ¶æ€ï¼Œå€¼ä¸º1ä»£è¡¨terminated kube_pod_container_status_terminated_reason gauge podå¤„äºterminatedçŠ¶æ€åŸå› ï¼šOOMKilledï¼ŒCompletedï¼ŒErrorï¼ŒContainerCannotRunï¼ŒDeadlineExceededï¼ŒEvicted kube_pod_container_status_restarts_total counter podä¸­çš„å®¹å™¨é‡å¯æ¬¡æ•° kube_pod_container_resource_requests_cpu_cores gauge podå®¹å™¨cpu limit kube_pod_container_resource_requests_memory_bytes gauge podå®¹å™¨mem limit(å•ä½:å­—èŠ‚) deployment metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_deployment_status_replicas gauge depä¸­çš„pod num kube_deployment_status_replicas_available gauge depä¸­çš„ å¯ç”¨pod num kube_deployment_status_replicas_unavailable gauge depä¸­çš„ ä¸å¯ç”¨pod num daemonSet metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_daemonset_status_number_available gauge ds å¯ç”¨æ•° kube_daemonset_status_number_unavailable gauge ds ä¸å¯ç”¨æ•° kube_daemonset_status_number_ready gauge ds readyæ•° kube_daemonset_status_number_misscheduled gauge æœªç»è¿‡è°ƒåº¦è¿è¡Œdsçš„èŠ‚ç‚¹æ•° kube_daemonset_status_current_number_scheduled gauge dsç›®å‰è¿è¡ŒèŠ‚ç‚¹æ•° kube_daemonset_status_desired_number_scheduled gauge åº”è¯¥è¿è¡Œdsçš„èŠ‚ç‚¹æ•° daemonSet metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_statefulset_status_replicas gauge sså‰¯æœ¬æ€»æ•° kube_statefulset_status_replicas_current gauge sså½“å‰å‰¯æœ¬æ•° kube_statefulset_status_replicas_updated gauge sså·²æ›´æ–°å‰¯æœ¬æ•° kube_statefulset_replicas gauge ssç›®æ ‡å‰¯æœ¬æ•° Job metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_job_status_active gauge job running podæ•° kube_job_status_succeeded gauge job æˆåŠŸ podæ•° kube_job_status_failed gauge job å¤±è´¥ podæ•° kube_job_complete gauge job æ˜¯å¦å®Œæˆ kube_job_failed gauge job æ˜¯å¦å¤±è´¥ CronJob metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_cronjob_status_active gauge job running podæ•° kube_cronjob_spec_suspend gauge =1ä»£è¡¨ job è¢«æŒ‚èµ· kube_cronjob_next_schedule_time gauge job ä¸‹æ¬¡è°ƒåº¦æ—¶é—´ kube_cronjob_status_last_schedule_time gauge job ä¸‹æ¬¡è°ƒåº¦æ—¶é—´ PersistentVolume metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_persistentvolume_capacity_bytes gauge pvç”³è¯·å¤§å° kube_persistentvolume_status_phase gauge pvçŠ¶æ€:Pendingï¼ŒAvailableï¼ŒBoundï¼ŒReleasedï¼ŒFailed PersistentVolumeClaim metrics æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_persistentvolumeclaim_resource_requests_storage_bytes gauge pvc requestå¤§å° kube_persistentvolumeclaim_status_phase gauge pvcçŠ¶æ€:Lostï¼ŒBoundï¼ŒPending ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:6","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["prometheus"],"content":"node metrics æŒ‡æ ‡è¯´æ˜ æŒ‡æ ‡å ç±»å‹ å«ä¹‰ kube_node_status_condition gauge condition:NetworkUnavailableï¼ŒMemoryPressureï¼ŒDiskPressureï¼ŒPIDPressureï¼ŒReady kube_node_status_allocatable_cpu_cores gauge èŠ‚ç‚¹å¯ä»¥åˆ†é…cpuæ ¸æ•° kube_node_status_allocatable_memory_bytes gauge èŠ‚ç‚¹å¯ä»¥åˆ†é…å†…å­˜æ€»é‡(å•ä½ï¼šå­—èŠ‚) kube_node_spec_taint gauge èŠ‚ç‚¹æ±¡ç‚¹æƒ…å†µ kube_node_status_capacity_memory_bytes gauge èŠ‚ç‚¹å†…å­˜æ€»é‡(å•ä½ï¼šå­—èŠ‚) kube_node_status_capacity_cpu_cores gauge èŠ‚ç‚¹cpuæ ¸æ•° kube_node_status_capacity_pods gauge èŠ‚ç‚¹å¯è¿è¡Œçš„podæ€»æ•° ","date":"2022-06-29","objectID":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/:2:7","tags":["prometheus"],"title":"Prometheus ç›‘æ§k8s ç»„ä»¶æŒ‡æ ‡æ¢³ç†","uri":"/prometheus%E7%9B%91%E6%8E%A7k8s%E6%8C%87%E6%A0%87%E5%92%8C%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%AD%96%E7%95%A5/"},{"categories":["Kubernetes"],"content":"ç†è§£ConfigMap ä¸ºäº†èƒ½å¤Ÿå‡†ç¡®å’Œæ·±åˆ»ç†è§£Kubernetes ConfigMapçš„åŠŸèƒ½å’Œä»·å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä»Dockerè¯´èµ·ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒDockeré€šè¿‡å°†ç¨‹åºã€ä¾èµ–åº“ã€æ•°æ®åŠé…ç½®æ–‡ä»¶â€œæ‰“åŒ…å›ºåŒ–â€åˆ°ä¸€ä¸ªä¸å˜çš„é•œåƒæ–‡ä»¶ä¸­çš„åšæ³•ï¼Œè§£å†³äº†åº”ç”¨çš„éƒ¨ç½²çš„éš¾é¢˜ï¼Œä½†è¿™åŒæ—¶å¸¦æ¥äº†æ£˜æ‰‹çš„é—®é¢˜ï¼Œå³é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°åœ¨è¿è¡ŒæœŸå¦‚ä½•ä¿®æ”¹çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¯èƒ½åœ¨å¯åŠ¨Dockerå®¹å™¨åå†ä¿®æ”¹å®¹å™¨é‡Œçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åç”¨æ–°çš„é…ç½®æ–‡ä»¶é‡å¯å®¹å™¨é‡Œçš„ç”¨æˆ·ä¸»è¿›ç¨‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDockeræä¾›äº†ä¸¤ç§æ–¹å¼ï¼š åœ¨è¿è¡Œæ—¶é€šè¿‡å®¹å™¨çš„ç¯å¢ƒå˜é‡æ¥ä¼ é€’å‚æ•°ï¼› é€šè¿‡Docker Volumeå°†å®¹å™¨å¤–çš„é…ç½®æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨å†…ã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½æœ‰å…¶ä¼˜åŠ¿å’Œç¼ºç‚¹ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåä¸€ç§æ–¹å¼æ›´åˆé€‚æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œå› ä¸ºå¤§å¤šæ•°åº”ç”¨é€šå¸¸ä»ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­è¯»å–å‚æ•°ã€‚ä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰æ˜æ˜¾çš„ç¼ºé™·ï¼šæˆ‘ä»¬å¿…é¡»åœ¨ç›®æ ‡ä¸»æœºä¸Šå…ˆåˆ›å»ºå¥½å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ‰èƒ½æ˜ å°„åˆ°å®¹å™¨é‡Œã€‚ä¸Šè¿°ç¼ºé™·åœ¨åˆ†å¸ƒå¼æƒ…å†µä¸‹å˜å¾—æ›´ä¸ºä¸¥é‡ï¼Œå› ä¸ºæ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œå†™å…¥ï¼ˆä¿®æ”¹ï¼‰å¤šå°æœåŠ¡å™¨ä¸Šçš„æŸä¸ªæŒ‡å®šæ–‡ä»¶ï¼Œå¹¶ç¡®ä¿è¿™äº›æ–‡ä»¶ä¿æŒä¸€è‡´ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¾ˆéš¾å®Œæˆçš„ç›®æ ‡ã€‚æ­¤å¤–ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›èƒ½é›†ä¸­ç®¡ç†ç³»ç»Ÿçš„é…ç½®å‚æ•°ï¼Œè€Œä¸æ˜¯ç®¡ç†ä¸€å †é…ç½®æ–‡ä»¶ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼ŒKubernetesç»™å‡ºäº†ä¸€ä¸ªå¾ˆå·§å¦™çš„è®¾è®¡å®ç°ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚ é¦–å…ˆï¼ŒæŠŠæ‰€æœ‰çš„é…ç½®é¡¹éƒ½å½“ä½œkeyvalueå­—ç¬¦ä¸²ï¼Œå½“ç„¶valueå¯ä»¥æ¥è‡ªæŸä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæ¯”å¦‚é…ç½®é¡¹password=123456ã€user=rootã€host=192.168.8.4ç”¨äºè¡¨ç¤ºè¿æ¥FTPæœåŠ¡å™¨çš„é…ç½®å‚æ•°ã€‚è¿™äº›é…ç½®é¡¹å¯ä»¥ä½œä¸ºMapè¡¨ä¸­çš„ä¸€ä¸ªé¡¹ï¼Œæ•´ä¸ªMapçš„æ•°æ®å¯ä»¥è¢«æŒä¹…åŒ–å­˜å‚¨åœ¨Kubernetesçš„Etcdæ•°æ®åº“ä¸­ï¼Œç„¶åæä¾›APIä»¥æ–¹ä¾¿Kubernetesç›¸å…³ç»„ä»¶æˆ–å®¢æˆ·åº”ç”¨CRUDæ“ä½œè¿™äº›æ•°æ®ï¼Œä¸Šè¿°ä¸“é—¨ç”¨æ¥ä¿å­˜é…ç½®å‚æ•°çš„Mapå°±æ˜¯Kubernetes ConfigMapèµ„æºå¯¹è±¡ã€‚ ","date":"2022-06-13","objectID":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/:1:0","tags":["Kubernetes"],"title":"Kubernetes ConfigMapå¤šæ–‡ä»¶æŒ‚è½½è‡³åŒä¸€ä¸ªpodå†…ç›®å½•å®è·µ","uri":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"ç—›ç‚¹æ”¹è¿› æ¥ä¸‹æ¥ï¼ŒKubernetesæä¾›äº†ä¸€ç§å†…å»ºæœºåˆ¶ï¼Œå°†å­˜å‚¨åœ¨etcdä¸­çš„ConfigMapé€šè¿‡Volumeæ˜ å°„çš„æ–¹å¼å˜æˆç›®æ ‡Podå†…çš„é…ç½®æ–‡ä»¶ï¼Œä¸ç®¡ç›®æ ‡Podè¢«è°ƒåº¦åˆ°å“ªå°æœåŠ¡å™¨ä¸Šï¼Œéƒ½ä¼šå®Œæˆè‡ªåŠ¨æ˜ å°„ã€‚è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœConfigMapä¸­çš„key/valueæ•°æ®è¢«ä¿®æ”¹ï¼Œåˆ™æ˜ å°„åˆ°Podä¸­çš„â€œé…ç½®æ–‡ä»¶â€ä¹Ÿä¼šéšä¹‹è‡ªåŠ¨æ›´æ–°ã€‚äºæ˜¯ï¼ŒKubernetes ConfigMapå°±æˆäº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€ä¸ºç®€å•ï¼ˆä½¿ç”¨æ–¹æ³•ç®€å•ï¼Œä½†èƒŒåå®ç°æ¯”è¾ƒå¤æ‚ï¼‰ä¸”å¯¹åº”ç”¨æ— ä¾µå…¥çš„é…ç½®ä¸­å¿ƒã€‚ ","date":"2022-06-13","objectID":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/:2:0","tags":["Kubernetes"],"title":"Kubernetes ConfigMapå¤šæ–‡ä»¶æŒ‚è½½è‡³åŒä¸€ä¸ªpodå†…ç›®å½•å®è·µ","uri":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/"},{"categories":["Kubernetes"],"content":"å®è·µ éœ€æ±‚ å°†ä¸€ä¸ªconfigmap å†…çš„ä¸¤ä¸ªæ–‡ä»¶æŒ‚è½½åœ¨ä¸€ä¸ªpodçš„ä¸åŒç›®å½•ä¸‹ /app/conf/grafanaoracle.properties /app/start-timeshift.sh åˆ›å»ºä¸€ä¸ªconfigmap apiVersion: v1 data: grafanaoracle.properties: | name=kevin nage=19 start-timeshift.sh: | #!/bin/sh cd /app/influxdb-timeshift-proxy INFLUXDB=nms-influxdb:8086 /usr/bin/npm run start kind: ConfigMap metadata: labels: app.kubernetes.io/managed-by: Helm name: test-config åˆ›å»ºä¸€ä¸ª deploy apiVersion: apps/v1 kind: Deployment metadata: labels: zcm-app: test-configmap name: test-configmap spec: replicas: 1 selector: matchLabels: zcm-app: test-configmap template: metadata: labels: zcm-app: test-configmap spec: containers: - env: - name: CLOUD_APP_NAME value: paas_test-configmap image: nginx imagePullPolicy: IfNotPresent name: test-configmap ports: - containerPort: 9999 name: http-oracle protocol: TCP volumeMounts: # å…³é”®é…ç½® å¼€å§‹ - mountPath: /app/start-timeshift.sh name: properties readOnly: true subPath: start-timeshift.sh - mountPath: /app/conf/grafanaoracle.properties name: properties readOnly: true subPath: grafanaoracle.properties dnsPolicy: ClusterFirst restartPolicy: Always volumes: - configMap: defaultMode: 420 items: - key: grafanaoracle.properties # key å’Œ path åŒåå³å¯ path: grafanaoracle.properties - key: start-timeshift.sh path: start-timeshift.sh name: test-configmap name: properties # å…³é”®é…ç½® ç»“æŸ ","date":"2022-06-13","objectID":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/:3:0","tags":["Kubernetes"],"title":"Kubernetes ConfigMapå¤šæ–‡ä»¶æŒ‚è½½è‡³åŒä¸€ä¸ªpodå†…ç›®å½•å®è·µ","uri":"/kubernetes-configmap%E5%A4%9A%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AApod%E5%86%85%E7%9B%AE%E5%BD%95%E5%AE%9E%E8%B7%B5/"},{"categories":["Django"],"content":"Django æ¨¡æ¿è¯­æ³• æ¨¡æ¿å¼•æ“æ˜¯ä¸€ç§å¯ä»¥è®©å¼€å‘è€…æŠŠæœåŠ¡ç«¯æ•°æ®å¡«å……åˆ°htmlç½‘é¡µä¸­å®Œæˆæ¸²æŸ“æ•ˆæœçš„æŠ€æœ¯ã€‚å®ƒå®ç°äº†æŠŠå‰ç«¯ä»£ç å’ŒæœåŠ¡ç«¯ä»£ç åˆ†ç¦»çš„ä½œç”¨ï¼Œè®©é¡¹ç›®ä¸­çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œæ•°æ®è¡¨ç°ä»£ç åˆ†ç¦»ï¼Œè®©å‰ç«¯å¼€å‘è€…å’ŒæœåŠ¡ç«¯å¼€å‘è€…å¯ä»¥æ›´å¥½çš„å®ŒæˆååŒå¼€å‘ã€‚ ä¿¡æ¯\ré™æ€ç½‘é¡µï¼šé¡µé¢ä¸Šçš„æ•°æ®éƒ½æ˜¯å†™æ­»çš„ï¼Œä¸‡å¹´ä¸å˜ åŠ¨æ€ç½‘é¡µï¼šé¡µé¢ä¸Šçš„æ•°æ®æ˜¯ä»åç«¯åŠ¨æ€è·å–çš„ï¼ˆæ¯”å¦‚åç«¯è·å–å½“å‰æ—¶é—´ï¼›åç«¯è·å–æ•°æ®åº“æ•°æ®ç„¶åä¼ é€’ç»™å‰ç«¯é¡µé¢ï¼‰ Djangoæ¡†æ¶ä¸­å†…ç½®äº†webå¼€å‘é¢†åŸŸéå¸¸å‡ºåçš„ä¸€ä¸ªDjangoTemplateæ¨¡æ¿å¼•æ“ï¼ˆDTLï¼‰ã€‚DTLå®˜æ–¹æ–‡æ¡£ è¦åœ¨djangoæ¡†æ¶ä¸­ä½¿ç”¨æ¨¡æ¿å¼•æ“æŠŠè§†å›¾ä¸­çš„æ•°æ®æ›´å¥½çš„å±•ç¤ºç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦å®Œæˆ3ä¸ªæ­¥éª¤ï¼š ä¿¡æ¯\råœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä¿å­˜æ¨¡æ¿æ–‡ä»¶çš„æ¨¡æ¿ç›®å½•ã€‚ä¸€èˆ¬æ¨¡æ¿ç›®å½•éƒ½æ˜¯è®¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ–è€…ä¸»åº”ç”¨ç›®å½•ä¸‹ã€‚ åœ¨è§†å›¾ä¸­åŸºäºdjangoæä¾›çš„æ¸²æŸ“å‡½æ•°ç»‘å®šæ¨¡æ¿æ–‡ä»¶å’Œéœ€è¦å±•ç¤ºçš„æ•°æ®å˜é‡ åœ¨æ¨¡æ¿ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ¨¡æ¿å¼•æ“å†…ç½®çš„æ¨¡æ¿è¯­æ³•ï¼Œå¡«å†™è¾“å‡ºè§†å›¾ä¼ é€’è¿‡æ¥çš„æ•°æ®ã€‚ é…ç½®æ¨¡æ¿ç›®å½•ï¼šåœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†æ¨¡æ¿ç›®å½•templates. ç„¶ååœ¨settings.py, æ¨¡æ¿ç›¸å…³é…ç½®ï¼Œæ‰¾åˆ°TEMPLATESé…ç½®é¡¹ï¼Œå¡«å†™DIRSè®¾ç½®æ¨¡æ¿ç›®å½•ã€‚ # æ¨¡æ¿å¼•æ“é…ç½® TEMPLATES = [ { 'BACKEND': 'django.template.backends.django.DjangoTemplates', 'DIRS': [ BASE_DIR / \"templates\", # è·¯å¾„æ‹¼æ¥ ], 'APP_DIRS': True, 'OPTIONS': { 'context_processors': [ 'django.template.context_processors.debug', 'django.template.context_processors.request', 'django.contrib.auth.context_processors.auth', 'django.contrib.messages.context_processors.messages', ], }, }, ] ","date":"2022-05-20","objectID":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/:1:0","tags":["Django"],"title":"Django æ¨¡æ¿è¯­æ³•","uri":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"},{"categories":["Django"],"content":"ç®€å•æ¡ˆä¾‹ ä¸ºäº†æ–¹ä¾¿æ¥ä¸‹é‡Œçš„æ¼”ç¤ºå†…å®¹ï¼Œæˆ‘è¿™é‡Œåˆ›å»ºåˆ›å»ºä¸€ä¸ªæ–°çš„å­åº”ç”¨myapp python manage.py startapp myapp settings.pyï¼Œæ³¨å†Œå­åº”ç”¨ï¼Œä»£ç ï¼š INSTALLED_APPS = [ 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', 'myapp', # å¼€å‘è€…åˆ›å»ºçš„å­åº”ç”¨ï¼Œè¿™å¡«å†™å°±æ˜¯å­åº”ç”¨çš„å¯¼åŒ…è·¯å¾„ ] æ€»è·¯ç”±åŠ è½½å­åº”ç”¨è·¯ç”±,urls.pyï¼Œä»£ç ï¼š from django.contrib import admin from django.urls import path,include urlpatterns = [ path('admin/', admin.site.urls), # path(\"è·¯ç”±å‰ç¼€/\", include(\"å­åº”ç”¨ç›®å½•å.è·¯ç”±æ¨¡å—\")) path(\"users/\", include(\"users.urls\")), path(\"tem/\", include(\"myapp.urls\")), ] åœ¨å­åº”ç”¨ç›®å½•ä¸‹åˆ›å»ºurls.pyå­è·¯ç”±æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š \"\"\"å­åº”ç”¨è·¯ç”±\"\"\" from django.urls import path, re_path from . import views urlpatterns = [ path(\"index\", views.index), ] myapp.views.indexï¼Œä»£ç ï¼š from django.shortcuts import render def index(request): # è¦æ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯çš„æ•°æ® name = \"hello DTL!\" # return render(request, \"æ¨¡æ¿æ–‡ä»¶è·¯å¾„\",context={å­—å…¸æ ¼å¼ï¼šè¦åœ¨å®¢æˆ·ç«¯ä¸­å±•ç¤ºçš„æ•°æ®}) return render(request, \"index.html\",context={\"name\":name}) ","date":"2022-05-20","objectID":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/:1:1","tags":["Django"],"title":"Django æ¨¡æ¿è¯­æ³•","uri":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"},{"categories":["Django"],"content":"renderå‡½æ•°å†…éƒ¨æœ¬è´¨ django renderå‡½æ•°å†…éƒ¨æœ¬è´¨\rfrom django.shortcuts import render from django.template.loader import get_template from django.http.response import HttpResponse def index(request): name = \"hello world!\" # 1. åˆå§‹åŒ–æ¨¡æ¿,è¯»å–æ¨¡æ¿å†…å®¹,å®ä¾‹åŒ–æ¨¡æ¿å¯¹è±¡ # get_templateä¼šä»é¡¹ç›®é…ç½®ä¸­æ‰¾åˆ°æ¨¡æ¿ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦å¡«å†™çš„å‚æ•°å°±æ˜¯è¡¥å…¨æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„ template = get_template(\"myapp/index.html\") # 2. è¯†åˆ«contextå†…å®¹, å’Œæ¨¡æ¿å†…å®¹é‡Œé¢çš„æ ‡è®°[æ ‡ç­¾]æ›¿æ¢,é’ˆå¯¹å¤æ‚çš„å†…å®¹,è¿›è¡Œæ­£åˆ™çš„æ›¿æ¢ context = {\"name\": name} content = template.render(context, request) # renderä¸­å®Œæˆäº†å˜é‡æ›¿æ¢æˆå˜é‡å€¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨äº†æ­£åˆ™ã€‚ print(content) # 3. é€šè¿‡responseå“åº”å¯¹è±¡,æŠŠæ›¿æ¢äº†æ•°æ®çš„æ¨¡æ¿å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ return HttpResponse(content) # ä¸Šé¢ä»£ç çš„ç®€å†™,ç›´æ¥ä½¿ç”¨ django.shortcuts.render # return render(request, \"index.html\",context={\"name\":name}) # return render(request,\"index.html\", locals()) # data = {} # data[\"name\"] = \"xiaoming\" # data[\"message\"] = \"ä½ å¥½ï¼\" # return render(request,\"index.html\", data) DTLæ¨¡æ¿æ–‡ä»¶ä¸æ™®é€šhtmlæ–‡ä»¶çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ DTLæ¨¡æ¿æ–‡ä»¶æ˜¯ä¸€ç§å¸¦æœ‰ç‰¹æ®Šè¯­æ³•çš„HTMLæ–‡ä»¶ï¼Œè¿™ä¸ªHTMLæ–‡ä»¶å¯ä»¥è¢«Djangoç¼–è¯‘ï¼Œå¯ä»¥ä¼ é€’å‚æ•°è¿›å»ï¼Œå®ç°æ•°æ®åŠ¨æ€åŒ–ã€‚åœ¨ç¼–è¯‘å®Œæˆåï¼Œç”Ÿæˆä¸€ä¸ªæ™®é€šçš„HTMLæ–‡ä»¶ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠå¼€å‘ä¸­çš„æ–‡ä»¶åˆ†2ç§ï¼Œåˆ†åˆ«æ˜¯é™æ€æ–‡ä»¶å’ŒåŠ¨æ€æ–‡ä»¶ã€‚ æŠ€å·§\ré™æ€æ–‡ä»¶ï¼Œæ•°æ®ä¿å­˜åœ¨å½“å‰æ–‡ä»¶ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•å¤„ç†å°±å¯ä»¥å±•ç¤ºå‡ºå»ã€‚æ™®é€šhtmlæ–‡ä»¶ï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼ŒéŸ³é¢‘ç­‰è¿™ä¸€ç±»æ–‡ä»¶å«é™æ€æ–‡ä»¶ã€‚ åŠ¨æ€æ–‡ä»¶ï¼Œæ•°æ®å¹¶ä¸åœ¨å½“å‰æ–‡ä»¶ï¼Œè€Œæ˜¯è¦ç»è¿‡æœåŠ¡ç«¯æˆ–å…¶ä»–ç¨‹åºè¿›è¡Œç¼–è¯‘è½¬æ¢æ‰å¯ä»¥å±•ç¤ºå‡ºå»ã€‚ ç¼–è¯‘è½¬æ¢çš„è¿‡ç¨‹å¾€å¾€å°±æ˜¯ä½¿ç”¨æ­£åˆ™æˆ–å…¶ä»–æŠ€æœ¯æŠŠæ–‡ä»¶å†…éƒ¨å…·æœ‰ç‰¹æ®Šæ ¼å¼çš„å˜é‡è½¬æ¢æˆçœŸå®æ•°æ®ã€‚ åŠ¨æ€æ–‡ä»¶ï¼Œä¸€èˆ¬æ•°æ®ä¼šä¿å­˜åœ¨ç¬¬ä¸‰æ–¹å­˜å‚¨è®¾å¤‡ï¼Œå¦‚æ•°æ®åº“ä¸­ã€‚djangoçš„æ¨¡æ¿æ–‡ä»¶ï¼Œå°±å±äºåŠ¨æ€æ–‡ä»¶ã€‚ ","date":"2022-05-20","objectID":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/:1:2","tags":["Django"],"title":"Django æ¨¡æ¿è¯­æ³•","uri":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"},{"categories":["Django"],"content":"æ¨¡æ¿è¯­æ³• å˜é‡æ¸²æŸ“ï¼ˆæ·±åº¦æŸ¥è¯¢ã€è¿‡æ»¤å™¨ï¼‰ {{val}} {{val|filter_name:å‚æ•°}} æ ‡ç­¾ åµŒå¥—å’Œç»§æ‰¿ å˜é‡æ¸²æŸ“ä¹‹æ·±åº¦æŸ¥è¯¢ def index(request): name = \"root\" age = 13 sex = True lve = [\"swimming\", \"shopping\", \"coding\", \"game\"] bookinfo = {\"id\": 1, \"price\": 9.90, \"name\": \"Django 3å¤©å…¥é—¨åˆ°æŒ£æ‰\", } book_list = [ {\"id\": 10, \"price\": 9.90, \"name\": \"Django 3å¤©å…¥é—¨åˆ°æŒ£æ‰\", }, {\"id\": 11, \"price\": 19.90, \"name\": \"Django 7å¤©å…¥é—¨åˆ°å‚æ­»æŒ£æ‰\", }, ] return render(request, 'index.html', locals()) æ¨¡æ¿ä»£ç ï¼Œtemplates/index.htmlï¼š \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003eTitle\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cp\u003ename={{ name }}\u003c/p\u003e \u003cp\u003e{{ age }}\u003c/p\u003e \u003cp\u003e{{ sex }}\u003c/p\u003e \u003cp\u003eåˆ—è¡¨æˆå‘˜\u003c/p\u003e \u003cp\u003e{{ lve }}\u003c/p\u003e \u003cp\u003e{{ lve.0 }}\u003c/p\u003e \u003cp\u003e{{ lve | last }}\u003c/p\u003e \u003cp\u003eå­—å…¸æˆå‘˜\u003c/p\u003e \u003cp\u003eid={{ bookinfo.id }}\u003c/p\u003e \u003cp\u003eprice={{ bookinfo.price }}\u003c/p\u003e \u003cp\u003ename={{ bookinfo.name }}\u003c/p\u003e \u003cp\u003eå¤æ‚åˆ—è¡¨\u003c/p\u003e \u003cp\u003e{{ book_list.0.name }}\u003c/p\u003e \u003cp\u003e{{ book_list.1.name }}\u003c/p\u003e \u003c/body\u003e \u003c/html\u003e å˜é‡æ¸²æŸ“ä¹‹å†…ç½®è¿‡æ»¤å™¨ è¯­æ³•ï¼š {{obj|è¿‡æ»¤å™¨åç§°:è¿‡æ»¤å™¨å‚æ•°}} å†…ç½®è¿‡æ»¤å™¨ è¿‡æ»¤å™¨ ç”¨æ³• ä»£ç  last è·å–åˆ—è¡¨/å…ƒç»„çš„æœ€åä¸€ä¸ªæˆå‘˜ {{liast | last}} first è·å–åˆ—è¡¨/å…ƒç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ {{list|first}} length è·å–æ•°æ®çš„é•¿åº¦ {{list | length}} defualt å½“å˜é‡æ²¡æœ‰å€¼çš„æƒ…å†µä¸‹, ç³»ç»Ÿè¾“å‡ºé»˜è®¤å€¼, {{str|default=â€œé»˜è®¤å€¼â€}} safe è®©ç³»ç»Ÿä¸è¦å¯¹å†…å®¹ä¸­çš„htmlä»£ç è¿›è¡Œå®ä½“è½¬ä¹‰ {{htmlcontent| safe}} upper å­—æ¯è½¬æ¢æˆå¤§å†™ {{str | upper}} lower å­—æ¯è½¬æ¢æˆå°å†™ {{str | lower}} title æ¯ä¸ªå•è¯é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ {{str | title}} date æ—¥æœŸæ—¶é—´æ ¼å¼è½¬æ¢ `{{ value cut ä»å†…å®¹ä¸­æˆªå–æ‰åŒæ ·å­—ç¬¦çš„å†…å®¹ {{content | cut:â€œhelloâ€}} list æŠŠå†…å®¹è½¬æ¢æˆåˆ—è¡¨æ ¼å¼ {{content | list}} add åŠ æ³• {{num| add}} filesizeformat æŠŠæ–‡ä»¶å¤§å°çš„æ•°å€¼è½¬æ¢æˆå•ä½è¡¨ç¤º {{filesize | filesizeformat}} join æŒ‰æŒ‡å®šå­—ç¬¦æ‹¼æ¥å†…å®¹ {{list| join(\"-\")}} random éšæœºæå–æŸä¸ªæˆå‘˜ {list | random}} slice æŒ‰åˆ‡ç‰‡æå–æˆå‘˜ {{list | slice:\":-2\"}} truncatechars æŒ‰å­—ç¬¦é•¿åº¦æˆªå–å†…å®¹ {{content | truncatechars:30}} truncatewords æŒ‰å•è¯é•¿åº¦æˆªå–å†…å®¹ åŒä¸Š è¿‡æ»¤å™¨çš„ä½¿ç”¨ è§†å›¾ä»£ç  myapp.views.py; def index(request): \"\"\"è¿‡æ»¤å™¨ filters\"\"\" content = \"Django template\" # content1 = '\u003cscript\u003ealert(1);\u003c/script\u003e' from datetime import datetime now = datetime.now() content2= \"hello wrold!\" return render(request,\"myapp/index.html\",locals()) # æ¨¡æ¿ä»£ç ,myapp/templates/index.html: {{ content | safe }} {{ content1 | safe }} {# è¿‡æ»¤å™¨æœ¬è´¨å°±æ˜¯å‡½æ•°,ä½†æ˜¯æ¨¡æ¿è¯­æ³•ä¸æ”¯æŒå°æ‹¬å·è°ƒç”¨,æ‰€ä»¥éœ€è¦ä½¿ç”¨:å·åˆ†å‰²å‚æ•° #} \u003cp\u003e{{ now | date:\"Y-m-d H:i:s\" }}\u003c/p\u003e \u003cp\u003e{{ conten1 | default:\"é»˜è®¤å€¼\" }}\u003c/p\u003e {# ä¸€ä¸ªæ•°æ®å¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªè¿‡æ»¤å™¨ #} \u003cp\u003e{{ content2 | truncatechars:6 | upper }}\u003c/p\u003e è‡ªå®šä¹‰è¿‡æ»¤å™¨ è™½ç„¶å®˜æ–¹å·²ç»æä¾›äº†è®¸å¤šå†…ç½®çš„è¿‡æ»¤å™¨ç»™å¼€å‘è€…,ä½†æ˜¯å¾ˆæ˜æ˜¾,è¿˜æ˜¯ä¼šæœ‰å­˜åœ¨ä¸è¶³çš„æ—¶å€™ã€‚ä¾‹å¦‚:å¸Œæœ›è¾“å‡ºç”¨æˆ·çš„æ‰‹æœºå·ç æ—¶, 13912345678 â€”-Â» 139*****678ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚è¦å£°æ˜è‡ªå®šä¹‰è¿‡æ»¤å™¨å¹¶ä¸”èƒ½åœ¨æ¨¡æ¿ä¸­æ­£å¸¸ä½¿ç”¨,éœ€è¦å®Œæˆ2ä¸ªå‰ç½®çš„å·¥ä½œ: # 1. å½“å‰ä½¿ç”¨å’Œå£°æ˜è¿‡æ»¤å™¨çš„å­åº”ç”¨å¿…é¡»åœ¨setting.pyé…ç½®æ–‡ä»¶ä¸­çš„INSTALLED_APPSä¸­æ³¨å†Œäº†!!! INSTALLED_APPS = [ 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', 'myapp', ] # 2. è‡ªå®šä¹‰è¿‡æ»¤å™¨å‡½æ•°å¿…é¡»è¢« template.registerè¿›è¡Œè£…é¥°ä½¿ç”¨. # è€Œä¸”è¿‡æ»¤å™¨å‡½æ•°æ‰€åœ¨çš„æ¨¡å—å¿…é¡»åœ¨templatetagsåŒ…é‡Œé¢ä¿å­˜ # åœ¨myappå­åº”ç”¨ä¸‹åˆ›å»ºtemplatetagsåŒ…[å¿…é¡»åŒ…å«__init__.py], åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»ºä»»æ„pyæ–‡ä»¶ # myapp.templatetags.my_filters.pyä»£ç : from django import template register = template.Library() # è‡ªå®šä¹‰è¿‡æ»¤å™¨ @register.filter(\"mobile\") def mobile(content): return content[:3]+\"*****\"+content[-3:] # 3. åœ¨éœ€è¦ä½¿ç”¨çš„æ¨¡æ¿æ–‡ä»¶ä¸­é¡¶éƒ¨ä½¿ç”¨loadæ ‡ç­¾åŠ è½½è¿‡æ»¤å™¨æ–‡ä»¶my_filters.pyå¹¶è°ƒç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ # myapp.views.py,ä»£ç : def index(request): \"\"\"è‡ªå®šä¹‰è¿‡æ»¤å™¨ filters\"\"\" moblie_number = \"13312345678\" return render(request,\"index2.html\",locals()) # templates/index2.html,ä»£ç : \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003eTitle\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e {{ moblie_number| mobile }} \u003c/body\u003e \u003c/html\u003e æ ‡ç­¾ if è§†å›¾ä»£ç ,myapp.views.py: def index(request): name = \"xiaoming\" age = 19 sex = True lve = [\"swimming\", \"shopping\", \"coding\", \"game\"] user_lve = \"sleep\" bookinfo = {\"id\": 1, \"price\": 9.90, \"name\": \"python3å¤©å…¥é—¨åˆ°æŒ£æ‰\", } book_list = [ {\"id\": 10, \"price\": 9.90, \"name\": \"python3å¤©å…¥é—¨åˆ°æŒ£æ‰\", }, {\"id\": 11, \"price\": 19.90, \"name\": \"python7å¤©å…¥é—¨åˆ°å‚æ­»æŒ£æ‰\", }, ] return render(request, 'index.html', locals()) æ¨¡æ¿ä»£ç ,templates/index.htmlï¼Œä»£ç ï¼š è·¯ç”±ä»£ç ï¼š \"\"\"å­åº”ç”¨è·¯ç”±\"\"\" from django.urls import path, re_path from . import views urlpatterns = [ # .... path(\"index\", views.index), ] for è§†å›¾ä»£ç , myapp.views.py: def index7(request): book_list1 = [ {\"id\": 11, \"name\": \"pythonåŸºç¡€å…¥é—¨\", \"price\": 130.00}, {\"id\": 17, \"name\": \"GoåŸºç¡€å…¥é—¨\", \"price\": 230.00}, {\"id\": 23, \"name\": \"PHPåŸºç¡€å…¥é—¨\", \"price\": 330.00}, {\"id\": 44, \"name\": \"JavaåŸºç¡€å…¥é—¨\", \"price\": ","date":"2022-05-20","objectID":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/:1:3","tags":["Django"],"title":"Django æ¨¡æ¿è¯­æ³•","uri":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"},{"categories":["Django"],"content":"é™æ€æ–‡ä»¶ å¼€å‘ä¸­åœ¨å¼€å¯äº†debugæ¨¡å¼æ—¶ï¼Œdjangoå¯ä»¥é€šè¿‡é…ç½®ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å¯¹åº”çš„urlåœ°å€è®¿é—®djangoçš„é™æ€æ–‡ä»¶ã€‚ setting.pyï¼Œä»£ç ï¼š STATIC_ROOT = BASE_DIR / 'static' STATIC_URL = '/static/' # djangoæ¨¡æ¿ä¸­ï¼Œå¯ä»¥å¼•ç”¨{{STATIC_URL}}å˜é‡é¿å…æŠŠè·¯å¾„å†™æ­»ã€‚ æ€»è·¯ç”±ï¼Œurls.pyï¼Œä»£ç ï¼š from django.views.static import serve as serve_static urlpatterns = [ path('admin/', admin.site.urls), # å¯¹å¤–æä¾›è®¿é—®é™æ€æ–‡ä»¶çš„è·¯ç”±ï¼Œserve_static æ˜¯djangoæä¾›é™æ€è®¿é—®æ”¯æŒçš„æ˜ å°„ç±»ã€‚ä¾é å®ƒï¼Œå®¢æˆ·ç«¯æ‰èƒ½è®¿é—®åˆ°djangoçš„é™æ€æ–‡ä»¶ã€‚ path(r'static/\u003cpath:path\u003e', serve_static, {'document_root': settings.STATIC_ROOT},), ] æ³¨æ„\ré¡¹ç›®ä¸Šçº¿ä»¥åï¼Œå…³é—­debugæ¨¡å¼æ—¶ï¼Œdjangoé»˜è®¤æ˜¯ä¸æä¾›é™æ€æ–‡ä»¶çš„è®¿é—®æ”¯æŒï¼Œé¡¹ç›®éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ”¶é›†é™æ€æ–‡ä»¶ä½¿ç”¨nginxè¿™ç§webæœåŠ¡å™¨æ¥æä¾›é™æ€æ–‡ä»¶çš„è®¿é—®æ”¯æŒã€‚\r","date":"2022-05-20","objectID":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/:1:4","tags":["Django"],"title":"Django æ¨¡æ¿è¯­æ³•","uri":"/django-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"},{"categories":["Kubernetes"],"content":"èƒŒæ™¯ é¡¹ç›®ç°åœºé€šè¿‡ kubeadm éƒ¨ç½²ä¸€å¥— k8s ä¸´æ—¶ç¯å¢ƒ ç‰ˆæœ¬æ˜¯v1.22, å› ä¸ºæ˜¯ä¸´æ—¶ç¯å¢ƒï¼Œéƒ¨ç½²æ–¹å¼æ˜¯ä¸€ä¸»ä¸¤ä»çš„æ¨¡å¼ï¼Œ éƒ¨ç½²ååå¤©å®¢æˆ·ç›´æ¥å°†ä¸»èŠ‚ç‚¹çš„å†…å­˜è¿›è¡Œäº†æ‰©å®¹ï¼Œå¯¼è‡´ç°åœºçš„åº”ç”¨æœåŠ¡æ— æ³•è®¿é—®ã€‚ ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"ç°è±¡ æ‰“å¼€è®¿é—®åº”ç”¨é—¨æˆ·ï¼Œæç¤º nginx ç½‘å…³è®¿é—®æŠ¥é”™ 503 Service Temporarily Unavailable ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"å®šä½ é€šè¿‡ kubectl æŸ¥çœ‹ pod çŠ¶æ€å‘ç°å¾ˆå¤šåº”ç”¨æ˜¯ CrashLoopBackOff,çŒœæµ‹æ˜¯ç³»ç»ŸåŸºç¡€ç»„ä»¶å‡ºç°å¼‚å¸¸,æŸ¥çœ‹åº”ç”¨æ—¥å¿—æç¤º jdbc è¿æ¥ MySQL å¼‚å¸¸ï¼ŒæŸ¥çœ‹MySQL æ—¥å¿—å‘ç°ç«¯å£52306è¢«å ç”¨ã€‚ æ’æŸ¥ä¸º apiserverå’Œetcdè¿æ¥çš„éšæœºç«¯å£å ç”¨äº†52306 # sudo netstat -nap|grep 52306 tcp 0 0 127.0.0.1:52306 127.0.0.1:2379 ESTABLISHED 30166/kube-apiserve tcp 0 0 127.0.0.1:2379 127.0.0.1:52306 ESTABLISHED 23788/etcd ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:3:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"é—®é¢˜å¤„ç† ç¡®è®¤ç«¯å£å ç”¨æƒ…å†µï¼šæ‰§è¡Œ sudo netstat -lnp | grep å‘½ä»¤æŸ¥çœ‹æŒ‡å®šç«¯å£æ˜¯å¦è¢«å ç”¨ é‡Šæ”¾ç«¯å£ï¼šå¦‚æœè¯¥ç«¯å£å·²è¢«å ç”¨ï¼Œå¯ä»¥é€šè¿‡ sudo lsof -i: å‘½ä»¤æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ ä¸´æ—¶å¤„ç†ï¼Œpod é‡å»º kill æ‰ etcd çš„é™æ€ podï¼Œç«¯å£å¯èƒ½è¿˜æ˜¯ä¼šé‡æ–°è¢«å ç”¨ æ°¸ä¹…å¤„ç†ï¼Œä¸»æœº k8s.conf é¢„ç•™ç«¯å£ ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:4:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"ä¿ç•™é¢„ç•™ç«¯å£ $ cat /etc/sysctl.d/k8s.conf net.ipv4.ip_forward = 1 kernel.core_pattern=/tmp/zcore/core.%h~%e fs.inotify.max_user_watches = 1048576 net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_local_reserved_ports = 52000-52999 net.ipv4.ip_local_reserved_portsæ–°å¢é¢„ç•™ç«¯å£é…ç½®ï¼Œä¿ç•™ç«¯å£èŒƒå›´ä¸è¢«å ç”¨ï¼Œå‘Šè¯‰å†…æ ¸ä¿ç•™ç«¯å£èŒƒå›´ä» 52000 åˆ° 52999ï¼Œä»¥ä¾¿è¿™äº›ç«¯å£ä¸ä¼šè¢«æ™®é€šåº”ç”¨ç¨‹åºå ç”¨ ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:4:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"/etc/sysctl.d/k8s.conf é…ç½®é¡¹è¯´æ˜ åœ¨ Kubernetes 1.22 ç‰ˆæœ¬çš„ /etc/sysctl.d/k8s.conf é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯èƒ½åŒ…å«ä»¥ä¸‹ä¸€äº›é…ç½®é¡¹ï¼š 1ã€ net.bridge.bridge-nf-call-ip6tablesï¼š å«ä¹‰ï¼šæ§åˆ¶æ˜¯å¦å°† IPv6 æ•°æ®åŒ…ä¼ é€’ç»™ iptables çš„ netfilter æ¡†æ¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨ï¼›å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ã€‚ é»˜è®¤å€¼ï¼š1 2ã€ net.bridge.bridge-nf-call-iptablesï¼š å«ä¹‰ï¼šæ§åˆ¶æ˜¯å¦å°†æ•°æ®åŒ…ä¼ é€’ç»™ iptables çš„ netfilter æ¡†æ¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨ï¼›å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ã€‚ é»˜è®¤å€¼ï¼š1 3ã€ net.ipv4.ip_forwardï¼š å«ä¹‰ï¼šæ§åˆ¶ Linux å†…æ ¸æ˜¯å¦å…è®¸ IP æ•°æ®åŒ…è½¬å‘ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨ IP è½¬å‘ï¼›å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ IP è½¬å‘ã€‚ é»˜è®¤å€¼ï¼š0 4ã€ net.ipv4.conf.all.forwardingï¼š å«ä¹‰ï¼šæ§åˆ¶æ‰€æœ‰ç½‘ç»œæ¥å£çš„ IP è½¬å‘åŠŸèƒ½ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨ IP è½¬å‘ï¼›å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ IP è½¬å‘ã€‚ é»˜è®¤å€¼ï¼š0 5ã€ net.ipv4.conf.default.forwardingï¼š å«ä¹‰ï¼šæ§åˆ¶é»˜è®¤ç½‘ç»œæ¥å£çš„ IP è½¬å‘åŠŸèƒ½ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨ IP è½¬å‘ï¼›å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ IP è½¬å‘ã€‚ é»˜è®¤å€¼ï¼š0 ä»¥ä¸Šæ˜¯å¸¸è§çš„ç¤ºä¾‹é…ç½®é¡¹å’Œé»˜è®¤å€¼ï¼Œä½†å®é™…çš„é…ç½®é¡¹å’Œé»˜è®¤å€¼å¯èƒ½ä¼šæ ¹æ®æ“ä½œç³»ç»Ÿå’Œ Kubernetes ç‰ˆæœ¬è€Œæœ‰æ‰€ä¸åŒã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¯·æ ¹æ®æ–‡æ¡£å’Œæ“ä½œç³»ç»Ÿçš„è¦æ±‚è¿›è¡Œæ­£ç¡®é…ç½®ã€‚ ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:5:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡ Apiserver å’Œ Etcd è¿æ¥çš„éšæœºç«¯å£å ç”¨å†²çªé—®é¢˜","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1apiserver%E5%92%8Cetcd%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["Kubernetes"],"content":"é—®é¢˜ç°è±¡ ç”Ÿäº§ç¯å¢ƒæ— æ³•è®¿é—®ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ¢³ç†é‡åˆ°é—®é¢˜åº”è¯¥æœ‰çš„ä¸€ä¸ªæ’æŸ¥æ€è·¯ portal-exception\r","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡é¡¹ç›®ç”Ÿäº§ç¯å¢ƒæ•…éšœåˆ†æ","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/"},{"categories":["Kubernetes"],"content":"é—®é¢˜æ’æŸ¥ ç™»å½•èŠ‚ç‚¹æŸ¥çœ‹namespace ä¸‹å„podçŠ¶æ€ kubectl get pod -o wide -n prod å‘ç°portal cmdb applicationç­‰å‡å¤„äºå¼‚å¸¸çŠ¶æ€ ç”±äºportalå¯åŠ¨ä¼šä¾èµ–cmdb ä¼˜å…ˆæŸ¥çœ‹cmdbçš„æ—¥å¿—ï¼Œå‘ç°æŠ¥é”™è¿æ¥rediså¼‚å¸¸ æŸ¥çœ‹redisçŠ¶æ€ å¤„äºæ­£å¸¸çŠ¶æ€ kubectl get pod -o wide -n prod|grep redis è¿›å…¥cmdb å®¹å™¨è¿›è¡Œredis è¿æ¥æµ‹è¯• telnet redis 6379 å‘ç°è§£æåŸŸå redis æœ‰é—®é¢˜ å› æ­¤æ€€ç–‘corednså­˜åœ¨é—®é¢˜ æŸ¥çœ‹ coredns çŠ¶æ€ kubectl get pod -o wide -n kube-system|grep coredns å‘ç°podå¤„äºterminatingä»¥åŠpending ç”±äºcorednsé…ç½®æœ‰èŠ‚ç‚¹é€‰æ‹©å™¨ï¼Œåªä¼šè°ƒåº¦åˆ°k8s masterèŠ‚ç‚¹ æ­¤å¤–å¯¹masteråšäº†taint ,â€”-é˜²æ­¢å…¶å®ƒçš„å„ç§ç³»ç»Ÿç»„ä»¶å‘Masterè°ƒåº¦ï¼Œå¯¼è‡´masterèµ„æºå—å‹ç¼©ã€‚ï¼ˆæ­¤æ±¡ç‚¹å¯¹å·²ç»è°ƒåº¦åœ¨è¯¥èŠ‚ç‚¹çš„podä¸ä¼šäº§ç”Ÿé©±é€ï¼Œä½†æ˜¯æ–°å»ºpodçš„å°†æ— æ³•è°ƒåº¦ï¼‰ $ kubectl describe node 10.10.xxx Name: 10.10.xxx Roles: master Labels: beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=10.10.xxx kubernetes.io/os=linux kubernetes.io/role=master zcm.role=k8s Annotations: node.alpha.kubernetes.io/ttl: 0 volumes.kubernetes.io/controller-managed-attach-detach: true CreationTimestamp: Sat, 25 Mar 2023 10:08:15 +0800 Taints: scheduler=custom:NoSchedule Unschedulable: false å¯¼è‡´coredns pending ä¸´æ—¶å¤„ç†,å°†èŠ‚ç‚¹é€‰æ‹©å™¨ç§»é™¤ corednsè°ƒåº¦æˆåŠŸï¼Œå¯åŠ¨å®Œæˆ portal cmdbç­‰ä¾èµ–redisçš„æœåŠ¡è‡ªè¡Œæ¢å¤ ç”Ÿäº§ç¯å¢ƒæ¢å¤è®¿é—® ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡é¡¹ç›®ç”Ÿäº§ç¯å¢ƒæ•…éšœåˆ†æ","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/"},{"categories":["Kubernetes"],"content":"é—®é¢˜åˆ†æ é—®é¢˜å‘ç”Ÿå‰ï¼Œé›†æˆå¯¹10.10.xxxç­‰k8s masteræœºå™¨è¿›è¡Œäº†è¿ç§»æ“ä½œï¼Œä¸»æœºå‘ç”Ÿäº†é‡å¯ã€‚ å› æ­¤corednså‘ç”Ÿé‡æ–°è°ƒåº¦ï¼Œæ­¤æ—¶ç”±äºèŠ‚ç‚¹é€‰æ‹©å™¨ä»¥åŠtaintçš„ç¼˜æ•…ï¼Œcorednsæ— æ³•æˆåŠŸè°ƒåº¦å¯åŠ¨ï¼Œ è¿›è€Œå½±å“äº†å®¹å™¨å†…å¯¹redisçš„è§£æ ï¼Œå¯¼è‡´ä¾èµ–redisçš„å®¹å™¨ä¸æ–­é‡å¯ï¼Œç”Ÿäº§ç¯å¢ƒæ— æ³•è®¿é—®ã€‚ åç»­å¯¹å„ä¸ªk8sé›†ç¾¤çš„corednsé…ç½®äº†å¯¹æ±¡ç‚¹çš„å®¹å¿ï¼Œé¿å…ç±»ä¼¼é—®é¢˜çš„å†æ¬¡å‘ç”Ÿã€‚ ","date":"2022-05-18","objectID":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/:3:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes è®°å½•ä¸€æ¬¡é¡¹ç›®ç”Ÿäº§ç¯å¢ƒæ•…éšœåˆ†æ","uri":"/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%95%85%E9%9A%9C%E5%88%86%E6%9E%90/"},{"categories":["Kubernetes"],"content":"èƒŒæ™¯ statefulset é€šè¿‡nfs åŠ¨æ€åˆ›å»ºpvï¼Œå‘ç°æ— æ³•åˆ›å»ºæˆåŠŸ ","date":"2022-05-18","objectID":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes é€šè¿‡ nfs åŠ¨æ€åˆ›å»º pv å¼‚å¸¸","uri":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/"},{"categories":["Kubernetes"],"content":"æŠ¥é”™æ—¥å¿— Warning FailedMount 2m50s (x6 over 6m4s) kubelet Unable to attach or mount volumes: unmounted volumes=[data], unattached volumes=[kube-api-access-8p8wf data]: error processing PVC kube-logging/data-es-cluster-0: PVC is not bound é€šè¿‡æŠ¥é”™æ—¥å¿—å¯ä»¥çœ‹çš„å‡ºæ¥pvc æ— æ³•ç»‘å®špv,é€šè¿‡å‘½ä»¤æŸ¥çœ‹pvcåˆ›å»ºæˆåŠŸï¼Œpv åˆ™æ²¡æœ‰è¿›è¡Œåˆ›å»º StatefulSet æŒ‚è½½ NFS å­˜å‚¨å·æ—¶å‡ºç°äº†é—®é¢˜,å¯¼è‡´ PVC æ²¡æœ‰è¢«æˆåŠŸç»‘å®šåˆ° PVçš„åŸå›  å¸¸è§åŸå› æœ‰: PVC å’Œ PV ä¸åŒ¹é… PVC çš„ storage classã€è®¿é—®æ¨¡å¼ã€å¤§å°èµ„æºè¯·æ±‚ç­‰éœ€è¦å’Œ PV å®šä¹‰ä¸€è‡´,å¦åˆ™ä¸ä¼šè¢«åŒ¹é…åˆ°åˆé€‚çš„ PVã€‚ NFS æœåŠ¡å™¨é…ç½®é—®é¢˜ NFS æœåŠ¡å™¨éœ€è¦æ­£å¸¸å¯åŠ¨ã€å¯¼å‡ºå…±äº«ç›®å½•,å¹¶ä¸” Kubernetes èŠ‚ç‚¹èƒ½å¤Ÿè®¿é—®åˆ° NFS æœåŠ¡å™¨ã€‚ RBAC é‰´æƒé—®é¢˜ Kubernetes èŠ‚ç‚¹ä¸Šçš„ kubelet éœ€è¦æœ‰è·å–ã€æŒ‚è½½ PV çš„æƒé™ã€‚ NFS Client é…ç½®é—®é¢˜ Kubernetes èŠ‚ç‚¹ä¸Šéœ€è¦å®‰è£… NFS Client,å¹¶ä¸”é…ç½®å¯ä»¥è®¿é—® NFS æœåŠ¡å™¨ã€‚ StatefulSet é…ç½®é”™è¯¯ StatefulSet çš„ volumeClaimTemplates éœ€è¦ä¸ PVC çš„å®šä¹‰ç›¸åŒ¹é…ã€‚ å­˜å‚¨å·è¯»å†™æƒé™é—®é¢˜ å­˜å‚¨å·éœ€è¦æœ‰è¯»å†™æƒé™,é¿å…å› æƒé™é—®é¢˜æ— æ³•æŒ‚è½½ã€‚ ","date":"2022-05-18","objectID":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes é€šè¿‡ nfs åŠ¨æ€åˆ›å»º pv å¼‚å¸¸","uri":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/"},{"categories":["Kubernetes"],"content":"nfs åœ¨kubernetesä¸­åŠ¨æ€åˆ›å»ºpvå’Œç‰ˆæœ¬çš„å…³ç³» åœ¨æ—©æœŸçš„ Kubernetes ç‰ˆæœ¬ä¸­(å¦‚ v1.11 ä¹‹å‰),NFS provisioner å¹¶ä¸åŒ…å«åœ¨é»˜è®¤éƒ¨ç½²ä¸­,è¿™ä¼šå¯¼è‡´é€šè¿‡ NFS å­˜å‚¨ç±»æ— æ³•åŠ¨æ€åˆ›å»º PVã€‚ ä» Kubernetes v1.11 å¼€å§‹,NFS åŠ¨æ€ä¾›åº”åŠŸèƒ½æˆä¸ºäº†é»˜è®¤éƒ¨ç½²çš„ä¸€éƒ¨åˆ†,ä½†ä¹Ÿéœ€è¦è¿›è¡Œé¢å¤–çš„é…ç½®,ä¸»è¦æ­¥éª¤åŒ…æ‹¬: å®‰è£… NFS å®¢æˆ·ç«¯ç»„ä»¶ éƒ¨ç½² NFS åŠ¨æ€ä¾›åº”å™¨ external-provisioner åˆ›å»º StorageClass,æŒ‡å®š nfs ä½œä¸º provisioner åˆ›å»º PersistentVolumeClaim, å¼•ç”¨è¯¥ StorageClass æ­¤æ—¶,NFS ä¾›åº”å™¨å°±å¯ä»¥æ ¹æ® PVC çš„è¯·æ±‚åŠ¨æ€åˆ›å»º PV æ¥ç»‘å®š PVCã€‚ æ‰€ä»¥ç®€å•æ¥è¯´,Kubernetes ä½ç‰ˆæœ¬ä¸­éœ€è¦æ‰‹åŠ¨å®‰è£…å’Œé…ç½® NFS åŠ¨æ€ä¾›åº”å™¨; é«˜ç‰ˆæœ¬ä¸­å·²å†…ç½®ä½†ä¹Ÿéœ€è¦æ˜¾å¼é…ç½®æ‰èƒ½å¯ç”¨è¯¥åŠŸèƒ½ã€‚æ­£ç¡®é…ç½®åå°±å¯ä»¥é€šè¿‡ NFS StorageClass æ¥åŠ¨æ€åˆ›å»º PVã€‚ è¿™é‡Œçš„é«˜ç‰ˆæœ¬æŒ‡çš„æ˜¯v1.20 ä¹‹åï¼Œåœ¨ kube-apiserver çš„å¯åŠ¨å‚æ•°ä¸­ä¸ç§»é™¤ API å¯¹è±¡ä¸­çš„ selfLink å­—æ®µã€‚ selfLink æ˜¯ Kubernetes ä¸­æ¯ä¸ª API å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µ,ç”¨äºè¡¨ç¤ºå¯¹è±¡è‡ªèº«çš„ URL åœ°å€ ä» Kubernetes 1.20 ç‰ˆæœ¬å¼€å§‹,è¯¥å­—æ®µé»˜è®¤è¢«ç§»é™¤äº†ã€‚ä½†å¯ä»¥é€šè¿‡è®¾ç½® RemoveSelfLink=false æ¥ä¿ç•™è¯¥å­—æ®µ åŸå› æ˜¯ selfLink å­—æ®µå·²å¾ˆå°‘è¢«ç”¨åˆ°,ä½†åˆ å»åå¯èƒ½ä¼šå½±å“éƒ¨åˆ†è€ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥æä¾›äº†è¿™ä¸ªç‰¹æ€§å¼€å…³æ¥å‘åå…¼å®¹ ä¸€èˆ¬æ¥è¯´,é™¤éç¡®å®éœ€è¦å…¼å®¹è€ç‰ˆæœ¬å®¢æˆ·ç«¯,å¦åˆ™ä¸å»ºè®®ä¿ç•™ selfLink å­—æ®µ æ˜¾å¼å¼€å¯æ–¹å¼ï¼š $ vi /etc/kubernetes/manifests/kube-apiserver.yaml .... spec: containers: - command: - kube-apiserver - --feature-gates=RemoveSelfLink=false ","date":"2022-05-18","objectID":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/:3:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes é€šè¿‡ nfs åŠ¨æ€åˆ›å»º pv å¼‚å¸¸","uri":"/kubernetes%E9%80%9A%E8%BF%87nfs%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv%E5%BC%82%E5%B8%B8/"},{"categories":["Redis"],"content":"åŸºæœ¬æ¦‚å¿µ Redisï¼ˆREmote DIctionary Serviceï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„é”®å€¼å¯¹æ•°æ®åº“æœåŠ¡å™¨ã€‚ Redisæ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰ï¼Œå†…å­˜å­˜å‚¨çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå¯ç”¨ä½œæ•°æ®åº“ï¼Œé«˜é€Ÿç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—ä»£ç†ã€‚å®ƒæ”¯æŒå­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼Œä½å›¾ï¼Œhyperloglogsç­‰æ•°æ®ç±»å‹ã€‚å†…ç½®å¤åˆ¶ã€Luaè„šæœ¬ã€LRUæ”¶å›ã€äº‹åŠ¡ä»¥åŠä¸åŒçº§åˆ«ç£ç›˜æŒä¹…åŒ–åŠŸèƒ½ï¼ŒåŒæ—¶é€šè¿‡Redis Sentinelæä¾›é«˜å¯ç”¨ï¼Œé€šè¿‡Redis Clusteræä¾›è‡ªåŠ¨åˆ†åŒºã€‚ redis explained\r","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:1:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"ä½¿ç”¨åœºæ™¯ æ•°æ®åº“ ç¼“å­˜ MQ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:1:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Redisä¼˜åŠ¿ æ€§èƒ½æé«˜ æ•°æ®ç±»å‹ä¸°å¯Œï¼Œå•é”®å€¼å¯¹æœ€å¤§æ”¯æŒ512Må¤§å°çš„æ•°æ® ç®€å•æ˜“ç”¨ï¼Œæ”¯æŒæ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€ æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œä¸»ä»å¤åˆ¶ï¼Œå“¨å…µæ¨¡å¼ç­‰é«˜å¯ç”¨ç‰¹æ€§ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:1:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"ç«å“å¯¹æ¯” Memcached vs Redis redis-vs-memcached\r","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:1:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å®‰è£…é…ç½® è¿™é‡Œå®‰è£…çš„ç¯å¢ƒæ˜¯Linux Ubuntu 22.04.4 LTS æ“ä½œç³»ç»Ÿï¼Œå…¶å®ƒå®‰è£…æ–¹å¼è§å®‰è£…ä»‹ç» sudo apt install lsb-release curl gpg curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg echo \"deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/redis.list sudo apt-get update sudo apt-get install redis Linux Centos å®‰è£…æ–¹å¼ $ yum install redis -y ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:2:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å¯åŠ¨ Redis root@k8s-master01:~/redis# redis-server 9204:C 17 Jul 2024 17:47:22.376 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 9204:C 17 Jul 2024 17:47:22.377 * Redis version=7.2.5, bits=64, commit=00000000, modified=0, pid=9204, just started 9204:C 17 Jul 2024 17:47:22.377 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf 9204:M 17 Jul 2024 17:47:22.377 * Increased maximum number of open files to 10032 (it was originally set to 1024). 9204:M 17 Jul 2024 17:47:22.377 * monotonic clock: POSIX clock_gettime _._ _.-``__ ''-._ _.-`` `. `_. ''-._ Redis 7.2.5 (00000000/0) 64 bit .-`` .-```. ```\\/ _.,_ ''-._ ( ' , .-` | `, ) Running in standalone mode |`-._`-...-` __...-.``-._|'` _.-'| Port: 6379 | `-._ `._ / _.-' | PID: 9204 `-._ `-._ `-./ _.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | https://redis.io `-._ `-._`-.__.-'_.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | `-._ `-._`-.__.-'_.-' _.-' `-._ `-.__.-' _.-' `-._ _.-' `-.__.-' 9204:M 17 Jul 2024 17:47:22.378 # Warning: Could not create server TCP listening socket *:6379: bind: Address already in use 9204:M 17 Jul 2024 17:47:22.378 # Failed listening on port 6379 (tcp), aborting. root@k8s-master01:~/redis# netstat -anp|grep 6379 tcp 0 0 127.0.0.1:6379 0.0.0.0:* LISTEN 8799/redis-server 1 tcp6 0 0 ::1:6379 :::* LISTEN 8799/redis-server 1 å®¢æˆ·ç«¯å‘½ä»¤è¿æ¥redis æœåŠ¡ï¼Œå¹¶é€šè¿‡å‘½ä»¤æ“ä½œredis root@k8s-master01:~/redis# redis-cli 127.0.0.1:6379\u003e set key1 value1 OK 127.0.0.1:6379\u003e get key1 \"value1\" å¤‡æ³¨ï¼šå¦‚æœè®¾ç½®çš„é”®ä¸­æœ‰ä¸­æ–‡æŸ¥çœ‹æ—¶æ˜¯è¿”å›çš„äºŒè¿›åˆ¶ï¼Œéœ€è¦ä½¿ç”¨redis-cli --raw ç™»å½• ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:2:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å›¾å½¢åŒ–å·¥å…·RedisInsight ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:2:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"ä½¿ç”¨æ–¹å¼ CLI å‘½ä»¤è¡Œ API (Application Programming interface) GUI (Graphical User Interface) ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:2:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å¸¸ç”¨å‘½ä»¤ redis çš„ä½¿ç”¨å‘½ä»¤å¾ˆå¤š,è¿™é‡Œé‡ç‚¹ä»‹ç»å‡ ç§å¸¸ç”¨çš„å‘½ä»¤ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Key Commands SET key value #: set a key to a value GET key #: get the value of a key (string only) DEL key #: delete a key EXPIRE key seconds #: set a timeout on a key TTL key #: get the remaining time to live of a key KEYS pattern #: find all keys matching a pattern SCAN cursor [MATCH pattern] [COUNT count] [TYPE type] #: iterate over keys with a cursor ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"String Commands APPEND key value #: append a value to a key STRLEN key #: get the length of the value of a key INCR key #: increment the value of a key by 1 DECR key #: decrement the value of a key by 1 INCRBY key increment #: increment the value of a key by a specified amount DECRBY key decrement #: decrement the value of a key by a specified amount ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Hash Commands HSET key field value #: set a field in a hash to a value HGET key field #: get the value of a field in a hash HDEL key field [field â€¦] #: delete one or more fields from a hash HGETALL key #: get all fields and values from a hash HKEYS key #: get all fields from a hash HVALS key #: get all values from a hash HEXISTS key field #: check if a field exists in a hash HLEN key #: get the number of fields in a hash hash å‘½ä»¤å®é™…ä½¿ç”¨æ–¹å¼ # Initialize the hash HMSET user name \"John Doe\" age 30 email \"lushuan2071@126.com\" # Get the value of a field HGET user name # Output: \"John Doe\" # Get the values of multiple fields HMGET user name age # Output: 1) \"John Doe\" 2) \"30\" # Get all fields and values HGETALL user # Output: 1) \"name\" 2) \"John Doe\" 3) \"age\" 4) \"30\" 5) \"email\" 6) \"johndoe@example.com\" # Get all fields HKEYS user # Output: 1) \"name\" 2) \"age\" 3) \"email\" # Get all values HVALS user # Output: 1) \"John Doe\" 2) \"30\" 3) \"johndoe@example.com\" # Get the number of fields HLEN user # Output: 3 # Modify a field HSET user age 31 HGET user age # Output: \"31\" # Increment a field HINCRBY user age 1 HGET user age # Output: \"32\" # Delete a field HDEL user email HKEYS user # Output: 1) \"name\" 2) \"age\" ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"List Commands LPUSH key value [value â€¦] #: prepend one or more values to a list RPUSH key value [value â€¦] #: append one or more values to a list LPOP key #: remove and return the first element of a list RPOP key #: remove and return the last element of a list LINDEX key index #: get the element at a specified index in a list LLEN key #: get the length of a list LRANGE key start stop #: get a range of elements from a list LREM key count value #: remove a specified number of occurrences of a value from a list list ä½¿ç”¨å®ä¾‹ # Initialize the list LPUSH numbers 3 2 1 # Get the length of the list LLEN numbers # Output: 3 # Get an element by index LINDEX numbers 1 # Output: \"2\" # Get a range of elements LRANGE numbers 0 1 # Output: 1) \"1\" 2) \"2\" # Append an element RPUSH numbers 4 LRANGE numbers 0 -1 # Output: 1) \"1\" 2) \"2\" 3) \"3\" 4) \"4\" # Pop an element LPOP numbers # Output: \"1\" RPOP numbers # Output: \"4\" LRANGE numbers 0 -1 # Output: 1) \"2\" 2) \"3\" # Insert an element LINSERT numbers BEFORE 2 1 LRANGE numbers 0 -1 # Output: 1) \"1\" 2) \"2\" 3) \"3\" # Remove an element LREM numbers 1 2 LRANGE numbers 0 -1 # Output: 1) \"1\" 2) \"3\" # Trim the list LTRIM numbers 0 0 LRANGE numbers 0 -1 # Output: 1) \"1\" ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:4","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Set Commands SADD key member [member â€¦] #: add one or more members to a set SREM key member [member â€¦] #: remove one or more members from a set SMEMBERS key #: get all members of a set SISMEMBER key member #: check if a member exists in a set SINTER key [key â€¦] #: get the intersection of sets SUNION key [key â€¦] #: get the union of sets Set ä½¿ç”¨å®ä¾‹ï¼Œæ³¨æ„ï¼Œç”±äºsetä¸æ˜¯æœ‰åºæ•°æ®ç±»å‹ï¼Œæ‰€ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶ï¼Œé¡¹çš„é¡ºåºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ: # Initialize the set SADD fruits apple banana orange # Get the number of elements in the set SCARD fruits # Output: 3 # Check if an element is a member of the set SISMEMBER fruits apple # Output: 1 (true) # Get all members of the set SMEMBERS fruits # Output: 1) \"apple\" 2) \"banana\" 3) \"orange\" # Remove an element from the set SREM fruits banana SMEMBERS fruits # Output: 1) \"apple\" 2) \"orange\" # Add multiple elements to the set SADD fruits pear peach SMEMBERS fruits # Output: 1) \"apple\" 2) \"orange\" 3) \"pear\" 4) \"peach\" # Get the intersection of multiple sets SADD fruits2 orange kiwi SINTER fruits fruits2 # Output: 1) \"orange\" # Get the union of multiple sets SUNION fruits fruits2 # Output: 1) \"apple\" 2) \"orange\" 3) \"pear\" 4) \"peach\" 5) \"kiwi\" # Get a random element from the set SRANDMEMBER fruits # Output: \"pear\" ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:5","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Sorted Set Commands ZADD key score member [score member â€¦] #: add one or more members with scores to a sorted set ZREM key member [member â€¦] #: remove one or more members from a sorted set ZRANGE key start stop [WITHSCORES] #: The order of elements is from the lowest to the highest score. Elements with the same score are ordered lexicographically. ZREVRANGE key start stop [WITHSCORES] #: Returns the specified range of elements in the sorted set stored at key. The elements are considered to be ordered from the highest to the lowest score. ZSCORE key member #: get the score of a member in a sorted set å®ä¾‹ # Initialize the sorted set ZADD scores 90 \"Alice\" 85 \"Bob\" 95 \"Charlie\" # Get the number of elements in the sorted set ZCARD scores # Output: 3 # Get the rank of an element ZRANK scores \"Charlie\" # Output: 2 # Get the score of an element ZSCORE scores \"Bob\" # Output: 85 # Get a range of elements by rank ZRANGE scores 0 1 # Output: 1) \"Bob\" 2) \"Alice\" # Get a range of elements by score ZRANGEBYSCORE scores 90 95 # Output: 1) \"Alice\" 2) \"Charlie\" # Increment the score of an element ZINCRBY scores 10 \"Alice\" ZSCORE scores \"Alice\" # Output: 100 # Remove an element from the sorted set ZREM scores \"Bob\" ZRANGE scores 0 -1 # Output: 1) \"Charlie\" 2) \"Alice\" # Get the highest-scoring element(s) ZREVRANGE scores 0 0 # Output: 1) \"Alice\" ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:3:6","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"åå¤§æ•°æ®æ¨¡å‹ redis åˆå§‹åŒ–ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæ›´å¤šæ•°æ®ç±»å‹å¯ä»¥æŸ¥çœ‹å®˜ç½‘ä»‹ç» redis-datatype\r# String SET key value SET name \"John Doe\" # List RPUSH key element [element ...] RPUSH numbers 1 2 3 4 5 # Set SADD key member [member ...] SADD colors red green blue # Hash HSET key field value [field value ...] HSET user id 1 name \"John Doe\" email \"john.doe@example.com\" # Sorted set ZADD key score member [score member ...] ZADD scores 90 \"John Doe\" 80 \"Jane Doe\" 95 \"Bob Smith\" ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:4:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"5ç§åŸºæœ¬æ•°æ®ç±»å‹ é¦–å…ˆå¯¹redisæ¥è¯´ï¼Œæ‰€æœ‰çš„keyï¼ˆé”®ï¼‰éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬åœ¨è°ˆåŸºç¡€æ•°æ®ç»“æ„æ—¶ï¼Œè®¨è®ºçš„æ˜¯å­˜å‚¨å€¼çš„æ•°æ®ç±»å‹ï¼Œä¸»è¦åŒ…æ‹¬å¸¸è§çš„5ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šStringã€Listã€Setã€Zsetã€Hashã€‚ redis datatype common in use\rç»“æ„ç±»å‹ ç»“æ„å­˜å‚¨çš„å€¼ ç»“æ„çš„è¯»å†™èƒ½åŠ› Stringå­—ç¬¦ä¸² å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•° å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼›å¯¹æ•´æ•°æˆ–æµ®ç‚¹æ•°è¿›è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œï¼› Liståˆ—è¡¨ ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸² å¯¹é“¾è¡¨çš„ä¸¤ç«¯è¿›è¡Œpushå’Œpopæ“ä½œï¼Œè¯»å–å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–åˆ é™¤å…ƒç´ ï¼› Seté›†åˆ åŒ…å«å­—ç¬¦ä¸²çš„æ— åºé›†åˆ å­—ç¬¦ä¸²çš„é›†åˆï¼ŒåŒ…å«åŸºç¡€çš„æ–¹æ³•æœ‰çœ‹æ˜¯å¦å­˜åœ¨æ·»åŠ ã€è·å–ã€åˆ é™¤ï¼›è¿˜åŒ…å«è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰ Hashæ•£åˆ— åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´  Zsetæœ‰åºé›†åˆ å’Œæ•£åˆ—ä¸€æ ·ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ å­—ç¬¦ä¸²æˆå‘˜ä¸æµ®ç‚¹æ•°åˆ†æ•°ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼›å…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†æ•°çš„å¤§å°å†³å®šï¼›åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ä»¥åŠæ ¹æ®åˆ†å€¼èŒƒå›´æˆ–æˆå‘˜æ¥è·å–å…ƒç´  Stringå­—ç¬¦ä¸² Stringæ˜¯redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚ Stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ„æ€æ˜¯ redis çš„ string å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚å¦‚æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œjpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ Liståˆ—è¡¨ Redisä¸­çš„Listå…¶å®å°±æ˜¯é“¾è¡¨ï¼ˆRedisç”¨åŒç«¯é“¾è¡¨å®ç°Listï¼‰ã€‚ ä½¿ç”¨Listç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®ç°æœ€æ–°æ¶ˆæ¯æ’é˜ŸåŠŸèƒ½ï¼ˆæ¯”å¦‚æ–°æµªå¾®åšçš„TimeLineï¼‰ã€‚Listçš„å¦ä¸€ä¸ªåº”ç”¨å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥åˆ©ç”¨Listçš„ PUSH æ“ä½œï¼Œå°†ä»»åŠ¡å­˜æ”¾åœ¨Listä¸­ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å†ç”¨ POP æ“ä½œå°†ä»»åŠ¡å–å‡ºè¿›è¡Œæ‰§è¡Œã€‚ Set é›†åˆ Redis çš„ Set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ã€‚ Redis ä¸­é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚ Hash æ•£åˆ— Redis hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ fieldï¼ˆå­—æ®µï¼‰ å’Œ valueï¼ˆå€¼ï¼‰ çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ Zsetæœ‰åºé›†åˆ Redis æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·ä¹Ÿæ˜¯ string ç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ª double ç±»å‹çš„åˆ†æ•°ã€‚redis æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚ æœ‰åºé›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„, ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚æœ‰åºé›†åˆæ˜¯é€šè¿‡ä¸¤ç§æ•°æ®ç»“æ„å®ç°ï¼š ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:4:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"5ç§é«˜çº§æ•°æ®ç±»å‹ æ¶ˆæ¯é˜Ÿåˆ— Stream åœ°ç†ç©ºé—´ Geospatial HyperLogLog æ˜¯ä¸€ç§ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³• Bitmap å³ä½å›¾æ•°æ®ç»“æ„ï¼Œéƒ½æ˜¯æ“ä½œäºŒè¿›åˆ¶ä½æ¥è¿›è¡Œè®°å½•ï¼Œåªæœ‰0 å’Œ 1 ä¸¤ä¸ªçŠ¶æ€ ä½åŸŸ Bitfield ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:4:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"äº‹åŠ¡ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:5:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"ä»€ä¹ˆæ˜¯ Redis äº‹åŠ¡ Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:5:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤å’Œä½¿ç”¨ MULTI ï¼šå¼€å¯äº‹åŠ¡ï¼Œredisä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨EXECå‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ—ã€‚ EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤ã€‚ DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚ WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey,å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚ UNWATCHï¼šå–æ¶ˆWATCHå¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:5:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å®ä¾‹ 127.0.0.1:6379\u003e MULTI OK 127.0.0.1:6379(TX)\u003e SET key1 1 QUEUED 127.0.0.1:6379(TX)\u003e SET key2 2 QUEUED 127.0.0.1:6379(TX)\u003e EXEC OK OK 127.0.0.1:6379\u003e GET key1 1 ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:5:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"æ•°æ®æŒä¹…åŒ– ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ä»¥åŠæœåŠ¡é‡å¯æ—¶èƒ½å¤Ÿæ¢å¤æ•°æ®ï¼ŒRedisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯RDBå’ŒAOF; å½“ç„¶å®é™…åœºæ™¯ä¸‹è¿˜ä¼šä½¿ç”¨è¿™ä¸¤ç§çš„æ··åˆæ¨¡å¼ã€‚ RDB(Redis Database) AOF(Append Only File) ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:6:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"RDB RDB å°±æ˜¯ Redis DataBase çš„ç¼©å†™ï¼Œä¸­æ–‡åä¸ºå¿«ç…§/å†…å­˜å¿«ç…§ï¼ŒRDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„è¿‡ç¨‹ï¼Œç”±äºæ˜¯æŸä¸€æ—¶åˆ»çš„å¿«ç…§ï¼Œé‚£ä¹ˆå¿«ç…§ä¸­çš„å€¼è¦æ—©äºæˆ–è€…ç­‰äºå†…å­˜ä¸­çš„å€¼ã€‚ å¯ä»¥ç†è§£ä¸ºæ•°æ®çš„å¿«ç…§æœºåˆ¶ï¼Œæ˜¯æŸä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šæ•°æ®çš„å®Œæ•´å‰¯æœ¬ï¼Œå°±æ˜¯å®šæ—¶æˆ–è€…æ‰‹åŠ¨çš„ç»™æ•°æ®åšä¸€ä¸‹å¿«ç…§ï¼Œæ‰€ä»¥è§¦å‘æ–¹å¼æœ‰ä¸¤ç§ï¼Œå®šæ—¶æˆ–è€…æ‰‹åŠ¨è§¦å‘ åœ¨æŸä¸ªå¿«ç…§æ—¶é—´ç‚¹ä¿®æ”¹è¿‡çš„æ•°æ®å°±ä¼šä¸¢å¤±æ‰ï¼Œæ‰€ä»¥RDB æ›´é€‚åˆç”¨æ¥åšå¤‡ä»½ Redisä¸­é»˜è®¤çš„å‘¨æœŸæ–°è®¾ç½® # å‘¨æœŸæ€§æ‰§è¡Œæ¡ä»¶çš„è®¾ç½®æ ¼å¼ä¸º save \u003cseconds\u003e \u003cchanges\u003e # é»˜è®¤çš„è®¾ç½®ä¸ºï¼š save 900 1 save 300 10 save 60 10000 # ä»¥ä¸‹è®¾ç½®æ–¹å¼ä¸ºå…³é—­RDBå¿«ç…§åŠŸèƒ½ save \"\" å®ä¾‹ xxd æ˜¯linux æŸ¥çœ‹äºŒè¿›åˆ¶æˆ–è€…16è¿›åˆ¶çš„æ–‡ä»¶å†…å®¹çš„å‘½ä»¤ï¼Œrdbå¤‡ä»½æ–‡ä»¶é»˜è®¤ç›®å½•æ˜¯/var/lib/redis/ root@k8s-master01:/etc/redis# redis-cli 127.0.0.1:6379\u003e set name lushuan OK 127.0.0.1:6379\u003e save OK 127.0.0.1:6379\u003e exit root@k8s-master01:/etc/redis# cd /var/lib/redis/ root@k8s-master01:/var/lib/redis# ls dump.rdb root@k8s-master01:/var/lib/redis# xxd dump.rdb 00000000: 5245 4449 5330 3031 31fa 0972 6564 6973 REDIS0011..redis 00000010: 2d76 6572 0537 2e32 2e35 fa0a 7265 6469 -ver.7.2.5..redi 00000020: 732d 6269 7473 c040 fa05 6374 696d 65c2 s-bits.@..ctime. 00000030: ffd0 9766 fa08 7573 6564 2d6d 656d c220 ...f..used-mem. 00000040: 7812 00fa 0861 6f66 2d62 6173 65c0 00fe x....aof-base... 00000050: 00fb 0600 0007 636f 7572 7365 321b 4859 ......course2.HY 00000060: 4c4c 0100 0000 0300 0000 0000 0000 6821 LL............h! 00000070: 8048 6c80 4366 844c 0600 0663 6f75 7273 .Hl.Cf.L...cours 00000080: 6524 4859 4c4c 0100 0000 0400 0000 0000 e$HYLL.......... 00000090: 0080 4303 8442 5284 4af7 8057 cf80 486c ..C..BR.J..W..Hl 000000a0: 8043 6684 4c06 0004 6e61 6d65 076c 7573 .Cf.L...name.lus 000000b0: 6875 616e 0006 7265 7375 6c74 2448 594c huan..result$HYL 000000c0: 4c01 0000 0006 0000 0000 0000 0043 0384 L............C.. 000000d0: 4252 844a f780 57cf 8048 6c80 4366 844c BR.J..W..Hl.Cf.L 000000e0: 0600 046b 6579 32c0 0200 046b 6579 31c0 ...key2....key1. 000000f0: 01ff 7d49 6715 3957 c40c ..}Ig.9W.. root@k8s-master01:/var/lib/redis# è§¦å‘æ–¹å¼ saveå‘½ä»¤ï¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜ æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´é˜»å¡ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ bgsaveå‘½ä»¤ï¼šRedisè¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ç”±å­ è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨forké˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­ RDB ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ RDBæ–‡ä»¶æ˜¯æŸä¸ªæ—¶é—´èŠ‚ç‚¹çš„å¿«ç…§ï¼Œé»˜è®¤ä½¿ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©åçš„æ–‡ä»¶ä½“ç§¯è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé€‚ç”¨äºå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ï¼› RedisåŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®è¦è¿œè¿œå¿«äºAOFæ–¹å¼ï¼› ç¼ºç‚¹ RDBæ–¹å¼å®æ—¶æ€§ä¸å¤Ÿï¼Œæ— æ³•åšåˆ°ç§’çº§çš„æŒä¹…åŒ–ï¼› æ¯æ¬¡è°ƒç”¨bgsaveéƒ½éœ€è¦forkå­è¿›ç¨‹ï¼Œforkå­è¿›ç¨‹å±äºé‡é‡çº§æ“ä½œï¼Œé¢‘ç¹æ‰§è¡Œæˆæœ¬è¾ƒé«˜ï¼› RDBæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ²¡æœ‰å¯è¯»æ€§ï¼ŒAOFæ–‡ä»¶åœ¨äº†è§£å…¶ç»“æ„çš„æƒ…å†µä¸‹å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æˆ–è€…è¡¥å…¨ï¼› ç‰ˆæœ¬å…¼å®¹RDBæ–‡ä»¶é—®é¢˜ï¼› é’ˆå¯¹RDBä¸é€‚åˆå®æ—¶æŒä¹…åŒ–çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFæŒä¹…åŒ–æ–¹å¼æ¥è§£å†³ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:6:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"AOF Redisæ˜¯â€œå†™åâ€æ—¥å¿—ï¼ŒRediså…ˆæ‰§è¡Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—ã€‚æ—¥å¿—é‡Œè®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜ã€‚PS: å¤§å¤šæ•°çš„æ•°æ®åº“é‡‡ç”¨çš„æ˜¯å†™å‰æ—¥å¿—ï¼ˆWALï¼‰ï¼Œä¾‹å¦‚MySQLï¼Œé€šè¿‡å†™å‰æ—¥å¿—å’Œä¸¤é˜¶æ®µæäº¤ï¼Œå®ç°æ•°æ®å’Œé€»è¾‘çš„ä¸€è‡´æ€§ã€‚ ä¸ºäº†è§£å†³RDB åœ¨å¿«ç…§æ—¶é˜»å¡æœåŠ¡çŠ¶æ€ï¼Œå³ä¾¿æ˜¯RDB çš„bgsave forkä¸€ä¸ªå­è¿›ç¨‹å¤‡ä»½æ—¶æ—¶é—´å¾ˆçŸ­ï¼Œä¸è¿‡åœ¨è¿™å¾ˆçŸ­çš„æ—¶é—´å†…redis è¿˜æ˜¯ä¸èƒ½å¤„ç†ä»»ä½•è¯·æ±‚ï¼Œæ— æ³•åšåˆ°ç§’çº§çš„å¿«ç…§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨AOF(è¿½åŠ æ–‡ä»¶)çš„æŒä¹…åŒ–æ–¹å¼ã€‚ å½“å¼€å¯AOF redis é‡å¯åä¼šå…ˆä»ç£ç›˜ä¸Šè¯»å–AOF æŒä¹…åŒ–çš„æ•°æ®è‡³å†…å­˜ä¸­ã€‚ è™½ç„¶ bgsave æ‰§è¡Œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€ï¼š ä¸€æ–¹é¢ï¼Œé¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå¤šä¸ªå¿«ç…§ç«äº‰æœ‰é™çš„ç£ç›˜å¸¦å®½ï¼Œå‰ä¸€ä¸ªå¿«ç…§è¿˜æ²¡æœ‰åšå®Œï¼Œåä¸€ä¸ªåˆå¼€å§‹åšäº†ï¼Œå®¹æ˜“é€ æˆæ¶æ€§å¾ªç¯ã€‚ å¦ä¸€æ–¹é¢ï¼Œbgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåä¸ä¼šå†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œfork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Šå¤§ï¼Œé˜»å¡æ—¶é—´è¶Šé•¿ã€‚å¦‚æœé¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹é˜»å¡ä¸»çº¿ç¨‹äº†ã€‚ é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆå…¶ä»–å¥½æ–¹æ³•å—ï¼Ÿæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšå¢é‡å¿«ç…§ï¼Œå°±æ˜¯æŒ‡åšäº†ä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§åªå¯¹ä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€ã€‚è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚ ä½†æ˜¯å®ƒéœ€è¦æˆ‘ä»¬ä½¿ç”¨é¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯å»è®°å½•å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„ç©ºé—´å¼€é”€é—®é¢˜ã€‚é‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•æ—¢èƒ½åˆ©ç”¨ RDB çš„å¿«é€Ÿæ¢å¤ï¼Œåˆèƒ½ä»¥è¾ƒå°çš„å¼€é”€åšåˆ°å°½é‡å°‘ä¸¢æ•°æ®å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å…¥RDBå’ŒAOFçš„æ··åˆæ–¹å¼è§£å†³æ–¹æ¡ˆäº†ã€‚ redis.confä¸­é…ç½®AOF é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæ˜¯æ²¡æœ‰å¼€å¯AOFçš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®redis.confæ–‡ä»¶æ¥å¼€å¯AOFæŒä¹…åŒ–ï¼Œå…³äºAOFçš„é…ç½®å¦‚ä¸‹ï¼š # appendonlyå‚æ•°å¼€å¯AOFæŒä¹…åŒ– appendonly no # AOFæŒä¹…åŒ–çš„æ–‡ä»¶åï¼Œé»˜è®¤æ˜¯appendonly.aof appendfilename \"appendonly.aof\" # AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡dirå‚æ•°è®¾ç½®çš„ dir ./ # åŒæ­¥ç­–ç•¥ # appendfsync always appendfsync everysec # appendfsync no # aofé‡å†™æœŸé—´æ˜¯å¦åŒæ­¥ no-appendfsync-on-rewrite no # é‡å†™è§¦å‘é…ç½® auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb # åŠ è½½aofå‡ºé”™å¦‚ä½•å¤„ç† aof-load-truncated yes # æ–‡ä»¶é‡å†™ç­–ç•¥ aof-rewrite-incremental-fsync yes ä»¥ä¸‹æ˜¯Redisä¸­å…³äºAOFçš„ä¸»è¦é…ç½®ä¿¡æ¯ï¼š appendonlyï¼šé»˜è®¤æƒ…å†µä¸‹AOFåŠŸèƒ½æ˜¯å…³é—­çš„ï¼Œå°†è¯¥é€‰é¡¹æ”¹ä¸ºyesä»¥ä¾¿æ‰“å¼€Redisçš„AOFåŠŸèƒ½ã€‚- - â€“ â€” appendfilenameï¼šè¿™ä¸ªå‚æ•°é¡¹å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯AOFæ–‡ä»¶çš„åå­—ã€‚ appendfsyncï¼šè¿™ä¸ªå‚æ•°é¡¹æ˜¯AOFåŠŸèƒ½æœ€é‡è¦çš„è®¾ç½®é¡¹ä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºè®¾ç½®â€œçœŸæ­£æ‰§è¡Œâ€æ“ä½œå‘½ä»¤å‘AOFæ–‡ä»¶ä¸­åŒæ­¥çš„ç­–ç•¥ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:6:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"RDBå’ŒAOFæ··åˆæ–¹å¼ Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ªæ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚ è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:6:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"ä¸»ä»å¤åˆ¶ æˆ‘ä»¬çŸ¥é“è¦é¿å…å•ç‚¹æ•…éšœï¼Œå³ä¿è¯é«˜å¯ç”¨ï¼Œä¾¿éœ€è¦å†—ä½™ï¼ˆå‰¯æœ¬ï¼‰æ–¹å¼æä¾›é›†ç¾¤æœåŠ¡ã€‚è€ŒRedis æä¾›äº†ä¸»ä»åº“æ¨¡å¼ï¼Œä»¥ä¿è¯æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚æœ¬æ–‡ä¸»è¦é˜è¿°Redisçš„ä¸»ä»å¤åˆ¶ã€‚ ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚ ä¸»ä»å¤åˆ¶çš„ä½œç”¨ä¸»è¦åŒ…æ‹¬ï¼š æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚ æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚ è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœ- åŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚ ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚ è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼› å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚ redis è¯»å†™åˆ†ç¦»\rè¿™é‡Œåœ¨åŒä¸€å°ä¸»æœºä¸Šæ¼”ç¤ºï¼Œå¤‡ä»½redis.conf ä¸ºredis-6380.confï¼Œä¿®æ”¹ä»¥ä¸‹å››ä¸ªé…ç½®é¡¹ port 6380 ... ... pidfile /var/run/reids_6380.pid ... ... dbfilename dump-6380.rdb # åœ¨åŒä¸€å°ä¸»æœºåšæµ‹è¯•æ—¶ä½¿ç”¨ ... ... replicaof 127.0.0.1 6379 ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:7:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å¯åŠ¨ä»èŠ‚ç‚¹ redis-server redis-6380.conf å®¢æˆ·ç«¯è¿æ¥ä»èŠ‚ç‚¹,å¯ä»¥çœ‹åˆ°è§’è‰²ä¸ºä»èŠ‚ç‚¹ï¼Œè¿™æ ·è¡¨ç¤ºä¸»ä»é…ç½®å°±æˆåŠŸäº†ã€‚ root@k8s-master01:/etc/redis# redis-cli -p 6380 127.0.0.1:6379\u003e info replication # Replication role:slave ... ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:7:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰ åœ¨ä¸Šæ–‡ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œå¦‚æœä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ åœ¨ Redis ä¸»ä»é›†ç¾¤ä¸­ï¼Œå“¨å…µæœºåˆ¶æ˜¯å®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢çš„å…³é”®æœºåˆ¶ï¼Œå®ƒæœ‰æ•ˆåœ°è§£å†³äº†ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹æ•…éšœè½¬ç§»çš„é—®é¢˜ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:8:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰ Redis Sentinelï¼Œå³Rediså“¨å…µï¼Œåœ¨Redis 2.8ç‰ˆæœ¬å¼€å§‹å¼•å…¥ã€‚å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚ å“¨å…µé›†ç¾¤ç›‘æ§çš„é€»è¾‘å›¾ï¼š redis å“¨å…µæœºåˆ¶\rå“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿä¸‹é¢æ˜¯Rediså®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š ç›‘æ§ï¼ˆMonitoringï¼‰ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚ é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚ é€šçŸ¥ï¼ˆNotificationï¼‰ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å…¶ä¸­ï¼Œç›‘æ§å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œä½¿å¾—å“¨å…µå¯ä»¥åŠæ—¶å‘ç°ä¸»èŠ‚ç‚¹æ•…éšœå¹¶å®Œæˆè½¬ç§»ï¼›è€Œé…ç½®æä¾›è€…å’Œé€šçŸ¥åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’ä¸­æ‰èƒ½ä½“ç°ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:8:1","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å“¨å…µé›†ç¾¤çš„ç»„å»º ä¸Šå›¾ä¸­å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„ä»¶çš„å‘¢ï¼Ÿå“¨å…µå®ä¾‹ä¹‹é—´å¯ä»¥ç›¸äº’å‘ç°ï¼Œè¦å½’åŠŸäº Redis æä¾›çš„ pub/sub æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒ / è®¢é˜…æœºåˆ¶ã€‚ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:8:2","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å¯åŠ¨å“¨å…µèŠ‚ç‚¹ sentinel.conf,æ¨¡æ‹Ÿè¿˜æ˜¯å½“å‰ä¸»æœºä¸‹ sentinel monitor master 127.0.0.1 6379 å¯åŠ¨å“¨å…µèŠ‚ç‚¹ï¼Œä¼šä»¥å“¨å…µæ¨¡å¼è¿›è¡Œå¯åŠ¨ redis-sentinel sentinel.conf æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦ä¸‰ä¸ªå“¨å…µèŠ‚ç‚¹ ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:8:3","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["Redis"],"content":"å‚è€ƒ https://redis.io/docs/latest/develop/ https://www.redis.net.cn/ Redis è®¾è®¡ä¸å®ç° https://datmt.com/backend/redis-command-cheatsheet/ https://pdai.tech/md/db/nosql-redis/db-redis-overview.html ","date":"2022-04-19","objectID":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/:9:0","tags":["Redis"],"title":"Redis çŸ¥è¯†ä½“ç³»","uri":"/redis%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"},{"categories":["linux"],"content":"netstat netstatæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å‘½ä»¤è¡Œç½‘ç»œå·¥å…·ï¼Œç”¨äºæ˜¾ç¤ºä¸ç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨å’Œç½‘ç»œæ¥å£ç›¸å…³çš„ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„netstatå‘½ä»¤ï¼š netstat -tunlpï¼šæ˜¾ç¤ºæ‰€æœ‰TCPå’ŒUDPç«¯å£çš„ç›‘å¬æƒ…å†µï¼Œä»¥åŠå¯¹åº”çš„è¿›ç¨‹ä¿¡æ¯ã€‚ netstat -tulnï¼šæ˜¾ç¤ºæ‰€æœ‰TCPç«¯å£çš„ç›‘å¬æƒ…å†µï¼ŒåŒ…æ‹¬æœ¬åœ°åœ°å€ã€å¤–éƒ¨åœ°å€å’ŒçŠ¶æ€ã€‚ netstat -aï¼šæ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨çš„ç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬ç›‘å¬å’Œéç›‘å¬çŠ¶æ€ã€‚ netstat -rï¼šæ˜¾ç¤ºè·¯ç”±è¡¨ï¼ŒåŒ…æ‹¬ç›®æ ‡åœ°å€ã€ç½‘å…³ã€å­ç½‘æ©ç å’Œæ¥å£ã€‚ netstat -sï¼šæ˜¾ç¤ºç½‘ç»œç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¼ è¾“çš„æ•°æ®åŒ…æ•°é‡ã€é”™è¯¯æ•°é‡å’Œä¸¢å¤±æ•°é‡ç­‰ã€‚ netstat -iï¼šæ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£åç§°ã€MACåœ°å€ã€IPåœ°å€å’ŒçŠ¶æ€ç­‰ã€‚ netstat -cï¼šæŒç»­è¾“å‡ºç½‘ç»œè¿æ¥çš„ä¿¡æ¯ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´åˆ·æ–°ä¸€æ¬¡ã€‚ ","date":"2022-03-29","objectID":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/:1:0","tags":["linux"],"title":"Linux ç½‘ç»œæ’éšœ","uri":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/"},{"categories":["linux"],"content":"sar sarï¼ˆSystem Activity Reporterï¼‰æ˜¯ä¸€ä¸ªæ€§èƒ½ç›‘æ§å·¥å…·ï¼Œå®ƒå¯ä»¥æä¾›ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µçš„å†å²æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„sarå‘½ä»¤å’Œç›¸åº”çš„ä½¿ç”¨åœºæ™¯ï¼š sar -uï¼šæ˜¾ç¤ºCPUä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šäº†è§£ç³»ç»ŸCPUçš„å¹³å‡è´Ÿè½½ã€ç”¨æˆ·ç©ºé—´CPUä½¿ç”¨ç‡ã€ç³»ç»Ÿç©ºé—´CPUä½¿ç”¨ç‡ï¼Œä»¥åŠç­‰å¾…I/Oçš„CPUä½¿ç”¨ç‡ã€‚ sar -rï¼šæ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹ä¸»è¦çš„å†…å­˜æŒ‡æ ‡ï¼Œå¦‚æ€»å†…å­˜ã€å¯ç”¨å†…å­˜ã€å†…å­˜åˆ©ç”¨ç‡ã€ç¼“å­˜å’Œç¼“å†²åŒºã€‚ sar -n DEVï¼šæ˜¾ç¤ºç½‘ç»œæ¥å£çš„æ•°æ®ä¼ è¾“æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šç›‘æµ‹ç½‘ç»œæµé‡ã€å¸¦å®½ä½¿ç”¨æƒ…å†µï¼Œè¯†åˆ«ç½‘ç»œç“¶é¢ˆã€‚ sar -qï¼šæ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šé€šè¿‡è§‚å¯Ÿå¹³å‡è´Ÿè½½ã€è¿è¡Œé˜Ÿåˆ—é•¿åº¦å’Œå°±ç»ªè¿›ç¨‹æ•°ï¼Œäº†è§£ç³»ç»Ÿæ€§èƒ½å’Œè´Ÿè½½æƒ…å†µã€‚ sar -bï¼šæ˜¾ç¤ºç³»ç»Ÿçš„I/Oä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šç›‘æµ‹ç£ç›˜IOçš„æƒ…å†µï¼ŒåŒ…æ‹¬å—è¯»å†™æ¬¡æ•°ã€å—ä¼ è¾“é€Ÿç‡ï¼ŒæŸ¥æ‰¾ç£ç›˜æ€§èƒ½é—®é¢˜ã€‚ sar -Wï¼šæ˜¾ç¤ºç³»ç»Ÿäº¤æ¢ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚ ä½¿ç”¨åœºæ™¯ï¼šäº†è§£äº¤æ¢ç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œè¯†åˆ«ç³»ç»Ÿå†…å­˜ä¸è¶³å¯¼è‡´çš„äº¤æ¢ç“¶é¢ˆã€‚ sar -dï¼šæ˜¾ç¤ºå—è®¾å¤‡çš„I/Oç»Ÿè®¡ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹å—è®¾å¤‡ï¼ˆç¡¬ç›˜ï¼‰çš„è¯»å†™æ“ä½œã€ä¼ è¾“é€Ÿç‡å’Œè¯·æ±‚é˜Ÿåˆ—é•¿åº¦ã€‚ ","date":"2022-03-29","objectID":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/:2:0","tags":["linux"],"title":"Linux ç½‘ç»œæ’éšœ","uri":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/"},{"categories":["linux"],"content":"Example ç»Ÿè®¡socketsè¿æ¥æ–° sar -n SOCK $ sar -n SOCK 1 1 Linux 4.4.115-1.el7.elrepo.x86_64 (chm) 2022å¹´05æœˆ20æ—¥ _x86_64_ (12 CPU) 14æ—¶05åˆ†40ç§’ totsck tcpsck udpsck rawsck ip-frag tcp-tw 14æ—¶05åˆ†41ç§’ 7725 76 5 0 0 642 å¹³å‡æ—¶é—´: 7725 76 5 0 0 642 totsck å½“å‰è¢«ä½¿ç”¨çš„socketæ€»æ•° tcpsck å½“å‰æ­£åœ¨è¢«ä½¿ç”¨çš„TCPçš„socketæ€»æ•° udpsck å½“å‰æ­£åœ¨è¢«ä½¿ç”¨çš„UDPçš„socketæ€»æ•° rawsck å½“å‰æ­£åœ¨è¢«ä½¿ç”¨äºRAWçš„skcketæ€»æ•° if-frag å½“å‰çš„IPåˆ†ç‰‡çš„æ•°ç›® tcp-tw TCPå¥—æ¥å­—ä¸­å¤„äºTIME-WAITçŠ¶æ€çš„è¿æ¥æ•°é‡ è¿™äº›sarå‘½ä»¤å¯ç”¨äºç›‘æ§ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¸®åŠ©è¯Šæ–­æ€§èƒ½é—®é¢˜å’Œä¼˜åŒ–ç³»ç»Ÿé…ç½®ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒæ•´å‘½ä»¤çš„å‚æ•°æ¥è·å–ç‰¹å®šçš„ç›‘æ§æ•°æ®ï¼Œå¹¶ç»“åˆå…¶ä»–å·¥å…·å’Œå‘½ä»¤è¿›è¡Œç»¼åˆåˆ†æ ","date":"2022-03-29","objectID":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/:2:1","tags":["linux"],"title":"Linux ç½‘ç»œæ’éšœ","uri":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/"},{"categories":["linux"],"content":"telnet telnetæ˜¯ä¸€ä¸ªç”¨äºè¿œç¨‹ç™»å½•å’Œç®¡ç†è¿œç¨‹ä¸»æœºçš„ç½‘ç»œåè®®å’Œå·¥å…·ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„telnetå‘½ä»¤å’Œç›¸åº”çš„ä½¿ç”¨åœºæ™¯ï¼š 1.telnet hostï¼šè¿æ¥åˆ°æŒ‡å®šçš„è¿œç¨‹ä¸»æœºã€‚ ä½¿ç”¨åœºæ™¯ï¼šè¿œç¨‹ç™»å½•åˆ°å…¶ä»–è®¡ç®—æœºï¼Œè¿›è¡Œå‘½ä»¤è¡Œç®¡ç†å’Œæ“ä½œã€‚ 2.telnet host portï¼šè¿æ¥åˆ°æŒ‡å®šä¸»æœºçš„ç‰¹å®šç«¯å£ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæ£€æŸ¥ç‰¹å®šæœåŠ¡çš„å¯ç”¨æ€§ï¼Œå¦‚é€šè¿‡telnetæµ‹è¯•SMTPæœåŠ¡å™¨æ˜¯å¦èƒ½å¤Ÿè¿æ¥ã€‚ 3.Ctrl + ]ï¼šè¿›å…¥telnetæ§åˆ¶å°ã€‚ ä½¿ç”¨åœºæ™¯ï¼šåœ¨telnetä¼šè¯ä¸­ï¼ŒæŒ‰ä¸‹Ctrl + ]é”®åï¼Œå¯ä»¥è¿›å…¥æ§åˆ¶å°ï¼Œæ‰§è¡Œä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œå¦‚ç»ˆæ­¢ä¼šè¯ã€æ›´æ”¹è®¾ç½®ç­‰ã€‚ 4.send stringï¼šå‘é€å­—ç¬¦ä¸²åˆ°è¿œç¨‹ä¸»æœºã€‚ ä½¿ç”¨åœºæ™¯ï¼šåœ¨telnetä¼šè¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨sendå‘½ä»¤å‘é€ç‰¹å®šçš„å­—ç¬¦ä¸²è‡³è¿œç¨‹ä¸»æœºï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥ç­‰æƒ…æ™¯ã€‚ 5.displayæˆ–toggle optionsï¼šæ˜¾ç¤ºæˆ–åˆ‡æ¢é€‰é¡¹çŠ¶æ€ã€‚ ä½¿ç”¨åœºæ™¯ï¼šåœ¨telnetä¼šè¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤æŸ¥çœ‹æˆ–åˆ‡æ¢å½“å‰ä¼šè¯çš„é€‰é¡¹çŠ¶æ€ï¼Œä¾‹å¦‚å›æ˜¾ã€è¡Œç¼–è¾‘ç­‰ã€‚ 6.quitï¼šé€€å‡ºå½“å‰telnetä¼šè¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šåœ¨å®Œæˆtelnetä¼šè¯åï¼Œä½¿ç”¨è¯¥å‘½ä»¤é€€å‡ºå¹¶å…³é—­è¿æ¥ã€‚ telnetå‘½ä»¤å¯ä»¥ç”¨äºè¿œç¨‹ç™»å½•å’Œç®¡ç†è¿œç¨‹ä¸»æœºï¼Œä½†ç”±äºå®‰å…¨æ€§è¾ƒå·®ï¼Œå·²é€æ¸è¢«SSHç­‰æ›´å®‰å…¨çš„åè®®å–ä»£ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®ä½¿ç”¨æ›´åŠ å®‰å…¨çš„è¿œç¨‹è¿æ¥æ–¹æ³•ï¼Œå¦‚SSHï¼ˆSecure Shellï¼‰ã€‚ ","date":"2022-03-29","objectID":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/:3:0","tags":["linux"],"title":"Linux ç½‘ç»œæ’éšœ","uri":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/"},{"categories":["linux"],"content":"ss ssï¼ˆSocket Statisticsï¼‰æ˜¯ä¸€ä¸ªLinuxç³»ç»Ÿä¸­ç”¨äºæ˜¾ç¤ºå½“å‰æ´»åŠ¨å¥—æ¥å­—ï¼ˆsocketï¼‰ä¿¡æ¯çš„å‘½ä»¤ã€‚å®ƒå¯ä»¥æä¾›æ›´è¯¦ç»†å’Œå…¨é¢çš„å¥—æ¥å­—ç»Ÿè®¡æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„sså‘½ä»¤å’Œç›¸åº”çš„ä½¿ç”¨åœºæ™¯ï¼š 1.ss -tï¼šæ˜¾ç¤ºTCPå¥—æ¥å­—ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šçš„TCPè¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ¬åœ°åœ°å€å’Œç«¯å£ã€è¿œç¨‹åœ°å€å’Œç«¯å£ã€è¿æ¥çŠ¶æ€ç­‰ã€‚ 2.ss -uï¼šæ˜¾ç¤ºUDPå¥—æ¥å­—ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šçš„UDPè¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ¬åœ°åœ°å€å’Œç«¯å£ã€è¿œç¨‹åœ°å€å’Œç«¯å£ç­‰ã€‚ 3.ss -lï¼šæ˜¾ç¤ºç›‘å¬å¥—æ¥å­—ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šæ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›‘å¬çš„åè®®ã€æœ¬åœ°åœ°å€å’Œç«¯å£ç­‰ã€‚ 4.ss -pï¼šæ˜¾ç¤ºå¥—æ¥å­—åŠå…¶å…³è”è¿›ç¨‹ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹æ¯ä¸ªå¥—æ¥å­—å¯¹åº”çš„å…³è”è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹IDã€ç”¨æˆ·ã€å‘½ä»¤ç­‰ã€‚ 5.ss -nï¼šä»¥æ•°å­—å½¢å¼å±•ç¤ºå¥—æ¥å­—ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæ˜¾ç¤ºIPåœ°å€å’Œç«¯å£å·æ—¶ä¸è¿›è¡Œåå‘è§£æï¼ŒåŠ å¿«è¾“å‡ºé€Ÿåº¦ã€‚ 6.ss -sï¼šæ˜¾ç¤ºå¥—æ¥å­—ç»Ÿè®¡æ‘˜è¦(åŒ…å«IPv6)ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæ˜¾ç¤ºç³»ç»Ÿçº§åˆ«çš„å¥—æ¥å­—ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰“å¼€çš„å¥—æ¥å­—æ•°ã€æ´»åŠ¨è¿æ¥æ•°ã€ä¾¦å¬å¥—æ¥å­—æ•°ç­‰ã€‚ 7.ss -oï¼šæ˜¾ç¤ºå®šæ—¶å™¨ç›¸å…³ä¿¡æ¯ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæŸ¥çœ‹ç³»ç»Ÿä¸­çš„å®šæ—¶å™¨äº‹ä»¶ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è®¡æ—¶å™¨åç§°ã€è¶…æ—¶æ—¶é—´ã€é‡å¤é—´éš”ç­‰ã€‚ è¿™äº›sså‘½ä»¤å¯ç”¨äºç›‘æ§å’Œè¯Šæ–­ç½‘ç»œè¿æ¥å’Œå¥—æ¥å­—çš„çŠ¶æ€ï¼Œå¸®åŠ©å®šä½ç½‘ç»œé—®é¢˜å¹¶è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ç»“åˆå…¶ä»–å‘½ä»¤å’Œå·¥å…·ï¼ˆå¦‚grepã€netstatç­‰ï¼‰è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æå’Œæ’æŸ¥ã€‚ ","date":"2022-03-29","objectID":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/:4:0","tags":["linux"],"title":"Linux ç½‘ç»œæ’éšœ","uri":"/linux%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/"},{"categories":["Python"],"content":"ä»‹ç» ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:1:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"Python ç®€ä»‹ æ‘˜è¦\rPython æ˜¯ä¸€ä¸ªé«˜å±‚æ¬¡çš„ç»“åˆäº†è§£é‡Šæ€§ã€ç¼–è¯‘æ€§ã€äº’åŠ¨æ€§å’Œé¢å‘å¯¹è±¡çš„è„šæœ¬è¯­è¨€ã€‚ Python çš„è®¾è®¡å…·æœ‰å¾ˆå¼ºçš„å¯è¯»æ€§ï¼Œç›¸æ¯”å…¶ä»–è¯­è¨€ç»å¸¸ä½¿ç”¨è‹±æ–‡å…³é”®å­—ï¼Œå…¶ä»–è¯­è¨€çš„ä¸€äº›æ ‡ç‚¹ç¬¦å·ï¼Œå®ƒå…·æœ‰æ¯”å…¶ä»–è¯­è¨€æ›´æœ‰ç‰¹è‰²è¯­æ³•ç»“æ„ã€‚ Python æ˜¯ä¸€ç§è§£é‡Šå‹è¯­è¨€ï¼š è¿™æ„å‘³ç€å¼€å‘è¿‡ç¨‹ä¸­æ²¡æœ‰äº†ç¼–è¯‘è¿™ä¸ªç¯èŠ‚ã€‚ç±»ä¼¼äºPHPå’ŒPerlè¯­è¨€ã€‚ Python æ˜¯äº¤äº’å¼è¯­è¨€ï¼š è¿™æ„å‘³ç€ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªPythonæç¤ºç¬¦ï¼Œç›´æ¥äº’åŠ¨æ‰§è¡Œå†™ä½ çš„ç¨‹åºã€‚ Python æ˜¯é¢å‘å¯¹è±¡è¯­è¨€: è¿™æ„å‘³ç€Pythonæ”¯æŒé¢å‘å¯¹è±¡çš„é£æ ¼æˆ–ä»£ç å°è£…åœ¨å¯¹è±¡çš„ç¼–ç¨‹æŠ€æœ¯ã€‚ Python æ˜¯åˆå­¦è€…çš„è¯­è¨€ï¼šPython å¯¹åˆçº§ç¨‹åºå‘˜è€Œè¨€ï¼Œæ˜¯ä¸€ç§ä¼Ÿå¤§çš„è¯­è¨€ï¼Œå®ƒæ”¯æŒå¹¿æ³›çš„åº”ç”¨ç¨‹åºå¼€å‘ï¼Œä»ç®€å•çš„æ–‡å­—å¤„ç†åˆ° WWW æµè§ˆå™¨å†åˆ°æ¸¸æˆã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:1:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"Python ç‰¹ç‚¹ ä¿¡æ¯\ræ˜“äºå­¦ä¹ ï¼šPythonæœ‰ç›¸å¯¹è¾ƒå°‘çš„å…³é”®å­—ï¼Œç»“æ„ç®€å•ï¼Œå’Œä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„è¯­æ³•ï¼Œå­¦ä¹ èµ·æ¥æ›´åŠ ç®€å•ã€‚ æ˜“äºé˜…è¯»ï¼šPythonä»£ç å®šä¹‰çš„æ›´æ¸…æ™°ã€‚ æ˜“äºç»´æŠ¤ï¼šPythonçš„æˆåŠŸåœ¨äºå®ƒçš„æºä»£ç æ˜¯ç›¸å½“å®¹æ˜“ç»´æŠ¤çš„ã€‚ ä¸€ä¸ªå¹¿æ³›çš„æ ‡å‡†åº“ï¼šPythonçš„æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯ä¸°å¯Œçš„åº“ï¼Œè·¨å¹³å°çš„ï¼Œåœ¨UNIXï¼ŒWindowså’ŒMacintoshå…¼å®¹å¾ˆå¥½ã€‚ äº’åŠ¨æ¨¡å¼ï¼šäº’åŠ¨æ¨¡å¼çš„æ”¯æŒï¼Œæ‚¨å¯ä»¥ä»ç»ˆç«¯è¾“å…¥æ‰§è¡Œä»£ç å¹¶è·å¾—ç»“æœçš„è¯­è¨€ï¼Œäº’åŠ¨çš„æµ‹è¯•å’Œè°ƒè¯•ä»£ç ç‰‡æ–­ã€‚ å¯ç§»æ¤ï¼šåŸºäºå…¶å¼€æ”¾æºä»£ç çš„ç‰¹æ€§ï¼ŒPythonå·²ç»è¢«ç§»æ¤ï¼ˆä¹Ÿå°±æ˜¯ä½¿å…¶å·¥ä½œï¼‰åˆ°è®¸å¤šå¹³å°ã€‚ å¯æ‰©å±•ï¼šå¦‚æœä½ éœ€è¦ä¸€æ®µè¿è¡Œå¾ˆå¿«çš„å…³é”®ä»£ç ï¼Œæˆ–è€…æ˜¯æƒ³è¦ç¼–å†™ä¸€äº›ä¸æ„¿å¼€æ”¾çš„ç®—æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨Cæˆ–C++å®Œæˆé‚£éƒ¨åˆ†ç¨‹åºï¼Œç„¶åä»ä½ çš„Pythonç¨‹åºä¸­è°ƒç”¨ã€‚ æ•°æ®åº“ï¼šPythonæä¾›æ‰€æœ‰ä¸»è¦çš„å•†ä¸šæ•°æ®åº“çš„æ¥å£ã€‚ GUIç¼–ç¨‹ï¼šPythonæ”¯æŒGUIå¯ä»¥åˆ›å»ºå’Œç§»æ¤åˆ°è®¸å¤šç³»ç»Ÿè°ƒç”¨ã€‚ å¯åµŒå…¥: ä½ å¯ä»¥å°†PythonåµŒå…¥åˆ°C/C++ç¨‹åºï¼Œè®©ä½ çš„ç¨‹åºçš„ç”¨æˆ·è·å¾—\"è„šæœ¬åŒ–\"çš„èƒ½åŠ›ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:1:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å®‰è£… Python 3 Pythonæœ€æ–°æºç ï¼ŒäºŒè¿›åˆ¶æ–‡æ¡£ï¼Œæ–°é—»èµ„è®¯ç­‰å¯ä»¥åœ¨Pythonçš„å®˜ç½‘æŸ¥çœ‹åˆ°ï¼š Pythonå®˜ç½‘ï¼šhttps://www.python.org/ ä½ å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­ä¸‹è½½ Python çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥ä¸‹è½½ HTMLã€PDF å’Œ PostScript ç­‰æ ¼å¼çš„æ–‡æ¡£ã€‚ Pythonæ–‡æ¡£ä¸‹è½½åœ°å€ï¼šhttps://www.python.org/doc/ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:2:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"Window å¹³å°å®‰è£… Python ä»¥ä¸‹ä¸ºåœ¨ Window å¹³å°ä¸Šå®‰è£… Python çš„ç®€å•æ­¥éª¤ï¼š æ‰“å¼€ WEB æµè§ˆå™¨è®¿é—®https://www.python.org/downloads/windows/ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:2:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"è®¾ç½®å¼€å‘ç¯å¢ƒ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:3:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ˆvirtualenv æˆ– venvï¼‰å‘½ä»¤è¡Œ venvï¼ŒPythonå®˜æ–¹ç”¨äºåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å·¥å…·ã€‚ cd xxx/xxx/crm python3.9 -m venv ddd python3.7 -m venv xxxx python3.7 -m venv /xxx/xxx/xxx/xx/ppp virtualenv ã€æ¨èã€‘ pip install virtualenv cd /xxx/xx/ virtualenv ddd --python=python3.9 # or virtualenv /xxx/xx/ddd --python=python3.9 æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ win cd F:\\envs\\crm\\Scripts activate mac source /è™šæ‹Ÿç¯å¢ƒç›®å½•/bin/activate ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:3:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"é€šè¿‡é…ç½®ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Codeã€PyCharm ç­‰ï¼‰ é€šè¿‡é…ç½®ç¼–è¾‘å™¨å¦‚Pycharm åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ˜¯ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼ŒåŸç†è¿˜æ˜¯é€šè¿‡å‘½ä»¤è¡Œï¼Œé€šè¿‡ç•Œé¢åŒ–æ“ä½œä¼šç›´è§‚ä¸€äº› virtualenv\r","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:3:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"åŸºç¡€è¯­æ³• ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:4:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å˜é‡ å˜é‡è§„åˆ™ å˜é‡åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ å˜é‡ä¸å¯ä»¥åŒ…å«ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æ¥åˆ†éš”å•è¯ ä¸è¦å°†python å…³é”®å­—ä½œä¸ºå˜é‡ å˜é‡ååº”è¯¥ç®€çŸ­å…·æœ‰æè¿°æ€§ æ…ç”¨å°å†™å­—æ¯iå’Œå¤§å†™å­—æ¯Oï¼Œä¼šè¢«è¯¯çœ‹å‡ºæ•°å­—1å’Œ0 ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:4:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ§åˆ¶æµï¼ˆifã€forã€whileï¼‰ æ¡ä»¶è¯­å¥ if æ¡ä»¶è¯­å¥ if åˆ¤æ–­æ¡ä»¶ï¼š æ‰§è¡Œè¯­å¥â€¦â€¦ elseï¼š æ‰§è¡Œè¯­å¥â€¦â€¦ å¤šæ¡ä»¶åŒ¹é…æ—¶ if åˆ¤æ–­æ¡ä»¶1: æ‰§è¡Œè¯­å¥1â€¦â€¦ elif åˆ¤æ–­æ¡ä»¶2: æ‰§è¡Œè¯­å¥2â€¦â€¦ elif åˆ¤æ–­æ¡ä»¶3: æ‰§è¡Œè¯­å¥3â€¦â€¦ else: æ‰§è¡Œè¯­å¥4â€¦â€¦ å¾ªç¯è¯­å¥ while å¾ªç¯è¯­å¥ while åˆ¤æ–­æ¡ä»¶ï¼š æ‰§è¡Œè¯­å¥â€¦â€¦ Gif æ¼”ç¤º Python while è¯­å¥æ‰§è¡Œè¿‡ç¨‹ loop-over-python-list-animation\rforå¾ªç¯è¯­å¥ for iterating_var in sequence: statements(s) æµç¨‹å›¾ python_for_loop\rå®ä¾‹ #!/usr/bin/python # -*- coding: UTF-8 -*- for letter in 'Python': # ç¬¬ä¸€ä¸ªå®ä¾‹ print('å½“å‰å­—æ¯ :', letter) fruits = ['banana', 'apple', 'mango'] for fruit in fruits: # ç¬¬äºŒä¸ªå®ä¾‹ print('å½“å‰æ°´æœ :', fruit) print(\"Good bye!\") é€šè¿‡åºåˆ—ç´¢å¼•è¿­ä»£ #!/usr/bin/python # -*- coding: UTF-8 -*- fruits = ['banana', 'apple', 'mango'] for index in range(len(fruits)): print('å½“å‰æ°´æœ :', fruits[index]) print(\"Good bye!\") ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:4:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å‡½æ•° å‡½æ•°å®šä¹‰å’Œè°ƒç”¨ def greet_user(): # 1. å…³é”®å­—def \"\"\"æ˜¾ç¤ºç®€å•çš„é—®å€™è¯­ï¼Œæ–‡æ¡£å­—ç¬¦ä¸²æ³¨é‡Šï¼Œæ–¹ä¾¿ç”Ÿæˆç¨‹åºæ–‡æ¡£\"\"\" # 2. æ³¨é‡Š print(\"hello\") # 3. å‡½æ•°ä½“ greet_user() # 4. è°ƒç”¨ å‚æ•° å®å‚å’Œå½¢å‚ def greet_user(username): pass username=\"xiao hua\" greet_user(username) # å½¢å‚ greet_user(\"xiao hua\") # å®å‚ é»˜è®¤å‚æ•° # å¯å†™å‡½æ•°è¯´æ˜ def printinfo(name, age=35): \"\"\"æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸²\"\"\" print(\"Name: \", name) print(\"Age \", age) return # è°ƒç”¨printinfoå‡½æ•° printinfo(age=50, name=\"miki\") printinfo(name=\"miki\") ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:4:3","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å¼‚å¸¸å¤„ç† æ•æ‰å¼‚å¸¸å¯ä»¥ä½¿ç”¨try/exceptè¯­å¥ã€‚ try/exceptè¯­å¥ç”¨æ¥æ£€æµ‹tryè¯­å¥å—ä¸­çš„é”™è¯¯ï¼Œä»è€Œè®©exceptè¯­å¥æ•è·å¼‚å¸¸ä¿¡æ¯å¹¶å¤„ç†ã€‚ å¦‚æœä½ ä¸æƒ³åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ç»“æŸä½ çš„ç¨‹åºï¼Œåªéœ€åœ¨tryé‡Œæ•è·å®ƒã€‚ tryâ€¦.exceptâ€¦else ä»¥ä¸‹ä¸ºç®€å•çš„tryâ€¦.exceptâ€¦elseçš„è¯­æ³•ï¼š try: \u003cè¯­å¥\u003e #è¿è¡Œåˆ«çš„ä»£ç  except \u003cåå­—\u003eï¼š \u003cè¯­å¥\u003e #å¦‚æœåœ¨tryéƒ¨ä»½å¼•å‘äº†'name'å¼‚å¸¸ except \u003cåå­—\u003eï¼Œ\u003cæ•°æ®\u003e: \u003cè¯­å¥\u003e #å¦‚æœå¼•å‘äº†'name'å¼‚å¸¸ï¼Œè·å¾—é™„åŠ çš„æ•°æ® else: \u003cè¯­å¥\u003e #å¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿ tryçš„å·¥ä½œåŸç†æ˜¯ï¼Œå½“å¼€å§‹ä¸€ä¸ªtryè¯­å¥åï¼Œpythonå°±åœ¨å½“å‰ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ä½œæ ‡è®°ï¼Œè¿™æ ·å½“å¼‚å¸¸å‡ºç°æ—¶å°±å¯ä»¥å›åˆ°è¿™é‡Œï¼Œtryå­å¥å…ˆæ‰§è¡Œï¼Œæ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆä¾èµ–äºæ‰§è¡Œæ—¶æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚ å¦‚æœå½“tryåçš„è¯­å¥æ‰§è¡Œæ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œpythonå°±è·³å›åˆ°tryå¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªåŒ¹é…è¯¥å¼‚å¸¸çš„exceptå­å¥ï¼Œå¼‚å¸¸å¤„ç†å®Œæ¯•ï¼Œæ§åˆ¶æµå°±é€šè¿‡æ•´ä¸ªtryè¯­å¥ï¼ˆé™¤éåœ¨å¤„ç†å¼‚å¸¸æ—¶åˆå¼•å‘æ–°çš„å¼‚å¸¸ï¼‰ã€‚ å¦‚æœåœ¨tryåçš„è¯­å¥é‡Œå‘ç”Ÿäº†å¼‚å¸¸ï¼Œå´æ²¡æœ‰åŒ¹é…çš„exceptå­å¥ï¼Œå¼‚å¸¸å°†è¢«é€’äº¤åˆ°ä¸Šå±‚çš„tryï¼Œæˆ–è€…åˆ°ç¨‹åºçš„æœ€ä¸Šå±‚ï¼ˆè¿™æ ·å°†ç»“æŸç¨‹åºï¼Œå¹¶æ‰“å°ç¼ºçœçš„å‡ºé”™ä¿¡æ¯ï¼‰ã€‚ å¦‚æœåœ¨tryå­å¥æ‰§è¡Œæ—¶æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œpythonå°†æ‰§è¡Œelseè¯­å¥åçš„è¯­å¥ï¼ˆå¦‚æœæœ‰elseçš„è¯ï¼‰ï¼Œç„¶åæ§åˆ¶æµé€šè¿‡æ•´ä¸ªtryè¯­å¥ã€‚ å®ä¾‹ ä¸‹é¢æ˜¯ç®€å•çš„ä¾‹å­ï¼Œå®ƒæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹å†™å…¥å†…å®¹ï¼Œä¸”å¹¶æœªå‘ç”Ÿå¼‚å¸¸ï¼š #!/usr/bin/python # -*- coding: UTF-8 -*- try: fh = open(\"testfile\", \"w\") fh.write(\"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•å¼‚å¸¸!!\") except IOError: print(\"Error: æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–è¯»å–æ–‡ä»¶å¤±è´¥\") else: print(\"å†…å®¹å†™å…¥æ–‡ä»¶æˆåŠŸ\") fh.close() è¾“å‡ºç»“æœ $ python test.py å†…å®¹å†™å…¥æ–‡ä»¶æˆåŠŸ $ cat testfile # æŸ¥çœ‹å†™å…¥çš„å†…å®¹ è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•å¼‚å¸¸!! try-finally è¯­å¥ try-finally è¯­å¥æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½å°†æ‰§è¡Œæœ€åçš„ä»£ç ã€‚ try: \u003cè¯­å¥\u003e finally: \u003cè¯­å¥\u003e #é€€å‡ºtryæ—¶æ€»ä¼šæ‰§è¡Œ raise ç¤ºä¾‹ #!/usr/bin/python # -*- coding: UTF-8 -*- try: fh = open(\"testfile\", \"w\") fh.write(\"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•å¼‚å¸¸!!\") finally: print(\"Error: æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–è¯»å–æ–‡ä»¶å¤±è´¥\") è¾“å‡º $ python test.py Error: æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–è¯»å–æ–‡ä»¶å¤±è´¥ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:4:4","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ•°æ®ç»“æ„ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:5:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"åˆ—è¡¨ï¼ˆListï¼‰ åˆ—è¡¨å¼ä»€ä¹ˆ? åˆ—è¡¨ç”±ä¸€ç³»åˆ—æŒ‰ç‰¹å®šé¡ºåºæ’åˆ—çš„å…ƒç´ ç»„æˆ Pythonæœ‰6ä¸ªåºåˆ—çš„å†…ç½®ç±»å‹ï¼Œä½†æœ€å¸¸è§çš„æ˜¯åˆ—è¡¨å’Œå…ƒç»„ã€‚ åºåˆ—éƒ½å¯ä»¥è¿›è¡Œçš„æ“ä½œåŒ…æ‹¬ç´¢å¼•ï¼Œåˆ‡ç‰‡ï¼ŒåŠ ï¼Œä¹˜ï¼Œæ£€æŸ¥æˆå‘˜ã€‚ æ­¤å¤–ï¼ŒPythonå·²ç»å†…ç½®ç¡®å®šåºåˆ—çš„é•¿åº¦ä»¥åŠç¡®å®šæœ€å¤§å’Œæœ€å°çš„å…ƒç´ çš„æ–¹æ³•ã€‚ åˆ—è¡¨æ˜¯æœ€å¸¸ç”¨çš„Pythonæ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªæ–¹æ‹¬å·å†…çš„é€—å·åˆ†éš”å€¼å‡ºç°ã€‚ åˆ—è¡¨çš„æ•°æ®é¡¹ä¸éœ€è¦å…·æœ‰ç›¸åŒçš„ç±»å‹ åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œåªè¦æŠŠé€—å·åˆ†éš”çš„ä¸åŒçš„æ•°æ®é¡¹ä½¿ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥å³å¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š list1 = ['physics', 'chemistry', 1997, 2000] list2 = [1, 2, 3, 4, 5 ] list3 = [\"a\", \"b\", \"c\", \"d\"] åˆ—è¡¨æ“ä½œ list1 = ['physics', 'chemistry', 1997, 2000] list2 = [1, 2, 3, 4, 5, 6, 7] # 1. è®¿é—®åˆ—è¡¨ä¸­çš„å€¼ print(\"list1[0]: \", list1[0]) print(\"list2[1:5]: \", list2[1:5]) # 2. æ›´æ–°åˆ—è¡¨ list2.append(8) print(list2) # [1, 2, 3, 4, 5, 6, 7, 8] # 3. åˆ é™¤åˆ—è¡¨ä¸­çš„å€¼ï¼Œé€šè¿‡ä¸‹æ ‡ç´¢å¼•åˆ é™¤ del list2[1] print(list2) # [1, 3, 4, 5, 6, 7, 8] åˆ—è¡¨è„šæœ¬æ“ä½œç¬¦ Python è¡¨è¾¾å¼ ç»“æœ æè¿° len([1, 2, 3]) 3 é•¿åº¦ [1, 2, 3] + [4, 5, 6] [1, 2, 3, 4, 5, 6] ç»„åˆ [â€˜Hi!â€™] * 4 [â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™] é‡å¤ 3 in [1, 2, 3] True å…ƒç´ æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­ for x in [1, 2, 3]: print x, 1 2 3 è¿­ä»£ Pythonåˆ—è¡¨å‡½æ•°\u0026æ–¹æ³• åºå· å‡½æ•° 1 cmp(list1, list2) æ¯”è¾ƒä¸¤ä¸ªåˆ—è¡¨çš„å…ƒç´  2 len(list) åˆ—è¡¨å…ƒç´ ä¸ªæ•° 3 max(list) è¿”å›åˆ—è¡¨å…ƒç´ æœ€å¤§å€¼ 4 min(list) è¿”å›åˆ—è¡¨å…ƒç´ æœ€å°å€¼ 5 list(seq) å°†å…ƒç»„è½¬æ¢ä¸ºåˆ—è¡¨ PythonåŒ…å«ä»¥ä¸‹æ–¹æ³•: åºå· æ–¹æ³• 1 list.append(obj) åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ æ–°çš„å¯¹è±¡ 2 list.count(obj) ç»Ÿè®¡æŸä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•° 3 list.extend(seq) åœ¨åˆ—è¡¨æœ«å°¾ä¸€æ¬¡æ€§è¿½åŠ å¦ä¸€ä¸ªåºåˆ—ä¸­çš„å¤šä¸ªå€¼ï¼ˆç”¨æ–°åˆ—è¡¨æ‰©å±•åŸæ¥çš„åˆ—è¡¨ï¼‰ 4 list.index(obj) ä»åˆ—è¡¨ä¸­æ‰¾å‡ºæŸä¸ªå€¼ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ç´¢å¼•ä½ç½® 5 list.insert(index, obj) å°†å¯¹è±¡æ’å…¥åˆ—è¡¨ 6 list.pop([index=-1]) ç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼ 7 list.remove(obj) ç§»é™¤åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ 8 list.reverse() åå‘åˆ—è¡¨ä¸­å…ƒç´  9 list.sort(cmp=None, key=None, reverse=False) å¯¹åŸåˆ—è¡¨è¿›è¡Œæ’åº ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:5:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å…ƒç»„ï¼ˆTupleï¼‰ Pythonçš„å…ƒç»„ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹ã€‚ å…ƒç»„ä½¿ç”¨å°æ‹¬å·ï¼Œåˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å·ã€‚ å…ƒç»„åˆ›å»ºå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æ‹¬å·ä¸­æ·»åŠ å…ƒç´ ï¼Œå¹¶ä½¿ç”¨é€—å·éš”å¼€å³å¯ã€‚ ç¤ºä¾‹ tup1 = ('physics', 'chemistry', 1997, 2000) tup2 = (1, 2, 3, 4, 5 ) tup3 = \"a\", \"b\", \"c\", \"d\" # ç©ºå…ƒç»„ tup1 = () # å…ƒç»„ä¸­åªåŒ…å«ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦åœ¨å…ƒç´ åé¢æ·»åŠ é€—å· tup1 = (50,) å…ƒç»„æ“ä½œ #!/usr/bin/python tup1 = ('physics', 'chemistry', 1997, 2000) tup2 = (1, 2, 3, 4, 5, 6, 7) # 1. è®¿é—®å…ƒç»„ print(\"tup1[0]: \", tup1[0]) print(\"tup2[1:5]: \", tup2[1:5]) # 2. ä¿®æ”¹å…ƒç»„(å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œè¿æ¥ç»„åˆ) # ä»¥ä¸‹ä¿®æ”¹å…ƒç»„å…ƒç´ æ“ä½œæ˜¯éæ³•çš„ã€‚ #tup2[0] = 100 # åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç»„ tup3 = tup1 + tup2 print(tup3) # 3. åˆ é™¤å…ƒç»„(å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸åˆ é™¤çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨delè¯­å¥æ¥åˆ é™¤æ•´ä¸ªå…ƒç»„) print(tup2) del tup2 print(\"After deleting tup2 : \") print(tup2) å…ƒç»„è¿ç®—ç¬¦ ä¸å­—ç¬¦ä¸²ä¸€æ ·ï¼Œå…ƒç»„ä¹‹é—´å¯ä»¥ä½¿ç”¨ + å·å’Œ * å·è¿›è¡Œè¿ç®—ã€‚è¿™å°±æ„å‘³ç€ä»–ä»¬å¯ä»¥ç»„åˆå’Œå¤åˆ¶ï¼Œè¿ç®—åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å…ƒç»„ã€‚ Python è¡¨è¾¾å¼ ç»“æœ æè¿° len((1, 2, 3)) 3 è®¡ç®—å…ƒç´ ä¸ªæ•° (1, 2, 3) + (4, 5, 6) (1, 2, 3, 4, 5, 6) è¿æ¥ (â€˜Hi!â€™,) * 4 (â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™) å¤åˆ¶ 3 in (1, 2, 3) True å…ƒç´ æ˜¯å¦å­˜åœ¨ for x in (1, 2, 3): print x, 1 2 3 è¿­ä»£ å…ƒç»„ç´¢å¼•ï¼Œæˆªå– å› ä¸ºå…ƒç»„ä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¿é—®å…ƒç»„ä¸­çš„æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æˆªå–ç´¢å¼•ä¸­çš„ä¸€æ®µå…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å…ƒç»„ï¼š L = ('spam', 'Spam', 'SPAM!') Python è¡¨è¾¾å¼ ç»“æœ æè¿° L[2] â€˜SPAM!â€™ è¯»å–ç¬¬ä¸‰ä¸ªå…ƒç´  L[-2] â€˜Spamâ€™ åå‘è¯»å–ï¼Œè¯»å–å€’æ•°ç¬¬äºŒä¸ªå…ƒç´  L[1:] (â€˜Spamâ€™, â€˜SPAM!â€™) æˆªå–å…ƒç´  å…ƒç»„å†…ç½®å‡½æ•° åºå· æ–¹æ³•åŠæè¿° 1 cmp(tuple1, tuple2) æ¯”è¾ƒä¸¤ä¸ªå…ƒç»„å…ƒç´ ã€‚ 2 len(tuple) è®¡ç®—å…ƒç»„å…ƒç´ ä¸ªæ•°ã€‚ 3 max(tuple) è¿”å›å…ƒç»„ä¸­å…ƒç´ æœ€å¤§å€¼ã€‚ 4 min(tuple) è¿”å›å…ƒç»„ä¸­å…ƒç´ æœ€å°å€¼ã€‚ 5 tuple(seq) å°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:5:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å­—å…¸ï¼ˆDictionaryï¼‰ å­—å…¸æ˜¯å¦ä¸€ç§å¯å˜å®¹å™¨æ¨¡å‹ï¼Œä¸”å¯å­˜å‚¨ä»»æ„ç±»å‹å¯¹è±¡ã€‚ å­—å…¸çš„æ¯ä¸ªé”®å€¼ key=\u003evalue å¯¹ç”¨å†’å· : åˆ†å‰²ï¼Œæ¯ä¸ªé”®å€¼å¯¹ä¹‹é—´ç”¨é€—å· , åˆ†å‰²ï¼Œæ•´ä¸ªå­—å…¸åŒ…æ‹¬åœ¨èŠ±æ‹¬å· {} ä¸­ ,æ ¼å¼å¦‚ä¸‹æ‰€ç¤º d = {key1 : value1, key2 : value2 } é”®ä¸€èˆ¬æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœé‡å¤æœ€åçš„ä¸€ä¸ªé”®å€¼å¯¹ä¼šæ›¿æ¢å‰é¢çš„ï¼Œå€¼ä¸éœ€è¦å”¯ä¸€ã€‚ å­—å…¸æ“ä½œ #!/usr/bin/python dict = {'Name': 'Zara', 'Age': 7, 'Class': 'First'} # 1. è®¿é—®å­—å…¸ print(\"dict['Name']: \", dict['Name']) print(\"dict['Age']: \", dict['Age']) # 2. ä¿®æ”¹å­—å…¸ dict['Age'] = 8 # æ›´æ–° dict['School'] = \"CODEXY\" # æ·»åŠ  print(\"dict['Age']: \", dict['Age']) print(\"dict['School']: \", dict['MIT']) # 3. åˆ é™¤å­—å…¸å…ƒç´  del dict['Name'] # åˆ é™¤é”®æ˜¯'Name'çš„æ¡ç›® dict.clear() # æ¸…ç©ºè¯å…¸æ‰€æœ‰æ¡ç›® del dict # åˆ é™¤è¯å…¸ å­—å…¸çš„ä¸¤ä¸ªç‰¹æ€§ ä¸å…è®¸åŒä¸€ä¸ªé”®å‡ºç°ä¸¤æ¬¡ã€‚åˆ›å»ºæ—¶å¦‚æœåŒä¸€ä¸ªé”®è¢«èµ‹å€¼ä¸¤æ¬¡ï¼Œåä¸€ä¸ªå€¼ä¼šè¢«è¦†ç›– é”®å¿…é¡»ä¸å¯å˜ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–å…ƒç»„å……å½“ï¼Œæ‰€ä»¥ç”¨åˆ—è¡¨å°±ä¸è¡Œ å­—å…¸å†…ç½®å‡½æ•°\u0026æ–¹æ³• Pythonå­—å…¸åŒ…å«äº†ä»¥ä¸‹å†…ç½®å‡½æ•°ï¼š åºå· å‡½æ•°åŠæè¿° 1 cmp(dict1, dict2) æ¯”è¾ƒä¸¤ä¸ªå­—å…¸å…ƒç´ ã€‚ 2 len(dict) è®¡ç®—å­—å…¸å…ƒç´ ä¸ªæ•°ï¼Œå³é”®çš„æ€»æ•°ã€‚ 3 str(dict) è¾“å‡ºå­—å…¸å¯æ‰“å°çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ 4 type(variable) è¿”å›è¾“å…¥çš„å˜é‡ç±»å‹ï¼Œå¦‚æœå˜é‡æ˜¯å­—å…¸å°±è¿”å›å­—å…¸ç±»å‹ã€‚ Pythonå­—å…¸åŒ…å«äº†ä»¥ä¸‹å†…ç½®æ–¹æ³•ï¼š åºå· å‡½æ•°åŠæè¿° 1 dict.clear() åˆ é™¤å­—å…¸å†…æ‰€æœ‰å…ƒç´  2 dict.copy() è¿”å›ä¸€ä¸ªå­—å…¸çš„æµ…å¤åˆ¶ 3 dict.fromkeys(seq[, val]) åˆ›å»ºä¸€ä¸ªæ–°å­—å…¸ï¼Œä»¥åºåˆ— seq ä¸­å…ƒç´ åšå­—å…¸çš„é”®ï¼Œval ä¸ºå­—å…¸æ‰€æœ‰é”®å¯¹åº”çš„åˆå§‹å€¼ 4 dict.get(key, default=None) è¿”å›æŒ‡å®šé”®çš„å€¼ï¼Œå¦‚æœå€¼ä¸åœ¨å­—å…¸ä¸­è¿”å›defaultå€¼ 5 dict.has_key(key) å¦‚æœé”®åœ¨å­—å…¸dicté‡Œè¿”å›trueï¼Œå¦åˆ™è¿”å›false 6 dict.items() ä»¥åˆ—è¡¨è¿”å›å¯éå†çš„(é”®, å€¼) å…ƒç»„æ•°ç»„ 7 dict.keys() ä»¥åˆ—è¡¨è¿”å›ä¸€ä¸ªå­—å…¸æ‰€æœ‰çš„é”® 8 dict.setdefault(key, default=None) å’Œget()ç±»ä¼¼, ä½†å¦‚æœé”®ä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œå°†ä¼šæ·»åŠ é”®å¹¶å°†å€¼è®¾ä¸ºdefault 9 dict.update(dict2) æŠŠå­—å…¸dict2çš„é”®/å€¼å¯¹æ›´æ–°åˆ°dicté‡Œ 10 dict.values() ä»¥åˆ—è¡¨è¿”å›å­—å…¸ä¸­çš„æ‰€æœ‰å€¼ 11 pop(key[,default]) åˆ é™¤å­—å…¸ç»™å®šé”® key æ‰€å¯¹åº”çš„å€¼ï¼Œè¿”å›å€¼ä¸ºè¢«åˆ é™¤çš„å€¼ã€‚keyå€¼å¿…é¡»ç»™å‡ºã€‚ å¦åˆ™ï¼Œè¿”å›defaultå€¼ã€‚ 12 popitem() éšæœºè¿”å›å¹¶åˆ é™¤å­—å…¸ä¸­çš„ä¸€å¯¹é”®å’Œå€¼ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:5:3","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"é›†åˆï¼ˆSetï¼‰ åœ¨ Python ä¸­ï¼Œé›†åˆï¼ˆSetï¼‰æ˜¯ä¸€ç§æ— åºä¸”å…ƒç´ å”¯ä¸€çš„æ•°æ®ç±»å‹ã€‚å®ƒåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œå› æ­¤æ”¯æŒé«˜æ•ˆçš„æˆå‘˜æ£€æµ‹å’Œåˆ é™¤æ“ä½œã€‚ åˆ›å»ºé›†åˆ å¯ä»¥ä½¿ç”¨å¤§æ‹¬å· {} æˆ–è€… set() æ„é€ å‡½æ•°æ¥åˆ›å»ºé›†åˆã€‚ # ä½¿ç”¨å¤§æ‹¬å·åˆ›å»ºé›†åˆ my_set = {1, 2, 3, 4, 5} # ä½¿ç”¨ set() æ„é€ å‡½æ•°åˆ›å»ºé›†åˆ another_set = set([5, 6, 7, 8, 9]) é›†åˆçš„ç‰¹ç‚¹ æ— åºæ€§ï¼šé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å›ºå®šçš„é¡ºåºã€‚ å”¯ä¸€æ€§ï¼šé›†åˆä¸­ä¸å…è®¸åŒ…å«é‡å¤çš„å…ƒç´ ã€‚ å¯å˜æ€§ï¼šé›†åˆæ˜¯å¯å˜çš„ï¼Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚ å“ˆå¸Œæ€§ï¼šé›†åˆä¸­çš„å…ƒç´ å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„ï¼Œå³ä¸å¯å˜ç±»å‹ï¼Œå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å…ƒç»„ã€å­—ç¬¦ä¸²ç­‰ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:5:4","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"é¢å‘å¯¹è±¡ç¼–ç¨‹ Pythonä»è®¾è®¡ä¹‹åˆå°±å·²ç»æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨Pythonä¸­åˆ›å»ºä¸€ä¸ªç±»å’Œå¯¹è±¡æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ é¢å‘å¯¹è±¡æŠ€æœ¯ç®€ä»‹ ç±»(Class): ç”¨æ¥æè¿°å…·æœ‰ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡çš„é›†åˆã€‚å®ƒå®šä¹‰äº†è¯¥é›†åˆä¸­æ¯ä¸ªå¯¹è±¡æ‰€å…±æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚ ç±»å˜é‡ï¼šç±»å˜é‡åœ¨æ•´ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ä¸­æ˜¯å…¬ç”¨çš„ã€‚ç±»å˜é‡å®šä¹‰åœ¨ç±»ä¸­ä¸”åœ¨å‡½æ•°ä½“ä¹‹å¤–ã€‚ç±»å˜é‡é€šå¸¸ä¸ä½œä¸ºå®ä¾‹å˜é‡ä½¿ç”¨ã€‚ æ•°æ®æˆå‘˜ï¼šç±»å˜é‡æˆ–è€…å®ä¾‹å˜é‡, ç”¨äºå¤„ç†ç±»åŠå…¶å®ä¾‹å¯¹è±¡çš„ç›¸å…³çš„æ•°æ®ã€‚ æ–¹æ³•é‡å†™ï¼šå¦‚æœä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ–¹æ³•çš„è¦†ç›–ï¼ˆoverrideï¼‰ï¼Œä¹Ÿç§°ä¸ºæ–¹æ³•çš„é‡å†™ã€‚ å±€éƒ¨å˜é‡ï¼šå®šä¹‰åœ¨æ–¹æ³•ä¸­çš„å˜é‡ï¼Œåªä½œç”¨äºå½“å‰å®ä¾‹çš„ç±»ã€‚ å®ä¾‹å˜é‡ï¼šåœ¨ç±»çš„å£°æ˜ä¸­ï¼Œå±æ€§æ˜¯ç”¨å˜é‡æ¥è¡¨ç¤ºçš„ã€‚è¿™ç§å˜é‡å°±ç§°ä¸ºå®ä¾‹å˜é‡ï¼Œæ˜¯åœ¨ç±»å£°æ˜çš„å†…éƒ¨ä½†æ˜¯åœ¨ç±»çš„å…¶ä»–æˆå‘˜æ–¹æ³•ä¹‹å¤–å£°æ˜çš„ã€‚ ç»§æ‰¿ï¼šå³ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼ˆderived classï¼‰ç»§æ‰¿åŸºç±»ï¼ˆbase 1. classï¼‰çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç»§æ‰¿ä¹Ÿå…è®¸æŠŠä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ä½œä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡å¯¹å¾…ã€‚ä¾‹å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªè®¾è®¡ï¼šä¸€ä¸ªDogç±»å‹çš„å¯¹è±¡æ´¾ç”Ÿè‡ªAnimalç±»ï¼Œè¿™æ˜¯æ¨¡æ‹Ÿ\"æ˜¯ä¸€ä¸ªï¼ˆis-aï¼‰â€œå…³ç³»ï¼ˆä¾‹å›¾ï¼ŒDogæ˜¯ä¸€ä¸ªAnimalï¼‰ã€‚ å®ä¾‹åŒ–ï¼šåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œç±»çš„å…·ä½“å¯¹è±¡ã€‚ æ–¹æ³•ï¼šç±»ä¸­å®šä¹‰çš„å‡½æ•°ã€‚ å¯¹è±¡ï¼šé€šè¿‡ç±»å®šä¹‰çš„æ•°æ®ç»“æ„å®ä¾‹ã€‚å¯¹è±¡åŒ…æ‹¬ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼ˆç±»å˜é‡å’Œå®ä¾‹å˜é‡ï¼‰å’Œæ–¹æ³•ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:6:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"ç±»å’Œå¯¹è±¡ åˆ›å»ºç±» class ClassName: '''ç±»çš„å¸®åŠ©ä¿¡æ¯''' #ç±»æ–‡æ¡£å­—ç¬¦ä¸² class_suite #ç±»ä½“ ç±»çš„å¸®åŠ©ä¿¡æ¯å¯ä»¥é€šè¿‡ClassName.__doc__æŸ¥çœ‹ã€‚ class_suite ç”±ç±»æˆå‘˜ï¼Œæ–¹æ³•ï¼Œæ•°æ®å±æ€§ç»„æˆã€‚ ç¤ºä¾‹ #!/usr/bin/python # -*- coding: UTF-8 -*- class Employee: 'æ‰€æœ‰å‘˜å·¥çš„åŸºç±»' empCount = 0 def __init__(self, name, salary): self.name = name self.salary = salary Employee.empCount += 1 def displayCount(self): print(\"Total Employee %d\" % Employee.empCount) def displayEmployee(self): print(\"Name : \", self.name, \", Salary: \", self.salary) åˆ›å»ºç±»çš„å®ä¾‹å¯¹è±¡ å®ä¾‹åŒ–ç±»å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ä¸€èˆ¬ç”¨å…³é”®å­— newï¼Œä½†æ˜¯åœ¨ Python ä¸­å¹¶æ²¡æœ‰è¿™ä¸ªå…³é”®å­—ï¼Œç±»çš„å®ä¾‹åŒ–ç±»ä¼¼å‡½æ•°è°ƒç”¨æ–¹å¼ã€‚ ä»¥ä¸‹ä½¿ç”¨ç±»çš„åç§° Employee æ¥å®ä¾‹åŒ–ï¼Œå¹¶é€šè¿‡ __init__ æ–¹æ³•æ¥æ”¶å‚æ•°ã€‚ \"åˆ›å»º Employee ç±»çš„ç¬¬ä¸€ä¸ªå¯¹è±¡\" emp1 = Employee(\"Zara\", 2000) \"åˆ›å»º Employee ç±»çš„ç¬¬äºŒä¸ªå¯¹è±¡\" emp2 = Employee(\"Manni\", 5000) Python å†…ç½®ç±»å±æ€§ __dict__ : ç±»çš„å±æ€§ï¼ˆåŒ…å«ä¸€ä¸ªå­—å…¸ï¼Œç”±ç±»çš„æ•°æ®å±æ€§ç»„æˆï¼‰ __doc__ :ç±»çš„æ–‡æ¡£å­—ç¬¦ä¸² __name__: ç±»å __module__: ç±»å®šä¹‰æ‰€åœ¨çš„æ¨¡å—ï¼ˆç±»çš„å…¨åæ˜¯'__main__.className'ï¼Œå¦‚æœç±»ä½äºä¸€ä¸ªå¯¼å…¥æ¨¡å—mymodä¸­ï¼Œé‚£ä¹ˆclassName.__module__ ç­‰äº mymodï¼‰ __bases__ : ç±»çš„æ‰€æœ‰çˆ¶ç±»æ„æˆå…ƒç´ ï¼ˆåŒ…å«äº†ä¸€ä¸ªç”±æ‰€æœ‰çˆ¶ç±»ç»„æˆçš„å…ƒç»„ï¼‰ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:6:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"ç±»çš„ç»§æ‰¿ é¢å‘å¯¹è±¡çš„ç¼–ç¨‹å¸¦æ¥çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯ä»£ç çš„é‡ç”¨ï¼Œå®ç°è¿™ç§é‡ç”¨çš„æ–¹æ³•ä¹‹ä¸€æ˜¯é€šè¿‡ç»§æ‰¿æœºåˆ¶ã€‚ é€šè¿‡ç»§æ‰¿åˆ›å»ºçš„æ–°ç±»ç§°ä¸ºå­ç±»æˆ–æ´¾ç”Ÿç±»ï¼Œè¢«ç»§æ‰¿çš„ç±»ç§°ä¸ºåŸºç±»ã€çˆ¶ç±»æˆ–è¶…ç±»ã€‚ ç»§æ‰¿è¯­æ³• class æ´¾ç”Ÿç±»å(åŸºç±»å) ... åœ¨pythonä¸­ç»§æ‰¿ä¸­çš„ä¸€äº›ç‰¹ç‚¹ï¼š 1ã€å¦‚æœåœ¨å­ç±»ä¸­éœ€è¦çˆ¶ç±»çš„æ„é€ æ–¹æ³•å°±éœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæˆ–è€…ä¸é‡å†™çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚è¯¦ç»†è¯´æ˜å¯æŸ¥çœ‹ï¼špython å­ç±»ç»§æ‰¿çˆ¶ç±»æ„é€ å‡½æ•°è¯´æ˜ã€‚ 2ã€åœ¨è°ƒç”¨åŸºç±»çš„æ–¹æ³•æ—¶ï¼Œéœ€è¦åŠ ä¸ŠåŸºç±»çš„ç±»åå‰ç¼€ï¼Œä¸”éœ€è¦å¸¦ä¸Š self å‚æ•°å˜é‡ã€‚åŒºåˆ«åœ¨äºç±»ä¸­è°ƒç”¨æ™®é€šå‡½æ•°æ—¶å¹¶ä¸éœ€è¦å¸¦ä¸Š self å‚æ•° 3ã€Python æ€»æ˜¯é¦–å…ˆæŸ¥æ‰¾å¯¹åº”ç±»å‹çš„æ–¹æ³•ï¼Œå¦‚æœå®ƒä¸èƒ½åœ¨æ´¾ç”Ÿç±»ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œå®ƒæ‰å¼€å§‹åˆ°åŸºç±»ä¸­é€ä¸ªæŸ¥æ‰¾ã€‚ï¼ˆå…ˆåœ¨æœ¬ç±»ä¸­æŸ¥æ‰¾è°ƒç”¨çš„æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°æ‰å»åŸºç±»ä¸­æ‰¾ï¼‰ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:6:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ¨¡å—å’ŒåŒ… Python æ¨¡å—(Module)ï¼Œæ˜¯ä¸€ä¸ª Python æ–‡ä»¶ï¼Œä»¥ .py ç»“å°¾ï¼ŒåŒ…å«äº† Python å¯¹è±¡å®šä¹‰å’ŒPythonè¯­å¥ã€‚ æ¨¡å—è®©ä½ èƒ½å¤Ÿæœ‰é€»è¾‘åœ°ç»„ç»‡ä½ çš„ Python ä»£ç æ®µã€‚ æŠŠç›¸å…³çš„ä»£ç åˆ†é…åˆ°ä¸€ä¸ªæ¨¡å—é‡Œèƒ½è®©ä½ çš„ä»£ç æ›´å¥½ç”¨ï¼Œæ›´æ˜“æ‡‚ã€‚ æ¨¡å—èƒ½å®šä¹‰å‡½æ•°ï¼Œç±»å’Œå˜é‡ï¼Œæ¨¡å—é‡Œä¹Ÿèƒ½åŒ…å«å¯æ‰§è¡Œçš„ä»£ç ã€‚ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:7:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ¨¡å—çš„å¯¼å…¥ æ¨¡å—å®šä¹‰å¥½åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ import è¯­å¥æ¥å¼•å…¥æ¨¡å—ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š import module1[, module2[,... moduleN]] æ¯”å¦‚è¦å¼•ç”¨æ¨¡å— mathï¼Œå°±å¯ä»¥åœ¨æ–‡ä»¶æœ€å¼€å§‹çš„åœ°æ–¹ç”¨ import math æ¥å¼•å…¥ã€‚åœ¨è°ƒç”¨ math æ¨¡å—ä¸­çš„å‡½æ•°æ—¶ï¼Œå¿…é¡»è¿™æ ·å¼•ç”¨ï¼š æ¨¡å—å.å‡½æ•°å fromâ€¦import è¯­å¥ Python çš„ from è¯­å¥è®©ä½ ä»æ¨¡å—ä¸­å¯¼å…¥ä¸€ä¸ªæŒ‡å®šçš„éƒ¨åˆ†åˆ°å½“å‰å‘½åç©ºé—´ä¸­ã€‚è¯­æ³•å¦‚ä¸‹ï¼š from modname import name1[, name2[, ... nameN]] fromâ€¦import* è¯­å¥ æŠŠä¸€ä¸ªæ¨¡å—çš„æ‰€æœ‰å†…å®¹å…¨éƒ½å¯¼å…¥åˆ°å½“å‰çš„å‘½åç©ºé—´ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåªéœ€ä½¿ç”¨å¦‚ä¸‹å£°æ˜ï¼š from modname import * ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:7:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ–‡ä»¶æ“ä½œ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:8:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ Python æä¾›äº†å¿…è¦çš„å‡½æ•°å’Œæ–¹æ³•è¿›è¡Œé»˜è®¤æƒ…å†µä¸‹çš„æ–‡ä»¶åŸºæœ¬æ“ä½œã€‚ä½ å¯ä»¥ç”¨ file å¯¹è±¡åšå¤§éƒ¨åˆ†çš„æ–‡ä»¶æ“ä½œã€‚ open å‡½æ•° ä½ å¿…é¡»å…ˆç”¨Pythonå†…ç½®çš„open()å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªfileå¯¹è±¡ï¼Œç›¸å…³çš„æ–¹æ³•æ‰å¯ä»¥è°ƒç”¨å®ƒè¿›è¡Œè¯»å†™ã€‚ è¯­æ³•ï¼š file object = open(file_name [, access_mode][, buffering]) å„ä¸ªå‚æ•°çš„ç»†èŠ‚å¦‚ä¸‹ï¼š file_nameï¼šfile_nameå˜é‡æ˜¯ä¸€ä¸ªåŒ…å«äº†ä½ è¦è®¿é—®çš„æ–‡ä»¶åç§°çš„å­—ç¬¦ä¸²å€¼ã€‚ access_modeï¼šaccess_modeå†³å®šäº†æ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ï¼šåªè¯»ï¼Œå†™å…¥ï¼Œè¿½åŠ ç­‰ã€‚æ‰€æœ‰å¯å–å€¼è§å¦‚ä¸‹çš„å®Œå…¨åˆ—è¡¨ã€‚è¿™ä¸ªå‚æ•°æ˜¯éå¼ºåˆ¶çš„ï¼Œé»˜è®¤æ–‡ä»¶è®¿é—®æ¨¡å¼ä¸ºåªè¯»(r)ã€‚ buffering:å¦‚æœbufferingçš„å€¼è¢«è®¾ä¸º0ï¼Œå°±ä¸ä¼šæœ‰å¯„å­˜ã€‚å¦‚æœbufferingçš„å€¼å–1ï¼Œè®¿é—®æ–‡ä»¶æ—¶ä¼šå¯„å­˜è¡Œã€‚å¦‚æœå°†bufferingçš„å€¼è®¾ä¸ºå¤§äº1çš„æ•´æ•°ï¼Œè¡¨æ˜äº†è¿™å°±æ˜¯çš„å¯„å­˜åŒºçš„ç¼“å†²å¤§å°ã€‚å¦‚æœå–è´Ÿå€¼ï¼Œå¯„å­˜åŒºçš„ç¼“å†²å¤§å°åˆ™ä¸ºç³»ç»Ÿé»˜è®¤ã€‚ è¯»å†™æ–‡ä»¶å†…å®¹ ä¸åŒæ¨¡å¼æ‰“å¼€æ–‡ä»¶çš„å®Œå…¨åˆ—è¡¨ï¼š æ¨¡å¼ æè¿° t æ–‡æœ¬æ¨¡å¼ (é»˜è®¤)ã€‚ x å†™æ¨¡å¼ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚ b äºŒè¿›åˆ¶æ¨¡å¼ã€‚ + æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ–°(å¯è¯»å¯å†™)ã€‚ U é€šç”¨æ¢è¡Œæ¨¡å¼ï¼ˆä¸æ¨èï¼‰ã€‚ r ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚ rb ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚ r+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ rb+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚ w æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ wb ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚ w+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ wb+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚ a æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚ ab ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚ a+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚æ–‡ä»¶æ‰“å¼€æ—¶ä¼šæ˜¯è¿½åŠ æ¨¡å¼ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚ ab+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚ ä¸‹å›¾å¾ˆå¥½çš„æ€»ç»“äº†è¿™å‡ ç§æ¨¡å¼ï¼š file accessmode\ræ¨¡å¼ r r+ w w+ a a+ è¯» + + + + å†™ + + + + + åˆ›å»º + + + + è¦†ç›– + + æŒ‡é’ˆåœ¨å¼€å§‹ + + + + æŒ‡é’ˆåœ¨ç»“å°¾ + + ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:8:1","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"ä½¿ç”¨ with è¯­å¥å¤„ç†æ–‡ä»¶ åœ¨ Python ä¸­ï¼Œwith è¯­å¥ç”¨äºç®¡ç†ä»£ç å—æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç¡®ä¿åœ¨è¿›å…¥å’Œé€€å‡ºä»£ç å—æ—¶ï¼Œèµ„æºçš„æ­£ç¡®è·å–å’Œé‡Šæ”¾ã€‚å®ƒé€šå¸¸ä¸æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼ˆContext Management Protocolï¼‰çš„å¯¹è±¡ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æ–‡ä»¶æ“ä½œã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰éœ€è¦åœ¨ä½¿ç”¨ååŠæ—¶å…³é—­æˆ–é‡Šæ”¾èµ„æºçš„æƒ…å†µã€‚ with open('example.txt', 'r') as file: content = file.read() print(content) # åœ¨é€€å‡º with å—åï¼Œæ–‡ä»¶ä¼šè‡ªåŠ¨å…³é—­ï¼Œå³ä½¿å‡ºç°å¼‚å¸¸ä¹Ÿèƒ½ä¿è¯èµ„æºçš„é‡Šæ”¾ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:8:2","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å¸¸ç”¨æ ‡å‡†åº“ æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆos æ¨¡å—ï¼‰ æ–‡ä»¶è·¯å¾„æ“ä½œï¼ˆpathlib æ¨¡å—ï¼‰ æ—¶é—´å’Œæ—¥æœŸå¤„ç†ï¼ˆdatetime æ¨¡å—ï¼‰ æ­£åˆ™è¡¨è¾¾å¼ï¼ˆre æ¨¡å—ï¼‰ Python å¸¸ç”¨æ¨¡å—å’Œå¸¸ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—ç¤ºä¾‹ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:9:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"è¿›é˜¶è¯é¢˜ å¹¶å‘ç¼–ç¨‹ï¼ˆå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ï¼‰ å¼‚æ­¥ç¼–ç¨‹ï¼ˆasyncio æ¨¡å—ï¼‰ æ•°æ®åº“è®¿é—®ï¼ˆsqlite3ã€SQLAlchemy ç­‰ï¼‰ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:10:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"å®é™…åº”ç”¨ç¤ºä¾‹ ç®€å•çš„ Web å¼€å‘ï¼ˆä½¿ç”¨ Flask æˆ– Djangoï¼‰ æ•°æ®åˆ†æä¸å¯è§†åŒ–ï¼ˆä½¿ç”¨ Pandas å’Œ Matplotlibï¼‰ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:11:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"èµ„æºæ¨è å®˜æ–¹æ–‡æ¡£é“¾æ¥ è°·æ­ŒPythonä»£ç é£æ ¼æŒ‡å— ä¸­æ–‡ç¿»è¯‘ 30ä¸ªPythonå¸¸ç”¨æç®€ä»£ç ï¼Œæ‹¿èµ°å°±ç”¨ æ”¶è— | å­¦ä¹ Pythonçš„11ä¸ªé¡¶çº§Githubå­˜å‚¨åº“ æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®® Django Django-ä¸­æ–‡ ","date":"2022-03-20","objectID":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/:12:0","tags":["Python"],"title":"Python3 å¿«é€Ÿä¸Šæ‰‹æŒ‡å—","uri":"/python3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97/"},{"categories":["Python"],"content":"é¡¹ç›®ç›®å½•å¸ƒå±€ project_name â”œâ”€â”€ docs â”‚ â”œâ”€â”€ make.bat â”‚ â”œâ”€â”€ Makefile â”‚ â””â”€â”€ source â”‚ â”œâ”€â”€ conf.py â”‚ â””â”€â”€ index.rst â”œâ”€â”€ examples â”‚ â””â”€â”€ example.py â”œâ”€â”€ project_name â”‚ â””â”€â”€ package_name â”‚ â””â”€â”€ __init__.py â”‚ â”œâ”€â”€ module1.py â”‚ â”œâ”€â”€ module2.py â”‚ â”œâ”€â”€ package1/ â”‚ â”‚ â”œâ”€â”€ __init__.py â”‚ â”‚ â”œâ”€â”€ module3.py â”‚ â”‚ â”œâ”€â”€ module4.py â”‚ â”‚ â””â”€â”€ ... â”œâ”€â”€ tests â”‚ â””â”€â”€ __init__.py â”œâ”€â”€ .gitignore â”œâ”€â”€ LICENSE.txt â”œâ”€â”€ MANIFEST.in â”œâ”€â”€ README.md â”œâ”€â”€ requirements.txt â”œâ”€â”€ setup.py åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼š project_name/ æ˜¯é¡¹ç›®çš„æ ¹ç›®å½•ã€‚ project_name/project_name/ ç›®å½•åŒ…å«é¡¹ç›®çš„æºä»£ç ï¼Œinit.py æ–‡ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå®ƒæ ‡å¿—ç€è¯¥ç›®å½•æ˜¯ä¸€ä¸ª Python åŒ…ã€‚ module1.py å’Œ module2.py æ˜¯ Python æ¨¡å—ï¼Œå®ƒä»¬åŒ…å« Python ä»£ç ã€‚ package1/ æ˜¯ä¸€ä¸ª Python åŒ…ï¼Œå®ƒå¯ä»¥åŒ…å«å…¶ä»–æ¨¡å—å’Œå­åŒ…ã€‚åŒ…å†…çš„ init.py æ–‡ä»¶ç”¨äºç»„ç»‡åŒ…çš„å†…å®¹ã€‚ tests/ ç›®å½•åŒ…å«é¡¹ç›®çš„æµ‹è¯•ä»£ç ã€‚ docs/ ç›®å½•åŒ…å«é¡¹ç›®çš„æ–‡æ¡£ã€‚ setup.py æ˜¯ä¸€ä¸ªå¸¸è§çš„ Python é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå®ƒç”¨äºå®‰è£…ï¼Œå¸è½½ï¼Œæ‰“åŒ…ç­‰ä»»åŠ¡ã€‚ requirements.txt åˆ—å‡ºäº†é¡¹ç›®çš„ä¾èµ–ã€‚ Python é¡¹ç›®ç»“æ„å¹¶æ²¡æœ‰ä¸¥æ ¼çš„è§„èŒƒï¼Œä¸è¿‡è¿™ç§ç»“æ„åŸºæœ¬å°±æ˜¯ Python ç¤¾åŒºä¸­é€šç”¨çš„æœ€ä½³å®è·µï¼Œä½ å¯ä»¥åœ¨å¾ˆå¤šå¼€æº Python é¡¹ç›®ä¸­çœ‹åˆ°è¿™ç§ç»“æ„ã€‚ ","date":"2022-03-18","objectID":"/python-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97_%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95/:0:0","tags":["Python"],"title":"Python å¿«é€Ÿä¸Šæ‰‹æŒ‡å— é¡¹ç›®ç›®å½•","uri":"/python-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97_%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95/"},{"categories":["Nginx"],"content":"Nginx æ˜¯ä»€ä¹ˆï¼Ÿ Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ã€‚ Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„. ç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:1:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"å››ä¸ªå‘è¡Œç‰ˆæœ¬ å¼€æºç‰ˆï¼šhttps://nginx.org/ å•†ä¸šç‰ˆï¼šhttps://nginx.com/ f5 Openresty: https://openresty.org/cn/ Tengine: https://tengine.taobao.org/ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:2:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"ä¸ºä»€ä¹ˆé€‰æ‹©Nginx? äº’è”ç½‘å…¬å¸å¤§éƒ½é€‰æ‹© Nginx Nginx æŠ€æœ¯æˆç†Ÿï¼Œå…·å¤‡çš„åŠŸèƒ½æ˜¯ä¼ä¸šæœ€å¸¸ä½¿ç”¨è€Œä¸”æœ€éœ€è¦çš„ é€‚åˆå½“å‰ä¸»æµæ¶æ„è¶‹åŠ¿, å¾®æœåŠ¡ã€äº‘æ¶æ„ã€ä¸­é—´å±‚ ç»Ÿä¸€æŠ€æœ¯æ ˆ, é™ä½ç»´æŠ¤æˆæœ¬, é™ä½æŠ€æœ¯æ›´æ–°æˆæœ¬ã€‚ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:3:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx ç‰¹ç‚¹ å¼€æº,å¯ä»¥ä»å®˜ç½‘ç›´æ¥è·å–æºä»£ç  é«˜å¹¶å‘ï¼šé«˜æ€§èƒ½,Nginxæ€§èƒ½éå¸¸æ®‹æš´,æ”¯æŒæµ·é‡å¹¶å‘ï¼Œé¡¶ä½10ä¸‡ä»¥ä¸Šè¿æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ ä½å†…å­˜æ¶ˆè€—ï¼šåœ¨é«˜æ€§èƒ½çš„åŒæ—¶ï¼Œä¿æŒå¾ˆä½çš„å†…å­˜æ¶ˆè€—ï¼› æ¨¡å—åŒ–ï¼šNginxå…·æœ‰ä¸°å¯Œçš„æ¨¡å—å¯ä»¥æŒ‰éœ€ä½¿ç”¨ï¼Œå¹¶ä¸”æœ‰å¼€å‘èƒ½åŠ›çš„æŠ€æœ¯äººå‘˜è¿˜å¯ä»¥äºŒæ¬¡å¼€å‘ çƒ­å¯åŠ¨ï¼šä¾‹å¦‚å½“ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä¸éœ€è¦åœæ­¢ä¸å¯åŠ¨å°±å¯ä»¥è®©é…ç½®ç”Ÿæ•ˆ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:4:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx åº”ç”¨åœºæ™¯ Nginx åº”ç”¨åœºæ™¯\r","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:5:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx çš„ç»„æˆ Nginx åº”ç”¨åœºæ™¯\rå¯ä»¥å°†Nginx ç†è§£ä¸ºä¸€è¾†å°æ±½è½¦ï¼Œnginx.conf å¯æ¯”ä½œé©¾é©¶å‘˜ï¼Œæ§åˆ¶è¿™Nginxçš„çš„è¡Œä¸ºï¼Œä½†æ˜¯å½“æ±½è½¦åœ¨é©¾é©¶çš„è¿‡ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªé»‘åŒ£å­åˆ°åº•æ˜¯æ±½è½¦æœ¬èº«å‡ºç°äº†é—®é¢˜ï¼Œè¿˜æ˜¯é©¾é©¶å‘˜é©¾é©¶ä¸å½“å‡ºç°äº†é—®é¢˜ã€‚Nginx äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ç”±æœ¬èº«çš„æ¡†æ¶å’Œç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºæ±½è½¦æœ¬èº«ã€‚å®ƒæœ‰å®Œæ•´çš„ç³»ç»Ÿï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½æœ‰å®ƒæä¾›ã€‚access.log å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªæ±½è½¦ç»è¿‡ä»»ä½•ä¸€ä¸ªåœ°æ–¹å½¢æˆçš„ä¸€ä¸ªGPSè½¨è¿¹ï¼Œerror.log å¯ä»¥ç†è§£ä¸ºæ±½è½¦çš„é»‘åŒ£å­,å½“é‡åˆ°ä¸å¯é¢„æœŸçš„é—®é¢˜æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥æ—¥å¿—æ–‡ä»¶è®°å½•ä¿¡æ¯è¿›è¡Œé—®é¢˜å®šä½ã€‚å¦‚æœè¦å¯¹nginx è¿›è¡Œè¿ç»´åˆ†æï¼Œå¯ä»¥å¯¹access.logè¿›è¡Œåˆ†æã€‚å¦‚æœé‡åˆ°ä¸€äº›æœªçŸ¥çš„é”™è¯¯ï¼Œè¿™æ—¶å°±è¦å¯¹error.logè¿›è¡Œåˆ†æäº†ã€‚ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx é‡è¦é…ç½®æ–‡ä»¶è¯´æ˜ 1. æŸ¥çœ‹é…ç½®æ–‡ä»¶ $ rpm -ql nginx ................................................... /etc/logrotate.d/nginx #nginxæ—¥å¿—åˆ‡å‰²çš„é…ç½®æ–‡ä»¶ /etc/nginx/nginx.conf #nginxä¸»é…ç½®æ–‡ä»¶ /etc/nginx/conf.d #å­é…ç½®æ–‡ä»¶ /etc/nginx/conf.d/default.conf #é»˜è®¤å±•ç¤ºçš„é¡µé¢ä¸€æ · /etc/nginx/mime.types #åª’ä½“ç±»å‹ ï¼ˆhttpåè®®ä¸­çš„æ–‡ä»¶ç±»å‹ï¼‰ /etc/sysconfig/nginx #systemctl ç®¡ç† nginxçš„ä½¿ç”¨çš„æ–‡ä»¶ /usr/lib/systemd/system/nginx.service #systemctl ç®¡ç†nginxï¼ˆå¼€ å…³ é‡å¯ reload) /usr/sbin/nginx #nginxå‘½ä»¤ /usr/share/nginx/html #ç«™ç‚¹ç›®å½• ç½‘ç«™çš„æ ¹ç›®å½• /var/log/nginx #nginxæ—¥å¿— access.log è®¿é—®æ—¥å¿— 2. æŸ¥çœ‹å·²ç»ç¼–è¯‘çš„æ¨¡å— [root@www html]# nginx -V nginx version: nginx/1.20.1 built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) built with OpenSSL 1.1.1k FIPS 25 Mar 2021 TLS SNI support enabled configure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic' --with-ld-opt='-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E' é…ç½®æ–‡ä»¶æ³¨è§£ ç¬¬ä¸€éƒ¨åˆ†ï¼šé…ç½®æ–‡ä»¶ä¸»åŒºåŸŸé…ç½® user nginx; #å®šä¹‰è¿è¡Œnginxè¿›ç¨‹çš„ç”¨æˆ· worker_processes auto; #Nginxè¿è¡Œçš„workè¿›ç¨‹æ•°é‡(å»ºè®®ä¸CPUæ•°é‡ä¸€è‡´æˆ– auto) error_log /var/log/nginx/error.log warn; #nginxé”™è¯¯æ—¥å¿— pid /var/run/nginx.pid; #nginxè¿è¡Œpid ç¬¬äºŒéƒ¨åˆ†ï¼šé…ç½®æ–‡ä»¶äº‹ä»¶åŒºåŸŸ events { worker_connections 1024; #æ¯ä¸ª worker è¿›ç¨‹æ”¯æŒçš„æœ€å¤§è¿æ¥æ•° } ç¬¬ä¸‰éƒ¨åˆ†ï¼šé…ç½®httpåŒºåŸŸ http { include /etc/nginx/mime.types; #Nginxæ”¯æŒçš„åª’ä½“ç±»å‹åº“æ–‡ä»¶ default_type application/octet-stream; #é»˜è®¤çš„åª’ä½“ç±»å‹ log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; #è®¿é—®æ—¥å¿—ä¿å­˜è·¯å¾„ sendfile on; #å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼ #tcp_nopush on; #å¿…é¡»é…åˆtcp_nopushä½¿ç”¨ï¼Œå½“æ•°æ®åŒ…ç´¯è®¡åˆ°ä¸€å®šå¤§å°åå°±å‘é€ keepalive_timeout 65; #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ #gzip on; #å¼€å¯æ–‡ä»¶å‹ç¼© include /etc/nginx/conf.d/*.conf; #åŒ…å«å­é…ç½®æ–‡ä»¶ } ç¬¬å››éƒ¨åˆ†ï¼šå­é…ç½®æ–‡ä»¶å†…å®¹ server { listen 80; #æŒ‡å®šç›‘å¬ç«¯å£ server_name localhost; #æŒ‡å®šç›‘å¬çš„åŸŸå location / { root /usr/share/nginx/html; #å®šä¹‰ç«™ç‚¹çš„ç›®å½• index index.html index.htm; #å®šä¹‰é¦–é¡µæ–‡ä»¶ } } http server location æ‰©å±•äº†è§£é¡¹ http{}å±‚ä¸‹å…è®¸æœ‰å¤šä¸ª Server{}å±‚ï¼Œä¸€ä¸ª Server{}å±‚ä¸‹åˆå…è®¸æœ‰å¤šä¸ª Location http{} æ ‡ç­¾ä¸»è¦ç”¨æ¥è§£å†³ç”¨æˆ·çš„è¯·æ±‚ä¸å“åº”ã€‚ server{} æ ‡ç­¾ä¸»è¦ç”¨æ¥å“åº”å…·ä½“çš„æŸä¸€ä¸ªç½‘ç«™ã€‚ location{} æ ‡ç­¾ä¸»è¦ç”¨äºåŒ¹é…ç½‘ç«™å…·ä½“ URL è·¯å¾„ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:1","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx é…ç½®è¯­æ³• é…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤å’ŒæŒ‡ä»¤å—æ„æˆ æ¯æ¡æŒ‡ä»¤ä»¥ï¼›åˆ†å·ç»“å°¾ï¼ŒæŒ‡ä»¤ä¸å‚æ•°é—´ä»¥ç©ºæ ¼ç¬¦å·åˆ†éš” æŒ‡ä»¤å—ä»¥{} å¤§æ‹¬å·å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ· include è¯­å¥å…è®¸ç»„åˆå¤šä¸ªé…ç½®æ–‡ä»¶ä»¥æå‡å¯ç»´æŠ¤æ€§ ä½¿ç”¨#ç¬¦å·æ·»åŠ æ³¨é‡Šï¼Œæé«˜å¯è¯»æ€§ ä½¿ç”¨$ç¬¦å·ä½¿ç”¨å˜é‡ éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ Nginx è¯­æ³•ç¤ºä¾‹ Nginx è¯­æ³•ç¤ºä¾‹\r","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:2","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"é…ç½®å‚æ•° æ—¶é—´çš„å•ä½ ms: milliseconds s: seconds m: minutes h: hours d: days w: weeks M: months,30 days y: years,.365 days ç©ºé—´çš„å•ä½ bytes kilobytes megabytes gigabytes ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:3","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"http é…ç½®çš„æŒ‡ä»¤å— http server upstream location http é…ç½®çš„æŒ‡ä»¤å—\r","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:4","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"Nginx å‘½ä»¤è¡Œ æ ¼å¼ï¼š nginx- s reload å¸®åŠ©ï¼š -h ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼š -c æŒ‡å®šé…ç½®å‘½ä»¤ï¼š -g æŒ‡å®šè¿è¡Œç›®å½•ï¼š -p å‘é€ä¿¡å·ï¼š-s ç«‹åˆ»åœæ­¢æœåŠ¡ï¼š stop ä¼˜é›…çš„åœæ­¢æœåŠ¡ï¼šquit é‡è½½é…ç½®æ–‡ä»¶ï¼šreload é‡æ–°å¼€å§‹è®°å½•æ—¥å¿—æ–‡ä»¶ï¼šreopen æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼š-t -T æ‰“å°nginx çš„ç‰ˆæœ¬ä¿¡æ¯ã€ç¼–è¯‘ä¿¡æ¯ç­‰ï¼š-v -V ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:6:5","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"å‚è€ƒ http://nginx.org/ https://www.nginx-cn.net/ https://matob.web.id/random/nginx/ ","date":"2022-01-19","objectID":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/:7:0","tags":["Nginx"],"title":"Nginx ä»‹ç»-å¿«é€Ÿäº†è§£","uri":"/nginx%E4%BB%8B%E7%BB%8D-%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3/"},{"categories":["Nginx"],"content":"åŸºæœ¬åŸç† ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:1:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx è¿›ç¨‹æ¨¡å‹ Nginxå¯åŠ¨åä»¥daemonå½¢å¼åœ¨åå°è¿è¡Œï¼Œåå°è¿›ç¨‹åŒ…å«ä¸€ä¸ªmasterè¿›ç¨‹å’Œå¤šä¸ªworkerè¿›ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š [root@www html]# ps -ef --forest|grep nginx|grep -v grep root 59984 1 0 13:23 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 59985 59984 0 13:23 ? 00:00:00 \\_ nginx: worker process nginx 59986 59984 0 13:23 ? 00:00:00 \\_ nginx: worker process nginx 59987 59984 0 13:23 ? 00:00:00 \\_ nginx: worker process nginx 59988 59984 0 13:23 ? 00:00:00 \\_ nginx: worker process nginxæ˜¯ç”±ä¸€ä¸ªmasterç®¡ç†è¿›ç¨‹ï¼Œå¤šä¸ªworkerè¿›ç¨‹å¤„ç†å·¥ä½œçš„å¤šè¿›ç¨‹æ¨¡å‹ã€‚åŸºç¡€æ¶æ„è®¾è®¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Nginx æ¶æ„\rMasterè´Ÿè´£ç®¡ç†workerè¿›ç¨‹ï¼Œworkerè¿›ç¨‹è´Ÿè´£å¤„ç†ç½‘ç»œäº‹ä»¶ã€‚æ•´ä¸ªæ¡†æ¶è¢«è®¾è®¡ä¸ºä¸€ç§ä¾èµ–äº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥ã€éé˜»å¡çš„æ¨¡å¼ã€‚ why â€”â€”ä¸ºä»€ä¹ˆé€‰æ‹©master/worker è¿™ç§æ¨¡å‹ï¼Ÿ å¦‚æ­¤è®¾è®¡çš„ä¼˜ç‚¹æœ‰ï¼š å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸æœºå™¨ï¼Œå¢å¼ºå¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ å¤šworkeré—´å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ Masterç›‘æ§å¹¶ç»Ÿä¸€ç®¡ç†workerè¡Œä¸ºã€‚åœ¨workerå¼‚å¸¸åï¼Œå¯ä»¥ä¸»åŠ¨æ‹‰èµ·workerè¿›ç¨‹ï¼Œä»è€Œæå‡äº†ç³»ç»Ÿçš„å¯é æ€§ã€‚å¹¶ä¸”ç”±Masterè¿›ç¨‹æ§åˆ¶æœåŠ¡è¿è¡Œä¸­çš„ç¨‹åºå‡çº§ã€é…ç½®é¡¹ä¿®æ”¹ç­‰æ“ä½œï¼Œä»è€Œå¢å¼ºäº†æ•´ä½“çš„åŠ¨æ€å¯æ‰©å±•ä¸çƒ­æ›´çš„èƒ½åŠ›ã€‚ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:1:1","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginxè¿›ç¨‹ç»“æ„ Nginx è¿›ç¨‹ç»“æ„\rè¿›ç¨‹ç»“æ„åˆ†ç±» å•è¿›ç¨‹ç»“æ„ é€‚ç”¨ä¸å¼€å‘æµ‹è¯•ç¯å¢ƒ å¤šè¿›ç¨‹ç»“æ„ é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ æ‰€æœ‰çš„worker è¿›ç¨‹æ˜¯å¤„ç†çœŸæ­£çš„è¯·æ±‚çš„ master è¿›ç¨‹æ˜¯ç›‘æ§ worker è¿›ç¨‹æ˜¯ä¸æ˜¯åœ¨æ­£å¸¸çš„å·¥ä½œ ç¼“å­˜æ˜¯è¦åœ¨å¤šä¸ªè¿›ç¨‹é—´è¿›è¡Œå…±äº«çš„ è¿™äº›è¿›ç¨‹é—´çš„é€šè®¯éƒ½æ˜¯ä½¿ç”¨å…±äº«å†…å­˜æ¥è§£å†³çš„ é—®é¢˜ï¼š nginx ä¸ºä»€ä¹ˆä¼šæœ‰å¤šä¸ªworkerè¿›ç¨‹ï¼Ÿ å› ä¸ºnginx æ˜¯é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ä»¥åï¼Œå®ƒå¸Œæœ›æ¯ä¸€ä¸ªworker è¿›ç¨‹ä»å¤´åˆ°å°¾å æœ‰ä¸€é¢— cpu,æ‰€ä»¥æˆ‘ä»¬è¦æŠŠworker è¿›ç¨‹çš„æ•°é‡é…ç½®å’ŒæœåŠ¡å™¨ä¸Šçš„cpuæ ¸æ•°ä¸€è‡´ Nginx æœåŠ¡å™¨ï¼Œæ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸­ï¼š å¤šè¿›ç¨‹ï¼šä¸€ä¸ª Master è¿›ç¨‹ã€å¤šä¸ª Worker è¿›ç¨‹ Master è¿›ç¨‹ï¼šç®¡ç† Worker è¿›ç¨‹ å¯¹å¤–æ¥å£ï¼šæ¥æ”¶å¤–éƒ¨çš„æ“ä½œï¼ˆä¿¡å·ï¼‰ å¯¹å†…è½¬å‘ï¼šæ ¹æ®å¤–éƒ¨çš„æ“ä½œçš„ä¸åŒï¼Œé€šè¿‡ä¿¡å·ç®¡ç† Worker ç›‘æ§ï¼šç›‘æ§ worker è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œworker è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åï¼Œè‡ªåŠ¨é‡å¯ worker è¿›ç¨‹ Worker è¿›ç¨‹ï¼šæ‰€æœ‰ Worker è¿›ç¨‹éƒ½æ˜¯å¹³ç­‰çš„ å®é™…å¤„ç†ï¼šç½‘ç»œè¯·æ±‚ï¼Œç”± Worker è¿›ç¨‹å¤„ç†ï¼› Worker è¿›ç¨‹æ•°é‡ï¼šåœ¨ nginx.conf ä¸­é…ç½®ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºæ ¸å¿ƒæ•°ï¼Œå……åˆ†åˆ©ç”¨ CPU èµ„æºï¼ŒåŒæ—¶ï¼Œé¿å…è¿›ç¨‹æ•°é‡è¿‡å¤šï¼Œé¿å…è¿›ç¨‹ç«äº‰ CPU èµ„æºï¼Œå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æŸè€—ã€‚ HTTP è¿æ¥å»ºç«‹å’Œè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼š Nginx å¯åŠ¨æ—¶ï¼ŒMaster è¿›ç¨‹ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ Master è¿›ç¨‹ï¼Œåˆå§‹åŒ–ç›‘å¬çš„ socket Master è¿›ç¨‹ï¼Œfork å‡ºå¤šä¸ª Worker è¿›ç¨‹ Worker è¿›ç¨‹ï¼Œç«äº‰æ–°çš„è¿æ¥ï¼Œè·èƒœæ–¹é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹ Socket è¿æ¥ï¼Œå¹¶å¤„ç†è¯·æ±‚ Nginx é«˜æ€§èƒ½ã€é«˜å¹¶å‘ï¼š Nginx é‡‡ç”¨ï¼šå¤šè¿›ç¨‹ + å¼‚æ­¥éé˜»å¡æ–¹å¼ï¼ˆIO å¤šè·¯å¤ç”¨ epollï¼‰ è¯·æ±‚çš„å®Œæ•´è¿‡ç¨‹ï¼š å»ºç«‹è¿æ¥ è¯»å–è¯·æ±‚ï¼šè§£æè¯·æ±‚ å¤„ç†è¯·æ±‚ å“åº”è¯·æ±‚ è¯·æ±‚çš„å®Œæ•´è¿‡ç¨‹ï¼Œå¯¹åº”åˆ°åº•å±‚ï¼Œå°±æ˜¯ï¼šè¯»å†™ socket äº‹ä»¶ è¿›ç¨‹ç»“æ„ç¤ºä¾‹æ¼”ç¤º å¯ä»¥çœ‹åˆ°å½“æ‰§è¡Œnginx -s reloadé‡è½½å‘½ä»¤åï¼Œä¼šé‡æ–°ç”Ÿæˆä¸‰ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹id59985 59986 59987 59988å˜æ›´ä¸º62907 62908 62909 62910,åŒç†æ‰§è¡Œkill -SIGHUP 59984 æ˜¯ä¸€æ ·çš„æ•ˆæœ [root@www ~]# ps -ef --forest|grep nginx|grep -v grep root 59984 1 0 13:24 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 59985 59984 0 13:24 ? 00:00:00 \\_ nginx: worker process nginx 59986 59984 0 13:24 ? 00:00:00 \\_ nginx: worker process nginx 59987 59984 0 13:24 ? 00:00:00 \\_ nginx: worker process nginx 59988 59984 0 13:24 ? 00:00:00 \\_ nginx: worker process [root@www ~]# nginx -s reload [root@www ~]# ps -ef --forest|grep nginx|grep -v grep root 59984 1 0 13:24 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 62907 59984 0 17:26 ? 00:00:00 \\_ nginx: worker process nginx 62908 59984 0 17:26 ? 00:00:00 \\_ nginx: worker process nginx 62909 59984 0 17:26 ? 00:00:00 \\_ nginx: worker process nginx 62910 59984 0 17:26 ? 00:00:00 \\_ nginx: worker process å•ç‹¬å‘é€ç»ˆæ­¢ä¿¡å·ç»ˆæ­¢ä¸€ä¸ª worker è¿›ç¨‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ [root@www ~]# ps -ef --forest|grep nginx|grep -v grep root 59984 1 0 13:24 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 62918 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62919 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62920 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62921 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process [root@www ~]# kill -SIGTERM 62918 [root@www ~]# ps -ef --forest|grep nginx|grep -v grep root 59984 1 0 13:24 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 62919 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62920 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62921 59984 0 17:31 ? 00:00:00 \\_ nginx: worker process nginx 62928 59984 0 17:33 ? 00:00:00 \\_ nginx: worker process ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:1:2","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Master è¿›ç¨‹ æ ¸å¿ƒé€»è¾‘ masterè¿›ç¨‹çš„ä¸»é€»è¾‘åœ¨ngx_master_process_cycleï¼Œæ ¸å¿ƒå…³æ³¨æºç ï¼š ngx_master_process_cycle(ngx_cycle_t cycle) { ... ngx_start_worker_processes(cycle, ccf-worker_processes, NGX_PROCESS_RESPAWN); ... for ( ;; ) { if (delay) {...} ngx_log_debug0(NGX_LOG_DEBUG_EVENT, cycle-log, 0, sigsuspend); sigsuspend(\u0026set); ngx_time_update(); ngx_log_debug1(NGX_LOG_DEBUG_EVENT, cycle-log, 0, wake up, sigio %i, sigio); if (ngx_reap) { ngx_reap = 0; ngx_log_debug0(NGX_LOG_DEBUG_EVENT, cycle-log, 0, reap children); live = ngx_reap_children(cycle); } if (!live \u0026\u0026 (ngx_terminate ngx_quit)) {...} if (ngx_terminate) {...} if (ngx_quit) {...} if (ngx_reconfigure) {...} if (ngx_restart) {...} if (ngx_reopen) {...} if (ngx_change_binary) {...} if (ngx_noaccept) { ngx_noaccept = 0; ngx_noaccepting = 1; ngx_signal_worker_processes(cycle, ngx_signal_value(NGX_SHUTDOWN_SIGNAL)); } } } ç”±ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç†è§£ï¼Œmasterè¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç†workerè¿›ç¨‹ï¼Œå…·ä½“åŒ…æ‹¬å¦‚ä¸‹4ä¸ªä¸»è¦åŠŸèƒ½ï¼š 1.æ¥å—æ¥è‡ªå¤–ç•Œçš„ä¿¡å·ã€‚å…¶ä¸­masterå¾ªç¯ä¸­çš„å„é¡¹æ ‡å¿—ä½å°±å¯¹åº”ç€å„ç§ä¿¡å·ï¼Œå¦‚ï¼šngx_quitä»£è¡¨QUITä¿¡å·ï¼Œè¡¨ç¤ºä¼˜é›…çš„å…³é—­æ•´ä¸ªæœåŠ¡ã€‚ 2.å‘å„ä¸ªworkerè¿›ç¨‹å‘é€ä¿¡ã€‚æ¯”å¦‚ngx_noacceptä»£è¡¨WINCHä¿¡å·ï¼Œè¡¨ç¤ºæ‰€æœ‰å­è¿›ç¨‹ä¸å†æ¥å—å¤„ç†æ–°çš„è¿æ¥ï¼Œç”±masterå‘æ‰€æœ‰çš„å­è¿›ç¨‹å‘é€QUITä¿¡å·é‡ã€‚ 3.ç›‘æ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚æ¯”å¦‚ngx_reapä»£è¡¨CHILDä¿¡å·ï¼Œè¡¨ç¤ºæœ‰å­è¿›ç¨‹æ„å¤–ç»“æŸï¼Œè¿™æ—¶éœ€è¦ç›‘æ§æ‰€æœ‰å­è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œä¸»è¦ç”±ngx_reap_childrenå®Œæˆã€‚ 4.å½“wokerè¿›ç¨‹é€€å‡ºåï¼ˆå¼‚å¸¸æƒ…å†µä¸‹ï¼‰ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„wokerè¿›ç¨‹ã€‚ä¸»è¦ä¹Ÿæ˜¯åœ¨ngx_reap_children ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:1:3","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx è¿›ç¨‹ç®¡ç†ï¼šä¿¡å· å¤šè¿›ç¨‹ä¹‹é—´é€šè®¯å¯ä»¥ä½¿ç”¨ä¿¡å·ã€å…±äº«å†…å­˜ç­‰ï¼Œå½“è¿›è¡Œ Nginx è¿›ç¨‹é—´çš„ç®¡ç†æ—¶é€šå¸¸åªä½¿ç”¨ä¿¡å· Nginx è¿›ç¨‹ç®¡ç†ï¼šä¿¡å·\rè¿™é‡Œå¯ä»¥çœ‹åˆ°worker è¿›ç¨‹æ¥æ”¶åˆ°çš„ä¿¡å·å’Œmaster è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å¯¹worker è¿›ç¨‹ç›´æ¥å‘é€ä¿¡å·å‘¢ï¼Œæ˜¯å› ä¸ºéœ€è¦é€šè¿‡master è¿›ç¨‹æ¥è¿›è¡Œç®¡ç†ï¼Œè¿™ä¹Ÿæ˜¯æ­£å¸¸çš„å¤„ç†æ–¹å¼ã€‚ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:1:4","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx reloadçƒ­æ›´æ–° Nginx reloadçƒ­æ›´æ–°\r","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:2:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"ä¸åœæœºè½½å…¥æ–°é…ç½® Nginx ä¸åœæœºè½½å…¥æ–°é…ç½®\r","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:2:1","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"çƒ­é‡è½½-é…ç½®çƒ­æ›´ Nginx çƒ­é‡è½½-é…ç½®çƒ­æ›´\rNginxçƒ­æ›´é…ç½®æ—¶ï¼Œå¯ä»¥ä¿æŒè¿è¡Œä¸­å¹³æ»‘æ›´æ–°é…ç½®ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š æ›´æ–°nginx.confé…ç½®æ–‡ä»¶ï¼Œå‘masterå‘é€SIGHUPä¿¡å·æˆ–æ‰§è¡Œnginx -s reload Masterè¿›ç¨‹ä½¿ç”¨æ–°é…ç½®ï¼Œå¯åŠ¨æ–°çš„workerè¿›ç¨‹ ä½¿ç”¨æ—§é…ç½®çš„workerè¿›ç¨‹ï¼Œä¸å†æ¥å—æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶åœ¨å®Œæˆå·²å­˜åœ¨çš„è¿æ¥åé€€å‡º ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:2:2","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx çƒ­å‡çº§-ç¨‹åºçƒ­æ›´ Nginx ç‰ˆæœ¬çƒ­å‡çº§\rnginxçƒ­å‡çº§è¿‡ç¨‹å¦‚ä¸‹ï¼š å°†æ—§Nginxæ–‡ä»¶æ¢æˆæ–°Nginxæ–‡ä»¶ï¼ˆæ³¨æ„å¤‡ä»½ï¼‰ å‘masterè¿›ç¨‹å‘é€USR2ä¿¡å·ï¼ˆå¹³æ»‘å‡çº§åˆ°æ–°ç‰ˆæœ¬çš„Nginxç¨‹åºï¼‰ masterè¿›ç¨‹ä¿®æ”¹pidæ–‡ä»¶å·ï¼ŒåŠ åç¼€.oldbin masterè¿›ç¨‹ç”¨æ–°Nginxæ–‡ä»¶å¯åŠ¨æ–°masterè¿›ç¨‹ï¼Œæ­¤æ—¶æ–°è€master/workeråŒæ—¶å­˜åœ¨ã€‚ å‘è€masterå‘é€WINCHä¿¡å·ï¼Œå…³é—­æ—§workerè¿›ç¨‹ï¼Œè§‚å¯Ÿæ–°workerè¿›ç¨‹å·¥ä½œæƒ…å†µã€‚è‹¥å‡çº§æˆåŠŸï¼Œåˆ™å‘è€masterè¿›ç¨‹å‘é€QUITä¿¡å·ï¼Œå…³é—­è€masterè¿›ç¨‹ï¼›è‹¥å‡çº§å¤±è´¥ï¼Œåˆ™éœ€è¦å›æ»šï¼Œå‘è€masterå‘é€HUPä¿¡å·ï¼ˆé‡è¯»é…ç½®æ–‡ä»¶ï¼‰ï¼Œå‘æ–°masterå‘é€QUITä¿¡å·ï¼Œå…³é—­æ–°masteråŠworkerã€‚ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:2:3","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Worker è¿›ç¨‹ æ ¸å¿ƒé€»è¾‘ workerè¿›ç¨‹çš„ä¸»é€»è¾‘åœ¨ngx_worker_process_cycleï¼Œæ ¸å¿ƒå…³æ³¨æºç ï¼š ngx_worker_process_cycle(ngx_cycle_t cycle, void data) { ngx_int_t worker = (intptr_t) data; ngx_process = NGX_PROCESS_WORKER; ngx_worker = worker; ngx_worker_process_init(cycle, worker); ngx_setproctitle(worker process); for ( ;; ) { if (ngx_exiting) {...} ngx_log_debug0(NGX_LOG_DEBUG_EVENT, cycle-log, 0, worker cycle); ngx_process_events_and_timers(cycle); if (ngx_terminate) {...} if (ngx_quit) {...} if (ngx_reopen) {...} } } ç”±ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç†è§£ï¼Œworkerè¿›ç¨‹ä¸»è¦åœ¨å¤„ç†ç½‘ç»œäº‹ä»¶ï¼Œé€šè¿‡ngx_process_events_and_timersæ–¹æ³•å®ç°ï¼Œå…¶ä¸­äº‹ä»¶ä¸»è¦åŒ…æ‹¬ï¼šç½‘ç»œäº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€‚ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:3:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx çš„äº‹ä»¶å¤„ç†æ¨¡å‹ requestï¼šNginx ä¸­ http è¯·æ±‚ã€‚ åŸºæœ¬çš„ HTTP Web Server å·¥ä½œæ¨¡å¼ï¼š æ¥æ”¶è¯·æ±‚ï¼šé€è¡Œè¯»å–è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ï¼Œåˆ¤æ–­æ®µæœ‰è¯·æ±‚ä½“åï¼Œè¯»å–è¯·æ±‚ä½“ å¤„ç†è¯·æ±‚ è¿”å›å“åº”ï¼šæ ¹æ®å¤„ç†ç»“æœï¼Œç”Ÿæˆç›¸åº”çš„ HTTP è¯·æ±‚ï¼ˆå“åº”è¡Œã€å“åº”å¤´ã€å“åº”ä½“ï¼‰ Nginx ä¹Ÿæ˜¯è¿™ä¸ªå¥—è·¯ï¼Œæ•´ä½“æµç¨‹ä¸€è‡´ã€‚ Nginx è¯·æ±‚æµç¨‹\r","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:4:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx æ¨¡å— ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:5:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx æ¨¡å—åŒ–ä½“ç³»ç»“æ„ Nginx æ¨¡å—åŒ–ä½“ç³»ç»“æ„\rnginxçš„æ¨¡å—æ ¹æ®å…¶åŠŸèƒ½åŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š event module: æ­å»ºäº†ç‹¬ç«‹äºæ“ä½œç³»ç»Ÿçš„äº‹ä»¶å¤„ç†æœºåˆ¶çš„æ¡†æ¶ï¼ŒåŠæä¾›äº†å„å…·ä½“äº‹ä»¶çš„å¤„ç†ã€‚åŒ…æ‹¬ngx_events_moduleï¼Œ ngx_event_core_moduleå’Œngx_epoll_moduleç­‰ã€‚nginxå…·ä½“ä½¿ç”¨ä½•ç§äº‹ä»¶å¤„ç†æ¨¡å—ï¼Œè¿™ä¾èµ–äºå…·ä½“çš„æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘é€‰é¡¹ã€‚ phase handler: æ­¤ç±»å‹çš„æ¨¡å—ä¹Ÿè¢«ç›´æ¥ç§°ä¸ºhandleræ¨¡å—ã€‚ä¸»è¦è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶äº§ç”Ÿå¾…å“åº”å†…å®¹ï¼Œæ¯”å¦‚ngx_http_static_moduleæ¨¡å—ï¼Œè´Ÿè´£å®¢æˆ·ç«¯çš„é™æ€é¡µé¢è¯·æ±‚å¤„ç†å¹¶å°†å¯¹åº”çš„ç£ç›˜æ–‡ä»¶å‡†å¤‡ä¸ºå“åº”å†…å®¹è¾“å‡ºã€‚ output filter: ä¹Ÿç§°ä¸ºfilteræ¨¡å—ï¼Œä¸»è¦æ˜¯è´Ÿè´£å¯¹è¾“å‡ºçš„å†…å®¹è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥å¯¹è¾“å‡ºè¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®ç°å¯¹è¾“å‡ºçš„æ‰€æœ‰htmlé¡µé¢å¢åŠ é¢„å®šä¹‰çš„footbarä¸€ç±»çš„å·¥ä½œï¼Œæˆ–è€…å¯¹è¾“å‡ºçš„å›¾ç‰‡çš„URLè¿›è¡Œæ›¿æ¢ä¹‹ç±»çš„å·¥ä½œã€‚ upstream: upstreamæ¨¡å—å®ç°åå‘ä»£ç†çš„åŠŸèƒ½ï¼Œå°†çœŸæ­£çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä»åç«¯æœåŠ¡å™¨ä¸Šè¯»å–å“åº”ï¼Œå‘å›å®¢æˆ·ç«¯ã€‚upstreamæ¨¡å—æ˜¯ä¸€ç§ç‰¹æ®Šçš„handlerï¼Œåªä¸è¿‡å“åº”å†…å®¹ä¸æ˜¯çœŸæ­£ç”±è‡ªå·±äº§ç”Ÿçš„ï¼Œè€Œæ˜¯ä»åç«¯æœåŠ¡å™¨ä¸Šè¯»å–çš„ã€‚ load-balancer: è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå®ç°ç‰¹å®šçš„ç®—æ³•ï¼Œåœ¨ä¼—å¤šçš„åç«¯æœåŠ¡å™¨ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨å‡ºæ¥ä½œä¸ºæŸä¸ªè¯·æ±‚çš„è½¬å‘æœåŠ¡å™¨ã€‚ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:5:1","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx æ¨¡å—ä»‹ç» Nginxä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§å°±æ˜¯æ‹¥æœ‰ä¸°å¯Œçš„æ¨¡å—ï¼Œæœ‰æ ¸å¿ƒçš„æ¨¡å—ï¼Œæ‹“å±•çš„æ¨¡å—å’Œç¬¬ä¸‰æ–¹æ‹“å±•æ¨¡å—ã€‚ Nginxæ¨¡å—ä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š æ ¸å¿ƒæ¨¡å—ï¼š HTTP æ¨¡å—ï¼šç”¨æ¥å‘å¸ƒhttp webæœåŠ¡ç½‘ç«™çš„æ¨¡å—ã€‚ eventæ¨¡å—ï¼šç”¨æ¥å¤„ç†nginx è®¿é—®è¯·æ±‚ï¼Œå¹¶è¿›è¡Œå›å¤ã€‚ åŸºæœ¬æ¨¡å—ï¼š HTTP Accessæ¨¡å—: ç”¨æ¥è¿›è¡Œè™šæ‹Ÿä¸»æœºå‘å¸ƒè®¿é—®æ¨¡å—ï¼Œèµ·åˆ°è®°å½•è®¿é—®æ—¥å¿—ã€‚ HTTP FastCGIæ¨¡å—ï¼šç”¨äºå’ŒPHPç¨‹åºè¿›è¡Œäº¤äº’çš„æ¨¡å—ï¼Œè´Ÿè´£å°†æ¥è®¿é—®nginx çš„PHPè¯·æ±‚è½¬å‘åˆ°åç«¯çš„PHPä¸Šã€‚ HTTP Proxyæ¨¡å—ï¼šé…ç½®åå‘ä»£ç†è½¬å‘çš„æ¨¡å—ï¼Œè´Ÿè´£å‘åç«¯ä¼ é€’å‚æ•°ã€‚ HTTP Rewriteæ¨¡å—ï¼šæ”¯æŒRewrite è§„åˆ™é‡å†™ï¼Œæ”¯æŒåŸŸåè·³è½¬ã€‚ Nginx æ¨¡å—ä¸­çš„å†…èšå’ŒæŠ½è±¡ Nginx æ¨¡å—ä¸­çš„å†…èšå’ŒæŠ½è±¡\rNginx æ¨¡å—åˆ†ç±» Nginx æ¨¡å—åˆ†ç±»\ræ¨¡å—çš„ä½¿ç”¨: å¦‚æˆ‘ä»¬æƒ³è¦æ‰“å¼€gzip å‹ç¼©ï¼Œå¯ä»¥åœ¨Nginx æ¨¡å—å®˜ç½‘ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ¨¡å—å‚è€ƒngx_http_gzip_module,æŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹ ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:5:2","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"Nginx è¿›ç¨‹é—´æ¶æ„å›¾ Nginx è¿›ç¨‹é—´æ¶æ„å›¾\r","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:6:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"é™„å½• ç™¾ä¸‡å¹¶å‘ä¸‹ Nginx çš„ä¼˜åŒ–ä¹‹é“ Nginx vs Apache ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:7:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":"å‚è€ƒ https://aosabook.org/en/v2/nginx.html https://www.fatalerrors.org/a/analysis-of-nginx-architecture.html Nginx å¹³å°åˆæ¢ https://www.bilibili.com/video/BV1KP4y1M75J?p=5\u0026vd_source=7e8c74e6ef5f4645e4247ef4120b7971 https://www.bilibili.com/video/BV1rY411E795/?spm_id_from=333.788.recommend_more_video.0\u0026vd_source=7e8c74e6ef5f4645e4247ef4120b7971 ","date":"2022-01-16","objectID":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/:8:0","tags":["Nginx"],"title":"Nginx æ¶æ„åŸç†","uri":"/nginx-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/"},{"categories":["Nginx"],"content":" æ–¹å¼ä¸€ï¼šyum å®‰è£…(Redhat) æ–¹å¼äºŒï¼šäºŒè¿›åˆ¶é¢„ç¼–è¯‘å®‰è£… æŒ‡å®šå®‰è£…ç‰ˆæœ¬ å®‰è£…æ“ä½œç³»ç»Ÿç‰ˆæœ¬CentOs7.x ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:0:0","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ–¹å¼ä¸€ï¼š yum åŒ…ç®¡ç†å™¨å®‰è£… è¿™é‡Œé€‰æ‹©é€šè¿‡yum æºè¿›è¡Œå®‰è£…ï¼Œå®‰è£…æ“ä½œç³»ç»Ÿä¸ºLinux CentOS 7.9 CentOs é…ç½®é˜¿é‡Œäº‘ yum æº # å¤‡ä»½ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup # ä¸‹è½½yum æº wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo # æ¸…é™¤yumç¼“å­˜ yum clean all # ç¼“å­˜é˜¿é‡Œäº‘æº yum makecache # æµ‹è¯•é˜¿é‡Œäº‘æº yum list å®‰è£…ä¾èµ–åŒ…ï¼Œ EPEL ä»“åº“ä¸­æœ‰ Nginx çš„å®‰è£…åŒ… yum install openssl-devel pcre-devel epel-release -y å®‰è£…nginx æœåŠ¡ # æŸ¥çœ‹å®‰è£…æä¾›çš„ç‰ˆæœ¬ $ sudo yum list nginx --showduplicates | sort -r å·²åŠ è½½æ’ä»¶ï¼šfastestmirror å·²å®‰è£…çš„è½¯ä»¶åŒ… å¯å®‰è£…çš„è½¯ä»¶åŒ… * updates: mirrors.aliyun.com nginx.x86_64 1:1.20.1-10.el7 epel nginx.x86_64 1:1.20.1-10.el7 @epel Loading mirror speeds from cached hostfile * extras: mirrors.aliyun.com * epel: pubmirror1.math.uh.edu * base: mirrors.aliyun.com # å®‰è£…æŒ‡å®šç‰ˆæœ¬ yum install nginx-1.20.1 -y # or æ·»åŠ  Nginx æº rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm # æŸ¥çœ‹nginx ç‰ˆæœ¬ $ nginx -v nginx version: nginx/1.20.1 å¯åŠ¨æœåŠ¡å¹¶é…ç½®å¼€æœºè‡ªå¯åŠ¨ systemctl start nginx systemctl eable nginx æµ‹è¯• curl 192.168.1.20 æµè§ˆå™¨è®¿é—® # å…³é—­é˜²ç«å¢™ systemctl stop firewalld ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:1:0","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ–¹å¼äºŒï¼šäºŒè¿›åˆ¶é¢„ç¼–è¯‘å®‰è£… åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Nginxçš„äºŒè¿›åˆ¶ç‰ˆæœ¬é€šå¸¸æŒ‡çš„æ˜¯ä»Nginxå®˜æ–¹ç½‘ç«™ä¸‹è½½é¢„ç¼–è¯‘çš„è½¯ä»¶åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡åŒ…ç®¡ç†å™¨ï¼ˆå¦‚aptæˆ–yumï¼‰è¿›è¡Œå®‰è£…ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹Nginx 1.20.1ç‰ˆæœ¬çš„äºŒè¿›åˆ¶å®‰è£…æ­¥éª¤ï¼š ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:0","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 1: ä¸‹è½½ Nginx é¦–å…ˆï¼Œä½ éœ€è¦è®¿é—®Nginxå®˜æ–¹ç½‘ç«™æ‰¾åˆ°1.20.1ç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥ã€‚å¯¹äºç¨³å®šç‰ˆï¼Œä½ å¯ä»¥ä½¿ç”¨wgetå‘½ä»¤ç›´æ¥ä¸‹è½½ï¼š wget https://nginx.org/download/nginx-1.20.1.tar.gz ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:1","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 2: è§£å‹ä¸‹è½½çš„æ–‡ä»¶ ä¸‹è½½å®Œæˆåï¼Œè§£å‹ç¼©æ–‡ä»¶åˆ°å½“å‰ç›®å½•ï¼š tar -zxvf nginx-1.20.1.tar.gz è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºnginx-1.20.1çš„æ–‡ä»¶å¤¹ã€‚ ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:2","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 3: é…ç½®å’Œç¼–è¯‘ è¿›å…¥è§£å‹åçš„ç›®å½•å¹¶å‡†å¤‡ç¼–è¯‘Nginxã€‚é¦–å…ˆè¿è¡Œé…ç½®è„šæœ¬ä»¥è®¾ç½®ç¼–è¯‘ç¯å¢ƒï¼š cd nginx-1.20.1 ./configure é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šè¿°å‘½ä»¤ä¼šä½¿ç”¨é»˜è®¤é…ç½®è¿›è¡Œç¼–è¯‘ã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰å®‰è£…è·¯å¾„æˆ–å…¶ä»–é€‰é¡¹ï¼Œå¯ä»¥æ·»åŠ ç›¸åº”çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®šä¸åŒçš„å®‰è£…å‰ç¼€è·¯å¾„ï¼š ./configure --prefix=/data/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_stub_status_module --with-http_gzip_static_module --with-http_addition_module --with-pcre --with-stream é…ç½®å®Œæˆåï¼Œç¼–è¯‘æºä»£ç ï¼š make ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:3","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 4: å®‰è£… ç¼–è¯‘æˆåŠŸåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…Nginxï¼š sudo make install è¿™å°†ä¼šæŠŠNginxå®‰è£…åˆ°ä½ ä¹‹å‰é…ç½®æ—¶æŒ‡å®šçš„ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯/data/nginxã€‚ ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:4","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 5: è®¾ç½®è½¯é“¾æ¥ï¼ˆå¯é€‰ï¼‰ å¦‚æœä½ å¸Œæœ›ç®€åŒ–Nginxå‘½ä»¤çš„è°ƒç”¨ï¼Œå¯ä»¥ä¸ºNginxåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥åˆ°ç³»ç»Ÿçš„sbinç›®å½•ä¸­ï¼š sudo ln -s /data/nginx/sbin/nginx /usr/local/sbin/nginx è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥ä½¿ç”¨nginxå‘½ä»¤æ¥ç®¡ç†å’Œæ“ä½œNginxæœåŠ¡å™¨äº†ã€‚ ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:5","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 6: å¯åŠ¨ Nginx å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨Nginxï¼š nginx # æŒ‡å®šé…ç½®æ–‡ä»¶ nginx -c /data/nginx/conf/nginx.conf å¦‚æœä½ æƒ³æ£€æŸ¥Nginxé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¯ä»¥åœ¨å¯åŠ¨å‰ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•é…ç½®æ–‡ä»¶ï¼š nginx -t æŒ‡å®šé…ç½®æ–‡ä»¶æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£å¸¸ sudo nginx -t -c /path/to/your/nginx.conf é‡æ–°åŠ è½½Nginxé…ç½® sudo nginx -s reload -c /path/to/your/nginx.conf ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:6","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤7 æ·»åŠ åˆ°shell é…ç½®æ–‡ä»¶ä¸­ æ·»åŠ åˆ°ä½ çš„shellé…ç½®æ–‡ä»¶ï¼ˆå¦‚.bashrcæˆ–.profileï¼‰ä¸­ echo 'export PATH=$PATH:/usr/local/sbin' \u003e\u003e ~/.bashrc source ~/.bashrc ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:7","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ­¥éª¤ 8: é…ç½®é˜²ç«å¢™å’ŒSELinuxï¼ˆå¦‚æœé€‚ç”¨ï¼‰ æ ¹æ®ä½ çš„æœåŠ¡å™¨å®‰å…¨è®¾ç½®ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´é˜²ç«å¢™è§„åˆ™å…è®¸HTTP(S)æµé‡ï¼Œå¹¶ä¸”å¦‚æœå¯ç”¨äº†SELinuxï¼Œåˆ™å¯èƒ½è¿˜éœ€è¦å¯¹å…¶è¿›è¡Œé€‚å½“çš„é…ç½®ä»¥ä¾¿è®©Nginxæ­£å¸¸å·¥ä½œã€‚ ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:8","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"æ³¨æ„äº‹é¡¹ ä¾èµ–åº“ï¼šç¡®ä¿ç³»ç»Ÿå·²å®‰è£…å¿…è¦çš„ä¾èµ–åº“ï¼Œå¦‚PCREã€Zlibå’ŒOpenSSLç­‰ï¼Œè¿™äº›å¯¹äºNginxçš„ä¸€äº›åŠŸèƒ½æ˜¯å¿…éœ€çš„ã€‚å¦‚æœä½ åœ¨./configureé˜¶æ®µé‡åˆ°ç¼ºå°‘ä¾èµ–çš„é—®é¢˜ï¼Œä½ å¯èƒ½éœ€è¦å…ˆå®‰è£…è¿™äº›ä¾èµ–ã€‚ æ›´æ–°ä¸ç»´æŠ¤ï¼šè™½ç„¶å¯ä»¥ä»äºŒè¿›åˆ¶å®‰è£…å¼€å§‹ï¼Œä½†åç»­çš„æ›´æ–°å¯èƒ½ä¼šæ¯”é€šè¿‡åŒ…ç®¡ç†å™¨æ›´åŠ å¤æ‚ã€‚å»ºè®®å®šæœŸæ£€æŸ¥Nginxå®˜ç½‘è·å–æœ€æ–°çš„å®‰å…¨è¡¥ä¸å’Œç‰ˆæœ¬æ›´æ–°ã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ°åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Nginx 1.20.1çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚ Nginx è®¿é—®é¦–é¡µ\r","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:2:9","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"Nginx ç®¡ç† ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:3:0","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"1. é€šè¿‡systemctlæˆ–è€…serviceç®¡ç† nginx -t systemctl start nginx systemctl reload nginx systemctl restart nginx systemctl stop nginx ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:3:1","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"2. é€šè¿‡nginxåŸç”Ÿå‘½ä»¤ç®¡ç† è®¾ç½®nginx è½¯è¿æ¥ sudo ln -s /PATH/nginx/sbin/nginx /usr/local/sbin/nginx æŸ¥æ‰¾NginxäºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½® é€šå¸¸ï¼ŒNginxçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº/usr/sbin/nginxï¼Œä½†è¿™ä¹Ÿå¯èƒ½æ ¹æ®ä½ çš„å®‰è£…ä½ç½®æœ‰æ‰€ä¸åŒã€‚å¦‚æœä¸ç¡®å®šï¼Œå¯ä»¥ä½¿ç”¨which nginxæˆ–whereis nginxæ¥æŸ¥æ‰¾ã€‚ which nginx æˆ–è€… whereis nginx æ£€æŸ¥Nginxé…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡® åœ¨å¯åŠ¨æˆ–é‡æ–°åŠ è½½Nginxä¹‹å‰ï¼Œå»ºè®®å…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æœ‰è¯¯ã€‚ $ nginx -t è¿™å°†æµ‹è¯•é…ç½®æ–‡ä»¶çš„æœ‰æ•ˆæ€§ï¼Œå¹¶å‘ŠçŸ¥ä½ æ˜¯å¦å­˜åœ¨ä»»ä½•è¯­æ³•é”™è¯¯ã€‚ å¯åŠ¨Nginx è¦å¯åŠ¨Nginxï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š $ nginx å¦‚æœæ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼ŒNginxä¼šé»˜è®¤å¯»æ‰¾ä½äº/etc/nginx/nginx.confçš„ä¸»é…ç½®æ–‡ä»¶ã€‚å¦‚æœä½ æƒ³æŒ‡å®šä¸€ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨-cé€‰é¡¹ï¼š $ nginx -c /path/to/nginx.conf åœæ­¢Nginx æœ‰å‡ ç§æ–¹å¼å¯ä»¥åœæ­¢Nginxï¼š å¿«é€Ÿåœæ­¢ï¼šç«‹å³åœæ­¢Nginxï¼Œä¸ç­‰å¾…å½“å‰å¤„ç†çš„è¯·æ±‚å®Œæˆã€‚ $ nginx -s stop ä¼˜é›…åœ°åœæ­¢ï¼ˆæ¨èï¼‰ï¼šå…è®¸Nginxå®Œæˆå½“å‰æ­£åœ¨å¤„ç†çš„æ‰€æœ‰è¯·æ±‚åå†åœæ­¢ã€‚ $ nginx -s quit é‡æ–°åŠ è½½Nginxé…ç½® å½“ä½ ä¿®æ”¹äº†Nginxé…ç½®æ–‡ä»¶å¹¶å¸Œæœ›é‡æ–°åŠ è½½è€Œä¸ä¸­æ–­ç°æœ‰è¿æ¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š $ nginx -s reload è¿™ä¸ªå‘½ä»¤ä¼šå‘Šè¯‰Nginxé‡æ–°åŠ è½½å…¶é…ç½®æ–‡ä»¶ã€‚å¦‚æœæœ‰ä»»ä½•è¯­æ³•é”™è¯¯ï¼ŒNginxå°†å¿½ç•¥æ­¤å‘½ä»¤å¹¶ä¸ä¼šé‡æ–°åŠ è½½é…ç½®ã€‚ é‡å¯Nginx è™½ç„¶æ²¡æœ‰ç›´æ¥çš„â€œé‡å¯â€å‘½ä»¤ï¼Œä½†ä½ å¯ä»¥ç»„åˆä½¿ç”¨ä¸Šè¿°å‘½ä»¤å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå…ˆå‘é€åœæ­¢ä¿¡å·å†å¯åŠ¨Nginxï¼š $ nginx -s quit \u0026\u0026 /usr/sbin/nginx ä¸è¿‡ï¼Œæ›´å¸¸ç”¨çš„æ˜¯ç®€å•åœ°ä½¿ç”¨reloadå‘½ä»¤ï¼Œå®ƒå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ»¡è¶³éœ€æ±‚è€Œä¸éœ€è¦å®Œå…¨é‡å¯æœåŠ¡ã€‚ æ³¨æ„äº‹é¡¹ åœ¨æ‰§è¡Œè¿™äº›æ“ä½œå‰ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™ã€‚é€šå¸¸éœ€è¦ä»¥rootç”¨æˆ·æˆ–ä½¿ç”¨sudoæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚ ç›´æ¥ä½¿ç”¨Nginxå‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç®¡ç†æ—¶ï¼Œæ³¨æ„ä¸è¦ä¸systemctlæˆ–serviceåŒæ—¶ä½¿ç”¨ï¼Œä»¥å…é€ æˆå†²çªæˆ–æ„å¤–çš„æœåŠ¡çŠ¶æ€å˜åŒ–ã€‚ æ€»æ˜¯å…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼ˆä½¿ç”¨nginx -tï¼‰ï¼Œç„¶åå†å°è¯•é‡æ–°åŠ è½½æˆ–é‡å¯æœåŠ¡ï¼Œä»¥é¿å…å› é…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚ ","date":"2022-01-15","objectID":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/:3:2","tags":["Nginx"],"title":"Nginx å®‰è£…éƒ¨ç½²","uri":"/nginx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"},{"categories":["Nginx"],"content":"èƒŒæ™¯ æ•´ç†åœ¨ä½¿ç”¨ Nginx è¿‡ç¨‹ä¸­é¢‘ç¹ä½¿ç”¨çš„Nginx å¸¸ç”¨é…ç½®ï¼Œå¦å¤–è¡¥å……ä¸€äº›å¸¸ç”¨å‘½ä»¤å’Œè§£å†³æ–¹æ¡ˆ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:1:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx å‘½ä»¤è¡Œå¸¸ç”¨å‘½ä»¤ nginx -s reload # å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œçƒ­é‡å¯ nginx -s reopen # é‡å¯ Nginx nginx -s stop # å¿«é€Ÿå…³é—­ nginx -s quit # ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­ nginx -t # æŸ¥çœ‹å½“å‰ Nginx é…ç½®æ˜¯å¦æœ‰é”™è¯¯ nginx -t -c \u003cé…ç½®è·¯å¾„\u003e # æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰é—®é¢˜ï¼Œå¦‚æœå·²ç»åœ¨é…ç½®ç›®å½•ï¼Œåˆ™ä¸éœ€è¦ - c ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:2:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"å¸¸ç”¨æ¨¡å— nginxæ¨¡å—åˆ†ä¸ºä¸¤ç§ï¼Œå®˜æ–¹å’Œç¬¬ä¸‰æ–¹ï¼Œæˆ‘ä»¬é€šè¿‡å‘½ä»¤ nginx -V æŸ¥çœ‹ nginxå·²ç»å®‰è£…çš„æ¨¡å— [root@www ~]# nginx -V nginx version: nginx/1.20.1 built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) built with OpenSSL 1.1.1k FIPS 25 Mar 2021 TLS SNI support enabled configure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic' --with-ld-opt='-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E' Nginxæ¨¡å—åç§° æ¨¡å—ä½œç”¨ ngx_http_access_module å››å±‚åŸºäºIPçš„è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡åŒ¹é…å®¢æˆ·ç«¯æºIPåœ°å€è¿›è¡Œé™åˆ¶ ngx_http_auth_basic_module çŠ¶æ€é¡µï¼Œä½¿ç”¨basicæœºåˆ¶è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œåœ¨ç¼–è¯‘å®‰è£…nginxçš„æ—¶å€™éœ€è¦æ·»åŠ ç¼–è¯‘å‚æ•°â€“withhttp_stub_status_moduleï¼Œå¦åˆ™é…ç½®å®Œæˆä¹‹åç›‘æµ‹ä¼šæ˜¯æç¤ºè¯­æ³•é”™è¯¯ ngx_http_stub_status_module çŠ¶æ€ç»Ÿè®¡æ¨¡å— ngx_http_gzip_module æ–‡ä»¶çš„å‹ç¼©åŠŸèƒ½ ngx_http_gzip_static_module é™æ€å‹ç¼©æ¨¡å— ngx_http_ssl_module nginx çš„https åŠŸèƒ½ ngx_http_rewrite_module é‡å®šå‘æ¨¡å—ï¼Œè§£æå’Œå¤„ç†rewriteè¯·æ±‚ ngx_http_referer_module é˜²ç›—é“¾åŠŸèƒ½ï¼ŒåŸºäºè®¿é—®å®‰å…¨è€ƒè™‘ ngx_http_proxy_module å°†å®¢æˆ·ç«¯çš„è¯·æ±‚ä»¥httpåè®®è½¬å‘è‡³æŒ‡å®šæœåŠ¡å™¨è¿›è¡Œå¤„ç† ngx_stream_proxy_module tcpè´Ÿè½½ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚ä»¥tcpåè®®è½¬å‘è‡³æŒ‡å®šæœåŠ¡å™¨å¤„ç† ngx_http_fastcgi_module å°†å®¢æˆ·ç«¯å¯¹phpçš„è¯·æ±‚ä»¥fastcgiåè®®è½¬å‘è‡³æŒ‡å®šæœåŠ¡å™¨åŠ©ç† ngx_http_uwsgi_module å°†å®¢æˆ·ç«¯å¯¹Pythonçš„è¯·æ±‚ä»¥uwsgiåè®®è½¬å‘è‡³æŒ‡å®šæœåŠ¡å™¨å¤„ç† ngx_http_headers_module å¯ä»¥å®ç°å¯¹å¤´éƒ¨æŠ¥æ–‡æ·»åŠ æŒ‡å®šçš„keyä¸å€¼ ngx_http_upstream_module è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œæä¾›æœåŠ¡å™¨åˆ†ç»„è½¬å‘ã€æƒé‡åˆ†é…ã€çŠ¶æ€ç›‘æµ‹ã€è°ƒåº¦ç®—æ³•ç­‰é«˜çº§åŠŸèƒ½ ngx_stream_upstream_module åç«¯æœåŠ¡å™¨åˆ†ç»„è½¬å‘ã€æƒé‡åˆ†é…ã€çŠ¶æ€ç›‘æµ‹ã€è°ƒåº¦ç®—æ³•ç­‰é«˜çº§åŠŸèƒ½ ngx_http_fastcgi_module å®ç°é€šè¿‡fastcgiåè®®å°†æŒ‡å®šçš„å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘è‡³php-fpmå¤„ç† ngx_http_flv_module ä¸ºflvä¼ªæµåª’ä½“æœåŠ¡ç«¯æä¾›æ”¯æŒ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:3:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx æ ¸å¿ƒé…ç½® ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:4:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"é…ç½®å—åµŒå¥— é…ç½®å—åµŒå¥—\r","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:4:1","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é»˜è®¤é…ç½®æ–‡ä»¶ [root@www nginx]# cat nginx.conf|grep -v \\# user nginx; worker_processes auto; error_log /var/log/nginx/error.log; pid /run/nginx.pid; include /usr/share/nginx/modules/*.conf; events { worker_connections 1024; } http { # æ•°æ®ä¼ è¾“æ€§èƒ½ç›¸å…³çš„å‚æ•°; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 4096; include /etc/nginx/mime.types; default_type application/octet-stream; include /etc/nginx/conf.d/*.conf; server { # ç«¯å£å· listen 80; listen [::]:80; # server_name æŒ‡ä»¤åå¯ä»¥è·Ÿå¤šä¸ªæŒ‡ä»¤ï¼Œç¬¬ä¸€ä¸ªä¸ºä¸»åŸŸå server_name _; #ä¸åšåŸŸååŒ¹é…ï¼Œåªæ ¹æ®è™šæ‹Ÿä¸»æœºå†…çš„portå»åŒ¹é… root /usr/share/nginx/html; # æ¨¡å—åŒ–å¼•å…¥å¤–éƒ¨é…ç½® include /etc/nginx/default.d/*.conf; # nginxå¼ºå¤§çš„åŸºäºurlå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œå°±æ˜¯åŸºäºlocationæ¥çš„ location / { # å®šä¹‰ç½‘ç«™æ ¹ç›®å½• root /usr/share/nginx/html; # å®šä¹‰é¦–é¡µæ–‡ä»¶ index index.html; } error_page 404 /404.html; location = /404.html { } error_page 500 502 503 504 /50x.html; location = /50x.html { } } } main: å…¨å±€è®¾ç½® events: é…ç½®å½±å“ Nginx æœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ http:http æ¨¡å—è®¾ç½® upstream: è´Ÿè½½å‡è¡¡è®¾ç½® server:http æœåŠ¡å™¨é…ç½®ï¼Œä¸€ä¸ª http æ¨¡å—ä¸­å¯ä»¥æœ‰å¤šä¸ª server æ¨¡å— location:url åŒ¹é…é…ç½®ï¼Œä¸€ä¸ª server æ¨¡å—ä¸­å¯ä»¥åŒ…å«å¤šä¸ª location æ¨¡å— ä¸€ä¸ª nginx é…ç½®æ–‡ä»¶çš„ç»“æ„å°±åƒ nginx.conf æ˜¾ç¤ºçš„é‚£æ ·ï¼Œé…ç½®æ–‡ä»¶çš„è¯­æ³•è§„åˆ™ï¼š é…ç½®æ–‡ä»¶ç”±æ¨¡å—ç»„æˆ ä½¿ç”¨#æ·»åŠ æ³¨é‡Š ä½¿ç”¨ $ ä½¿ç”¨å˜é‡ ä½¿ç”¨ include å¼•ç”¨å¤šä¸ªé…ç½®æ–‡ä»¶ æ¯ä¸€æ¡è¯­å¥ç»“å°¾å¿…é¡»æ˜¯åˆ†å·ç»“æŸ ä»¥åŒºæ®µå½¢å¼çš„é…ç½®å‚æ•°ï¼Œéœ€è¦æœ‰é—­åˆçš„èŠ±æ‹¬å· {} ä¸åŒä½œç”¨åŸŸçš„é…ç½®å‚æ•°ï¼Œä¸èƒ½çåµŒå¥— server{}æ˜¯ç”¨äºå®šä¹‰nginxçš„ httpæ ¸å¿ƒæ¨¡å—åŠŸèƒ½çš„å­é…ç½®ï¼Œå¿…é¡»é˜²æ­¢åœ¨http{}æ‹¬å·å¤–ä¸­ å†™åœ¨http{}å¤–å±‚ï¼Œä¸å…¶åŒçº§ï¼Œè¯­æ³•æŠ¥é”™ includeé…ç½®å‚æ•°ï¼šinclude /etc/nginx/default.d/*.conf; å¯¼å…¥å¤–éƒ¨çš„é…ç½®æ–‡ä»¶ï¼Œä¼˜åŒ–ï¼Œç®€åŒ–ä¸»é…ç½®æ–‡ä»¶çš„æ ¼å¼ http{}åˆ©ç”¨includeå¯¼å…¥å¤–éƒ¨çš„ server{}é…ç½® includeå¾—å†™åœ¨http{}èŠ±æ‹¬å·å†…ï¼Œæ‰è¡¨ç¤ºç»™è¿™ä¸ªåŒºåŸŸå¯¼å…¥å¤–éƒ¨çš„é…ç½®æ–‡ä»¶ åªé’ˆå¯¹http{}åŒºåŸŸç”Ÿæ•ˆ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:4:2","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Http Location æŒ‡ä»¤æ¨¡å— location æ˜¯ ngx_http_core_module æ ¸å¿ƒæ¨¡å—ä¸‹çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œè¿™é‡Œåšä¸€ä¸‹æ•´ç†è®°å½• location åŒ¹é…è§„åˆ™\ræŒ‡ä»¤çš„Location Syntax: location [ = | ~ | ~* | ^~ ] uri { ... } location @name { ... } Default: â€” Context: server, location location åŒ¹é…é¡ºåº\rä¸¾ä¾‹ # = ç²¾ç¡®åŒ¹é… location = / { [ configuration A ] } location / { [ configuration B ] } location /documents/ { [ configuration C ] } location ^~ /images/ { [ configuration D ] } location ~* \\.(gif|jpg|jpeg)$ { [ configuration E ] } ç¤ºä¾‹\r\" / â€œè¯·æ±‚å°†åŒ¹é…é…ç½®Aï¼Œ \" /index.html â€œè¯·æ±‚å°†åŒ¹é…é…ç½®Bï¼Œ \" /documents/document.html â€œè¯·æ±‚å°†åŒ¹é…é…ç½®Cï¼Œ \" /images/1.gif â€œè¯·æ±‚å°†åŒ¹é…é…ç½®Dï¼Œ \" /documents/1.jpg â€œè¯·æ±‚å°†åŒ¹é…é…ç½®Eã€‚\r","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:4:3","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx åœºæ™¯æ–¹æ¡ˆ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é…ç½®åŠ¨é™åˆ†ç¦» ä»€ä¹ˆæ˜¯åŠ¨é™åˆ†ç¦» åœ¨ Web å¼€å‘ä¸­ï¼Œé€šå¸¸æ¥è¯´ï¼ŒåŠ¨æ€èµ„æºå…¶å®å°±æ˜¯æŒ‡é‚£äº›åå°èµ„æºï¼Œè€Œé™æ€èµ„æºå°±æ˜¯æŒ‡ HTMLï¼ŒJavaScriptï¼ŒCSSï¼Œimg ç­‰æ–‡ä»¶ã€‚ åœ¨ä½¿ç”¨å‰åç«¯åˆ†ç¦»ä¹‹åï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦çš„æå‡é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ï¼ŒåŒæ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥è®©å‰åç«¯å¼€å‘å¹¶è¡Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¼€å‘æ—¶é—´ï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆçš„å‡å°‘è”è°ƒæ—¶é—´ ã€‚ é€‚åˆä¸­å°å‹ç½‘å€ åŠ¨é™åˆ†ç¦»æ–¹æ¡ˆ ç›´æ¥ä½¿ç”¨ä¸åŒçš„åŸŸåï¼ŒæŠŠé™æ€èµ„æºæ”¾åœ¨ç‹¬ç«‹çš„äº‘æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªç§æ–¹æ¡ˆä¹Ÿæ˜¯ç›®å‰æ¯”è¾ƒæ¨å´‡çš„ã€‚ åŠ¨æ€è¯·æ±‚å’Œé™æ€æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œé€šè¿‡ nginx é…ç½®åˆ†å¼€ server { location /www/ { root /www/; index index.html index.htm; } location /image/ { root /image/; } } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:1","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"nginx é…ç½®åå‘ä»£ç† åå‘ä»£ç†å¸¸ç”¨äºä¸æƒ³æŠŠç«¯å£æš´éœ²å‡ºå»ï¼Œç›´æ¥è®¿é—®åŸŸåå¤„ç†è¯·æ±‚ã€‚ server { listen 80; server_name blog.dazhongma.top; location /swoole/ { proxy_pass http://127.0.0.1:9501; } location /node/ { proxy_pass http://127.0.0.1:9502; } } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:2","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx è´Ÿè½½å‡è¡¡é…ç½® # å®šä¹‰ä¸€ä¸ªåä¸ºphpServerçš„ä¸Šæ¸¸æœåŠ¡å™¨ç»„ï¼Œç”¨äºè´Ÿè½½å‡è¡¡ upstream phpServer{ # æŒ‡å®šä¸Šæ¸¸æœåŠ¡å™¨ç»„ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨å’Œç«¯å£ server 127.0.0.1:9501; # æœåŠ¡å™¨1çš„åœ°å€å’Œç«¯å£ server 127.0.0.1:9502; # æœåŠ¡å™¨2çš„åœ°å€å’Œç«¯å£ server 127.0.0.1:9503; # æœåŠ¡å™¨3çš„åœ°å€å’Œç«¯å£ } # å®šä¹‰ä¸€ä¸ªæœåŠ¡å™¨å—ï¼Œç”¨äºå¤„ç†HTTPè¯·æ±‚ server { # ç›‘å¬80ç«¯å£ï¼Œå³HTTPé»˜è®¤ç«¯å£ listen 80; # è®¾ç½®æœåŠ¡å™¨çš„åŸŸå server_name blog.dazhongma.top; # å®šä¹‰å¯¹æ ¹ç›®å½•çš„è¯·æ±‚çš„å¤„ç†æ–¹å¼ location / { # å°†è¯·æ±‚ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨ç»„phpServer proxy_pass http://phpServer; # å…³é—­ä»£ç†ä¸­çš„é‡å®šå‘ proxy_redirect off; # è®¾ç½®ä»£ç†è¯·æ±‚ä¸­çš„Hostå¤´ï¼Œä½¿ç”¨åŸå§‹è¯·æ±‚çš„Hostå¤´ proxy_set_header Host $host; # è®¾ç½®ä»£ç†è¯·æ±‚ä¸­çš„X-Real-IPå¤´ï¼Œä½¿ç”¨åŸå§‹è¯·æ±‚çš„IPåœ°å€ proxy_set_header X-Real-IP $remote_addr; # è®¾ç½®å½“ä»£ç†è¯·æ±‚å¤±è´¥æ—¶ï¼Œå¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ proxy_next_upstream error timeout invalid_header; # è®¾ç½®ä»£ç†è¯·æ±‚æ—¶ï¼Œä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§å¤§å°ä¸º0ï¼Œå³ä¸ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ proxy_max_temp_file_size 0; # è®¾ç½®ä»£ç†è¿æ¥çš„è¶…æ—¶æ—¶é—´ proxy_connect_timeout 90; # è®¾ç½®ä»£ç†å‘é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ proxy_send_timeout 90; # è®¾ç½®ä»£ç†è¯»å–å“åº”çš„è¶…æ—¶æ—¶é—´ proxy_read_timeout 90; # è®¾ç½®ä»£ç†ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å° proxy_buffer_size 4k; # è®¾ç½®ä»£ç†ä½¿ç”¨çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å° proxy_buffers 4 32k; # è®¾ç½®ä»£ç†å¿™ç¢Œæ—¶ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å° proxy_busy_buffers_size 64k; # è®¾ç½®ä»£ç†ä¸´æ—¶æ–‡ä»¶å†™å…¥çš„æœ€å¤§å¤§å° proxy_temp_file_write_size 64k; } } å¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ round-robin / è½®è¯¢ï¼š åˆ°åº”ç”¨æœåŠ¡å™¨çš„è¯·æ±‚ä»¥ round-robin / è½®è¯¢çš„æ–¹å¼è¢«åˆ†å‘ upstream phpServer{ server 127.0.0.1:9501 weight=3; server 127.0.0.1:9502; server 127.0.0.1:9503; } åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæ¯ 5 ä¸ªæ–°è¯·æ±‚å°†ä¼šå¦‚ä¸‹çš„åœ¨åº”ç”¨å®ä¾‹ä¸­åˆ†æ´¾ï¼š 3 ä¸ªè¯·æ±‚åˆ†æ´¾å» 9501, ä¸€ä¸ªå» 9502, å¦å¤–ä¸€ä¸ªå» 9503. least-connected / æœ€å°‘è¿æ¥ï¼šä¸‹ä¸€ä¸ªè¯·æ±‚å°†è¢«åˆ†æ´¾åˆ°æ´»åŠ¨è¿æ¥æ•°é‡æœ€å°‘çš„æœåŠ¡å™¨ upstream phpServer{ least_conn; server 127.0.0.1:9501; server 127.0.0.1:9502; server 127.0.0.1:9503; } å½“æŸäº›è¯·æ±‚éœ€è¦æ›´é•¿æ—¶é—´æ¥å®Œæˆæ—¶ï¼Œæœ€å°‘è¿æ¥å¯ä»¥æ›´å…¬å¹³çš„æ§åˆ¶åº”ç”¨å®ä¾‹ä¸Šçš„è´Ÿè½½ã€‚ ip-hash/IP æ•£åˆ—ï¼š ä½¿ç”¨ hash ç®—æ³•æ¥å†³å®šä¸‹ä¸€ä¸ªè¯·æ±‚è¦é€‰æ‹©å“ªä¸ªæœåŠ¡å™¨ (åŸºäºå®¢æˆ·ç«¯ IP åœ°å€) upstream phpServer{ ip_hash; server 127.0.0.1:9501; server 127.0.0.1:9502; server 127.0.0.1:9503; } å°†ä¸€ä¸ªå®¢æˆ·ç«¯ç»‘å®šç»™æŸä¸ªç‰¹å®šçš„åº”ç”¨æœåŠ¡å™¨ï¼› ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:3","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é…ç½®è·¨åŸŸ ç”±äºæµè§ˆå™¨åŒæºç­–ç•¥çš„å­˜åœ¨ä½¿å¾—ä¸€ä¸ªæºä¸­åŠ è½½æ¥è‡ªå…¶å®ƒæºä¸­èµ„æºçš„è¡Œä¸ºå—åˆ°äº†é™åˆ¶ã€‚å³ä¼šå‡ºç°è·¨åŸŸè¯·æ±‚ç¦æ­¢ã€‚ æ‰€è°“åŒæºæ˜¯æŒ‡ï¼šåŸŸåã€åè®®ã€ç«¯å£ç›¸åŒã€‚ URL ç»“æœ åŸå›  http://blog.dazhongma.top/other/index.html æˆåŠŸ åŸŸåã€åè®®ã€ç«¯å£å‡ ç›¸åŒ https://blog.dazhongma.top/home/index.html å¤±è´¥ åè®®ä¸åŒ http://blog.dazhongma.top:8080/home/index.html å¤±è´¥ ç«¯å£ä¸åŒ http://www.dazhongma.com/home/index.html å¤±è´¥ åŸŸåä¸åŒ server { listen 80; server_name blog.dazhongma.top; root /Users/shiwenyuan/blog/public; index index.html index.htm index.php; location / { try_files $uri $uri/ /index.php?$query_string; } add_header 'Access-Control-Allow-Origin' \"$http_origin\"; add_header 'Access-Control-Allow-Credentials' 'true'; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT, PATCH'; add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,X-XSRF-TOKEN'; location ~ \\.php$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } error_page 404 /404.html; error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } Access-Control-Allow-Originï¼šå…è®¸çš„åŸŸåï¼Œåªèƒ½å¡« *ï¼ˆé€šé…ç¬¦ï¼‰æˆ–è€…å•åŸŸåã€‚ Access-Control-Allow-Methods: å…è®¸çš„æ–¹æ³•ï¼Œå¤šä¸ªæ–¹æ³•ä»¥é€—å·åˆ†éš”ã€‚ Access-Control-Allow-Headers: å…è®¸çš„å¤´éƒ¨ï¼Œå¤šä¸ªæ–¹æ³•ä»¥é€—å·åˆ†éš”ã€‚ Access-Control-Allow-Credentials: æ˜¯å¦å…è®¸å‘é€ Cookieã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:4","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"URLRewrite ä¼ªé™æ€é…ç½® èƒ½éšè—åç«¯æœåŠ¡å™¨çš„åœ°å€ URLRewriteçš„ä½¿ç”¨åœºæ™¯ é…ç½®æ–¹å¼ http://192.168.143.101/index.jsp?pageNum=2 ä¼ªé™æ€é…ç½®åï¼Œéšè—è¯·æ±‚å‚æ•° http://192.168.143.101/2.html rewrite \u003cregex\u003e \u003creplacement\u003e [flag]; å…³é”®å­— æ­£åˆ™ æ›¿ä»£å†…å®¹ flagæ ‡è®° rewrite å‚æ•°çš„æ ‡ç­¾æ®µä½ç½®ï¼šserver,location,if flagæ ‡è®°è¯´æ˜ï¼š last # æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„location URIè§„åˆ™ break # æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆå³ç»ˆæ­¢ï¼Œä¸å†åŒ¹é…åé¢çš„ä»»ä½•è§„åˆ™ redirect # è¿”å›302 ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€ permant # 301 æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€ é…ç½® location / { # ([0-9]+) å…¥å‚ï¼Œ$1 æ˜¯ ([0-9]+)çš„å ä½ç¬¦ rewrite ^/([0-9]+).html$ /index.jsp?pageNum=$1 break; proxy_pass http://192.168.143.104:8080; } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:5","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"é…ç½®é˜²ç›—é“¾ é˜²ç›—é“¾æœ¬è´¨ä¸Šæ˜¯å­˜åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œåªèƒ½ç”±è‡ªå·±çš„æœåŠ¡å™¨æ¥è®¿é—®ï¼Œå…¶å®æ›´å¤šçš„æ—¶å€™ç½‘ç«™è¿˜æ˜¯å¸Œæœ›è‡ªå·±çš„èƒ½å¤Ÿæœ‰æ›´å¤šçš„æµé‡è¿›æ¥ï¼Œè€Œä¸æ˜¯æ·»åŠ é˜²ç›—é“¾é˜²æ­¢åˆ«äººå¼•ç”¨ï¼Œåªæ˜¯åœ¨ä¸ªåˆ«çš„æƒ…å†µï¼Œä¾‹å¦‚å¾®ä¿¡å…¬ä¼—å·æ–‡ç« ä¸­çš„å›¾ç‰‡ä¸å…è®¸åˆ«äººå¼•ç”¨æ—¶ä¼šæ·»åŠ é˜²ç›—é“¾ httpåè®®ä¸­çš„referer nginx é˜²ç›—é“¾é…ç½® ä½¿ç”¨æµè§ˆå™¨æˆ–curlæ£€æµ‹ è¿”å›é”™è¯¯ç  è¿”å›é”™è¯¯é¡µé¢ æ•´åˆrewrite è¿”å›æŠ¥é”™å›¾ç‰‡ é˜²ç›—é“¾é…ç½® valid_referes none | blocked |server_names | strings ...; noneï¼Œæ£€æµ‹referer å¤´åŸŸä¸å­˜åœ¨çš„æƒ…å†µ blocked,æ£€æµ‹refererå¤´åŸŸçš„å€¼è¢«é˜²ç«å¢™æˆ–è€…ä»£ç†æœåŠ¡å™¨åˆ é™¤æˆ–ä¼ªè£…çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µå¤´åŸŸçš„å€¼ä¸ä»¥\"http://\" æˆ– â€œhttps://â€ å¼€å¤´ server_names,è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªURLï¼Œæ£€æµ‹Refererå¤´åŸŸçš„å€¼æ˜¯å¦æ˜¯è¿™äº›URLä¸­çš„æŸä¸€ä¸ª é…ç½®ç¤ºä¾‹ location ~*/(js|img|css) { # æ£€æµ‹æ¥æºçš„ç½‘å€ï¼Œè€Œä¸æ˜¯ip valid_referes 192.168.44.101; if($valid_referer){ return 403 } root html; index index.html index.htm; } é˜²ç›—é“¾è¿”å›é¡µé¢é…ç½® # é˜²ç›—é“¾è¿”å›é¡µé¢é…ç½® error_page 401 /401.html; location = /401.html { } error_page 404 /404.html; location = /404.html { } error_page 500 502 503 504 /50x.html; location = /50x.html { } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:6","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é«˜å¯ç”¨é…ç½® é«˜å¯ç”¨åœºæ™¯åŠè§£å†³æ–¹æ¡ˆ å®‰è£…keepalived é€‰ä¸¾æ–¹å¼(ä¼˜å…ˆçº§é…ç½®) ç¤ºä¾‹èŠ‚ç‚¹192.168.143.101å’Œ192.168.143.102,vip 192.168.143.100 å®‰è£… # å®‰è£…ä¾èµ– $ yum install openssl-devel $ yum install keepalived $ vim /etc/keepalived/keepalived.conf 192.168.143.101 master èŠ‚ç‚¹keepalivedé…ç½® ! Configuration File for keepalived global_defs { router_id LVS_DEVEL-101 } vrrp_instance demo_keepalived { state MASTER # æ³¨æ„ä¿®æ”¹ç½‘å¡ä¿¡æ¯ interface ens33 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.143.100 } } 192.168.143.102 backup èŠ‚ç‚¹keepalivedé…ç½® ! Configuration File for keepalived global_defs { router_id LVS_DEVEL-102 } vrrp_instance demo_keepalived { state BACKUP # æ³¨æ„ä¿®æ”¹ç½‘å¡ä¿¡æ¯ interface ens32 virtual_router_id 51 priority 50 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.143.100 } } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:7","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx https åŠ å¯†è®¤è¯è®¿é—® https è¯ä¹¦é…ç½® httpsåŸç† CA æœºæ„ è¯ä¹¦ å®¢æˆ·ç«¯(æµè§ˆå™¨) æœåŠ¡å™¨ç«¯ è¯ä¹¦è‡ªç­¾å åœ¨çº¿è¯ä¹¦ç”³è¯· è¯ä¹¦è‡ªç­¾å ä¸€èˆ¬æ˜¯ç”¨åœ¨å†…ç½‘ä¸­ï¼Œé€šè¿‡opensslè¿›è¡Œåˆ›å»ºï¼Œå¯¹äºå…¬ç½‘è¿˜æ˜¯éœ€è¦è¿›è¡Œç”³è¯·è´­ä¹°çš„ ç”Ÿäº§nginx è‡ªç­¾åè¯ä¹¦ # å‘½åæ—¶ä½œåŒºåˆ†ä½¿ç”¨(ä¸ªäººä¹ æƒ¯) $ host_ip=192.168.143.101 # 1ã€æ¨¡æ‹Ÿåˆ›å»ºCA server_${host_ip}.key ç§é’¥ ï¼š ç”Ÿæˆkeyï¼šï¼ˆç”Ÿæˆrsaç§é’¥ï¼Œdes3å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œopensslæ ¼å¼ï¼Œ2048ä½å¼ºåº¦ï¼‰ # You must type in 4 to 1023 characters ä½¿ç”¨ host_ip åœ°å€å³å¯ $ openssl genrsa -des3 -out server_${host_ip}.key 2048 # 2ã€é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç”Ÿæˆæ²¡æœ‰å¯†ç çš„key $ openssl rsa -in server_${host_ip}.key -out server_${host_ip}.key # 3ã€[ç§é’¥åŠ å¯†]é€šè¿‡ CA server_${host_ip}.key ç§é’¥é’¥ç”Ÿæˆè‡ªç­¾åçš„ CA ca.crt è¯ä¹¦ï¼Œè¯¥è¯ä¹¦åŒ…å«CAæœºæ„çš„å…¬é’¥ï¼šï¼ˆç”¨æ¥ç­¾ç½²ä¸‹é¢çš„server.csræ–‡ä»¶,ä¸€è·¯å›è½¦ $ openssl req -new -x509 -key server_${host_ip}.key -out ca.crt -days 3650 # 4ã€ç”Ÿæˆè¯ä¹¦ç­¾åcsrè¯·æ±‚ certificate sign requestï¼ŒåŒ…å«1ï¼‰å…¬é’¥ 2ï¼‰ç”³è¯·è€…ä¿¡æ¯ 3ï¼‰åŸŸå, ï¼šä¸€è·¯å›è½¦ $ openssl req -new -key server_${host_ip}.key -out server.csr # 5ã€[å…¬é’¥éªŒç­¾(ç­¾å)] å°†csrè¯ä¹¦ç­¾åè¯·æ±‚å‘é€ç»™CAæœºæ„ï¼ŒCAæœºæ„ä¸­å¯¹ ca.crt è¯ä¹¦è¿›è¡Œç­¾åå¤„ç†å¹¶ç”Ÿæˆcrt server_${host_ip}.crtï¼š # ä¹Ÿå°±æ˜¯è¯´å…¬é’¥ server_${host_ip}.crt ç›¸å¯¹äº å…¬é’¥ ca.crtå¤šäº†ç­¾åå¤„ç†çš„ $ openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey server_${host_ip}.key -CAcreateserial -out server_${host_ip}.crt æ€»ç»“ï¼š ç”Ÿæˆç§é’¥server_${host_ip}.key ç”Ÿæˆæ²¡æœ‰å¯†ç çš„ç§é’¥key(å¯é€‰) è‡ªç­¾åçš„ CA ca.crt è¯ä¹¦ï¼Œè¯¥è¯ä¹¦åŒ…å«CAæœºæ„çš„å…¬é’¥ ç”Ÿæˆè¯ä¹¦ç­¾åcsrè¯·æ±‚(CSR) å…¬é’¥éªŒç­¾(ç­¾å) éªŒè¯è¯ä¹¦ å›¾å½¢åŒ–å·¥å…·XCA ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:8","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx å¼€å¯httpå¹¶é‡å®šå‘åˆ°https å¼€å¯http å¼€å¯httpå¾ˆç®€å•ï¼Œç›´æ¥æŠŠlisten 80;åŠ åˆ°listen 443 ssl;ä¸Šé¢å»å°±å¯ä»¥äº†ã€‚æˆ–è€…æ–°åŠ ä¸€ä¸ªserveré…ç½®ï¼Œå¦‚ä¸‹ï¼š server { listen 443 ssl; server_name localhost; ssl_certificate /key-path/localhost.pem; ssl_certificate_key /key-path/localhost.key; ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / { proxy_set_header HOST $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8000/; } } server { listen 80; server_name localhost; location / { proxy_set_header HOST $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8000/; } } é‡å®šå‘åˆ°httpsçš„ä¸¤ç§æ–¹å¼ è¦æŠŠhttpé‡å®šå‘åˆ°httpsä¹Ÿå¾ˆç®€å•ï¼Œå…·ä½“å¯ä»¥ä½¿ç”¨ä¸¤ç§é…ç½®æ¥å®ç°ã€‚ ç¬¬ä¸€ç§æ–¹å¼ä½¿ç”¨return 301å¦‚ä¸‹ï¼š server { listen 80; server_name localhost; return 301 https://127.0.0.1$request_uri; } ç¬¬äºŒç§æ–¹å¼ä½¿ç”¨rewriteå¦‚ä¸‹ï¼š server { listen 80; server_name localhost; rewrite ^(.*)$ https://$host$1 permanent; } å¯¹äºreturnå’Œrewriteçš„åŒºåˆ«ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼šCreating NGINX Rewrite Rules ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:9","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"nginx å¯¹å®¢æˆ·ç«¯å’Œä¸Šæ¸¸æœåŠ¡å™¨ä½¿ç”¨keepalive é…ç½®è¯¦è§£ Nginx ä¸­çš„ keepalive æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œä»è€Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥æ‰€å¸¦æ¥çš„å¼€é”€ã€‚è¿™å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å»¶è¿Ÿç½‘ç»œç¯å¢ƒä¸­ã€‚ä»¥ä¸‹æ˜¯å¯¹ Nginx é…ç½® keepalive çš„è¯¦ç»†ä»‹ç»ã€‚ 1. HTTP Keepalive å¯¹äº HTTP åè®®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ¥é…ç½® keepaliveï¼š keepalive_timeoutï¼šè®¾ç½® keep-alive å®¢æˆ·ç«¯è¿æ¥åœ¨æœåŠ¡å™¨ç«¯ä¿æŒæ‰“å¼€çŠ¶æ€çš„æ—¶é—´é•¿åº¦ã€‚ä¾‹å¦‚ï¼š keepalive_timeout 65; ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºå¦‚æœä¸€ä¸ªè¿æ¥åœ¨65ç§’å†…æ²¡æœ‰æ´»åŠ¨ï¼Œé‚£ä¹ˆå®ƒå°†è¢«å…³é—­ã€‚ keepalive_requestsï¼šæŒ‡å®šä¸€ä¸ª keep-alive è¿æ¥ä¸Šå¯ä»¥æœåŠ¡çš„æœ€å¤§è¯·æ±‚æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼æ˜¯100ã€‚ keepalive_requests 100; keepalive_disableï¼šå…è®¸ç¦ç”¨å¯¹æŸäº›æµè§ˆå™¨çš„æ”¯æŒã€‚ä¸€äº›æ—§ç‰ˆæµè§ˆå™¨å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç† keep-alive è¯·æ±‚ã€‚ keepalive_disable msie6; ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:10","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"2. Upstream Keepalive nginx å¯¹ä¸Šæ¸¸æœåŠ¡å™¨ä½¿ç”¨keepalive é…ç½®è¯¦è§£ å½“ä¸ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆå¦‚åº”ç”¨æœåŠ¡å™¨ï¼‰é€šä¿¡æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ keepalive æ¥ä¼˜åŒ–è¿æ¥ã€‚è¿™éœ€è¦é€šè¿‡ upstream å—è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨ keepalive æŒ‡ä»¤æ¥æŒ‡å®šè¦ç¼“å­˜çš„ç©ºé—² keepalive è¿æ¥æ•°ã€‚ upstream backend { server backend1.example.com; server backend2.example.com; keepalive 32; # è®¾ç½®ä¿æŒè¿æ¥çš„ç©ºé—²è¿æ¥æ•°ä¸º32 keepalive_requests 1000; keepalive_timeout 65; # å¯ä»¥ä¸é…ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤ } server { location / { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Connection \"\"; } } è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ä½¿ upstream keepalive èµ·ä½œç”¨ï¼Œå¿…é¡»å°† proxy_http_version è®¾ç½®ä¸º 1.1 å¹¶æ¸…é™¤ Connection å¤´éƒ¨å­—æ®µã€‚ æ³¨æ„äº‹é¡¹ ä½¿ç”¨ keepalive å¯èƒ½ä¼šå¢åŠ æœåŠ¡å™¨èµ„æºçš„æ¶ˆè€—ï¼Œå› ä¸ºå®ƒéœ€è¦ç»´æŠ¤æ›´å¤šçš„è¿æ¥çŠ¶æ€ã€‚å› æ­¤ï¼Œåˆç†è®¾ç½® keepalive ç›¸å…³å‚æ•°æ˜¯éå¸¸é‡è¦çš„ã€‚ å¯¹äº HTTPS ç«™ç‚¹ï¼Œé™¤äº†ä¸Šè¿°é…ç½®å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘ SSL/TLS æ¡æ‰‹çš„æˆæœ¬ã€‚å°½ç®¡ keepalive å¯ä»¥é‡ç”¨å·²å»ºç«‹çš„å®‰å…¨è¿æ¥ï¼Œå‡å°‘é‡å¤æ¡æ‰‹å¸¦æ¥çš„å»¶è¿Ÿï¼Œä½†æ˜¯é¦–æ¬¡è¿æ¥ä»éœ€å®Œæˆå®Œæ•´çš„ SSL/TLS æ¡æ‰‹è¿‡ç¨‹ã€‚ é€šè¿‡é€‚å½“çš„é…ç½®ï¼ŒNginx çš„ keepalive åŠŸèƒ½å¯ä»¥å¸®åŠ©æå‡ç½‘ç«™æˆ–åº”ç”¨çš„å“åº”é€Ÿåº¦å’Œæ•´ä½“æ€§èƒ½ã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:11","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx å†…å­˜ä¸æ–‡ä»¶ç¼“å†²åŒº Nginx ä½œä¸ºä¸€æ¬¾é«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå…¶å¤„ç†è¯·æ±‚çš„èƒ½åŠ›å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå…¶å¯¹å†…å­˜å’Œæ–‡ä»¶ç¼“å†²åŒºçš„æœ‰æ•ˆç®¡ç†ã€‚ä¸‹é¢ä»‹ç»Nginxåå‘ä»£ç†çš„å†…å­˜ä¸æ–‡ä»¶ç¼“å†²åŒºçš„æ ¸å¿ƒæµç¨‹ã€‚ Header ç¼“å†²åŒº proxy_buffer_sizeï¼šè¿™ä¸ªæŒ‡ä»¤ç”¨äºè®¾ç½®è¯»å–æ¥è‡ªåç«¯æœåŠ¡å™¨å“åº”çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆé€šå¸¸åŒ…æ‹¬å“åº”å¤´ï¼‰çš„ç¼“å†²åŒºå¤§å°ã€‚ç”±äºå“åº”å¤´å¯èƒ½åŒ…å«ä¸€äº›è¾ƒå¤§çš„Cookieæˆ–å…¶å®ƒå…ƒæ•°æ®ï¼Œé€‚å½“è°ƒæ•´è¿™ä¸ªå€¼å¯ä»¥ç¡®ä¿å¤´éƒ¨ä¿¡æ¯èƒ½å¤Ÿè¢«å®Œæ•´åœ°ç¼“å­˜è€Œä¸ä¼šå¯¼è‡´é¢å¤–çš„ç£ç›˜I/Oæ“ä½œã€‚ Body ç¼“å†²åŒº proxy_buffering on;ï¼šå¯ç”¨æˆ–ç¦ç”¨ç¼“å†²åŠŸèƒ½ã€‚å½“å¼€å¯æ—¶ï¼ŒNginxä¼šå°è¯•å…ˆå°†ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®å­˜å‚¨åˆ°ç”±proxy_buffersæŒ‡å®šçš„å†…å­˜ç¼“å†²åŒºä¸­ã€‚å¦‚æœå“åº”æ•°æ®é‡è¶…è¿‡äº†å†…å­˜ç¼“å†²åŒºå®¹é‡ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†ä¼šè¢«å†™å…¥ç”±proxy_temp_pathå®šä¹‰çš„ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚è‹¥å…³é—­(off)ï¼Œåˆ™æ‰€æœ‰å“åº”å†…å®¹éƒ½å°†ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸ç»è¿‡ä»»ä½•ç¼“å†²ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ å®¢æˆ·ç«¯ç­‰å¾…æ—¶é—´å¹¶å‡å°‘æœåŠ¡å™¨æ€§èƒ½ã€‚ proxy_buffers 32 64k;ï¼šæ­¤æŒ‡ä»¤å®šä¹‰äº†ç”¨äºå­˜å‚¨å“åº”ä½“çš„ç¼“å†²åŒºæ•°é‡åŠå…¶å¤§å°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè¡¨ç¤ºåˆ†é…äº†32ä¸ªæ¯ä¸ªå¤§å°ä¸º64KBçš„ç¼“å†²å—æ¥ä¿å­˜å“åº”ä½“æ•°æ®ã€‚åˆç†çš„é…ç½®å¯ä»¥æ ¹æ®é¢„æœŸçš„å“åº”ä½“å¤§å°åŠç³»ç»Ÿèµ„æºçŠ¶å†µè¿›è¡Œè°ƒæ•´ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ proxy_max_temp_file_size 1G;ï¼šå½“å“åº”ä½“è¿‡å¤§ä»¥è‡³äºè¶…è¿‡å†…å­˜ç¼“å†²åŒºå®¹é‡æ—¶ï¼ŒNginxä¼šå°†å¤šä½™çš„æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶ã€‚è¯¥å‚æ•°é™åˆ¶äº†è¿™äº›ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§æ€»å°ºå¯¸ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯1GBã€‚å¦‚æœè¾¾åˆ°è¿™ä¸ªé™åˆ¶ï¼ŒNginxå°†åœæ­¢å‘ç£ç›˜å†™å…¥æ–°çš„æ•°æ®ï¼Œå¹¶å¼€å§‹ç›´æ¥å°†å‰©ä½™çš„å“åº”æµå¼ä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚ proxy_temp_file_write_size 8k;ï¼šæ§åˆ¶ä¸€æ¬¡å†™å…¥ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®é‡ã€‚è¿™é‡Œçš„ä¾‹å­è¡¨æ˜æ¯æ¬¡å†™æ“ä½œçš„å¤§å°è¢«è®¾å®šä¸º8KBã€‚åˆç†è®¾ç½®è¿™ä¸ªå€¼æœ‰åŠ©äºå¹³è¡¡ç£ç›˜I/Oè´Ÿè½½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚æ—¶å°¤ä¸ºé‡è¦ã€‚ é€šè¿‡ä¸Šè¿°é…ç½®ï¼ŒNginxèƒ½æœ‰æ•ˆåœ°ç®¡ç†åå‘ä»£ç†è¿‡ç¨‹ä¸­çš„æ•°æ®æµåŠ¨ï¼Œæ—¢ä¿è¯äº†å¿«é€Ÿå“åº”åˆèƒ½æœ‰æ•ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…åº”ç”¨ä¸­åº”æ ¹æ®å…·ä½“æƒ…å†µï¼ˆå¦‚æœåŠ¡å™¨ç¡¬ä»¶æ¡ä»¶ã€é¢„è®¡çš„æµé‡è§„æ¨¡ç­‰ï¼‰è°ƒæ•´è¿™äº›å‚æ•°ï¼Œä»¥å®ç°æœ€ä½³æ€§èƒ½ã€‚ ç¤ºä¾‹ http { # å…¶ä»–é…ç½®é¡¹... server { listen 80; server_name example.com; location / { proxy_pass http://backend_server; # å‡è®¾åç«¯æœåŠ¡å™¨åœ°å€ # è®¾ç½®Headerç¼“å†²åŒºå¤§å° proxy_buffer_size 128k; # å¯ç”¨å“åº”ä½“æ•°æ®çš„ç¼“å†²åŠŸèƒ½ proxy_buffering on; # è®¾ç½®ç”¨äºè¯»å–å“åº”ä½“çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å° proxy_buffers 32 64k; # å½“å“åº”ä½“è¿‡å¤§æ—¶ï¼Œé™åˆ¶å†™å…¥ç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§æ€»å°ºå¯¸ä¸º1G proxy_max_temp_file_size 1G; # æ§åˆ¶ä¸€æ¬¡å†™å…¥ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®é‡ä¸º8KB proxy_temp_file_write_size 8k; } } # å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨ç»„ upstream backend_server { server 192.168.1.1:8080; # åç«¯æœåŠ¡å™¨çš„å®é™…IPå’Œç«¯å£ server 192.168.1.2:8080; # å¯ä»¥æ·»åŠ å¤šä¸ªåç«¯æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½å‡è¡¡ } } é…ç½®è§£é‡Šï¼š proxy_buffer_size 128k;ï¼šå¢å¤§äº†headeréƒ¨åˆ†çš„ç¼“å†²åŒºå¤§å°åˆ°128KBï¼Œé€‚ç”¨äºåŒ…å«è¾ƒå¤§å¤´éƒ¨ä¿¡æ¯çš„æƒ…å†µã€‚ proxy_buffering on;ï¼šå¯ç”¨ç¼“å†²åŠŸèƒ½ã€‚è¿™æ„å‘³ç€Nginxä¼šå°è¯•å…ˆå°†ä»åç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ proxy_buffers 32 64k;ï¼šè®¾ç½®äº†32å—æ¯å—64KBå¤§å°çš„ç¼“å†²åŒºæ¥å­˜å‚¨å“åº”ä½“å†…å®¹ã€‚è¿™æ ·æ€»å…±æä¾›äº†2MBï¼ˆ32*64KBï¼‰çš„å†…å­˜ç©ºé—´æ¥ç¼“å­˜å“åº”ä½“æ•°æ®ã€‚ proxy_max_temp_file_size 1G;ï¼šå½“å“åº”ä½“å¤ªå¤§ä»¥è‡³äºè¶…è¿‡å†…å­˜ç¼“å†²åŒºå®¹é‡æ—¶ï¼ŒNginxä¼šå°†è¶…å‡ºçš„æ•°æ®å†™å…¥ç£ç›˜ä¸Šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ­¤è®¾ç½®é™åˆ¶äº†è¿™äº›ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§æ€»å°ºå¯¸ä¸º1GBã€‚ proxy_temp_file_write_size 8k;ï¼šæ§åˆ¶äº†ä¸€æ¬¡å†™å…¥ç£ç›˜ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®é‡ä¸º8KBï¼Œæœ‰åŠ©äºå¹³è¡¡ç£ç›˜I/Oæ“ä½œã€‚ è¿™ä¸ªé…ç½®å®ä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸Šè¿°å‚æ•°æ¥ä¼˜åŒ–Nginxä½œä¸ºåå‘ä»£ç†æ—¶çš„æ€§èƒ½è¡¨ç°ã€‚æ ¹æ®å®é™…æƒ…å†µï¼Œæ¯”å¦‚åç«¯æœåŠ¡å“åº”çš„æ•°æ®é‡ã€æœåŠ¡å™¨ç¡¬ä»¶èµ„æºç­‰ï¼Œä½ å¯ä»¥é€‚å½“è°ƒæ•´è¿™äº›æ•°å€¼ä»¥è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:12","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx å¯¹å®¢æˆ·ç«¯çš„é™åˆ¶ Nginx æä¾›äº†å¤šç§é…ç½®é€‰é¡¹æ¥é™åˆ¶å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒ…æ‹¬å¯¹è¯·æ±‚ä½“å¤§å°ã€å¤´éƒ¨å¤§å°ã€è¶…æ—¶æ—¶é—´ç­‰æ–¹é¢çš„æ§åˆ¶ã€‚ä»¥ä¸‹æ˜¯å¯¹ä½ æåˆ°çš„å…³é”®è¯è¿›è¡Œè¡¥å……å¹¶ç»™å‡ºå®Œæ•´é‡Šä¹‰ï¼Œä»¥åŠä¸€ä¸ªé…ç½®ç¤ºä¾‹ã€‚ å…³é”®è¯è§£é‡Š client_body_buffer_sizeï¼šè®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä½“ï¼ˆbodyï¼‰çš„ç¼“å†²åŒºå¤§å°ã€‚å¦‚æœè¯·æ±‚ä½“è¶…è¿‡äº†è¿™ä¸ªç¼“å†²åŒºå¤§å°ï¼Œæ•°æ®å°†è¢«å†™å…¥ç£ç›˜ä¸Šçš„ä¸´æ—¶æ–‡ä»¶ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ ç­‰åœºæ™¯éå¸¸é‡è¦ã€‚ client_header_buffer_sizeï¼šè®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´ï¼ˆheaderï¼‰çš„ç¼“å†²åŒºå¤§å°ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼è¶³ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†å¦‚æœå®¢æˆ·ç«¯å‘é€éå¸¸å¤§çš„è¯·æ±‚å¤´ï¼ˆå¦‚åŒ…å«å¤§é‡Cookieæˆ–é•¿URLï¼‰ï¼Œåˆ™å¯èƒ½éœ€è¦å¢åŠ æ­¤å€¼ã€‚ client_body_temp_pathï¼šæŒ‡å®šå½“è¯·æ±‚ä½“è¶…è¿‡client_body_buffer_sizeæ—¶ï¼ŒNginxå°†è¯·æ±‚ä½“æ•°æ®å†™å…¥ç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨è·¯å¾„ã€‚åˆç†è®¾ç½®å¯ä»¥é¿å…ç³»ç»Ÿé»˜è®¤ä¸´æ—¶ç›®å½•ç©ºé—´ä¸è¶³çš„é—®é¢˜ã€‚ client_max_body_size 1000M;ï¼šå®šä¹‰å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§ä¸»ä½“å¤§å°ã€‚å¦‚æœè¯·æ±‚ä½“è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒNginxä¼šè¿”å›413 (Request Entity Too Large)é”™è¯¯ã€‚è®¾ç½®ä¸º0å¯ç¦ç”¨æ£€æŸ¥ã€‚ client_body_timeoutï¼šè®¾ç½®ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚ä½“çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è®¾å®šçš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚ä½“ï¼ŒNginxå°†å…³é—­è¿æ¥ã€‚ client_header_timeoutï¼šè®¾ç½®ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚å¤´ï¼ŒNginxä¹Ÿå°†å…³é—­è¿æ¥ã€‚ é…ç½®ç¤ºä¾‹ http { # è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ç¼“å†²åŒºå¤§å° client_body_buffer_size 16k; # è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„ç¼“å†²åŒºå¤§å° client_header_buffer_size 2k; # è®¾ç½®å½“è¯·æ±‚ä½“è¿‡å¤§æ—¶ï¼ŒNginxå†™å…¥ç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ä½ç½® client_body_temp_path /var/lib/nginx/body; # å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§ä¸»ä½“å¤§å°ä¸º1000MB client_max_body_size 1000M; # å¦‚æœåœ¨60ç§’å†…æ²¡æœ‰è¯»å–åˆ°è¯·æ±‚ä½“ï¼Œå°±æŠ¥è¶…æ—¶é”™è¯¯ client_body_timeout 60s; # å¦‚æœåœ¨30ç§’å†…æ²¡æœ‰è¯»å–åˆ°è¯·æ±‚å¤´ï¼Œå°±æŠ¥è¶…æ—¶é”™è¯¯ client_header_timeout 30s; server { listen 80; server_name example.com; location / { proxy_pass http://backend_server; } } upstream backend_server { server 192.168.1.1:8080; server 192.168.1.2:8080; } } è¡¥å……è¯´æ˜ å¯¹äºå¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ çš„åœºæ™¯ï¼Œé™¤äº†è°ƒæ•´client_body_buffer_sizeå’Œclient_max_body_sizeå¤–ï¼Œè¿˜éœ€è¦ç¡®ä¿æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´æ¥å­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶ä¸”æ­£ç¡®è®¾ç½®äº†client_body_temp_pathã€‚ client_body_timeoutå’Œclient_header_timeoutå¯ä»¥æ ¹æ®å®é™…ç½‘ç»œçŠ¶å†µå’Œåº”ç”¨éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œä»¥å¹³è¡¡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ è€ƒè™‘å®‰å…¨æ€§ï¼Œå»ºè®®æ ¹æ®å®é™…æƒ…å†µåˆç†è®¾ç½®client_max_body_sizeï¼Œé˜²æ­¢å› è¿‡å¤§çš„è¯·æ±‚å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:13","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx Gzipå‹ç¼© ä½¿ç”¨ç¤ºä¾‹ http { ... # nginx åŠ¨æ€å‹ç¼© å’Œ é™æ€å‹ç¼©ç»“åˆä½¿ç”¨ä¼šæ›´å¥½ # å¼€å¯gzip é™æ€å‹ç¼© gzip_static on; # ä½œä¸ºåå‘ä»£ç†æ—¶ï¼Œé’ˆå¯¹ä¸Šæ¸¸æœåŠ¡å™¨è¿”å›çš„å¤´ä¿¡æ¯è¿›è¡Œå‹ç¼© gzip_proxied expired no-cache no-store private auth; # å¼€å¯gzip åŠ¨æ€å‹ç¼© gzip on; # å¯ç”¨gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶ï¼Œå°äºè®¾ç½®å€¼çš„æ–‡ä»¶å°†ä¸ä¼šå‹ç¼© gzip_min_length 1k; # gzip å‹ç¼©çº§åˆ«ï¼Œ1-9ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©çš„è¶Šå¥½ï¼Œä¹Ÿè¶Šå ç”¨CPUæ—¶é—´ï¼Œåé¢ä¼šæœ‰è¯¦ç»†è¯´æ˜ gzip_comp_level 6; # è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚javascriptæœ‰å¤šç§å½¢å¼ã€‚å…¶ä¸­çš„å€¼å¯ä»¥åœ¨ mime.types æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚ gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml; # æ˜¯å¦åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encodingï¼Œå»ºè®®å¼€å¯ï¼Œä¸é…ç½®ä¹Ÿå°±å¯ä»¥ gzip_vary on; # ç¦ç”¨IE 1-6ç‰ˆæœ¬çš„ gzipå‹ç¼©ï¼Œå¤§å‹ç½‘ç«™å»ºè®®ä¸è¦é…ç½®ï¼Œå»ºè®®å°½é‡ä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°‘ç”¨æ­£åˆ™ï¼Œå› ä¸ºè¿™æ˜¯å½±å“æ€§èƒ½çš„ä¸€ä¸ªé€‰é¡¹ # gzip_disable \"MSIE [1-6]\\.\"; # è®¾ç½®å‹ç¼©æ‰€éœ€è¦çš„ç¼“å†²åŒºå¤§å° gzip_buffers 32 4k; # è®¾ç½®gzipå‹ç¼©é’ˆå¯¹çš„HTTPåè®®ç‰ˆæœ¬ gzip_http_version 1.0; ... server { listen 80; listen [::]:80; ... } } Gzip åŠ¨æ€å‹ç¼©åŠç¼ºç‚¹ ç¼ºç‚¹ï¼šå¼€å¯gzip å‹ç¼©åï¼Œsendfile é›¶æ‹·è´åˆ™ä¼šå¤±æ•ˆ Gzip é™æ€å‹ç¼© é™æ€å‹ç¼©å¼€å§‹ä¸ä¼šå¯¼è‡´sendfile é›¶æ‹·è´å¤±æ•ˆ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:14","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é…ç½®æ­£å‘ä»£ç†ä¸åå‘ä»£ç†ç¼“å­˜ æ­£å‘ä»£ç†é…ç½®å‚è€ƒ $ proxy_pass $scheme://$host$request_uri; $ resolver 8.8.8.8; åå‘ä»£ç†ç¼“å­˜proxy_cacheé…ç½®ç¤ºä¾‹ http { ... upstream backend { keepalive 1000; # è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°ä¸º32 keepalive_requests 1000; server 192.168.143.102; } proxy_cache_path /ngx_tmp levels=1:2 keys_zone=test_cache:100m inactive=1d max_size=10g; ... server { listen 80; listen [::]:80; .... location / { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Connection \"\"; # proxy åå‘ä»£ç†ç¼“å­˜ add_header Nginx-Cache \"$upstream_cache_status\"; proxy_cache test_cache; proxy_cache_valid 1h; # åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å–æ•°æ®å¤šä¹…è¿‡æœŸ } } ... } nginx åå‘ä»£ç†ç¼“å­˜proxy_cache é…ç½®çš„ä¼˜ç‚¹ Nginxçš„proxy_cacheé…ç½®ä¸»è¦ç”¨äºå®ç°åå‘ä»£ç†ç¼“å­˜ï¼Œå®ƒæœ‰å¤šä¸ªæ˜¾è‘—çš„å¥½å¤„ï¼Œå¯ä»¥æå¤§åœ°æå‡Webåº”ç”¨çš„æ€§èƒ½å’Œå¯é æ€§ï¼š æé«˜å“åº”é€Ÿåº¦ å‡å°‘åç«¯æœåŠ¡å™¨è´Ÿè½½ï¼šé€šè¿‡ç¼“å­˜é™æ€å†…å®¹æˆ–é¢‘ç¹è¯·æ±‚çš„æ•°æ®ï¼Œå¯ä»¥å¤§å¹…å‡å°‘åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜å“åº”é€Ÿåº¦ã€‚ å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ï¼šå¯¹äºå·²ç»ç¼“å­˜çš„å†…å®¹ï¼ŒNginxå¯ä»¥ç›´æ¥ä»æœ¬åœ°ç£ç›˜æä¾›æœåŠ¡ï¼Œè€Œä¸éœ€è¦è½¬å‘åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œè¿™å¤§å¤§åŠ å¿«äº†å“åº”æ—¶é—´ã€‚ å¢å¼ºç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œç¨³å®šæ€§ å¹³æ»‘æµé‡é«˜å³°ï¼šåœ¨æµé‡é«˜å³°æœŸï¼Œç¼“å­˜å¯ä»¥å‡è½»åç«¯æœåŠ¡å™¨çš„å‹åŠ›ï¼Œé¿å…å› è¿‡è½½å¯¼è‡´çš„æœåŠ¡ä¸­æ–­æˆ–å“åº”è¿Ÿç¼“ã€‚ æé«˜å¯ç”¨æ€§ï¼šå³ä½¿åç«¯æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ç”±äºç»´æŠ¤æˆ–æ•…éšœï¼‰ï¼ŒNginxä¹Ÿå¯ä»¥ç»§ç»­ä¸ºç”¨æˆ·æä¾›ç¼“å­˜çš„å†…å®¹ï¼Œç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§ã€‚ ä¼˜åŒ–èµ„æºåˆ©ç”¨ èŠ‚çœå¸¦å®½ï¼šç¼“å­˜æœºåˆ¶å‡å°‘äº†é‡å¤æ•°æ®ä¼ è¾“çš„éœ€æ±‚ï¼Œæœ‰åŠ©äºèŠ‚çœç½‘ç»œå¸¦å®½ã€‚ é™ä½æ•°æ®åº“å‹åŠ›ï¼šå¯¹äºåŠ¨æ€å†…å®¹ï¼Œå¦‚æœéƒ¨åˆ†æ•°æ®å¯ä»¥è¢«ç¼“å­˜ï¼ˆå¦‚æŸ¥è¯¢ç»“æœï¼‰ï¼Œåˆ™å¯ä»¥å‡å°‘å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®æ¬¡æ•°ï¼Œé™ä½æ•°æ®åº“çš„å‹åŠ›ã€‚ çµæ´»çš„é…ç½®é€‰é¡¹ ç»†ç²’åº¦æ§åˆ¶ï¼šNginxæä¾›äº†ä¸°å¯Œçš„æŒ‡ä»¤æ¥æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼Œæ¯”å¦‚è®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæœŸã€å¦‚ä½•æ›´æ–°ç¼“å­˜ã€å“ªäº›å“åº”åº”è¯¥è¢«ç¼“å­˜ç­‰ã€‚ æ”¯æŒæ¡ä»¶ç¼“å­˜ï¼šå¯ä»¥æ ¹æ®è¯·æ±‚æ–¹æ³•ã€å“åº”å¤´ç­‰å¤šç§æ¡ä»¶å†³å®šæ˜¯å¦ç¼“å­˜å“åº”ï¼Œä½¿å¾—ç¼“å­˜ç­–ç•¥æ›´åŠ çµæ´»å’Œç²¾ç¡®ã€‚ å®ç°ç®€å•ä¸”é«˜æ•ˆ æ˜“äºéƒ¨ç½²å’Œç®¡ç†ï¼šä¸åº”ç”¨ç¨‹åºçº§åˆ«çš„ç¼“å­˜ç›¸æ¯”ï¼ŒNginxçš„åå‘ä»£ç†ç¼“å­˜é…ç½®ç›¸å¯¹ç®€å•ï¼Œå®¹æ˜“é›†æˆåˆ°ç°æœ‰æ¶æ„ä¸­ã€‚ é«˜æ•ˆçš„å­˜å‚¨æœºåˆ¶ï¼šNginxé‡‡ç”¨é«˜æ•ˆçš„æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ–¹å¼ï¼Œå¹¶æ”¯æŒå†…å­˜ç¼“å­˜ä»¥åŠ é€Ÿé¢‘ç¹è®¿é—®çš„å†…å®¹ã€‚ åˆç†åœ°ä½¿ç”¨Nginxçš„proxy_cacheä¸ä»…å¯ä»¥æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒï¼Œè¿˜èƒ½å¢å¼ºæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼“å­˜ç­–ç•¥çš„è®¾è®¡åº”å½“è€ƒè™‘åˆ°æ•°æ®çš„ä¸€è‡´æ€§å’Œæ—¶æ•ˆæ€§è¦æ±‚ï¼Œä»¥å…å½±å“åˆ°ç”¨æˆ·çš„ä½“éªŒæˆ–ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ‰§è¡Œã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:15","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx é…ç½®å¸¦å®½é™åˆ¶ Nginx æä¾›äº†å¤šç§æ–¹å¼æ¥é™åˆ¶å¸¦å®½ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚åœºæ™¯ã€‚è¿™é€šå¸¸ç”¨äºé˜²æ­¢æœåŠ¡å™¨è¿‡è½½ã€ä¿éšœæœåŠ¡è´¨é‡æˆ–æ§åˆ¶å†…å®¹åˆ†å‘é€Ÿåº¦ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯ä»¥åŠç›¸åº”çš„é…ç½®ç¤ºä¾‹ã€‚ åœºæ™¯ä¸€ï¼šé™åˆ¶å®¢æˆ·ç«¯ä¸‹è½½é€Ÿåº¦ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›é™åˆ¶å®¢æˆ·ç«¯ä»ä½ çš„ç½‘ç«™ä¸‹è½½æ–‡ä»¶çš„æœ€å¤§é€Ÿåº¦ï¼Œä»¥ç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è·å¾—è‰¯å¥½çš„æœåŠ¡ä½“éªŒï¼Œæˆ–è€…æ§åˆ¶èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚ ç¤ºä¾‹é…ç½®ï¼š server { listen 80; server_name example.com; location /downloads/ { # ä½¿ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œé™åˆ¶ä¸‹è½½é€Ÿç‡ä¸ºæ¯ç§’100KB limit_rate 100k; # å¯é€‰ï¼šè®¾ç½®åˆå§‹çˆ†å‘é€Ÿç‡ï¼Œè¿™é‡Œä¸º500KB limit_rate_after 500k; root /var/www/downloads; } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlimit_rate æŒ‡ä»¤è®¾ç½®äº†æ¯ä¸ªå“åº”çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆè¿™é‡Œæ˜¯100KB/sï¼‰ï¼Œè€Œ limit_rate_after åˆ™æŒ‡å®šäº†åœ¨å¼€å§‹é™é€Ÿä¹‹å‰å…è®¸ä¼ è¾“çš„æ•°æ®é‡ï¼ˆè¿™é‡Œæ˜¯500KBï¼‰ã€‚è¿™æ„å‘³ç€å¯¹äºå‰500KBçš„æ•°æ®ï¼Œä¸ä¼šæœ‰ä»»ä½•é€Ÿç‡é™åˆ¶ï¼Œä¹‹åçš„é€Ÿåº¦å°†è¢«é™åˆ¶åœ¨100KB/sã€‚ åœºæ™¯äºŒï¼šåŸºäºè¿æ¥æ•°å’Œè¯·æ±‚é¢‘ç‡çš„æµé‡æ§åˆ¶ æœ‰æ—¶ï¼Œé™¤äº†é™åˆ¶å¸¦å®½å¤–ï¼Œè¿˜éœ€è¦å¯¹æ¥è‡ªå•ä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥æ•°æˆ–è¯·æ±‚é¢‘ç‡è¿›è¡Œé™åˆ¶ï¼Œä»¥é˜²æ­¢æ¶æ„æ”»å‡»æˆ–æ»¥ç”¨èµ„æºã€‚ ç¤ºä¾‹é…ç½®ï¼š http { # å®šä¹‰ä¸€ä¸ªåä¸º addr çš„é™æµåŒºï¼Œé™åˆ¶æ¯ç§’è¯·æ±‚æ•°ä¸è¶…è¿‡20æ¬¡ limit_req_zone $binary_remote_addr zone=addr:10m rate=20r/s; server { listen 80; server_name example.com; location / { # åº”ç”¨å‰é¢å®šä¹‰çš„é™æµåŒºï¼Œå¹¶å…è®¸çªå‘æœ€å¤š5ä¸ªé¢å¤–è¯·æ±‚ limit_req zone=addr burst=5 nodelay; # é™åˆ¶æ¯ä¸ªè¿æ¥çš„å¸¦å®½ä¸º50KB/s limit_rate 50k; proxy_pass http://backend; } } } è¿™é‡Œä½¿ç”¨äº† limit_req_zone å’Œ limit_req æ¥é™åˆ¶æ¯ä¸ªIPåœ°å€çš„è¯·æ±‚é¢‘ç‡ï¼ŒåŒæ—¶é€šè¿‡ limit_rate æ¥é™åˆ¶å¸¦å®½ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°ä¿æŠ¤æœåŠ¡å™¨å…å—è¿‡å¤šè¯·æ±‚çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿæ§åˆ¶äº†æ•°æ®ä¼ è¾“é€Ÿåº¦ã€‚ åœºæ™¯ä¸‰ï¼šé’ˆå¯¹ä¸åŒç”¨æˆ·ç»„åº”ç”¨ä¸åŒçš„å¸¦å®½é™åˆ¶ æœ‰æ—¶å€™éœ€è¦æ ¹æ®ç”¨æˆ·çš„ç±»å‹ï¼ˆå¦‚å…è´¹ç”¨æˆ·ä¸ä»˜è´¹ç”¨æˆ·ï¼‰æä¾›ä¸åŒçš„æœåŠ¡çº§åˆ«ï¼ŒåŒ…æ‹¬ä¸åŒçš„ä¸‹è½½é€Ÿåº¦ã€‚ ç¤ºä¾‹é…ç½®ï¼š map $http_x_user_type $download_rate { default \"50k\"; # é»˜è®¤ä¸‹è½½é€Ÿç‡ä¸º50KB/s premium \"200k\"; # é«˜çº§ç”¨æˆ·çš„ä¸‹è½½é€Ÿç‡ä¸º200KB/s } server { listen 80; server_name example.com; location /downloads/ { # æ ¹æ®ç”¨æˆ·ç±»å‹åŠ¨æ€è®¾ç½®ä¸‹è½½é€Ÿç‡ limit_rate $download_rate; root /var/www/downloads; } } åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† map æŒ‡ä»¤æ ¹æ®è‡ªå®šä¹‰çš„HTTPå¤´ï¼ˆæœ¬ä¾‹ä¸­çš„ X-User-Typeï¼‰æ¥å†³å®šä½¿ç”¨å“ªä¸ªä¸‹è½½é€Ÿç‡ã€‚è¿™ä½¿å¾—å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ç±»åˆ«çµæ´»åœ°è°ƒæ•´æœåŠ¡ç­‰çº§ã€‚ è¿™äº›åªæ˜¯Nginxå¸¦å®½é™åˆ¶çš„ä¸€äº›åŸºç¡€åº”ç”¨åœºæ™¯å’Œé…ç½®ç¤ºä¾‹ã€‚å®é™…éƒ¨ç½²æ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œç¯å¢ƒè¿›è¡Œé€‚å½“çš„è°ƒæ•´ã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:16","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx å¹¶å‘æ•°é™åˆ¶ Nginx çš„å¹¶å‘é™åˆ¶åŠŸèƒ½ä¸»è¦ç”¨äºæ§åˆ¶æ¥è‡ªå•ä¸€å®¢æˆ·ç«¯æˆ–ä¸€ç»„å®¢æˆ·ç«¯çš„è¿æ¥æ•°ï¼Œä»¥é˜²æ­¢æœåŠ¡å™¨è¿‡è½½æˆ–è¢«æ»¥ç”¨ã€‚é€šè¿‡ä½¿ç”¨ limit_conn_zone å’Œ limit_conn æŒ‡ä»¤ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†èµ„æºå¹¶ç¡®ä¿æœåŠ¡çš„ç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯åŠç›¸åº”çš„é…ç½®ç¤ºä¾‹ã€‚ åœºæ™¯ä¸€ï¼šé™åˆ¶å•ä¸ªIPåœ°å€çš„æœ€å¤§å¹¶å‘è¿æ¥æ•° åœ¨WebæœåŠ¡å™¨ä¸Šï¼Œå¯èƒ½ä¼šé‡åˆ°æŸäº›ç”¨æˆ·åŒæ—¶å‘èµ·å¤§é‡è¯·æ±‚çš„æƒ…å†µï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œå½±å“å…¶ä»–ç”¨æˆ·çš„è®¿é—®ä½“éªŒã€‚é€šè¿‡é™åˆ¶æ¯ä¸ªIPåœ°å€çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼Œå¯ä»¥æœ‰æ•ˆç¼“è§£è¿™ç§é—®é¢˜ã€‚ ç¤ºä¾‹é…ç½®ï¼š http { # å®šä¹‰ä¸€ä¸ªåä¸º addr çš„é™æµåŒºï¼ŒåŸºäºå®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œé™åˆ¶ limit_conn_zone $binary_remote_addr zone=addr:10m; server { listen 80; server_name example.com; location / { # å…è®¸æ¯ä¸ªIPåœ°å€æœ€å¤šæœ‰10ä¸ªå¹¶å‘è¿æ¥ limit_conn addr 10; proxy_pass http://backend; } } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlimit_conn_zone ä½¿ç”¨ $binary_remote_addr å˜é‡ä½œä¸ºé”®ï¼ˆå³å®¢æˆ·ç«¯çš„IPåœ°å€ï¼‰ï¼Œå¹¶åœ¨å…±äº«å†…å­˜åŒºåŸŸ addr ä¸­ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼Œå¤§å°ä¸º10MBã€‚ç„¶åï¼Œåœ¨å…·ä½“çš„ location å—ä¸­ä½¿ç”¨ limit_conn æ¥æŒ‡å®šæ¯ä¸ªIPåœ°å€å…è®¸çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ä¸º10ã€‚ åœºæ™¯äºŒï¼šæ ¹æ®ä¸åŒçš„URLè·¯å¾„åº”ç”¨ä¸åŒçš„å¹¶å‘é™åˆ¶ æœ‰æ—¶éœ€è¦å¯¹ä¸åŒç±»å‹çš„èµ„æºåº”ç”¨ä¸åŒçš„å¹¶å‘é™åˆ¶ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå¯¹äºé™æ€èµ„æºå’ŒåŠ¨æ€å†…å®¹å¯èƒ½å¸Œæœ›è®¾ç½®ä¸åŒçš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚ ç¤ºä¾‹é…ç½®ï¼š http { # å®šä¹‰ä¸¤ä¸ªé™æµåŒºï¼Œä¸€ä¸ªåŸºäºIPåœ°å€ï¼Œå¦ä¸€ä¸ªåŸºäºURI limit_conn_zone $binary_remote_addr zone=per_ip:10m; limit_conn_zone $request_uri zone=per_uri:10m; server { listen 80; server_name example.com; location /static/ { # å¯¹äºé™æ€èµ„æºï¼Œé™åˆ¶æ¯ä¸ªIPåœ°å€æœ€å¤šæœ‰20ä¸ªå¹¶å‘è¿æ¥ limit_conn per_ip 20; } location /api/ { # å¯¹äºAPIè¯·æ±‚ï¼Œé™åˆ¶æ¯ä¸ªURIæœ€å¤šæœ‰5ä¸ªå¹¶å‘è¿æ¥ limit_conn per_uri 5; proxy_pass http://backend_api; } } } æ­¤é…ç½®ä¸º /static/ è·¯å¾„ä¸‹çš„è¯·æ±‚è®¾ç½®äº†åŸºäºIPåœ°å€çš„å¹¶å‘é™åˆ¶ï¼Œè€Œä¸º /api/ è·¯å¾„ä¸‹çš„è¯·æ±‚è®¾ç½®äº†åŸºäºURIçš„å¹¶å‘é™åˆ¶ã€‚ åœºæ™¯ä¸‰ï¼šç»“åˆé€Ÿç‡é™åˆ¶ä¸å¹¶å‘é™åˆ¶ åœ¨ä¸€äº›é«˜æµé‡ç½‘ç«™ä¸­ï¼Œä¸ä»…éœ€è¦é™åˆ¶å¹¶å‘è¿æ¥æ•°ï¼Œè¿˜éœ€è¦é™åˆ¶è¯·æ±‚çš„é€Ÿç‡ï¼Œä»¥è¿›ä¸€æ­¥ä¿æŠ¤åç«¯æœåŠ¡å…å—çªå‘æµé‡çš„å½±å“ã€‚ ç¤ºä¾‹é…ç½®ï¼š http { # å®šä¹‰å¹¶å‘é™åˆ¶åŒº limit_conn_zone $binary_remote_addr zone=addr:10m; # å®šä¹‰é€Ÿç‡é™åˆ¶åŒº limit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=5r/s; server { listen 80; server_name example.com; location / { # è®¾ç½®æ¯ä¸ªIPåœ°å€æœ€å¤šæœ‰5ä¸ªå¹¶å‘è¿æ¥ limit_conn addr 5; # è®¾ç½®æ¯ä¸ªIPåœ°å€æ¯ç§’æœ€å¤šå¤„ç†5ä¸ªè¯·æ±‚ï¼Œå¹¶å…è®¸çªå‘æœ€å¤š10ä¸ªé¢å¤–è¯·æ±‚ limit_req zone=req_limit_per_ip burst=10 nodelay; proxy_pass http://backend; } } } è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åŒæ—¶åº”ç”¨å¹¶å‘é™åˆ¶å’Œé€Ÿç‡é™åˆ¶æ¥ä¿æŠ¤ä½ çš„Webåº”ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ—¢å¯ä»¥æ§åˆ¶åŒä¸€æ—¶é—´å†…çš„æœ€å¤§è¿æ¥æ•°ï¼Œä¹Ÿèƒ½å¹³æ»‘è¯·æ±‚åˆ°è¾¾çš„é€Ÿç‡ï¼Œé¿å…ç¬é—´çš„å¤§æµé‡å†²å‡»ã€‚ ä»¥ä¸Šæ˜¯å…³äºNginxå¹¶å‘é™åˆ¶çš„ä¸€äº›å…¸å‹åº”ç”¨åœºæ™¯åŠå…¶é…ç½®ç¤ºä¾‹ã€‚æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è¿™äº›å‚æ•°ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å’Œä¼˜åŒ–ä½ çš„WebæœåŠ¡æ€§èƒ½ã€‚ ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:17","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx æ—¥å¿—ç®¡ç† åº”ç”¨åœºæ™¯ è®¿é—®æ—¥å¿— é”™è¯¯æ—¥å¿— æ—¥å¿—åˆ†éš” ngx_http_log_module æ—¥å¿—å†…å­˜ç¼“å†²åŒº åŒ…æ—¥å¿—å‹ç¼©è§£å‹ç¼©ä¸jsonæ ¼å¼è¾“å‡ºæ ·ä¾‹ ç¤ºä¾‹ http { log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; # buffer=32k å½“æ—¥å¿—å¤§å°è¾¾åˆ°32kæ—¶ä¼šå†™å…¥è‡³æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸‹ # access_log /var/log/nginx/access.log main buffer=32k gzip=3 flush=1s; access_log /var/log/nginx/access.log main buffer=32k; ... } jsonæ ¼å¼è¾“å‡º è¦åœ¨Nginxä¸­é…ç½®æ—¥å¿—æ ¼å¼ä¸ºJSONè¾“å‡ºï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¥å¿—æ ¼å¼ï¼Œå¹¶ä½¿ç”¨log_formatæŒ‡ä»¤å°†å…¶è®¾ç½®ä¸ºJSONç»“æ„ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œå±•ç¤ºäº†å¦‚ä½•è®¾ç½®Nginxä»¥JSONæ ¼å¼è®°å½•è®¿é—®æ—¥å¿—ã€‚ ç¤ºä¾‹é…ç½® é¦–å…ˆï¼Œåœ¨ä½ çš„Nginxé…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯nginx.confæˆ–ä½äºsites-availableç›®å½•ä¸‹çš„æŸä¸ªé…ç½®æ–‡ä»¶ï¼‰ä¸­çš„httpå—å†…æ·»åŠ å¦‚ä¸‹å®šä¹‰ï¼š http { # å®šä¹‰JSONæ ¼å¼çš„æ—¥å¿— log_format json_combined escape=json '{\"time_local\": \"$time_local\", ' '\"remote_addr\": \"$remote_addr\", ' '\"remote_user\": \"$remote_user\", ' '\"request\": \"$request\", ' '\"status\": $status, ' '\"body_bytes_sent\": $body_bytes_sent, ' '\"request_time\": $request_time, ' '\"http_referer\": \"$http_referer\", ' '\"http_user_agent\": \"$http_user_agent\"}'; server { listen 80; server_name example.com; access_log /var/log/nginx/access.log json_combined; location / { proxy_pass http://backend; } } } é‡Šä¹‰ log_formatï¼šè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºjson_combinedçš„æ—¥å¿—æ ¼å¼ã€‚ä½¿ç”¨escape=jsonç¡®ä¿æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦éƒ½è¢«æ­£ç¡®è½¬ä¹‰ï¼Œé¿å…ç ´åJSONç»“æ„ã€‚ å­—æ®µè¯´æ˜ï¼š $time_local: è¯·æ±‚çš„æœ¬åœ°æ—¶é—´ã€‚ $remote_addr: å®¢æˆ·ç«¯IPåœ°å€ã€‚ $remote_user: è¿œç¨‹ç”¨æˆ·ï¼ˆé€šå¸¸ç”¨äºèº«ä»½éªŒè¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºç©ºï¼‰ã€‚ $request: å®Œæ•´çš„åŸå§‹è¯·æ±‚è¡Œã€‚ $status: HTTPå“åº”çŠ¶æ€ç ã€‚ $body_bytes_sent: å‘é€ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬å“åº”å¤´çš„å¤§å°ã€‚ $request_time: è¯·æ±‚å¤„ç†æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œç²¾åº¦è¾¾åˆ°æ¯«ç§’ã€‚ $http_referer: æ¥æºé¡µé¢ï¼ˆå³ç”¨æˆ·æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼‰ã€‚ $http_user_agent: ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ç±»å‹ç­‰ä¿¡æ¯ï¼‰ã€‚ æ—¥å¿—è¾“å‡ºæ ·ä¾‹ åŸºäºä¸Šè¿°é…ç½®ï¼Œä¸€æ¡å…¸å‹çš„Nginxè®¿é—®æ—¥å¿—è®°å½•å°†ä»¥å¦‚ä¸‹JSONæ ¼å¼è¾“å‡ºåˆ°/var/log/nginx/access.logæ–‡ä»¶ä¸­ï¼š { \"time_local\": \"12/Feb/2025:17:32:00 +0000\", \"remote_addr\": \"192.168.1.1\", \"remote_user\": \"-\", \"request\": \"GET /index.html HTTP/1.1\", \"status\": 200, \"body_bytes_sent\": 612, \"request_time\": 0.002, \"http_referer\": \"http://example.com/start.html\", \"http_user_agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3\" } è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªHTTP GETè¯·æ±‚çš„æ—¥å¿—æ¡ç›®ï¼Œå…¶ä¸­åŒ…å«äº†è¯·æ±‚çš„å„ç§è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡å°†Nginxçš„æ—¥å¿—æ ¼å¼åŒ–ä¸ºJSONï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæ—¥å¿—åˆ†æã€ç›‘æ§ä»¥åŠä¸å…¶ä»–ç³»ç»Ÿé›†æˆã€‚ æ—¥å¿—åˆ‡å‰² æ—¥å¿—åˆ†éš”çš„å¿…è¦æ€§ é¿å…å•ä¸ªæ–‡ä»¶è¿‡å¤§ï¼šé•¿æ—¶é—´è¿è¡Œä¼šå¯¼è‡´æ—¥å¿—æ–‡ä»¶å ç”¨è¿‡å¤šç£ç›˜ç©ºé—´ã€‚ ä¾¿äºå½’æ¡£å’Œæ’æŸ¥ï¼šæŒ‰æ—¶é—´æˆ–å¤§å°åˆ†éš”æ—¥å¿—ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ã€‚ ç»“åˆå‹ç¼©èŠ‚çœç©ºé—´ï¼šå‹ç¼©æ—§æ—¥å¿—å‡å°‘å­˜å‚¨å‹åŠ›ã€‚ ä½¿ç”¨ logrotate å·¥å…·ï¼ˆæ¨èï¼‰ logrotate æ˜¯Linuxç³»ç»Ÿè‡ªå¸¦çš„æ—¥å¿—ç®¡ç†å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–è½®è½¬ã€å‹ç¼©å’Œåˆ é™¤æ—§æ—¥å¿—ã€‚ æ­¥éª¤ï¼š ç¼–è¾‘Nginxçš„logrotateé…ç½®æ–‡ä»¶ é€šå¸¸è·¯å¾„ä¸º /etc/logrotate.d/nginxï¼Œå†…å®¹å¦‚ä¸‹ï¼š /var/log/nginx/*.log { # åŒ¹é…Nginxæ—¥å¿—è·¯å¾„ daily # æŒ‰å¤©è½®è½¬ missingok # æ—¥å¿—ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™ rotate 14 # ä¿ç•™æœ€è¿‘14å¤©çš„æ—¥å¿— compress # å‹ç¼©æ—§æ—¥å¿—ï¼ˆgzipï¼‰ delaycompress # å»¶è¿Ÿå‹ç¼©å‰ä¸€ä¸ªè½®è½¬çš„æ—¥å¿—ï¼ˆæ–¹ä¾¿æ’æŸ¥æœ€æ–°æ—§æ—¥å¿—ï¼‰ notifempty # ç©ºæ—¥å¿—ä¸è½®è½¬ create 0640 www-data adm # åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶å¹¶è®¾ç½®æƒé™ã€æ‰€æœ‰è€… sharedscripts # æ‰€æœ‰æ—¥å¿—å¤„ç†å®Œæˆåæ‰§è¡Œè„šæœ¬ postrotate # è½®è½¬åæ‰§è¡Œçš„å‘½ä»¤ [ -f /var/run/nginx.pid ] \u0026\u0026 kill -USR1 `cat /var/run/nginx.pid` # é€šçŸ¥Nginxé‡æ–°æ‰“å¼€æ—¥å¿— endscript } æµ‹è¯•é…ç½® æ‰‹åŠ¨æ‰§è¡Œè½®è½¬å¹¶æ£€æŸ¥ç»“æœï¼š logrotate -vf /etc/logrotate.d/nginx # -v: è¯¦ç»†è¾“å‡ºï¼Œ-f: å¼ºåˆ¶è¿è¡Œ éªŒè¯æ—¥å¿—åˆ†éš” æ£€æŸ¥ /var/log/nginx ç›®å½•æ˜¯å¦ç”Ÿæˆç±»ä¼¼ access.log.1.gz çš„å‹ç¼©æ–‡ä»¶ï¼Œå¹¶ç¡®è®¤Nginxæ­£å¸¸å†™å…¥æ–°æ—¥å¿—ã€‚ å…³é”®æ³¨æ„äº‹é¡¹ æƒé™é—®é¢˜ ç¡®ä¿æ–°æ—¥å¿—æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆå¦‚ www-dataï¼‰ä¸Nginxè¿è¡Œç”¨æˆ·ä¸€è‡´ã€‚ logrotate é…ç½®ä¸­ä½¿ç”¨ create æŒ‡ä»¤è®¾ç½®æƒé™ã€‚ ä¿¡å·æœºåˆ¶ kill -USR1 é€šçŸ¥Nginxé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚ ä¹Ÿå¯ç”¨ nginx -s reopen å‘½ä»¤å®ç°ç›¸åŒæ•ˆæœã€‚ è½®è½¬å‘¨æœŸè°ƒæ•´ ä¿®æ”¹ logrotate é…ç½®ä¸­çš„ daily ä¸º weeklyã€monthly æˆ– sizeï¼ˆå¦‚ size 100Mï¼‰ã€‚ æ—¥å¿—å¤„ç† ä½¿ç”¨ compress å’Œ delaycompress æ§åˆ¶å‹ç¼©è¡Œä¸ºã€‚ é€šè¿‡ rotate è®¾ç½®ä¿ç•™çš„æ—§æ—¥å¿—æ•°é‡ã€‚ é…ç½®å¤šä¸ªç›®å½•çš„æ–¹å¼ # /etc/logrotate.d/nginx /var/log/nginx/*.log { daily rotate 14 compress missingok create 0640 www-data adm postrotate nginx -s reopen endscript } # /etc/logrotate.d/nginx /opt/nginx/logs/*.log /data/logs/nginx/*.log { daily rotate 30 missingok dateext compress delaycompress notifempty sharedscripts postrotate [ -f /opt/nginx/logs/nginx.pid ] \u0026\u0026 kill -USR1 `cat /opt/nginx/logs/nginx.pid` endscript } ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:18","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"Nginx upsream é‡è¯•æœºåˆ¶ æ¢æµ‹ä¸Šæ¸¸æœåŠ¡å™¨å¥åº·çŠ¶æ€ é‡è¯•æœºåˆ¶(è¢«åŠ¨é‡è¯•æœºåˆ¶å’Œä¸»åŠ¨é‡è¯•æœºåˆ¶) çŠ¶æ€æ£€æŸ¥ Nginxçš„upstreamæ¨¡å—ç”¨äºå®šä¹‰ä¸€ç»„æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨å¯ä»¥æ˜¯æä¾›ç›¸åŒæœåŠ¡çš„å¤šä¸ªåç«¯å®ä¾‹ã€‚Nginxèƒ½å¤Ÿæ ¹æ®é…ç½®å°†è¯·æ±‚åˆ†é…ç»™è¿™äº›ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è¿›è¡Œé‡è¯•ï¼Œè¿™æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå¯é æ€§ã€‚ è¢«åŠ¨æ€å¼é‡è¯•æœºåˆ¶ å½“ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å¤±è´¥æ—¶ï¼ˆä¾‹å¦‚ç”±äºè¶…æ—¶ã€è¿æ¥å¤±è´¥æˆ–è¿”å›äº†é”™è¯¯ç ï¼‰ï¼ŒNginxå¯ä»¥æ ¹æ®é…ç½®å†³å®šæ˜¯å¦ä»¥åŠå¦‚ä½•é‡è¯•è¯¥è¯·æ±‚ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡proxy_next_upstreamæŒ‡ä»¤æ¥æ§åˆ¶ã€‚å®ƒå…è®¸ä½ æŒ‡å®šåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹Nginxåº”è¯¥å°è¯•è½¬å‘è¯·æ±‚åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨çš„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚ å¯ç”¨æ¡ä»¶åŒ…æ‹¬ error: å½“ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€ä¼ é€’è¯·æ±‚æˆ–è¯»å–å“åº”å¤´æ—¶å‘ç”Ÿé”™è¯¯ã€‚ timeout: è¶…æ—¶å‘ç”Ÿæ—¶ï¼ˆç”±å…¶ä»–æŒ‡ä»¤å¦‚proxy_connect_timeout, proxy_read_timeoutç­‰å®šä¹‰ï¼‰ã€‚ invalid_header: æœåŠ¡å™¨è¿”å›æ— æ•ˆå“åº”å¤´ã€‚ http_500, http_502, http_503, http_504: åˆ†åˆ«å¯¹åº”HTTPçŠ¶æ€ç 500, 502, 503å’Œ504ã€‚ non_idempotent: é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å¹‚ç­‰è¯·æ±‚ï¼ˆå¦‚GET, HEADï¼‰ä¼šè¢«é‡è¯•ã€‚è®¾ç½®æ­¤é€‰é¡¹å¯å…è®¸éå¹‚ç­‰è¯·æ±‚ï¼ˆå¦‚POSTï¼‰ä¹Ÿè¢«é‡è¯•ã€‚ ç¤ºä¾‹é…ç½® ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨proxy_next_upstreamçš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•é…ç½®Nginxä»¥å®ç°åŠ¨æ€å¼é‡è¯•æœºåˆ¶ï¼š http { upstream backend { server backend1.example.com max_fails=5; server backend2.example.com; server backend3.example.com backup; # å¤‡ä»½æœåŠ¡å™¨ï¼Œä»…å½“å‰é¢æ‰€æœ‰æœåŠ¡å™¨éƒ½ä¸å¯ç”¨æ—¶ä½¿ç”¨ } server { listen 80; location / { proxy_pass http://backend; # é…ç½®é‡è¯•æ¡ä»¶ proxy_next_upstream error timeout http_500 http_502 http_503 http_504; # è®¾ç½®å°è¯•ä¸‹ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨å‰ç­‰å¾…çš„æ—¶é—´ proxy_next_upstream_timeout 60s; # è®¾ç½®æ¯ä¸ªè¯·æ±‚æœ€å¤šå°è¯•å¤šå°‘æ¬¡ä¸Šæ¸¸æœåŠ¡å™¨ proxy_next_upstream_tries 3; } } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ upstream å—å®šä¹‰äº†ä¸€ä¸ªåä¸ºbackendçš„ç»„ï¼ŒåŒ…å«ä¸‰ä¸ªåç«¯æœåŠ¡å™¨ã€‚æœ€åä¸€ä¸ªæ ‡è®°ä¸ºbackupï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨æ‰€æœ‰éå¤‡ä»½æœåŠ¡å™¨éƒ½æ— æ³•ä½¿ç”¨æ—¶æ‰ä¼šå°è¯•è”ç³»å®ƒã€‚ åœ¨locationå—å†…ï¼Œproxy_passæŒ‡ä»¤æŒ‡å®šäº†è¦ä½¿ç”¨çš„ä¸Šæ¸¸æœåŠ¡å™¨ç»„ã€‚ proxy_next_upstreamæŒ‡ä»¤è®¾ç½®äº†åœ¨é‡åˆ°é”™è¯¯ã€è¶…æ—¶æˆ–æ”¶åˆ°ç‰¹å®šHTTPçŠ¶æ€ç ï¼ˆ500, 502, 503, 504ï¼‰æ—¶å°è¯•ä¸‹ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ã€‚ proxy_next_upstream_timeoutè®¾å®šäº†å°è¯•ä¸‹ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€å¤§ç­‰å¾…æ—¶é—´ä¸º60ç§’ã€‚ proxy_next_upstream_triesé™åˆ¶äº†å¯¹æ¯ä¸ªè¯·æ±‚æœ€å¤šå°è¯•3æ¬¡ä¸Šæ¸¸æœåŠ¡å™¨ã€‚ é€šè¿‡è¿™ç§æ–¹å¼é…ç½®ï¼ŒNginxå¯ä»¥åœ¨é¢å¯¹ç½‘ç»œæ³¢åŠ¨æˆ–å…¶ä»–ä¸´æ—¶æ€§æ•…éšœæ—¶æ›´åŠ å¥å£®ï¼Œç¡®ä¿ç”¨æˆ·è¯·æ±‚å°½å¯èƒ½å¾—åˆ°æˆåŠŸå¤„ç†ã€‚è¿™å¯¹äºæ„å»ºé«˜å¯ç”¨æ€§çš„Webåº”ç”¨è‡³å…³é‡è¦ã€‚ ä¸»åŠ¨é‡è¯•æœºåˆ¶ ä¸»åŠ¨å¥åº·æ£€æŸ¥ä½¿ç”¨tengineæ¨¡å— tengineç‰ˆæœ¬(å·²åº”ç”¨åˆ°æ·˜å®ç½‘ä¸Šäº†) https://github.com/yaoweibin/nginx_upstream_check_module nginx å•†ä¸šç‰ˆæ’ä»¶ https://nginx.org/en/docs/http/ngx_http_upstream_hc_module.html ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:5:19","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"å‚è€ƒ https://nginx.org/en/docs/http/ngx_http_core_module.html#http Nginx Config å¯ä»¥å¿«é€Ÿæ–¹ä¾¿è·å¾—nginxçš„é…ç½® ","date":"2022-01-13","objectID":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/:6:0","tags":["Nginx"],"title":"Nginx å¸¸ç”¨é…ç½®","uri":"/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"},{"categories":["Nginx"],"content":"æ—¥å¸¸å·¥ä½œä¸­çš„å¥‡æ·«æŠ€å·§ ","date":"2022-01-11","objectID":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:0","tags":["Nginx"],"title":"Nginx æ—¥å¸¸å·¥ä½œå¸¸ç”¨è„šæœ¬","uri":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Nginx"],"content":"æ—¥å¿—åˆ‡å‰²è„šæœ¬ #!/bin/bash #è®¾ç½®ä½ çš„æ—¥å¿—å­˜æ”¾çš„ç›®å½• log_files_path=\"/mnt/usr/logs/\" #æ—¥å¿—ä»¥å¹´/æœˆçš„ç›®å½•å½¢å¼å­˜æ”¾ log_files_dir=${log_files_path}\"backup/\" #è®¾ç½®éœ€è¦è¿›è¡Œæ—¥å¿—åˆ†å‰²çš„æ—¥å¿—æ–‡ä»¶åç§°ï¼Œå¤šä¸ªä»¥ç©ºæ ¼éš”å¼€ log_files_name=(access.log error.log) #è®¾ç½®nginxçš„å®‰è£…è·¯å¾„ nginx_sbin=\"/mnt/usr/sbin/nginx -c /mnt/usr/conf/nginx.conf\" #Set how long you want to save save_days=10 ############################################ #Please do not modify the following script # ############################################ mkdir -p $log_files_dir log_files_num=${#log_files_name[@]} #cut nginx log files for((i=0;i\u003c$log_files_num;i++));do mv ${log_files_path}${log_files_name[i]} ${log_files_dir}${log_files_name[i]}_$(date -d \"yesterday\" +\"%Y%m%d\") done $nginx_sbin -s reload ","date":"2022-01-11","objectID":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:1","tags":["Nginx"],"title":"Nginx æ—¥å¸¸å·¥ä½œå¸¸ç”¨è„šæœ¬","uri":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Nginx"],"content":"å›¾ç‰‡æ”¾ç›—é“¾ server { listen 80; server_name *.phpblog.com.cn; # å›¾ç‰‡é˜²ç›—é“¾ location ~* \\.(gif|jpg|jpeg|png|bmp|swf)$ { valid_referers none blocked server_names ~\\.google\\. ~\\.baidu\\. *.qq.com; if ($invalid_referer){ return 403; } } } ","date":"2022-01-11","objectID":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:2","tags":["Nginx"],"title":"Nginx æ—¥å¸¸å·¥ä½œå¸¸ç”¨è„šæœ¬","uri":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Nginx"],"content":"nginx è®¿é—®æ§åˆ¶ location ~ \\.php$ { allow 127.0.0.1; #åªå…è®¸127.0.0.1çš„è®¿é—®ï¼Œå…¶ä»–å‡æ‹’ç» deny all; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } ","date":"2022-01-11","objectID":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:3","tags":["Nginx"],"title":"Nginx æ—¥å¸¸å·¥ä½œå¸¸ç”¨è„šæœ¬","uri":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Nginx"],"content":"ä¸¢å¼ƒä¸å—æ”¯æŒçš„æ–‡ä»¶æ‰©å±•åçš„è¯·æ±‚ location ~ \\.(js|css|sql)$ { deny all; } ","date":"2022-01-11","objectID":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:4","tags":["Nginx"],"title":"Nginx æ—¥å¸¸å·¥ä½œå¸¸ç”¨è„šæœ¬","uri":"/nginx%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["hugo"],"content":"test test LoveItæä¾›äº†admonition shortcodeï¼Œæ”¯æŒ 12 ç§æ ·å¼ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸­æ’å…¥æç¤ºçš„æ¨ªå¹…ã€‚ä»£ç å¦‚ä¸‹ ","date":"2021-09-15","objectID":"/first_post/:1:0","tags":["hugo"],"title":"First_post","uri":"/first_post/"},{"categories":["hugo"],"content":"ä¸»é¢˜è‡ªå¸¦çš„admonitionæ ·å¼ æ³¨æ„\rä¸€ä¸ª æ³¨æ„ æ¨ªå¹…\rè¿™æ˜¯ä¸€ä¸ªé»˜è®¤ä¸å±•å¼€çš„æ¨ªå¹…\rä¸€ä¸ª æ³¨æ„ æ¨ªå¹…\ræ‘˜è¦\rä¸€ä¸ª æ‘˜è¦ æ¨ªå¹…\rä¿¡æ¯\rä¸€ä¸ª ä¿¡æ¯ æ¨ªå¹…\ræŠ€å·§\rä¸€ä¸ª æŠ€å·§ æ¨ªå¹…\ræˆåŠŸ\rä¸€ä¸ª æˆåŠŸ æ¨ªå¹…\ré—®é¢˜\rä¸€ä¸ª é—®é¢˜ æ¨ªå¹…\rè­¦å‘Š\rä¸€ä¸ª è­¦å‘Š æ¨ªå¹…\rå¤±è´¥\rä¸€ä¸ª å¤±è´¥ æ¨ªå¹…\rå±é™©\rä¸€ä¸ª å±é™© æ¨ªå¹…\rBug\rä¸€ä¸ª Bug æ¨ªå¹…\rç¤ºä¾‹\rä¸€ä¸ª ç¤ºä¾‹ æ¨ªå¹…\rå¼•ç”¨\rä¸€ä¸ª å¼•ç”¨ æ¨ªå¹…\r","date":"2021-09-15","objectID":"/first_post/:2:0","tags":["hugo"],"title":"First_post","uri":"/first_post/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº ContainerCreating æˆ– Waiting çŠ¶æ€ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod é…ç½®é”™è¯¯ æ£€æŸ¥æ˜¯å¦æ‰“åŒ…äº†æ­£ç¡®çš„é•œåƒ æ£€æŸ¥é…ç½®äº†æ­£ç¡®çš„å®¹å™¨å‚æ•° ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"ç£ç›˜çˆ†æ»¡ å¯åŠ¨ Pod ä¼šè°ƒ CRI æ¥å£åˆ›å»ºå®¹å™¨ï¼Œå®¹å™¨è¿è¡Œæ—¶åˆ›å»ºå®¹å™¨æ—¶é€šå¸¸ä¼šåœ¨æ•°æ®ç›®å½•ä¸‹ä¸ºæ–°å»ºçš„å®¹å™¨åˆ›å»ºä¸€äº›ç›®å½•å’Œæ–‡ä»¶ï¼Œå¦‚æœæ•°æ®ç›®å½•æ‰€åœ¨çš„ç£ç›˜ç©ºé—´æ»¡äº†å°±ä¼šåˆ›å»ºå¤±è´¥å¹¶æŠ¥é”™: Events: Type Reason Age From Message ---- ------ ---- ---- ------- Warning FailedCreatePodSandBox 2m (x4307 over 16h) kubelet, 10.179.80.31 (combined from similar events): Failed create pod sandbox: rpc error: code = Unknown desc = failed to create a sandbox for pod \"apigateway-6dc48bf8b6-l8xrw\": Error response from daemon: mkdir /var/lib/docker/aufs/mnt/1f09d6c1c9f24e8daaea5bf33a4230de7dbc758e3b22785e8ee21e3e3d921214-init: no space left on device ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"limit è®¾ç½®å¤ªå°æˆ–è€…å•ä½ä¸å¯¹ å¦‚æœ limit è®¾ç½®è¿‡å°ä»¥è‡³äºä¸è¶³ä»¥æˆåŠŸè¿è¡Œ Sandbox ä¹Ÿä¼šé€ æˆè¿™ç§çŠ¶æ€ï¼Œå¸¸è§çš„æ˜¯å› ä¸º memory limit å•ä½è®¾ç½®ä¸å¯¹é€ æˆçš„ limit è¿‡å°ï¼Œæ¯”å¦‚è¯¯å°† memory çš„ limit å•ä½åƒ request ä¸€æ ·è®¾ç½®ä¸ºå° mï¼Œè¿™ä¸ªå•ä½åœ¨ memory ä¸é€‚ç”¨ï¼Œä¼šè¢« k8s è¯†åˆ«æˆ byteï¼Œ åº”è¯¥ç”¨ Mi æˆ– Mã€‚ï¼Œ ä¸¾ä¸ªä¾‹å­: å¦‚æœ memory limit è®¾ä¸º 1024m è¡¨ç¤ºé™åˆ¶ 1.024 Byteï¼Œè¿™ä¹ˆå°çš„å†…å­˜ï¼Œ pause å®¹å™¨ä¸€èµ·æ¥å°±ä¼šè¢« cgroup-oom kill æ‰ï¼Œå¯¼è‡´ pod çŠ¶æ€ä¸€ç›´å¤„äº ContainerCreatingã€‚ è¿™ç§æƒ…å†µé€šå¸¸ä¼šæŠ¥ä¸‹é¢çš„ event: Pod sandbox changed, it will be killed and re-createdã€‚ kubeletæŠ¥é”™ to start sandbox container for pod ... Error response from daemon: OCI runtime create failed: container_linux.go:348: starting container process caused \"process_linux.go:301: running exec setns process for init caused \\\"signal: killed\\\"\": unknown ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"æ‹‰å–é•œåƒå¤±è´¥ é•œåƒæ‹‰å–å¤±è´¥ä¹Ÿåˆ†å¾ˆå¤šæƒ…å†µï¼Œè¿™é‡Œåˆ—ä¸¾ä¸‹: é…ç½®äº†é”™è¯¯çš„é•œåƒ Kubelet æ— æ³•è®¿é—®é•œåƒä»“åº“ï¼ˆæ¯”å¦‚é»˜è®¤ pause é•œåƒåœ¨ gcr.io ä¸Šï¼Œå›½å†…ç¯å¢ƒè®¿é—®éœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰ æ‹‰å–ç§æœ‰é•œåƒçš„ imagePullSecret æ²¡æœ‰é…ç½®æˆ–é…ç½®æœ‰è¯¯ é•œåƒå¤ªå¤§ï¼Œæ‹‰å–è¶…æ—¶ï¼ˆå¯ä»¥é€‚å½“è°ƒæ•´ kubelet çš„ â€”image-pull-progress-deadline å’Œ â€”runtime-request-timeout é€‰é¡¹ï¼‰ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:4","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"controller-manager å¼‚å¸¸ æŸ¥çœ‹ master ä¸Š kube-controller-manager çŠ¶æ€ï¼Œå¼‚å¸¸çš„è¯å°è¯•é‡å¯ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:1:5","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº Error çŠ¶æ€ é€šå¸¸å¤„äº Error çŠ¶æ€è¯´æ˜ Pod å¯åŠ¨è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ã€‚å¸¸è§çš„åŸå› åŒ…æ‹¬ï¼š ä¾èµ–çš„ ConfigMapã€Secret æˆ–è€… PV ç­‰ä¸å­˜åœ¨ è¯·æ±‚çš„èµ„æºè¶…è¿‡äº†ç®¡ç†å‘˜è®¾ç½®çš„é™åˆ¶ï¼Œæ¯”å¦‚è¶…è¿‡äº† LimitRange ç­‰ è¿åé›†ç¾¤çš„å®‰å…¨ç­–ç•¥ å®¹å™¨æ— æƒæ“ä½œé›†ç¾¤å†…çš„èµ„æºï¼Œæ¯”å¦‚å¼€å¯ RBAC åï¼Œéœ€è¦ä¸º ServiceAccount é…ç½®è§’è‰²ç»‘å®š ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº ImagePullBackOff çŠ¶æ€ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"http ç±»å‹ registryï¼Œåœ°å€æœªåŠ å…¥åˆ° insecure-registry dockerd é»˜è®¤ä» https ç±»å‹çš„ registry æ‹‰å–é•œåƒï¼Œå¦‚æœä½¿ç”¨ https ç±»å‹çš„ registryï¼Œåˆ™å¿…é¡»å°†å®ƒæ·»åŠ åˆ° insecure-registry å‚æ•°ä¸­ï¼Œç„¶åé‡å¯æˆ– reload dockerd ç”Ÿæ•ˆã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"https è‡ªç­¾å‘ç±»å‹ resitryï¼Œæ²¡æœ‰ç»™èŠ‚ç‚¹æ·»åŠ  ca è¯ä¹¦ å¦‚æœ registry æ˜¯ https ç±»å‹ï¼Œä½†è¯ä¹¦æ˜¯è‡ªç­¾å‘çš„ï¼Œdockerd ä¼šæ ¡éªŒ registry çš„è¯ä¹¦ï¼Œæ ¡éªŒæˆåŠŸæ‰èƒ½æ­£å¸¸ä½¿ç”¨é•œåƒä»“åº“ï¼Œ è¦æƒ³æ ¡éªŒæˆåŠŸå°±éœ€è¦å°† registry çš„ ca è¯ä¹¦æ”¾ç½®åˆ° /etc/docker/certs.d/\u003cregistry:port\u003e/ca.crt ä½ç½®ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"ç§æœ‰é•œåƒä»“åº“è®¤è¯å¤±è´¥ å¦‚æœ registry éœ€è¦è®¤è¯ï¼Œä½†æ˜¯ Pod æ²¡æœ‰é…ç½® imagePullSecretï¼Œé…ç½®çš„ Secret ä¸å­˜åœ¨æˆ–è€…æœ‰è¯¯éƒ½ä¼šè®¤è¯å¤±è´¥ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"é•œåƒæ–‡ä»¶æŸå å¦‚æœ push çš„é•œåƒæ–‡ä»¶æŸåäº†ï¼Œä¸‹è½½ä¸‹æ¥ä¹Ÿç”¨ä¸äº†ï¼Œéœ€è¦é‡æ–° push é•œåƒæ–‡ä»¶ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:4","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"é•œåƒæ‹‰å–è¶…æ—¶ å¦‚æœèŠ‚ç‚¹ä¸Šæ–°èµ·çš„ Pod å¤ªå¤šå°±ä¼šæœ‰è®¸å¤šå¯èƒ½ä¼šé€ æˆå®¹å™¨é•œåƒä¸‹è½½æ’é˜Ÿï¼Œå¦‚æœå‰é¢æœ‰è®¸å¤šå¤§é•œåƒéœ€è¦ä¸‹è½½å¾ˆé•¿æ—¶é—´ï¼Œåé¢æ’é˜Ÿçš„ Pod å°±ä¼šæŠ¥æ‹‰å–è¶…æ—¶ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:5","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"é•œåƒä¸å­˜åœ¨ kubelet æ—¥å¿—ï¼š PullImage \"imroc/test:v0.2\" from image service failed: rpc error: code = Unknown desc = Error response from daemon: manifest for imroc/test:v0.2 not found ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:3:6","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€ Pending çŠ¶æ€è¯´æ˜ Pod è¿˜æ²¡æœ‰è¢«è°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œéœ€è¦çœ‹ä¸‹ Pod äº‹ä»¶è¿›ä¸€æ­¥åˆ¤æ–­åŸå› ï¼Œæ¯”å¦‚: $ kubectl describe pod tikv-0 ... Events: Type Reason Age From Message ---- ------ ---- ---- ------- Warning FailedScheduling 3m (x106 over 33m) default-scheduler 0/4 nodes are available: 1 node(s) had no available volume zone, 2 Insufficient cpu, 3 Insufficient memory. ä¸‹é¢åˆ—ä¸¾ä¸‹å¯èƒ½åŸå› å’Œè§£å†³æ–¹æ³•ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:4:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹èµ„æºä¸å¤Ÿ èŠ‚ç‚¹èµ„æºä¸å¤Ÿæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ: CPU è´Ÿè½½è¿‡é«˜ å‰©ä½™å¯ä»¥è¢«åˆ†é…çš„å†…å­˜ä¸å¤Ÿ å¦‚æœåˆ¤æ–­æŸä¸ª Node èµ„æºæ˜¯å¦è¶³å¤Ÿï¼Ÿ é€šè¿‡ kubectl describe node æŸ¥çœ‹ node èµ„æºæƒ…å†µï¼Œå…³æ³¨ä»¥ä¸‹ä¿¡æ¯ï¼š Allocatable: è¡¨ç¤ºæ­¤èŠ‚ç‚¹èƒ½å¤Ÿç”³è¯·çš„èµ„æºæ€»å’Œ Allocated resources: è¡¨ç¤ºæ­¤èŠ‚ç‚¹å·²åˆ†é…çš„èµ„æº (Allocatable å‡å»èŠ‚ç‚¹ä¸Šæ‰€æœ‰ Pod æ€»çš„ Request) $ sudo kubectl describe node 10.10.192.220|grep Allo -A 6 Allocatable: cpu: 8 ephemeral-storage: 33806352329 hugepages-2Mi: 0 memory: 24543516Ki pods: 110 System Info: -- Allocated resources: (Total limits may be over 100 percent, i.e., overcommitted.) Resource Requests Limits -------- -------- ------ cpu 3650m (45%) 50150m (626%) memory 5092Mi (21%) 81290Mi (339%) ephemeral-storage 0 (0%) 0 (0%) å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿç”³è¯·çš„èµ„æºæ€»å’Œï¼Œå½“å‰èŠ‚ç‚¹å¯ä»¥åˆ›å»º110ä¸ªpodsï¼Œcpu 8æ ¸ï¼Œcpu requestså æ¯”45% å‰è€…ä¸åè€…ç›¸å‡ï¼Œå¯å¾—å‡ºå‰©ä½™å¯ç”³è¯·çš„èµ„æºã€‚å¦‚æœè¿™ä¸ªå€¼å°äº Pod çš„ requestï¼Œå°±ä¸æ»¡è¶³ Pod çš„èµ„æºè¦æ±‚ï¼ŒScheduler åœ¨ Predicates (é¢„é€‰) é˜¶æ®µå°±ä¼šå‰”é™¤æ‰è¿™ä¸ª Nodeï¼Œä¹Ÿå°±ä¸ä¼šè°ƒåº¦ä¸Šå» ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:4:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"ä¸æ»¡è¶³ nodeSelector ä¸ affinity å¦‚æœ Pod åŒ…å« nodeSelector æŒ‡å®šäº†èŠ‚ç‚¹éœ€è¦åŒ…å«çš„ labelï¼Œè°ƒåº¦å™¨å°†åªä¼šè€ƒè™‘å°† Pod è°ƒåº¦åˆ°åŒ…å«è¿™äº› label çš„ Node ä¸Šï¼Œå¦‚æœæ²¡æœ‰ Node æœ‰è¿™äº› label æˆ–è€…æœ‰è¿™äº› label çš„ Node å…¶å®ƒæ¡ä»¶ä¸æ»¡è¶³ä¹Ÿå°†ä¼šæ— æ³•è°ƒåº¦ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/assign-pod-node/ å¦‚æœ Pod åŒ…å« affinityï¼ˆäº²å’Œæ€§ï¼‰çš„é…ç½®ï¼Œè°ƒåº¦å™¨æ ¹æ®è°ƒåº¦ç®—æ³•ä¹Ÿå¯èƒ½ç®—å‡ºæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„ Nodeï¼Œä»è€Œæ— æ³•è°ƒåº¦ã€‚affinity æœ‰ä»¥ä¸‹å‡ ç±»: nodeAffinity: èŠ‚ç‚¹äº²å’Œæ€§ï¼Œå¯ä»¥çœ‹æˆæ˜¯å¢å¼ºç‰ˆçš„ nodeSelectorï¼Œç”¨äºé™åˆ¶ Pod åªå…è®¸è¢«è°ƒåº¦åˆ°æŸä¸€éƒ¨åˆ† Nodeã€‚ podAffinity: Pod äº²å’Œæ€§ï¼Œç”¨äºå°†ä¸€äº›æœ‰å…³è”çš„ Pod è°ƒåº¦åˆ°åŒä¸€ä¸ªåœ°æ–¹ï¼ŒåŒä¸€ä¸ªåœ°æ–¹å¯ä»¥æ˜¯æŒ‡åŒä¸€ä¸ªèŠ‚ç‚¹æˆ–åŒä¸€ä¸ªå¯ç”¨åŒºçš„èŠ‚ç‚¹ç­‰ã€‚ podAntiAffinity: Pod åäº²å’Œæ€§ï¼Œç”¨äºé¿å…å°†æŸä¸€ç±» Pod è°ƒåº¦åˆ°åŒä¸€ä¸ªåœ°æ–¹é¿å…å•ç‚¹æ•…éšœï¼Œæ¯”å¦‚å°†é›†ç¾¤ DNS æœåŠ¡çš„ Pod å‰¯æœ¬éƒ½è°ƒåº¦åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œé¿å…ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†é€ æˆæ•´ä¸ªé›†ç¾¤ DNS è§£æå¤±è´¥ï¼Œä½¿å¾—ä¸šåŠ¡ä¸­æ–­ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:4:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Node å­˜åœ¨ Pod æ²¡æœ‰å®¹å¿çš„æ±¡ç‚¹ å¦‚æœèŠ‚ç‚¹ä¸Šå­˜åœ¨æ±¡ç‚¹ (Taints)ï¼Œè€Œ Pod æ²¡æœ‰å“åº”çš„å®¹å¿ (Tolerations)ï¼ŒPod ä¹Ÿå°†ä¸ä¼šè°ƒåº¦ä¸Šå»ã€‚é€šè¿‡ describe node å¯ä»¥çœ‹ä¸‹ Node æœ‰å“ªäº› Taints: $ kubectl describe nodes host1 ... Taints: special=true:NoSchedule ... æ±¡ç‚¹æ—¢å¯ä»¥æ˜¯æ‰‹åŠ¨æ·»åŠ ä¹Ÿå¯ä»¥æ˜¯è¢«è‡ªåŠ¨æ·»åŠ  æ‰‹åŠ¨æ·»åŠ æ±¡ç‚¹ $ kubectl taint node host1 special=true:NoSchedule node \"host1\" tainted å¦å¤–ï¼Œæœ‰äº›åœºæ™¯ä¸‹å¸Œæœ›æ–°åŠ çš„èŠ‚ç‚¹é»˜è®¤ä¸è°ƒåº¦ Podï¼Œç›´åˆ°è°ƒæ•´å®ŒèŠ‚ç‚¹ä¸ŠæŸäº›é…ç½®æ‰å…è®¸è°ƒåº¦ï¼Œå°±ç»™æ–°åŠ çš„èŠ‚ç‚¹éƒ½åŠ ä¸Š node.kubernetes.io/unschedulable è¿™ä¸ªæ±¡ç‚¹ è‡ªåŠ¨æ·»åŠ æ±¡ç‚¹ å¦‚æœèŠ‚ç‚¹è¿è¡ŒçŠ¶æ€ä¸æ­£å¸¸ï¼Œæ±¡ç‚¹ä¹Ÿå¯ä»¥è¢«è‡ªåŠ¨æ·»åŠ ï¼Œä» v1.12 å¼€å§‹ï¼ŒTaintNodesByCondition ç‰¹æ€§è¿›å…¥ Beta é»˜è®¤å¼€å¯ï¼Œcontroller manager ä¼šæ£€æŸ¥ Node çš„ Conditionï¼Œå¦‚æœå‘½ä¸­æ¡ä»¶å°±è‡ªåŠ¨ä¸º Node åŠ ä¸Šç›¸åº”çš„æ±¡ç‚¹ï¼Œè¿™äº› Condition ä¸ Taints çš„å¯¹åº”å…³ç³»å¦‚ä¸‹: Conditon Value Taints -------- ----- ------ OutOfDisk True node.kubernetes.io/out-of-disk Ready False node.kubernetes.io/not-ready Ready Unknown node.kubernetes.io/unreachable MemoryPressure True node.kubernetes.io/memory-pressure PIDPressure True node.kubernetes.io/pid-pressure DiskPressure True node.kubernetes.io/disk-pressure NetworkUnavailable True node.kubernetes.io/network-unavailable è§£é‡Šä¸‹ä¸Šé¢å„ç§æ¡ä»¶çš„æ„æ€: OutOfDisk ä¸º True è¡¨ç¤ºèŠ‚ç‚¹ç£ç›˜ç©ºé—´ä¸å¤Ÿäº† Ready ä¸º False è¡¨ç¤ºèŠ‚ç‚¹ä¸å¥åº· Ready ä¸º Unknown è¡¨ç¤ºèŠ‚ç‚¹å¤±è”ï¼Œåœ¨ node-monitor-grace-period è¿™ä¹ˆé•¿çš„æ—¶é—´å†…æ²¡æœ‰ä¸ŠæŠ¥çŠ¶æ€ controller-manager å°±ä¼šå°† Node çŠ¶æ€ç½®ä¸º Unknown (é»˜è®¤ 40s) MemoryPressure ä¸º True è¡¨ç¤ºèŠ‚ç‚¹å†…å­˜å‹åŠ›å¤§ï¼Œå®é™…å¯ç”¨å†…å­˜å¾ˆå°‘ PIDPressure ä¸º True è¡¨ç¤ºèŠ‚ç‚¹ä¸Šè¿è¡Œäº†å¤ªå¤šè¿›ç¨‹ï¼ŒPID æ•°é‡ä¸å¤Ÿç”¨äº† DiskPressure ä¸º True è¡¨ç¤ºèŠ‚ç‚¹ä¸Šçš„ç£ç›˜å¯ç”¨ç©ºé—´å¤ªå°‘äº† NetworkUnavailable ä¸º True è¡¨ç¤ºèŠ‚ç‚¹ä¸Šçš„ç½‘ç»œæ²¡æœ‰æ­£ç¡®é…ç½®ï¼Œæ— æ³•è·Ÿå…¶å®ƒ Pod æ­£å¸¸é€šä¿¡ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:4:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"kube-scheduler æ²¡æœ‰æ­£å¸¸è¿è¡Œ æ£€æŸ¥ maser ä¸Šçš„ kube-scheduler æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œå¼‚å¸¸çš„è¯å¯ä»¥å°è¯•é‡å¯ä¸´æ—¶æ¢å¤ã€‚ $ sudo kubectl -n kube-system get pod|grep kube-scheduler kube-scheduler-10.10.192.220 1/1 Running 183 (40d ago) 424d ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:4:4","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº Terminating çŠ¶æ€ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:5:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"ç£ç›˜çˆ†æ»¡ å¦‚æœ docker çš„æ•°æ®ç›®å½•æ‰€åœ¨ç£ç›˜è¢«å†™æ»¡ï¼Œdocker æ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ— æ³•è¿›è¡Œåˆ é™¤å’Œåˆ›å»ºæ“ä½œï¼Œæ‰€ä»¥ kubelet è°ƒç”¨ docker åˆ é™¤å®¹å™¨æ²¡ååº”ï¼Œçœ‹ event ç±»ä¼¼è¿™æ ·ï¼š Normal Killing 39s (x735 over 15h) kubelet, 10.179.80.31 Killing container with id docker://apigateway:Need to kill Pod ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:5:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"å­˜åœ¨ â€œiâ€ æ–‡ä»¶å±æ€§ å¦‚æœå®¹å™¨çš„é•œåƒæœ¬èº«æˆ–è€…å®¹å™¨å¯åŠ¨åå†™å…¥çš„æ–‡ä»¶å­˜åœ¨ â€œiâ€ æ–‡ä»¶å±æ€§ï¼Œæ­¤æ–‡ä»¶å°±æ— æ³•è¢«ä¿®æ”¹åˆ é™¤ï¼Œè€Œåˆ é™¤ Pod æ—¶ä¼šæ¸…ç†å®¹å™¨ç›®å½•ï¼Œä½†é‡Œé¢åŒ…å«æœ‰ä¸å¯åˆ é™¤çš„æ–‡ä»¶ï¼Œå°±ä¸€ç›´åˆ ä¸äº†ï¼ŒPod çŠ¶æ€ä¹Ÿå°†ä¸€ç›´ä¿æŒ Terminatingï¼Œkubelet æŠ¥é”™: Sep 27 14:37:21 VM_0_7_centos kubelet[14109]: E0927 14:37:21.922965 14109 remote_runtime.go:250] RemoveContainer \"19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257\" from runtime service failed: rpc error: code = Unknown desc = failed to remove container \"19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257\": Error response from daemon: container 19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257: driver \"overlay2\" failed to remove root filesystem: remove /data/docker/overlay2/b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868/diff/usr/bin/bash: operation not permitted Sep 27 14:37:21 VM_0_7_centos kubelet[14109]: E0927 14:37:21.923027 14109 kuberuntime_gc.go:126] Failed to remove container \"19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257\": rpc error: code = Unknown desc = failed to remove container \"19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257\": Error response from daemon: container 19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257: driver \"overlay2\" failed to remove root filesystem: remove /data/docker/overlay2/b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868/diff/usr/bin/bash: operation not permitted é€šè¿‡ man chattr æŸ¥çœ‹ â€œiâ€ æ–‡ä»¶å±æ€§æè¿°: A file with the 'i' attribute cannot be modified: it cannot be deleted or renamed, no link can be created to this file and no data can be written to the file. Only the superuser or a process possessing the CAP_LINUX_IMMUTABLE capability can set or clear this attribute. å½»åº•è§£å†³å½“ç„¶æ˜¯ä¸è¦åœ¨å®¹å™¨é•œåƒä¸­æˆ–å¯åŠ¨åçš„å®¹å™¨è®¾ç½® â€œiâ€ æ–‡ä»¶å±æ€§ï¼Œä¸´æ—¶æ¢å¤æ–¹æ³•ï¼š å¤åˆ¶ kubelet æ—¥å¿—æŠ¥é”™æç¤ºçš„æ–‡ä»¶è·¯å¾„ï¼Œç„¶åæ‰§è¡Œ chattr -i : chattr -i /data/docker/overlay2/b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868/diff/usr/bin/bash æ‰§è¡Œå®Œåç­‰å¾… kubelet è‡ªåŠ¨é‡è¯•ï¼ŒPod å°±å¯ä»¥è¢«è‡ªåŠ¨åˆ é™¤äº†ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:5:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"docker 17 çš„ bug docker hang ä½ï¼Œæ²¡æœ‰ä»»ä½•å“åº”ï¼Œçœ‹ event: Warning FailedSync 3m (x408 over 1h) kubelet, 10.179.80.31 error determining status: rpc error: code = DeadlineExceeded desc = context deadline exceeded æ€€ç–‘æ˜¯17ç‰ˆæœ¬dockerdçš„BUGã€‚å¯é€šè¿‡ kubectl -n cn-staging delete pod apigateway-6dc48bf8b6-clcwk â€“force â€“grace-period=0 å¼ºåˆ¶åˆ é™¤podï¼Œä½† docker ps ä»çœ‹å¾—åˆ°è¿™ä¸ªå®¹å™¨ å¤„ç½®å»ºè®®ï¼š å‡çº§åˆ°docker 18. è¯¥ç‰ˆæœ¬ä½¿ç”¨äº†æ–°çš„ containerdï¼Œé’ˆå¯¹å¾ˆå¤šbugè¿›è¡Œäº†ä¿®å¤ã€‚ å¦‚æœå‡ºç°terminatingçŠ¶æ€çš„è¯ï¼Œå¯ä»¥æä¾›è®©å®¹å™¨ä¸“å®¶è¿›è¡Œæ’æŸ¥ï¼Œä¸å»ºè®®ç›´æ¥å¼ºè¡Œåˆ é™¤ï¼Œä¼šå¯èƒ½å¯¼è‡´ä¸€äº›ä¸šåŠ¡ä¸Šé—®é¢˜ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:5:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"å­˜åœ¨ Finalizers k8s èµ„æºçš„ metadata é‡Œå¦‚æœå­˜åœ¨ finalizersï¼Œé‚£ä¹ˆè¯¥èµ„æºä¸€èˆ¬æ˜¯ç”±æŸç¨‹åºåˆ›å»ºçš„ï¼Œå¹¶ä¸”åœ¨å…¶åˆ›å»ºçš„èµ„æºçš„ metadata é‡Œçš„ finalizers åŠ äº†ä¸€ä¸ªå®ƒçš„æ ‡è¯†ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªèµ„æºè¢«åˆ é™¤æ—¶éœ€è¦ç”±åˆ›å»ºèµ„æºçš„ç¨‹åºæ¥åšåˆ é™¤å‰çš„æ¸…ç†ï¼Œæ¸…ç†å®Œäº†å®ƒéœ€è¦å°†æ ‡è¯†ä»è¯¥èµ„æºçš„ finalizers ä¸­ç§»é™¤ï¼Œç„¶åæ‰ä¼šæœ€ç»ˆå½»åº•åˆ é™¤èµ„æºã€‚æ¯”å¦‚ Rancher åˆ›å»ºçš„ä¸€äº›èµ„æºå°±ä¼šå†™å…¥ finalizers æ ‡è¯†ã€‚ å¤„ç†å»ºè®®ï¼škubectl edit æ‰‹åŠ¨ç¼–è¾‘èµ„æºå®šä¹‰ï¼Œåˆ æ‰ finalizersï¼Œè¿™æ—¶å†çœ‹ä¸‹èµ„æºï¼Œå°±ä¼šå‘ç°å·²ç»åˆ æ‰äº†ã€‚é€šè¿‡prometheus-operator åˆ›å»ºprometheusæ—¶ï¼Œæœ€åæ— æ³•åˆ é™¤namespace ä¹Ÿæ˜¯æ­¤åŸå› ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:5:4","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod ä¸€ç›´å¤„äº Unknown çŠ¶æ€ é€šå¸¸æ˜¯èŠ‚ç‚¹å¤±è”ï¼Œæ²¡æœ‰ä¸ŠæŠ¥çŠ¶æ€ç»™ apiserverï¼Œåˆ°è¾¾é˜€å€¼å controller-manager è®¤ä¸ºèŠ‚ç‚¹å¤±è”å¹¶å°†å…¶çŠ¶æ€ç½®ä¸º Unknownã€‚ å¯èƒ½åŸå› : èŠ‚ç‚¹é«˜è´Ÿè½½å¯¼è‡´æ— æ³•ä¸ŠæŠ¥ èŠ‚ç‚¹å®•æœº èŠ‚ç‚¹è¢«å…³æœº ç½‘ç»œä¸é€š ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:6:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod å¥åº·æ£€æŸ¥å¤±è´¥ Kubernetes å¥åº·æ£€æŸ¥åŒ…å«å°±ç»ªæ£€æŸ¥(readinessProbe)å’Œå­˜æ´»æ£€æŸ¥(livenessProbe) pod å¦‚æœå°±ç»ªæ£€æŸ¥å¤±è´¥ä¼šå°†æ­¤ pod ip ä» service ä¸­æ‘˜é™¤ï¼Œé€šè¿‡ service è®¿é—®ï¼Œæµé‡å°†ä¸ä¼šè¢«è½¬å‘ç»™å°±ç»ªæ£€æŸ¥å¤±è´¥çš„ pod pod å¦‚æœå­˜æ´»æ£€æŸ¥å¤±è´¥ï¼Œkubelet å°†ä¼šæ€æ­»å®¹å™¨å¹¶å°è¯•é‡å¯ å¥åº·æ£€æŸ¥å¤±è´¥çš„å¯èƒ½åŸå› æœ‰å¤šç§ï¼Œé™¤äº†ä¸šåŠ¡ç¨‹åºBUGå¯¼è‡´ä¸èƒ½å“åº”å¥åº·æ£€æŸ¥å¯¼è‡´ unhealthyï¼Œè¿˜èƒ½æœ‰æœ‰å…¶å®ƒåŸå› ï¼Œä¸‹é¢æˆ‘ä»¬æ¥é€ä¸ªæ’æŸ¥ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:7:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"å¥åº·æ£€æŸ¥é…ç½®ä¸åˆç† initialDelaySeconds å¤ªçŸ­ï¼Œå®¹å™¨å¯åŠ¨æ…¢ï¼Œå¯¼è‡´å®¹å™¨è¿˜æ²¡å®Œå…¨å¯åŠ¨å°±å¼€å§‹æ¢æµ‹ï¼Œå¦‚æœ successThreshold æ˜¯é»˜è®¤å€¼ 1ï¼Œæ£€æŸ¥å¤±è´¥ä¸€æ¬¡å°±ä¼šè¢« killï¼Œç„¶å pod ä¸€ç›´è¿™æ ·è¢« kill é‡å¯ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:7:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹è´Ÿè½½é«˜ cpu å ç”¨é«˜ï¼ˆæ¯”å¦‚è·‘æ»¡ï¼‰ä¼šå¯¼è‡´è¿›ç¨‹æ— æ³•æ­£å¸¸å‘åŒ…æ”¶åŒ…ï¼Œé€šå¸¸ä¼š timeoutï¼Œå¯¼è‡´ kubelet è®¤ä¸º pod ä¸å¥åº·ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:7:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"å®¹å™¨å†…è¿›ç¨‹ç«¯å£ç›‘å¬æŒ‚æ‰ ä½¿ç”¨ netstat -tunlp æ£€æŸ¥ç«¯å£ç›‘å¬æ˜¯å¦è¿˜åœ¨ï¼Œå¦‚æœä¸åœ¨äº†ï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°ä¼šç›´æ¥ reset æ‰å¥åº·æ£€æŸ¥æ¢æµ‹çš„è¿æ¥: 20:15:17.890996 IP 172.16.2.1.38074 \u003e 172.16.2.23.8888: Flags [S], seq 96880261, win 14600, options [mss 1424,nop,nop,sackOK,nop,wscale 7], length 0 20:15:17.891021 IP 172.16.2.23.8888 \u003e 172.16.2.1.38074: Flags [R.], seq 0, ack 96880262, win 0, length 0 20:15:17.906744 IP 10.0.0.16.54132 \u003e 172.16.2.23.8888: Flags [S], seq 1207014342, win 14600, options [mss 1424,nop,nop,sackOK,nop,wscale 7], length 0 20:15:17.906766 IP 172.16.2.23.8888 \u003e 10.0.0.16.54132: Flags [R.], seq 0, ack 1207014343, win 0, length 0 è¿æ¥å¼‚å¸¸ï¼Œä»è€Œå¥åº·æ£€æŸ¥å¤±è´¥ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› å¯èƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨äº†å¤šä¸ªä½¿ç”¨ hostNetwork ç›‘å¬ç›¸åŒå®¿ä¸»æœºç«¯å£çš„ Podï¼Œåªä¼šæœ‰ä¸€ä¸ª Pod ç›‘å¬æˆåŠŸï¼Œä½†ç›‘å¬å¤±è´¥çš„ Pod çš„ä¸šåŠ¡é€»è¾‘å…è®¸äº†ç›‘å¬å¤±è´¥ï¼Œå¹¶æ²¡æœ‰é€€å‡ºï¼ŒPod åˆé…äº†å¥åº·æ£€æŸ¥ï¼Œkubelet å°±ä¼šç»™ Pod å‘é€å¥åº·æ£€æŸ¥æ¢æµ‹æŠ¥æ–‡ï¼Œä½† Pod ç”±äºæ²¡æœ‰ç›‘å¬æ‰€ä»¥å°±ä¼šå¥åº·æ£€æŸ¥å¤±è´¥ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:7:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Pod å¤„äº CrashLoopBackOff çŠ¶æ€ Pod å¦‚æœå¤„äº CrashLoopBackOff çŠ¶æ€è¯´æ˜ä¹‹å‰æ˜¯å¯åŠ¨äº†ï¼Œåªæ˜¯åˆå¼‚å¸¸é€€å‡ºäº†ï¼Œåº”ç”¨å®ä¾‹çŠ¶æ€ä¸ºCrashLoopBackOffï¼Œ è¡¨ç°ä¸ºå®ä¾‹ä¸æ–­é‡å¯ï¼Œç”±readyçŠ¶æ€å˜ä¸ºCompleteå†å˜æˆCrashLoopBackOffã€‚ ä¸€èˆ¬ç”±äºåº”ç”¨å®ä¾‹å®¹å™¨å¼‚å¸¸é€€å‡ºå¯¼è‡´çš„å®ä¾‹å¼‚å¸¸ï¼Œéœ€è¦æ’æŸ¥åº”ç”¨æ—¥å¿—ç¡®å®šå¼‚å¸¸é€€å‡ºåŸå› ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:8:0","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"å®¹å™¨è¿›ç¨‹ä¸»åŠ¨é€€å‡º å¦‚æœæ˜¯å®¹å™¨è¿›ç¨‹ä¸»åŠ¨é€€å‡ºï¼Œé€€å‡ºçŠ¶æ€ç ä¸€èˆ¬åœ¨ 0-128 ä¹‹é—´ï¼Œé™¤äº†å¯èƒ½æ˜¯ä¸šåŠ¡ç¨‹åº BUGï¼Œè¿˜æœ‰å…¶å®ƒè®¸å¤šå¯èƒ½åŸå›  ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:8:1","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"ç³»ç»ŸOOM å¦‚æœå‘ç”Ÿç³»ç»Ÿ OOMï¼Œå¯ä»¥çœ‹åˆ° Pod ä¸­å®¹å™¨é€€å‡ºçŠ¶æ€ç æ˜¯ 137ï¼Œè¡¨ç¤ºè¢« SIGKILL ä¿¡å·æ€æ­»ï¼ŒåŒæ—¶å†…æ ¸ä¼šæŠ¥é”™: Out of memory: Kill process â€¦ã€‚å¤§æ¦‚ç‡æ˜¯èŠ‚ç‚¹ä¸Šéƒ¨ç½²äº†å…¶å®ƒé K8S ç®¡ç†çš„è¿›ç¨‹æ¶ˆè€—äº†æ¯”è¾ƒå¤šçš„å†…å­˜ï¼Œæˆ–è€… kubelet çš„ â€“kube-reserved å’Œ â€“system-reserved é…çš„æ¯”è¾ƒå°ï¼Œæ²¡æœ‰é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ç»™å…¶å®ƒéå®¹å™¨è¿›ç¨‹ï¼ŒèŠ‚ç‚¹ä¸Šæ‰€æœ‰ Pod çš„å®é™…å†…å­˜å ç”¨æ€»é‡ä¸ä¼šè¶…è¿‡ /sys/fs/cgroup/memory/kubepods è¿™é‡Œ cgroup çš„é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ç­‰äº capacity - â€œkube-reservedâ€ - â€œsystem-reservedâ€ï¼Œå¦‚æœé¢„ç•™ç©ºé—´è®¾ç½®åˆç†ï¼ŒèŠ‚ç‚¹ä¸Šå…¶å®ƒéå®¹å™¨è¿›ç¨‹ï¼ˆkubelet, dockerd, kube-proxy, sshd ç­‰) å†…å­˜å ç”¨æ²¡æœ‰è¶…è¿‡ kubelet é…ç½®çš„é¢„ç•™ç©ºé—´æ˜¯ä¸ä¼šå‘ç”Ÿç³»ç»Ÿ OOM çš„ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åšåˆç†çš„è°ƒæ•´ã€‚ ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:8:2","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"cgroup OOM å¦‚æœæ˜¯ cgroup OOM æ€æ‰çš„è¿›ç¨‹ï¼Œä» Pod äº‹ä»¶çš„ä¸‹ Reason å¯ä»¥çœ‹åˆ°æ˜¯ OOMKilledï¼Œè¯´æ˜å®¹å™¨å®é™…å ç”¨çš„å†…å­˜è¶…è¿‡ limit äº†ï¼ŒåŒæ—¶å†…æ ¸æ—¥å¿—ä¼šæŠ¥: ``ã€‚ å¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´ä¸‹ limit ","date":"2021-07-28","objectID":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/:8:3","tags":["Kubernetesæ’éšœ"],"title":"Kubernetes Pod æ’éšœæŒ‡å—","uri":"/kubernetes-pod%E6%8E%92%E9%9A%9C%E6%8C%87%E5%8D%97/"},{"categories":["Kubernetes"],"content":"Podè°ƒåº¦ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ¨ç½²çš„ Pod æ˜¯é€šè¿‡é›†ç¾¤çš„è‡ªåŠ¨è°ƒåº¦ç­–ç•¥æ¥é€‰æ‹©èŠ‚ç‚¹çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹è°ƒåº¦å™¨è€ƒè™‘çš„æ˜¯èµ„æºè¶³å¤Ÿï¼Œå¹¶ä¸”è´Ÿè½½å°½é‡å¹³å‡ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ›´åŠ ç»†ç²’åº¦çš„å»æ§åˆ¶ Pod çš„è°ƒåº¦ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›ä¸€äº›æœºå™¨å­¦ä¹ çš„åº”ç”¨åªè·‘åœ¨æœ‰ GPU çš„èŠ‚ç‚¹ä¸Šï¼›ä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬çš„æœåŠ¡ä¹‹é—´äº¤æµæ¯”è¾ƒé¢‘ç¹ï¼Œåˆå¸Œæœ›èƒ½å¤Ÿå°†è¿™æœåŠ¡çš„ Pod éƒ½è°ƒåº¦åˆ°åŒä¸€ä¸ªçš„èŠ‚ç‚¹ä¸Šã€‚è¿™å°±éœ€è¦ä½¿ç”¨ä¸€äº›è°ƒåº¦æ–¹å¼æ¥æ§åˆ¶ Pod çš„è°ƒåº¦äº†ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼šäº²å’Œæ€§å’Œåäº²å’Œæ€§ï¼Œäº²å’Œæ€§åˆåˆ†æˆèŠ‚ç‚¹äº²å’Œæ€§(nodeAffinity)å’Œ Pod äº²å’Œæ€§(podAffinity)ã€‚ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:0:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"nodeSelector åœ¨äº†è§£äº²å’Œæ€§ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„è°ƒåº¦æ–¹å¼ï¼šnodeSelectorã€‚æˆ‘ä»¬çŸ¥é“ label æ ‡ç­¾æ˜¯ kubernetes ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥éå¸¸çµæ´»çš„åˆ©ç”¨ label æ¥ç®¡ç†é›†ç¾¤ä¸­çš„èµ„æºï¼Œæ¯”å¦‚æœ€å¸¸è§çš„ Service å¯¹è±¡é€šè¿‡ label å»åŒ¹é… Pod èµ„æºï¼Œè€Œ Pod çš„è°ƒåº¦ä¹Ÿå¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„ label æ¥è¿›è¡Œè°ƒåº¦ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æˆ‘ä»¬çš„ node çš„ labelï¼š $ kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS master1 Ready control-plane,master 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master1,kubernetes.io/os=linux,node-role.kubernetes.io/control-plane=,node-role.kubernetes.io/master=,node.kubernetes.io/exclude-from-external-load-balancers= node1 Ready \u003cnone\u003e 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux node2 Ready \u003cnone\u003e 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node2,kubernetes.io/os=linux ç°åœ¨æˆ‘ä»¬å…ˆç»™èŠ‚ç‚¹ node2 å¢åŠ ä¸€ä¸ªcom=schedulernodeçš„æ ‡ç­¾ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š $ kubectl label nodes node2 com=schedulernode node/node2 labeled æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šé¢çš„ â€“show-labels å‚æ•°å¯ä»¥æŸ¥çœ‹ä¸Šè¿°æ ‡ç­¾æ˜¯å¦ç”Ÿæ•ˆã€‚å½“èŠ‚ç‚¹è¢«æ‰“ä¸Šäº†ç›¸å…³æ ‡ç­¾åï¼Œåœ¨è°ƒåº¦çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ ‡ç­¾äº†ï¼Œåªéœ€è¦åœ¨ Pod çš„ spec å­—æ®µä¸­æ·»åŠ  nodeSelector å­—æ®µï¼Œé‡Œé¢æ˜¯æˆ‘ä»¬éœ€è¦è¢«è°ƒåº¦çš„èŠ‚ç‚¹çš„ label æ ‡ç­¾ï¼Œæ¯”å¦‚ï¼Œä¸‹é¢çš„ Pod æˆ‘ä»¬è¦å¼ºåˆ¶è°ƒåº¦åˆ° node2 è¿™ä¸ªèŠ‚ç‚¹ä¸Šå»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ nodeSelector æ¥è¡¨ç¤ºäº†ï¼š # node-selector-demo.yaml apiVersion: v1 kind: Pod metadata: labels: app: busybox-pod name: test-busybox spec: containers: - command: - sleep - \"3600\" image: busybox imagePullPolicy: Always name: test-busybox nodeSelector: com: schedulernode ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ describe å‘½ä»¤æŸ¥çœ‹è°ƒåº¦ç»“æœï¼š $ kubectl apply -f pod-selector-demo.yaml pod/test-busybox created $ kubectl describe pod test-busybox Name: test-busybox Namespace: default Priority: 0 Node: node2/192.168.31.46 ...... Node-Selectors: com=schedulernode Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled \u003cunknown\u003e default-scheduler Successfully assigned default/test-busybox to node2 Normal Pulling 13s kubelet, node2 Pulling image \"busybox\" Normal Pulled 10s kubelet, node2 Successfully pulled image \"busybox\" Normal Created 10s kubelet, node2 Created container test-busybox Normal Started 9s kubelet, node2 Started container test-busybox æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Events ä¸‹é¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çš„ Pod é€šè¿‡é»˜è®¤çš„ default-scheduler è°ƒåº¦å™¨è¢«ç»‘å®šåˆ°äº† node2 èŠ‚ç‚¹ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯nodeSelector å±äºå¼ºåˆ¶æ€§çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®æ ‡èŠ‚ç‚¹æ²¡æœ‰å¯ç”¨çš„èµ„æºï¼Œæˆ‘ä»¬çš„ Pod å°±ä¼šä¸€ç›´å¤„äº Pending çŠ¶æ€ã€‚ é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ° nodeSelector çš„æ–¹å¼æ¯”è¾ƒç›´è§‚ï¼Œä½†æ˜¯è¿˜å¤Ÿçµæ´»ï¼Œæ§åˆ¶ç²’åº¦åå¤§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†å’Œå¤§å®¶äº†è§£ä¸‹æ›´åŠ çµæ´»çš„æ–¹å¼ï¼šèŠ‚ç‚¹äº²å’Œæ€§(nodeAffinity)ã€‚ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:1:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"äº²å’Œæ€§å’Œåäº²å’Œæ€§è°ƒåº¦ å‰é¢æˆ‘ä»¬äº†è§£äº† kubernetes è°ƒåº¦å™¨çš„è°ƒåº¦æµç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“é»˜è®¤çš„è°ƒåº¦å™¨åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œç»è¿‡äº† predicates å’Œ priorities ä¸¤ä¸ªé˜¶æ®µï¼Œä½†æ˜¯åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾€å¾€æˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸€äº›å®é™…éœ€æ±‚æ¥æ§åˆ¶ Pod çš„è°ƒåº¦ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° nodeAffinity(èŠ‚ç‚¹äº²å’Œæ€§)ã€podAffinity(pod äº²å’Œæ€§) ä»¥åŠ podAntiAffinity(pod åäº²å’Œæ€§)ã€‚ äº²å’Œæ€§è°ƒåº¦å¯ä»¥åˆ†æˆè½¯ç­–ç•¥å’Œç¡¬ç­–ç•¥ä¸¤ç§æ–¹å¼: è½¯ç­–ç•¥å°±æ˜¯å¦‚æœç°åœ¨æ²¡æœ‰æ»¡è¶³è°ƒåº¦è¦æ±‚çš„èŠ‚ç‚¹çš„è¯ï¼ŒPod å°±ä¼šå¿½ç•¥è¿™æ¡è§„åˆ™ï¼Œç»§ç»­å®Œæˆè°ƒåº¦è¿‡ç¨‹ï¼Œè¯´ç™½äº†å°±æ˜¯æ»¡è¶³æ¡ä»¶æœ€å¥½äº†ï¼Œæ²¡æœ‰çš„è¯ä¹Ÿæ— æ‰€è°“ ç¡¬ç­–ç•¥å°±æ¯”è¾ƒå¼ºç¡¬äº†ï¼Œå¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹çš„è¯ï¼Œå°±ä¸æ–­é‡è¯•ç›´åˆ°æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ï¼Œç®€å•è¯´å°±æ˜¯ä½ å¿…é¡»æ»¡è¶³æˆ‘çš„è¦æ±‚ï¼Œä¸ç„¶å°±ä¸å¹²äº† å¯¹äºäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ½æœ‰è¿™ä¸¤ç§è§„åˆ™å¯ä»¥è®¾ç½®ï¼š preferredDuringSchedulingIgnoredDuringExecution å’ŒrequiredDuringSchedulingIgnoredDuringExecutionï¼Œå‰é¢çš„å°±æ˜¯è½¯ç­–ç•¥ï¼Œåé¢çš„å°±æ˜¯ç¡¬ç­–ç•¥ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:2:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"èŠ‚ç‚¹äº²å’Œæ€§ èŠ‚ç‚¹äº²å’Œæ€§ï¼ˆnodeAffinityï¼‰ä¸»è¦æ˜¯ç”¨æ¥æ§åˆ¶ Pod è¦éƒ¨ç½²åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šï¼Œä»¥åŠä¸èƒ½éƒ¨ç½²åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šçš„ï¼Œå®ƒå¯ä»¥è¿›è¡Œä¸€äº›ç®€å•çš„é€»è¾‘ç»„åˆäº†ï¼Œä¸åªæ˜¯ç®€å•çš„ç›¸ç­‰åŒ¹é…ã€‚ æ¯”å¦‚ç°åœ¨æˆ‘ä»¬ç”¨ä¸€ä¸ª Deployment æ¥ç®¡ç†8ä¸ª Pod å‰¯æœ¬ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ§åˆ¶ä¸‹è¿™äº› Pod çš„è°ƒåº¦ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š # node-affinity-demo.yaml apiVersion: apps/v1 kind: Deployment metadata: name: node-affinity labels: app: node-affinity spec: replicas: 8 selector: matchLabels: app: node-affinity template: metadata: labels: app: node-affinity spec: containers: - name: nginx image: nginx:1.7.9 ports: - containerPort: 80 name: nginxweb affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬ç­–ç•¥ nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: NotIn values: - master1 preferredDuringSchedulingIgnoredDuringExecution: # è½¯ç­–ç•¥ - weight: 1 preference: matchExpressions: - key: com operator: In values: - schedulernode ä¸Šé¢è¿™ä¸ª Pod é¦–å…ˆæ˜¯è¦æ±‚ä¸èƒ½è¿è¡Œåœ¨ master1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœæœ‰ä¸ªèŠ‚ç‚¹æ»¡è¶³ com=schedulernode çš„è¯å°±ä¼˜å…ˆè°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šã€‚ ç”±äºä¸Šé¢ node02 èŠ‚ç‚¹æˆ‘ä»¬æ‰“ä¸Šäº† com=schedulernode è¿™æ ·çš„ label æ ‡ç­¾ï¼Œæ‰€ä»¥æŒ‰è¦æ±‚ä¼šä¼˜å…ˆè°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹æ¥çš„ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºè¿™ä¸ª Podï¼Œç„¶åæŸ¥çœ‹å…·ä½“çš„è°ƒåº¦æƒ…å†µæ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ $ kubectl apply -f node-affinty-demo.yaml deployment.apps/node-affinity created $ kubectl get pods -l app=node-affinity -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES node-affinity-cdd9d54d9-bgbbh 1/1 Running 0 2m28s 10.244.2.247 node2 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-dlbck 1/1 Running 0 2m28s 10.244.4.16 node1 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-g2jr6 1/1 Running 0 2m28s 10.244.4.17 node1 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-gzr58 1/1 Running 0 2m28s 10.244.1.118 node1 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-hcv7r 1/1 Running 0 2m28s 10.244.2.246 node2 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-kvxw4 1/1 Running 0 2m28s 10.244.2.245 node2 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-p4mmk 1/1 Running 0 2m28s 10.244.2.244 node2 \u003cnone\u003e \u003cnone\u003e node-affinity-cdd9d54d9-t5mff 1/1 Running 0 2m28s 10.244.1.117 node2 \u003cnone\u003e \u003cnone\u003e ä»ç»“æœå¯ä»¥çœ‹å‡ºæœ‰5ä¸ª Pod è¢«éƒ¨ç½²åˆ°äº† node2 èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰ä¸€ä¸ª Pod è¢«éƒ¨ç½²åˆ° master1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¡¬ç­–ç•¥å°±æ˜¯ä¸å…è®¸éƒ¨ç½²åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œè€Œ node2 æ˜¯è½¯ç­–ç•¥ï¼Œæ‰€ä»¥ä¼šå°½é‡æ»¡è¶³ã€‚è¿™é‡Œçš„åŒ¹é…é€»è¾‘æ˜¯ label æ ‡ç­¾çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­ï¼Œç°åœ¨ Kubernetes æä¾›çš„æ“ä½œç¬¦æœ‰ä¸‹é¢çš„å‡ ç§ï¼š Inï¼šlabel çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­ NotInï¼šlabel çš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­ Gtï¼šlabel çš„å€¼å¤§äºæŸä¸ªå€¼ Ltï¼šlabel çš„å€¼å°äºæŸä¸ªå€¼ Existsï¼šæŸä¸ª label å­˜åœ¨ DoesNotExistï¼šæŸä¸ª label ä¸å­˜åœ¨ ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ nodeSelectorTerms ä¸‹é¢æœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œæ»¡è¶³ä»»ä½•ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥äº†ï¼›å¦‚æœ matchExpressionsæœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œåˆ™å¿…é¡»åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶æ‰èƒ½æ­£å¸¸è°ƒåº¦ Podã€‚ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:3:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"Podäº²å’Œæ€§ Pod äº²å’Œæ€§ï¼ˆpodAffinityï¼‰ä¸»è¦è§£å†³ Pod å¯ä»¥å’Œå“ªäº› Pod éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ï¼ˆå…¶ä¸­æ‹“æ‰‘åŸŸç”¨ä¸»æœºæ ‡ç­¾å®ç°ï¼Œå¯ä»¥æ˜¯å•ä¸ªä¸»æœºï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªä¸»æœºç»„æˆçš„ clusterã€zone ç­‰ç­‰ï¼‰ï¼Œè€Œ Pod åäº²å’Œæ€§ä¸»è¦æ˜¯è§£å†³ Pod ä¸èƒ½å’Œå“ªäº› Pod éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ï¼Œå®ƒä»¬éƒ½æ˜¯å¤„ç†çš„ Pod ä¸ Pod ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚ä¸€ä¸ª Pod åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šäº†ï¼Œé‚£ä¹ˆæˆ‘è¿™ä¸ªä¹Ÿå¾—åœ¨è¿™ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…ä½ è¿™ä¸ª Pod åœ¨èŠ‚ç‚¹ä¸Šäº†ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸æƒ³å’Œä½ å¾…åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ ç”±äºæˆ‘ä»¬è¿™é‡Œåªæœ‰ä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶æ²¡æœ‰åŒºåŸŸæˆ–è€…æœºæˆ¿çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨ä¸»æœºåæ¥ä½œä¸ºæ‹“æ‰‘åŸŸï¼ŒæŠŠ Pod åˆ›å»ºåœ¨åŒä¸€ä¸ªä¸»æœºä¸Šé¢ã€‚ $ kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS master1 Ready control-plane,master 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master1,kubernetes.io/os=linux,node-role.kubernetes.io/control-plane=,node-role.kubernetes.io/master=,node.kubernetes.io/exclude-from-external-load-balancers= node1 Ready \u003cnone\u003e 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux node2 Ready \u003cnone\u003e 82d v1.22.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node2,kubernetes.io/os=linux,com=schedulernode åŒæ ·ï¼Œè¿˜æ˜¯é’ˆå¯¹ä¸Šé¢çš„èµ„æºå¯¹è±¡ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ Pod çš„äº²å’Œæ€§ï¼š # pod-affinity-demo.yaml apiVersion: apps/v1 kind: Deployment metadata: name: pod-affinity labels: app: pod-affinity spec: replicas: 3 selector: matchLabels: app: pod-affinity template: metadata: labels: app: pod-affinity spec: containers: - name: nginx image: nginx ports: - containerPort: 80 name: nginxweb affinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬ç­–ç•¥ - labelSelector: matchExpressions: - key: app operator: In values: - busybox-pod topologyKey: kubernetes.io/hostname ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­çš„ Pod éœ€è¦è°ƒåº¦åˆ°æŸä¸ªæŒ‡å®šçš„èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œäº†ä¸€ä¸ªå¸¦æœ‰ app=busybox-pod æ ‡ç­¾çš„ Podã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æœ‰æ ‡ç­¾ app=busybox-pod çš„ pod åˆ—è¡¨ï¼š $ kubectl get pods -l app=busybox-pod -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES test-busybox 1/1 Running 0 27m 10.244.2.242 node2 \u003cnone\u003e \u003cnone\u003e æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ª Pod è¿è¡Œåœ¨äº† node2 çš„èŠ‚ç‚¹ä¸Šé¢ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸Šé¢çš„äº²å’Œæ€§æ¥è¯´ï¼Œä¸Šé¢æˆ‘ä»¬éƒ¨ç½²çš„3ä¸ª Pod å‰¯æœ¬ä¹Ÿåº”è¯¥è¿è¡Œåœ¨ node2 èŠ‚ç‚¹ä¸Šï¼š $ kubectl apply -f pod-affinity-demo.yaml deployment.apps/pod-affinity created $ kubectl get pods -o wide -l app=pod-affinity NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod-affinity-587f9b5b58-5nxmf 1/1 Running 0 26s 10.244.2.249 node2 \u003cnone\u003e \u003cnone\u003e pod-affinity-587f9b5b58-m2j7s 1/1 Running 0 26s 10.244.2.248 node2 \u003cnone\u003e \u003cnone\u003e pod-affinity-587f9b5b58-vrd7b 1/1 Running 0 26s 10.244.2.250 node2 \u003cnone\u003e \u003cnone\u003e å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢çš„ test-busybox å’Œ pod-affinity è¿™ä¸ª Deployment éƒ½åˆ é™¤ï¼Œç„¶åé‡æ–°åˆ›å»º pod-affinity è¿™ä¸ªèµ„æºï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è°ƒåº¦å‘¢ï¼š $ kubectl delete -f node-selector-demo.yaml pod \"test-busybox\" deleted $ kubectl delete -f pod-affinity-demo.yaml deployment.apps \"pod-affinity\" deleted $ kubectl apply -f pod-affinity-demo.yaml deployment.apps/pod-affinity created $ kubectl get pods -o wide -l app=pod-affinity NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod-affinity-587f9b5b58-bbfgr 0/1 Pending 0 18s \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e pod-affinity-587f9b5b58-lwc8n 0/1 Pending 0 18s \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e pod-affinity-587f9b5b58-pc7ql 0/1 Pending 0 18s \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e æˆ‘ä»¬å¯ä»¥çœ‹åˆ°éƒ½å¤„äº Pending çŠ¶æ€äº†ï¼Œè¿™æ˜¯å› ä¸ºç°åœ¨æ²¡æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢æ‹¥æœ‰ app=busybox-pod è¿™ä¸ªæ ‡ç­¾çš„ Podï¼Œè€Œä¸Šé¢æˆ‘ä»¬çš„è°ƒåº¦ä½¿ç”¨çš„æ˜¯ç¡¬ç­–ç•¥ï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•è¿›è¡Œè°ƒåº¦äº†ï¼Œå¤§å®¶å¯ä»¥å»å°è¯•ä¸‹é‡æ–°å°† test-busybox è¿™ä¸ª Pod è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œè§‚å¯Ÿä¸‹ä¸Šé¢çš„3ä¸ªå‰¯æœ¬ä¼šä¸ä¼šä¹Ÿè¢«è°ƒåº¦åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šå»ã€‚ æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹ä½¿ç”¨çš„æ˜¯ kubernetes.io/hostname è¿™ä¸ªæ‹“æ‰‘åŸŸï¼Œæ„æ€å°±æ˜¯æˆ‘ä»¬å½“å‰è°ƒåº¦çš„ Pod è¦å’Œç›®æ ‡çš„ Pod å¤„äºåŒä¸€ä¸ªä¸»æœºä¸Šé¢ï¼Œå› ä¸ºè¦å¤„äºåŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸‹é¢ï¼Œä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æŠŠæ‹“æ‰‘åŸŸæ”¹æˆ beta.kubernetes.io/osï¼ŒåŒæ ·çš„æˆ‘ä»¬å½“å‰è°ƒåº¦çš„ Pod è¦å’Œç›®æ ‡çš„ Pod å¤„äºåŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­ï¼Œç›®æ ‡çš„ Pod æ˜¯æ‹¥æœ‰ beta.kubernetes.io/os=linux çš„æ ‡ç­¾ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰è¿™æ ·çš„æ ‡ç­¾ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œçš„ Pod å¯ä»¥è¢«è°ƒåº¦åˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‡æ–°è¿è¡Œä¸Šé¢çš„ app=busybox-pod çš„ Podï¼Œç„¶åå†æ›´æ–°ä¸‹æˆ‘ä»¬è¿™é‡Œçš„èµ„æºå¯¹è±¡ï¼š $ kubectl get pods -o wide -l app=pod-affinity NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod-affinity-76c56567c-792n4 1/1 Running 0 2m59s 10.244.2.254 node2 \u003cnone\u003e \u003cnone\u003e pod-affinity-76c56567c-8s2pd 1/1 Running 0 3m53s 10.244.4.18 node1 \u003cnone\u003e \u003cnone\u003e pod-affinity-76c56567c-hx7ck 1/1 Running 0 2m52s 10.244.3.23 node2 \u003cnone\u003e \u003cnone\u003e å¯ä»¥çœ‹åˆ°ç°åœ¨æ˜¯åˆ†åˆ«è¿è¡Œåœ¨2ä¸ªèŠ‚ç‚¹ä¸‹é¢çš„ï¼Œå› ä¸ºä»–ä»¬éƒ½å±äº beta.kubernetes.io/os è¿™ä¸ªæ‹“æ‰‘åŸŸã€‚ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:4:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"Podåäº²å’Œæ€§ Pod åäº²å’Œæ€§ï¼ˆpodAntiAffinityï¼‰åˆ™æ˜¯åç€æ¥çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œäº†æŸä¸ª Podï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ¨¡æ¿ Pod åˆ™ä¸å¸Œæœ›è¢«è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šé¢å»äº†ã€‚æˆ‘ä»¬æŠŠä¸Šé¢çš„ podAffinity ç›´æ¥æ”¹æˆ podAntiAffinityï¼š # pod-antiaffinity-demo.yaml apiVersion: apps/v1 kind: Deployment metadata: name: pod-antiaffinity labels: app: pod-antiaffinity spec: replicas: 3 selector: matchLabels: app: pod-antiaffinity template: metadata: labels: app: pod-antiaffinity spec: containers: - name: nginx image: nginx ports: - containerPort: 80 name: nginxweb affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬ç­–ç•¥ - labelSelector: matchExpressions: - key: app operator: In values: - busybox-pod topologyKey: kubernetes.io/hostname è¿™é‡Œçš„æ„æ€å°±æ˜¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢æœ‰ä¸€ä¸ª app=busybox-pod è¿™æ ·çš„ Pod çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ Pod å°±åˆ«è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šé¢æ¥ï¼Œä¸Šé¢æˆ‘ä»¬æŠŠapp=busybox-pod è¿™ä¸ª Pod å›ºå®šåˆ°äº† node2 è¿™ä¸ªèŠ‚ç‚¹ä¸Šé¢çš„ï¼Œæ‰€ä»¥æ­£å¸¸æ¥è¯´æˆ‘ä»¬è¿™é‡Œçš„ Pod ä¸ä¼šå‡ºç°åœ¨è¯¥èŠ‚ç‚¹ä¸Šï¼š $ kubectl apply -f pod-antiaffinity-demo.yaml deployment.apps/pod-antiaffinity created $ kubectl get pods -l app=pod-antiaffinity -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod-antiaffinity-84d5bf9df4-9c9qk 1/1 Running 0 73s 10.244.4.19 node1 \u003cnone\u003e \u003cnone\u003e pod-antiaffinity-84d5bf9df4-q6lkm 1/1 Running 0 67s 10.244.3.24 node1 \u003cnone\u003e \u003cnone\u003e pod-antiaffinity-84d5bf9df4-vk9tc 1/1 Running 0 57s 10.244.3.25 node1 \u003cnone\u003e \u003cnone\u003e æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ²¡æœ‰è¢«è°ƒåº¦åˆ° node2 èŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ Pod åäº²å’Œæ€§ã€‚å¤§å®¶å¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè¿™é‡Œæˆ‘ä»¬å°†æ‹“æ‰‘åŸŸæ›´æ”¹æˆ beta.kubernetes.io/os ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¯ä»¥è‡ªå·±å»æµ‹è¯•ä¸‹çœ‹çœ‹ã€‚ ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:5:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["Kubernetes"],"content":"æ±¡ç‚¹å’Œå®¹å¿ å¯¹äº nodeAffinity æ— è®ºæ˜¯ç¡¬ç­–ç•¥è¿˜æ˜¯è½¯ç­–ç•¥æ–¹å¼ï¼Œéƒ½æ˜¯è°ƒåº¦ Pod åˆ°é¢„æœŸèŠ‚ç‚¹ä¸Šï¼Œè€Œæ±¡ç‚¹ï¼ˆTaintsï¼‰æ°å¥½ä¸ä¹‹ç›¸åï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸º Taints ï¼Œé™¤é Pod ä¹Ÿè¢«æ ‡è¯†ä¸ºå¯ä»¥å®¹å¿æ±¡ç‚¹èŠ‚ç‚¹ï¼Œå¦åˆ™è¯¥ Taints èŠ‚ç‚¹ä¸ä¼šè¢«è°ƒåº¦ Podã€‚ æ¯”å¦‚ç”¨æˆ·å¸Œæœ›æŠŠ Master èŠ‚ç‚¹ä¿ç•™ç»™ Kubernetes ç³»ç»Ÿç»„ä»¶ä½¿ç”¨ï¼Œæˆ–è€…æŠŠä¸€ç»„å…·æœ‰ç‰¹æ®Šèµ„æºé¢„ç•™ç»™æŸäº› Podï¼Œåˆ™æ±¡ç‚¹å°±å¾ˆæœ‰ç”¨äº†ï¼ŒPod ä¸ä¼šå†è¢«è°ƒåº¦åˆ° taint æ ‡è®°è¿‡çš„èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨ kubeadm æ­å»ºçš„é›†ç¾¤é»˜è®¤å°±ç»™ master èŠ‚ç‚¹æ·»åŠ äº†ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬å¹³æ—¶çš„ Pod éƒ½æ²¡æœ‰è¢«è°ƒåº¦åˆ° master ä¸Šå»ï¼š $ kubectl describe node master1 Name: master1 Roles: master Labels: beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=master1 kubernetes.io/os=linux node-role.kubernetes.io/master= ...... Taints: node-role.kubernetes.io/master:NoSchedule Unschedulable: false ...... æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æŸ¥çœ‹ master èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰ä¸€æ¡å…³äº Taints çš„ä¿¡æ¯ï¼šnode-role.kubernetes.io/master:NoScheduleï¼Œå°±è¡¨ç¤ºmaster èŠ‚ç‚¹æ‰“äº†ä¸€ä¸ªæ±¡ç‚¹çš„æ ‡è®°ï¼Œå…¶ä¸­å½±å“çš„å‚æ•°æ˜¯ NoScheduleï¼Œè¡¨ç¤º Pod ä¸ä¼šè¢«è°ƒåº¦åˆ°æ ‡è®°ä¸º taints çš„èŠ‚ç‚¹ï¼Œé™¤äº† NoSchedule å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªé€‰é¡¹ï¼š PreferNoScheduleï¼šNoSchedule çš„è½¯ç­–ç•¥ç‰ˆæœ¬ï¼Œè¡¨ç¤ºå°½é‡ä¸è°ƒåº¦åˆ°æ±¡ç‚¹èŠ‚ç‚¹ä¸Šå» NoExecuteï¼šè¯¥é€‰é¡¹æ„å‘³ç€ä¸€æ—¦ Taint ç”Ÿæ•ˆï¼Œå¦‚è¯¥èŠ‚ç‚¹å†…æ­£åœ¨è¿è¡Œçš„ Pod æ²¡æœ‰å¯¹åº”å®¹å¿ï¼ˆTolerateï¼‰è®¾ç½®ï¼Œåˆ™ä¼šç›´æ¥è¢«é€å‡ºæ±¡ç‚¹ ç›¸æ¯”è¾ƒNoExecuteç­–ç•¥ï¼ŒNoScheduleï¼Œåªä¼šå½±å“æ–°çš„ Pod è°ƒåº¦ï¼Œä¸ä¼šå°†æ­£åœ¨è¿è¡Œçš„Podè¿›è¡Œé©±é€ taint æ ‡è®°èŠ‚ç‚¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š $ kubectl taint nodes node2 test=node2:NoSchedule node \"node2\" tainted ä¸Šé¢çš„å‘½åå°† node2 èŠ‚ç‚¹æ ‡è®°ä¸ºäº†æ±¡ç‚¹ï¼Œå½±å“ç­–ç•¥æ˜¯ NoScheduleï¼Œåªä¼šå½±å“æ–°çš„ Pod è°ƒåº¦ï¼Œå¦‚æœä»ç„¶å¸Œæœ›æŸä¸ª Pod è°ƒåº¦åˆ° taint èŠ‚ç‚¹ä¸Šï¼Œåˆ™å¿…é¡»åœ¨ Spec ä¸­åšå‡º Toleration å®šä¹‰ï¼Œæ‰èƒ½è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ª Pod è°ƒåº¦åˆ° master èŠ‚ç‚¹ï¼š # taint-demo.yaml apiVersion: apps/v1 kind: Deployment metadata: name: taint labels: app: taint spec: replicas: 3 selector: matchLabels: app: taint template: metadata: labels: app: taint spec: containers: - name: nginx image: nginx ports: - name: http containerPort: 80 tolerations: - key: \"node-role.kubernetes.io/master\" operator: \"Exists\" effect: \"NoSchedule\" ç”±äº master èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºäº†æ±¡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè¦æƒ³ Pod èƒ½å¤Ÿè°ƒåº¦åˆ°æ”¹èŠ‚ç‚¹å»ï¼Œå°±éœ€è¦å¢åŠ å®¹å¿çš„å£°æ˜ï¼š tolerations: - key: \"node-role.kubernetes.io/master\" operator: \"Exists\" effect: \"NoSchedule\" ç„¶ååˆ›å»ºä¸Šé¢çš„èµ„æºï¼ŒæŸ¥çœ‹ç»“æœï¼š $ kubectl apply -f taint-demo.yaml deployment.apps \"taint\" created $ kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE ...... taint-845d8bb4fb-57mhm 1/1 Running 0 1m 10.244.4.247 node2 taint-845d8bb4fb-bbvmp 1/1 Running 0 1m 10.244.0.33 master1 taint-845d8bb4fb-zb78x 1/1 Running 0 1m 10.244.4.246 node2 ...... æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª Pod å‰¯æœ¬è¢«è°ƒåº¦åˆ°äº† master èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯å®¹å¿çš„ä½¿ç”¨æ–¹æ³•ã€‚ å¯¹äº tolerations å±æ€§çš„å†™æ³•ï¼Œå…¶ä¸­çš„ keyã€valueã€effect ä¸ Node çš„ Taint è®¾ç½®éœ€ä¿æŒä¸€è‡´ï¼Œ è¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š å¦‚æœ operator çš„å€¼æ˜¯ Existsï¼Œåˆ™ value å±æ€§å¯çœç•¥ å¦‚æœ operator çš„å€¼æ˜¯ Equalï¼Œåˆ™è¡¨ç¤ºå…¶ key ä¸ value ä¹‹é—´çš„å…³ç³»æ˜¯ equal(ç­‰äº) å¦‚æœä¸æŒ‡å®š operator å±æ€§ï¼Œåˆ™é»˜è®¤å€¼ä¸º Equal å¦å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šå€¼ï¼š ç©ºçš„ key å¦‚æœå†é…åˆ Exists å°±èƒ½åŒ¹é…æ‰€æœ‰çš„ key ä¸ valueï¼Œä¹Ÿå°±æ˜¯æ˜¯èƒ½å®¹å¿æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Taints ç©ºçš„ effect åŒ¹é…æ‰€æœ‰çš„ effect æœ€åå¦‚æœæˆ‘ä»¬è¦å–æ¶ˆèŠ‚ç‚¹çš„æ±¡ç‚¹æ ‡è®°ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ $ kubectl taint nodes node2 test- node \"node2\" untainted ","date":"2021-07-16","objectID":"/pod%E8%B0%83%E5%BA%A6/:6:0","tags":["Kubernetes"],"title":"Podè°ƒåº¦","uri":"/pod%E8%B0%83%E5%BA%A6/"},{"categories":["linux"],"content":"awk æ˜¯ Linux/Unix ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·,ä¸»è¦ç”¨äºå¤„ç†æ–‡æœ¬æ–‡ä»¶å’Œå­—ç¬¦ä¸²ã€‚ ","date":"2021-06-29","objectID":"/awk/:0:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"ç‰¹æ€§ awk çš„ä¸€äº›å…³é”®ç‰¹æ€§: å¯ä»¥æ ¹æ®å­—æ®µè¿›è¡Œæ“ä½œ,å¦‚æ‰“å°æŒ‡å®šåˆ—ã€æ±‚åˆ—çš„æ€»å’Œç­‰ æ”¯æŒæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯è¯­å¥,å¯ä»¥å®ç°å¤æ‚çš„æ–‡æœ¬å¤„ç† ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…å’Œå†…å®¹æå– å†…ç½®å­—ç¬¦ä¸²æ“ä½œå‡½æ•°,å¦‚åŒ¹é…ã€æ›¿æ¢ã€æˆªå–ç­‰ ","date":"2021-06-29","objectID":"/awk/:1:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"é€‚ç”¨åœºæ™¯ awk é€‚ç”¨äºæŠ¥è¡¨ç”Ÿæˆã€æ ¼å¼è½¬æ¢ã€æ•°å­¦è¿ç®—ç­‰åœºæ™¯ã€‚æŒæ¡äº† awk,å¯ä»¥å¤§å¤§æé«˜ Bash è„šæœ¬çš„æ–‡æœ¬å¤„ç†èƒ½åŠ› ","date":"2021-06-29","objectID":"/awk/:2:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"å†…ç½®å‡½æ•° å†…ç½®å‡½æ•° command é‡Šä¹‰ gsub(r,s) åœ¨æ•´ä¸ª$0ä¸­ç”¨sæ›¿ä»£r ç›¸å½“äº sed â€™s///g' gsub(r,s,t) åœ¨æ•´ä¸ªtä¸­ç”¨sæ›¿ä»£r index(s,t) è¿”å›sä¸­å­—ç¬¦ä¸²tçš„ç¬¬ä¸€ä½ç½® length(s) è¿”å›sé•¿åº¦ match(s,r) æµ‹è¯•sæ˜¯å¦åŒ…å«åŒ¹é…rçš„å­—ç¬¦ä¸² split(s,a,fs) åœ¨fsä¸Šå°†såˆ†æˆåºåˆ—a sprint(fmt,exp) è¿”å›ç»fmtæ ¼å¼åŒ–åçš„exp sub(r,s) ç”¨$0ä¸­æœ€å·¦è¾¹æœ€é•¿çš„å­ä¸²ä»£æ›¿s ç›¸å½“äº sed â€™s///' substr(s,p) è¿”å›å­—ç¬¦ä¸²sä¸­ä»på¼€å§‹çš„åç¼€éƒ¨åˆ† substr(s,p,n) è¿”å›å­—ç¬¦ä¸²sä¸­ä»på¼€å§‹é•¿åº¦ä¸ºnçš„åç¼€éƒ¨åˆ† ","date":"2021-06-29","objectID":"/awk/:3:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"awk åˆ¤æ–­ awk â€˜{print ($1\u003e$2)?â€œç¬¬ä¸€æ’â€$1:â€œç¬¬äºŒæ’â€$2}â€™ # æ¡ä»¶åˆ¤æ–­ æ‹¬å·ä»£è¡¨ifè¯­å¥åˆ¤æ–­ â€œ?â€œä»£è¡¨then â€œ:â€œä»£è¡¨else awk â€˜{max=($1\u003e$2)? $1 : $2; print max}â€™ # æ¡ä»¶åˆ¤æ–­ å¦‚æœ$1å¤§äº$2,maxå€¼ä¸ºä¸º$1,å¦åˆ™ä¸º$2 awk â€˜{if ( $6 \u003e 50) print $1 \" Too highâ€ ;else print â€œRange is OKâ€}â€™ file awk â€˜{if ( $6 \u003e 50) { count++;print $3 } else { x+5; print $2 } }â€™ file ","date":"2021-06-29","objectID":"/awk/:4:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"awk å¾ªç¯ awk â€˜{i = 1; while ( i \u003c= NF ) { print NF, $i ; i++ } }â€™ file awk â€˜{ for ( i = 1; i \u003c= NF; i++ ) print NF,$i }â€™ file ","date":"2021-06-29","objectID":"/awk/:5:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"ç¤ºä¾‹ awk â€˜{print $1, $3}â€™ file.txt æ¯è¡ŒæŒ‰ç©ºæ ¼åˆ†å‰²æˆå¤šä¸ªå­—æ®µ,è¾“å‡ºç¬¬1ä¸ªå’Œç¬¬3ä¸ªå­—æ®µ awk â€˜{sum+=$1*$1} END {print sum}â€™ file.txt æ±‚ç¬¬ä¸€åˆ—çš„å¹³æ–¹å’Œ awk â€™length \u003e 80â€™ file.txt æŸ¥æ‰¾é•¿åº¦å¤§äº80çš„è¡Œ awk â€˜/regex/ {print $0}â€™ log.txt ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å†…å®¹ awk â€˜{print $NF}â€™ file.txt æ‰“å°æœ€åä¸€åˆ— awk â€˜{print $(NF-1) }â€™ file.txt æ‰“å°å€’æ•°ç¬¬äºŒåˆ— awk â€˜{OFS=â€#â€;$1=$1;print $0}â€™ file.txt OFS è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ awk â€˜{if(NR==3){print $0} else {print â€œä¸æ˜¯ç¬¬ä¸‰è¡Œâ€}}â€™ file.txt æ‰“å°æŒ‡å®šè¡Œ awk â€˜NR==1||NR==3{print $0}â€™ test.txt æ‰“å°ç¬¬ä¸€è¡Œæˆ–è€…ç¬¬ä¸‰è¡Œ awk â€˜/Tom/â€™ file # æ‰“å°åŒ¹é…åˆ°å¾—è¡Œ awk â€˜/^Tom/{print $1}â€™ # åŒ¹é…Tomå¼€å¤´çš„è¡Œ æ‰“å°ç¬¬ä¸€ä¸ªå­—æ®µ awk â€˜$1 !~ /ly$/â€™ # æ˜¾ç¤ºæ‰€æœ‰ç¬¬ä¸€ä¸ªå­—æ®µä¸æ˜¯ä»¥lyç»“å°¾çš„è¡Œ awk â€˜$3 \u003c40â€™ # å¦‚æœç¬¬ä¸‰ä¸ªå­—æ®µå€¼å°äº40æ‰æ‰“å° awk â€˜$4==90{print $5}â€™ # å–å‡ºç¬¬å››åˆ—ç­‰äº90çš„ç¬¬äº”åˆ— awk â€˜/^(no|so)/â€™ test # æ‰“å°æ‰€æœ‰ä»¥æ¨¡å¼noæˆ–soå¼€å¤´çš„è¡Œ awk â€˜$3 * $4 \u003e 500â€™ # ç®—æœ¯è¿ç®—(ç¬¬ä¸‰ä¸ªå­—æ®µå’Œç¬¬å››ä¸ªå­—æ®µä¹˜ç§¯å¤§äº500åˆ™æ˜¾ç¤º) awk â€˜{print NRâ€ â€œ$0}â€™ # åŠ è¡Œå· awk â€˜/tom/,/suz/â€™ # æ‰“å°tomåˆ°suzä¹‹é—´çš„è¡Œ awk â€˜{a+=$1}END{print a}â€™ # åˆ—æ±‚å’Œ awk â€˜sum+=$1{print sum}â€™ # å°†$1çš„å€¼å åŠ åèµ‹ç»™sum awk â€˜{a+=$1}END{print a/NR}â€™ # åˆ—æ±‚å¹³å‡å€¼ awk â€˜!s[$1 $3]++â€™ file # æ ¹æ®ç¬¬ä¸€åˆ—å’Œç¬¬ä¸‰åˆ—è¿‡æ»¤é‡å¤è¡Œ awk -Fâ€™[ :\\t]â€™ â€˜{print $1,$2}â€™ # ä»¥ç©ºæ ¼ã€:ã€åˆ¶è¡¨ç¬¦Tabä¸ºåˆ†éš”ç¬¦ awk â€˜{print â€œâ€™\"$aâ€â€™â€,\"â€™\"$b\"â€™\"}â€™ # å¼•ç”¨å¤–éƒ¨å˜é‡ awk â€˜{if(NR==52){print;exit}}â€™ # æ˜¾ç¤ºç¬¬52è¡Œ awk â€˜/å…³é”®å­—/{a=NR+2}a==NR {print}â€™ # å–å…³é”®å­—ä¸‹ç¬¬å‡ è¡Œ awk â€˜gsub(/liu/,â€œaaaaâ€,$1){print $0}â€™ # åªæ‰“å°åŒ¹é…æ›¿æ¢åçš„è¡Œ ll | awk -Fâ€™ +| +â€™ â€˜/^$/{print $8}â€™ # æå–æ—¶é—´,ç©ºæ ¼ä¸å›ºå®š awk â€˜{$1=\"\";$2=\"\";$3=\"\";print}â€™ # å»æ‰å‰ä¸‰åˆ— echo aada:aba|awk â€˜/d/||/b/{print}â€™ # åŒ¹é…ä¸¤å†…å®¹ä¹‹ä¸€ echo aada:abaa|awk -F: â€˜$1~/d/||$2~/b/{print}â€™ # å…³é”®åˆ—åŒ¹é…ä¸¤å†…å®¹ä¹‹ä¸€ echo Ma asdas|awk â€˜$1~/^[a-Z][a-Z]$/{print }â€™ # ç¬¬ä¸€ä¸ªåŸŸåŒ¹é…æ­£åˆ™ echo aada:aaba|awk â€˜/d/\u0026\u0026/b/{print}â€™ # åŒæ—¶åŒ¹é…ä¸¤æ¡ä»¶ awk â€™length($1)==â€œ4â€{print $1}â€™ # å­—ç¬¦ä¸²ä½æ•° awk â€˜{if($2\u003e3){system (â€œtouch â€œ$1)}}â€™ # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ awk â€˜{sub(/Mac/,â€œMacintoshâ€,$0);print}â€™ # ç”¨Macintoshæ›¿æ¢Mac awk â€˜{gsub(/Mac/,â€œMacIntoshâ€,$1); print}â€™ # ç¬¬ä¸€ä¸ªåŸŸå†…ç”¨Macintoshæ›¿æ¢Mac awk -F â€™â€™ â€˜{ for(i=1;i\u003cNF+1;i++)a+=$i ;print a}â€™ # å¤šä½æ•°ç®—å‡ºå…¶æ¯ä½æ•°çš„æ€»å’Œ.æ¯”å¦‚ 1234ï¼Œ å¾—åˆ° 10 awk â€˜{ i=$1%10;if ( i == 0 ) {print i}}â€™ # åˆ¤æ–­$1æ˜¯å¦æ•´é™¤(awkä¸­å®šä¹‰å˜é‡å¼•ç”¨æ—¶ä¸èƒ½å¸¦ $ ) awk â€˜BEGIN{a=0}{if ($1\u003ea) a=$1 fi}END{print a}â€™ # åˆ—æ±‚æœ€å¤§å€¼ è®¾å®šä¸€ä¸ªå˜é‡å¼€å§‹ä¸º0ï¼Œé‡åˆ°æ¯”è¯¥æ•°å¤§çš„å€¼ï¼Œå°±èµ‹å€¼ç»™è¯¥å˜é‡ï¼Œç›´åˆ°ç»“æŸ awk â€˜BEGIN{a=11111}{if ($1\u003ca) a=$1 fi}END{print a}â€™ # æ±‚æœ€å°å€¼ awk â€˜{if(A)print;A=0}/regexp/{A=1}â€™ # æŸ¥æ‰¾å­—ç¬¦ä¸²å¹¶å°†åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†å¹¶ä¸æ˜¾ç¤ºåŒ¹é…è¡Œ awk â€˜/regexp/{print A}{A=$0}â€™ # æŸ¥æ‰¾å­—ç¬¦ä¸²å¹¶å°†åŒ¹é…è¡Œçš„ä¸Šä¸€è¡Œæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†å¹¶ä¸æ˜¾ç¤ºåŒ¹é…è¡Œ awk â€˜{if(!/mysql/)gsub(/1/,â€œaâ€);print $0}â€™ # å°†1æ›¿æ¢æˆaï¼Œå¹¶ä¸”åªåœ¨è¡Œä¸­æœªå‡ºç°å­—ä¸²mysqlçš„æƒ…å†µä¸‹æ›¿æ¢ awk â€˜BEGIN{srand();fr=int(100*rand());print fr;}â€™ # è·å–éšæœºæ•° awk â€˜{if(NR==3)F=1}{if(F){i++;if(i%7==1)print}}â€™ # ä»ç¬¬3è¡Œå¼€å§‹ï¼Œæ¯7è¡Œæ˜¾ç¤ºä¸€æ¬¡ awk â€˜{if(NF\u003c1){print i;i=0} else {i++;print $0}}â€™ # æ˜¾ç¤ºç©ºè¡Œåˆ†å‰²å„æ®µçš„è¡Œæ•° echo +null:null |awk -F: â€˜$1!~\"^+â€\u0026\u0026$2!=â€œnullâ€{print $0}â€™ # å…³é”®åˆ—åŒæ—¶åŒ¹é… awk -v RS=@ â€˜NF{for(i=1;i\u003c=NF;i++)if($i) printf $i;print â€œâ€}â€™ # æŒ‡å®šè®°å½•åˆ†éš”ç¬¦ awk â€˜{b[$1]=b[$1]$2}END{for(i in b){print i,b[i]}}â€™ # åˆ—å åŠ  awk â€˜{ i=($1%100);if ( $i \u003e= 0 ) {print $0,$i}}â€™ # æ±‚ä½™æ•° awk â€˜{b=a;a=$1; if(NR\u003e1){print a-b}}â€™ # å½“å‰è¡Œå‡ä¸Šä¸€è¡Œ awk â€˜{a[NR]=$1}END{for (i=1;i\u003c=NR;i++){print a[i]-a[i-1]}}â€™ # å½“å‰è¡Œå‡ä¸Šä¸€è¡Œ awk -F: â€˜{name[x++]=$1};END{for(i=0;i\u003cNR;i++)print i,name[i]}â€™ # ENDåªæ‰“å°æœ€åçš„ç»“æœ,ENDå—é‡Œé¢å¤„ç†æ•°ç»„å†…å®¹ awk â€˜{sum2+=$2;count=count+1}END{print sum2,sum2/count}â€™ # $2çš„æ€»å’Œ $2æ€»å’Œé™¤ä¸ªæ•°(å¹³å‡å€¼) awk -v a=0 -F â€˜Bâ€™ â€˜{for (i=1;i\u003cNF;i++){ a=a+length($i)+1;print a }}â€™ # æ‰“å°æ‰€ä»¥Bçš„æ‰€åœ¨ä½ç½® awk â€˜BEGIN{ â€œdateâ€ | getline d; split(d,mon) ; print mon[2]}â€™ file # å°†dateå€¼èµ‹ç»™dï¼Œå¹¶å°†dè®¾ç½®ä¸ºæ•°ç»„monï¼Œæ‰“å°monæ•°ç»„ä¸­ç¬¬2ä¸ªå…ƒç´  awk â€˜BEGIN{info=â€œthis is a test2010test!\";print substr(info,4,10);}â€™ # æˆªå–å­—ç¬¦ä¸²(substrä½¿ç”¨) awk â€˜BEGIN{info=â€œthis is a test2010test!\";print index(info,â€œtestâ€)?â€œokâ€:â€œno foundâ€;}â€™ # åŒ¹é…å­—ç¬¦ä¸²(indexä½¿ç”¨) awk â€˜BEGIN{info=â€œthis is a test2010test!\";print match(info,/[0-9]+/)?â€œokâ€:â€œno foundâ€;}â€™ # æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æŸ¥æ‰¾(matchä½¿ç”¨) awk â€˜{for(i=1;i\u003c=4;i++)printf $i\"â€œFS; for(y=10;y\u003c=13;y++) printf $y\"â€œFS;print â€œâ€}â€™ # æ‰“å°å‰4åˆ—å’Œå4åˆ— awk â€˜BEGIN{for(n=0;n++\u003c9;){for(i=0;i++\u003cn;)printf i\"x\"nâ€=â€œi*nâ€ â€œ;print â€œâ€}}â€™ # ä¹˜æ³•å£è¯€ awk â€˜BEGIN{info=â€œthis is a testâ€;split(info,tA,â€ â€œ);print length(tA);for(k in tA){print k,tA[k];}}â€™ # å­—ç¬¦ä¸²åˆ†å‰²(splitä½¿ç”¨) awk â€˜{if (system (â€œgrep â€œ$2â€ tmp/* \u003e /dev/null 2\u003e\u00261â€) == 0 ) {print $1,â€œYâ€} else {print $1,â€œNâ€} }â€™ a # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤åˆ¤æ–­è¿”å›çŠ¶æ€ awk â€˜{for(i=1;i\u003c=NF;i++) a[i,NR]=$i}END{for(i=1;i\u003c=NF;i++) {for(j=1;j\u003c=NR;j++) printf a[i,j] \" â€œ;print â€œâ€}}â€™ # å°†å¤šè¡Œè½¬å¤šåˆ— å¸¸ç”¨ç¤ºä¾‹ #åˆ é™¤tempæ–‡ä»¶çš„é‡å¤è¡Œ awk '!($0 in array) { array[$0]; print }' temp #æŸ¥çœ‹æœ€é•¿ä½¿ç”¨çš„10ä¸ªunixå‘½ä»¤ awk '{print $1}' ~/.bash_","date":"2021-06-29","objectID":"/awk/:6:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"æ€ç»´å¯¼å›¾ awk\r","date":"2021-06-29","objectID":"/awk/:7:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ awk","uri":"/awk/"},{"categories":["linux"],"content":"æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢ä¹‹SED Stream EDitor, æµç¼–è¾‘å™¨ sedæ˜¯ä¸€ç§æµç¼–è¾‘å™¨ï¼Œå®ƒä¸€æ¬¡å¤„ç†ä¸€è¡Œå†…å®¹ã€‚å¤„ç†æ—¶ï¼ŒæŠŠå½“å‰å¤„ç†çš„è¡Œå­˜å‚¨åœ¨ä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œç§°ä¸º\"æ¨¡å¼ç©ºé—´\"ï¼ˆpattern spaceï¼‰ï¼Œæ¥ç€ç”¨sedå‘½ä»¤å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œå¤„ç†å®Œæˆåï¼ŒæŠŠç¼“å†²åŒºçš„å†…å®¹é€å¾€å±å¹•ã€‚ç„¶åè¯»å…¥ä¸‹è¡Œï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå¾ªç¯ã€‚å¦‚æœæ²¡æœ‰ä½¿è¯¸å¦‚â€˜Dâ€™çš„ç‰¹æ®Šå‘½ä»¤ï¼Œé‚£ä¼šåœ¨ä¸¤ä¸ªå¾ªç¯ä¹‹é—´æ¸…ç©ºæ¨¡å¼ç©ºé—´ï¼Œä½†ä¸ä¼šæ¸…ç©ºä¿ç•™ç©ºé—´ã€‚è¿™æ ·ä¸æ–­é‡å¤ï¼Œç›´åˆ°æ–‡ä»¶æœ«å°¾ã€‚æ–‡ä»¶å†…å®¹å¹¶æ²¡æœ‰æ”¹å˜ï¼Œé™¤éä½ ä½¿ç”¨é‡å®šå‘å­˜å‚¨è¾“å‡ºã€‚ åŠŸèƒ½ï¼šä¸»è¦ç”¨æ¥è‡ªåŠ¨ç¼–è¾‘ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶,ç®€åŒ–å¯¹æ–‡ä»¶çš„åå¤æ“ä½œ,ç¼–å†™è½¬æ¢ç¨‹åºç­‰ å‚è€ƒï¼š http://www.gnu.org/software/sed/manual/sed.html ç®€å•çš„è¯´sedä¸»è¦æ˜¯ç”¨æ¥ç¼–è¾‘æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ä»å››ä¸ªè§’åº¦æ¥å­¦è¿™ä¸ªå‘½ä»¤ï¼Œå¢åˆ æŸ¥æ”¹ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:0:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"åˆä½“éªŒ åœ¨è¡Œé¦–æ·»åŠ ä¸€è¡Œ sed '1i\\AAA' aa.txt åœ¨è¡Œå°¾æ·»åŠ ä¸€è¡Œ sed '$a\\AAA' aa.txt ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:1:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"åŸºç¡€ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"ç”¨æ³• ç”¨æ³•ï¼š sed [option]... 'script' inputfile... å¸¸ç”¨é€‰é¡¹ï¼š -n ä¸è¾“å‡ºæ¨¡å¼ç©ºé—´å†…å®¹åˆ°å±å¹•ï¼Œå³ä¸è‡ªåŠ¨æ‰“å° -e å¤šç‚¹ç¼–è¾‘ -f /PATH/SCRIPT_FILE ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–ç¼–è¾‘è„šæœ¬ -r æ”¯æŒä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ -i.bak å¤‡ä»½æ–‡ä»¶å¹¶åŸå¤„ç¼–è¾‘ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:1","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"åœ°å€å®šç•Œ (1) ä¸ç»™åœ°å€ï¼šå¯¹å…¨æ–‡è¿›è¡Œå¤„ç† (2) å•åœ°å€ï¼š #ï¼šæŒ‡å®šçš„è¡Œï¼Œ$ï¼šæœ€åä¸€è¡Œ /pattern/ï¼šè¢«æ­¤å¤„æ¨¡å¼æ‰€èƒ½å¤ŸåŒ¹é…åˆ°çš„æ¯ä¸€è¡Œ (3) åœ°å€èŒƒå›´ï¼š #,# #,+# /pat1/,/pat2/ #,/pat1/ (4) ~ï¼šæ­¥è¿› 1~2 å¥‡æ•°è¡Œ 2~2 å¶æ•°è¡Œ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:2","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"ç¼–è¾‘å‘½ä»¤ å‘½ä»¤ è¯´æ˜ d åˆ é™¤æ¨¡å¼ç©ºé—´åŒ¹é…çš„è¡Œï¼Œå¹¶ç«‹å³å¯ç”¨ä¸‹ä¸€è½®å¾ªç¯ p æ‰“å°å½“å‰æ¨¡å¼ç©ºé—´å†…å®¹ï¼Œè¿½åŠ åˆ°é»˜è®¤è¾“å‡ºä¹‹å a [\\]text åœ¨æŒ‡å®šè¡Œåé¢è¿½åŠ æ–‡æœ¬ï¼Œæ”¯æŒä½¿ç”¨\\nå®ç°å¤šè¡Œè¿½åŠ  i [\\]text åœ¨è¡Œå‰é¢æ’å…¥æ–‡æœ¬ c [\\]text æ›¿æ¢è¡Œä¸ºå•è¡Œæˆ–å¤šè¡Œæ–‡æœ¬ w /path/file ä¿å­˜æ¨¡å¼åŒ¹é…çš„è¡Œè‡³æŒ‡å®šæ–‡ä»¶ r /path/file è¯»å–æŒ‡å®šæ–‡ä»¶çš„æ–‡æœ¬è‡³æ¨¡å¼ç©ºé—´ä¸­åŒ¹é…åˆ°çš„è¡Œå = ä¸ºæ¨¡å¼ç©ºé—´ä¸­çš„è¡Œæ‰“å°è¡Œå· ! æ¨¡å¼ç©ºé—´ä¸­åŒ¹é…è¡Œå–åå¤„ç† ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:3","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"æŸ¥æ‰¾æ›¿æ¢ s/// æŸ¥æ‰¾æ›¿æ¢,æ”¯æŒä½¿ç”¨å…¶å®ƒåˆ†éš”ç¬¦ï¼Œs@@@ï¼Œs### æ›¿æ¢æ ‡è®°ï¼š g è¡Œå†…å…¨å±€æ›¿æ¢ p æ˜¾ç¤ºæ›¿æ¢æˆåŠŸçš„è¡Œ w /PATH/FILE å°†æ›¿æ¢æˆåŠŸçš„è¡Œä¿å­˜è‡³æ–‡ä»¶ä¸­ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:4","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"ç¤ºä¾‹ å‘½ä»¤ ä»‹ç» cp /etc/passwd /tmp/passwd æ ·æœ¬æ–‡ä»¶ sed â€˜2pâ€™ /tmp/passwd æ‰“å°ç¬¬äºŒè¡Œ sed -n â€˜2pâ€™ /tmp/passwd æ‰“å°ç¬¬äºŒè¡Œé™é»˜è¾“å‡ºç¬¬äºŒè¡Œ sed -n â€˜1,4pâ€™ /tmp/passwd é™é»˜è¾“å‡ºä¸€è‡³å››è¡Œ sed -n â€˜/root/pâ€™ /tmp/passwd é™é»˜è¾“å‡ºåŒ¹é…åŒ…å«rootå­—ç¬¦ä¸²çš„è¡Œ sed -n â€˜2,/root/pâ€™ /tmp/passwd ä»2è¡Œå¼€å§‹ï¼Œé™é»˜è¾“å‡ºåŒ¹é…åŒ…å«rootå­—ç¬¦ä¸²çš„è¡Œ sed -n â€˜/^$/=â€™ file æ˜¾ç¤ºç©ºè¡Œè¡Œå· sed -n -e â€˜/^$/pâ€™ -e â€˜/^$/=â€™ file sed â€˜/root/a\\supermanâ€™ /tmp/passwd åœ¨åŒ¹é…rootå­—ç¬¦ä¸²è¡Œåè¿½åŠ superman sed â€˜/root/i\\supermanâ€™ /tmp/passwd åœ¨åŒ¹é…rootå­—ç¬¦ä¸²è¡Œå‰è¿½åŠ superman sed â€˜/root/c\\supermanâ€™ /tmp/passwd é‡å†™åŒ¹é…rootå­—ç¬¦ä¸²çš„è¡Œ sed â€˜/^$/dâ€™ file æ¸…ç©ºæ–‡ä»¶ sed â€˜1,10dâ€™ file åˆ é™¤æ–‡ä»¶çš„1-10è¡Œ nl /tmp/passwd sed â€˜2,5dâ€™ nl /tmp/passwd sed â€˜2a teaâ€™ sed â€™s/test/mytest/gâ€™ example æ–‡ä»¶æ›¿æ¢ sed -n â€™s/root/\u0026superman/pâ€™ /tmp/passwd åœ¨åŒ¹é…çš„å•è¯åæ·»åŠ å†…å®¹ sed -n â€™s/root/superman\u0026/pâ€™ /tmp/passwd åœ¨åŒ¹é…çš„å•è¯å‰æ·»åŠ å†…å®¹ sed -e â€™s/dog/cat/â€™ -e â€™s/hi/lo/â€™ pets å¤šä¸ªæ­£åˆ™åŒ¹é… sed â€“i â€™s/dog/cat/gâ€™ pets æ›¿æ¢ç”Ÿæ•ˆ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:2:5","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"æ€»ç»“ æ·»åŠ ä½¿ç”¨append,insertå‘½ä»¤ï¼Œåˆ é™¤ä½¿ç”¨delete,ä¿®æ”¹ä½¿ç”¨copy,subsituteå‘½ä»¤,æŸ¥çœ‹print ç»“åˆ-n é™é»˜è¾“å‡ºï¼Œå¯ä»¥è¦†ç›–ç™¾åˆ†ä¹‹å…«åä»¥ä¸Šçš„åœºæ™¯ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:3:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"é«˜çº§ç¼–è¾‘å‘½ä»¤ Pï¼š æ‰“å°æ¨¡å¼ç©ºé—´å¼€ç«¯è‡³\\nå†…å®¹ï¼Œå¹¶è¿½åŠ åˆ°é»˜è®¤è¾“å‡ºä¹‹å‰ h: æŠŠæ¨¡å¼ç©ºé—´ä¸­çš„å†…å®¹è¦†ç›–è‡³ä¿æŒç©ºé—´ä¸­ Hï¼šæŠŠæ¨¡å¼ç©ºé—´ä¸­çš„å†…å®¹è¿½åŠ è‡³ä¿æŒç©ºé—´ä¸­ g: ä»ä¿æŒç©ºé—´å–å‡ºæ•°æ®è¦†ç›–è‡³æ¨¡å¼ç©ºé—´ Gï¼šä»ä¿æŒç©ºé—´å–å‡ºå†…å®¹è¿½åŠ è‡³æ¨¡å¼ç©ºé—´ x: æŠŠæ¨¡å¼ç©ºé—´ä¸­çš„å†…å®¹ä¸ä¿æŒç©ºé—´ä¸­çš„å†…å®¹è¿›è¡Œäº’æ¢ n: è¯»å–åŒ¹é…åˆ°çš„è¡Œçš„ä¸‹ä¸€è¡Œè¦†ç›–è‡³æ¨¡å¼ç©ºé—´ Nï¼šè¯»å–åŒ¹é…åˆ°çš„è¡Œçš„ä¸‹ä¸€è¡Œè¿½åŠ è‡³æ¨¡å¼ç©ºé—´ d: åˆ é™¤æ¨¡å¼ç©ºé—´ä¸­çš„è¡Œ Dï¼šå¦‚æœæ¨¡å¼ç©ºé—´åŒ…å«æ¢è¡Œç¬¦ï¼Œåˆ™åˆ é™¤ç›´åˆ°ç¬¬ä¸€ä¸ªæ¢è¡Œç¬¦çš„æ¨¡å¼ç©ºé—´ä¸­çš„æ–‡æœ¬ï¼Œå¹¶ä¸ä¼šè¯»å–æ–°çš„è¾“å…¥è¡Œï¼Œè€Œä½¿ç”¨åˆæˆçš„æ¨¡å¼ç©ºé—´é‡æ–°å¯åŠ¨å¾ªç¯ã€‚å¦‚æœæ¨¡å¼ç©ºé—´ ä¸åŒ…å«æ¢è¡Œç¬¦ï¼Œåˆ™ä¼šåƒå‘å‡ºdå‘½ä»¤é‚£æ ·å¯åŠ¨æ­£å¸¸çš„æ–°å¾ªç¯ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:4:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"ç»ƒä¹  1ã€åˆ é™¤centos7ç³»ç»Ÿ/etc/grub2.cfgæ–‡ä»¶ä¸­æ‰€æœ‰ä»¥ç©ºç™½å¼€å¤´çš„è¡Œè¡Œé¦–çš„ç©ºç™½å­—ç¬¦ 2ã€åˆ é™¤/etc/fstabæ–‡ä»¶ä¸­æ‰€æœ‰ä»¥#å¼€å¤´ï¼Œåé¢è‡³å°‘è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦çš„è¡Œçš„è¡Œé¦–çš„#å’Œç©ºç™½å­—ç¬¦ 3ã€åœ¨centos6ç³»ç»Ÿ/root/install.logæ¯ä¸€è¡Œè¡Œé¦–å¢åŠ #å· 4ã€åœ¨/etc/fstabæ–‡ä»¶ä¸­ä¸ä»¥#å¼€å¤´çš„è¡Œçš„è¡Œé¦–å¢åŠ #å· 5ã€å¤„ç†/etc/fstabè·¯å¾„,ä½¿ç”¨sedå‘½ä»¤å–å‡ºå…¶ç›®å½•åå’ŒåŸºå 6ã€åˆ©ç”¨sed å–å‡ºifconfigå‘½ä»¤ä¸­æœ¬æœºçš„IPv4åœ°å€ 7ã€ç»Ÿè®¡centoså®‰è£…å…‰ç›˜ä¸­Packageç›®å½•ä¸‹çš„æ‰€æœ‰rpmæ–‡ä»¶çš„ä»¥.åˆ†éš”å€’æ•°ç¬¬äºŒä¸ªå­—æ®µçš„é‡å¤æ¬¡æ•° 8ã€ç»Ÿè®¡/etc/init.d/functionsæ–‡ä»¶ä¸­æ¯ä¸ªå•è¯çš„å‡ºç°æ¬¡æ•°ï¼Œå¹¶æ’åºï¼ˆç”¨grepå’Œsedä¸¤ç§æ–¹æ³•åˆ†åˆ«å®ç°ï¼‰ 9ã€å°†æ–‡æœ¬æ–‡ä»¶çš„nå’Œn+1è¡Œåˆå¹¶ä¸ºä¸€è¡Œï¼Œnä¸ºå¥‡æ•°è¡Œ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:5:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"æ€ç»´å¯¼å›¾ sed\r","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:6:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"å‚è€ƒ linux-sed-command sedå¸¸ç”¨å‘½ä»¤ ","date":"2021-06-26","objectID":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/:7:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ sed","uri":"/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/"},{"categories":["linux"],"content":"ä¸ºä»€ä¹ˆä½¿ç”¨Linux grepå‘½ä»¤? Grepæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ–‡æœ¬æ¨¡å¼ã€‚é€šè¿‡ä½¿ç”¨grepå‘½ä»¤ï¼Œä½ å¯ä»¥å¿«é€Ÿå®šä½å’Œæå–åŒ…å«ç‰¹å®šæ¨¡å¼çš„è¡Œï¼Œä»è€ŒåŠ å¿«æŸ¥æ‰¾å’Œå¤„ç†æ–‡æœ¬æ•°æ®çš„æ•ˆç‡ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨æ—¥å¸¸å·¥ä½œä¸­ç»å¸¸éœ€è¦ä½¿ç”¨çš„ä»»åŠ¡ï¼Œå› æ­¤grepå‘½ä»¤åœ¨Linuxä¸­éå¸¸æµè¡Œã€‚ ","date":"2021-06-20","objectID":"/grep/:1:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["linux"],"content":"Linux grepå‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ Grepæ˜¯ä¸€ä¸ªåœ¨Linuxå’Œå…¶ä»–ç±»Unixç³»ç»Ÿä¸Šå¯ç”¨çš„å‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œç”¨äºæœç´¢å’ŒåŒ¹é…æ–‡æœ¬ã€‚å®ƒçš„åå­—æ¥è‡ªäºå…¨å±€æ­£åˆ™è¡¨è¾¾å¼ï¼ˆglobal regular expression printï¼‰ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®ç»™å®šçš„æ¨¡å¼æœç´¢æ–‡ä»¶ä¸­çš„æ–‡æœ¬ï¼Œå¹¶æ‰“å°åŒ¹é…çš„è¡Œã€‚grepå‘½ä»¤æ”¯æŒä½¿ç”¨ç®€å•çš„æ–‡æœ¬æ¨¡å¼æˆ–æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‘½ä»¤é€‰é¡¹è¿›è¡Œè¿›ä¸€æ­¥çš„å®šåˆ¶ã€‚ ","date":"2021-06-20","objectID":"/grep/:2:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["linux"],"content":"å¦‚ä½•ä½¿ç”¨Linux grepå‘½ä»¤ï¼Ÿ è¦ä½¿ç”¨grepå‘½ä»¤ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥grepï¼Œåè·Ÿè¦æœç´¢çš„æ¨¡å¼å’Œè¦æœç´¢çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„grepå‘½ä»¤é€‰é¡¹å’Œç¤ºä¾‹ï¼š ç¤ºä¾‹åˆ—è¡¨ å‘½ä»¤ è§£é‡Š grep -i â€œpatternâ€ file.txt å¿½ç•¥å¤§å°å†™è¿›è¡Œæœç´¢ grep -r â€œpatternâ€ directory/ é€’å½’æœç´¢å­ç›®å½• grep -E â€œpatternâ€ file.txt ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ grep -A 2 â€œpatternâ€ file.txt æ˜¾ç¤ºåŒ¹é…æ¨¡å¼ä¹‹å‰æˆ–ä¹‹åçš„æ–‡æœ¬è¡Œ grep -C 2 â€œpatternâ€ file.txt è¾“å‡ºåŒ¹é…æ¨¡å¼çš„ä¸Šä¸‹æ–‡è¡Œ grep -i â€œpatternâ€ file.txt å¿½ç•¥å¤§å°å†™ grep -w â€œpatternâ€ file.txt ç²¾ç¡®åŒ¹é… grep -e hello -e world file.txt å¤šä¸ªå…³é”®è¯åŒ¹é… grep -v â€œpatternâ€ file.txt åå‘æŸ¥æ‰¾ï¼Œä¸åŒ…å«æŸä¸ªå…³é”®è¯çš„è¡Œ grep -lr â€œpatternâ€ file.txt é€’å½’åŒ¹é…å“ªäº›æ–‡ä»¶ååŒ…å«åŒ¹é…çš„å…³é”®è¯ grep -o â€œpatternâ€ file.txt åªè¾“å‡ºåŒ¹é…çš„å†…å®¹ grep\r","date":"2021-06-20","objectID":"/grep/:3:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["linux"],"content":"æœ€ä½³å®è·µ ","date":"2021-06-20","objectID":"/grep/:4:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["linux"],"content":"æœç´¢æ–‡ä»¶ä¸­æœ€ååŒ¹é…çš„ä¸€ä¸ªå…³é”®è¯çš„ä¸Šä¸‹200è¡Œ $ tac file.txt | grep -m 1 \"/enforcementGroupInfo/editPassword\" -B 200 -A 200 | tac \u003e /tmp/1.txt # or $ tac file.txt | grep -m 1 \"/enforcementGroupInfo/editPassword\" -C 200 | tac \u003e /tmp/1.txt å‘½ä»¤è§£é‡Šï¼š tac file.txt - åå‘è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆä»æœ€åä¸€è¡Œå¼€å§‹ï¼‰ grep -m 1 - åªåŒ¹é…ç¬¬ä¸€ä¸ªå‡ºç°çš„æ¨¡å¼ï¼ˆå³åŸæ–‡ä»¶æœ€åä¸€ä¸ªåŒ¹é…é¡¹ï¼‰ -B 200 -A 200 - æ˜¾ç¤ºåŒ¹é…è¡Œå‰åçš„200è¡Œå†…å®¹ -C 200 - è¾“å‡ºåŒ¹é…æ¨¡å¼çš„ä¸Šä¸‹æ–‡è¡Œ tac - å†æ¬¡åå‘è¾“å‡ºï¼Œæ¢å¤åŸå§‹è¡Œé¡ºåº \u003e /tmp/1.txt - å°†ç»“æœé‡å®šå‘åˆ°ç›®æ ‡æ–‡ä»¶ å¤‡é€‰æ–¹æ¡ˆï¼ˆé€‚ç”¨äºå¤§æ–‡ä»¶ï¼‰ å¦‚æœæ–‡ä»¶éå¸¸å¤§ï¼Œå¯ä»¥ä½¿ç”¨æ›´èŠ‚çœå†…å­˜çš„æ–¹æ³•ï¼š # è·å–æœ€åä¸€ä¸ªåŒ¹é…è¡Œå· line=$(grep -n \"/enforcementGroupInfo/editPassword\" file.txt | tail -1 | cut -d: -f1) # æå–è¯¥è¡Œä¸Šä¸‹200è¡Œå†…å®¹ [ -n \"$line\" ] \u0026\u0026 sed -n \"$((line\u003e200 ? line-200 : 1)),$((line+200))p\" file.txt \u003e /tmp/1.txt éªŒè¯ç»“æœ æ£€æŸ¥è¾“å‡ºæ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®ï¼š wc -l /tmp/1.txt # åº”è¯¥æœ€å¤š401è¡Œï¼ˆ200+1+200ï¼‰ tail -n 10 /tmp/1.txt | grep \"/enforcementGroupInfo/editPassword\" # ç¡®è®¤åŒ…å«å…³é”®è¯ æ³¨æ„äº‹é¡¹ å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰åŒ¹é…é¡¹ï¼Œ/tmp/1.txt ä¼šæ˜¯ç©ºæ–‡ä»¶ å¦‚æœåŒ¹é…é¡¹åœ¨æ–‡ä»¶å¼€å¤´ï¼Œå‰200è¡Œä¼šä»ç¬¬1è¡Œå¼€å§‹ å¦‚æœåŒ¹é…é¡¹åœ¨æ–‡ä»¶ç»“å°¾ï¼Œå200è¡Œä¼šåˆ°æ–‡ä»¶æœ«å°¾ç»“æŸ å¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ·»åŠ  -a é€‰é¡¹ï¼šgrep -a ","date":"2021-06-20","objectID":"/grep/:4:1","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["linux"],"content":"å‚è€ƒ æ˜¯çœŸçš„å¾ˆè¯¦ç»†äº†ï¼Linuxä¸­çš„Grepå‘½ä»¤ä½¿ç”¨å®ä¾‹ ","date":"2021-06-20","objectID":"/grep/:5:0","tags":["linuxæ–‡æœ¬ä¸‰å‰‘å®¢"],"title":"æ–‡æœ¬ä¸‰å‰‘å®¢ä¹‹ grep","uri":"/grep/"},{"categories":["Kubernetes"],"content":"K8s Serviceæœ‰å››ç§ç±»å‹ Service Headless Service NodePort Service LoadBalancer Service Service å¦‚æœä¸æŒ‡å®šåˆ™ä¸ºé»˜è®¤ç±»å‹ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:0:0","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"Service ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:1:0","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"Serviceæ˜¯ä»€ä¹ˆï¼Ÿ ServiceæœåŠ¡å¯ä»¥ä¸ºä¸€ç»„å…·æœ‰ç›¸åŒåŠŸèƒ½çš„å®¹å™¨åº”ç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ã€‚ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:1:1","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"Serviceå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ æˆ‘ä»¬éƒ½çŸ¥é“Podåœ¨æ‘§æ¯é‡å»ºæ—¶ipåœ°å€æ˜¯ä¼šåŠ¨æ€å˜åŒ–çš„ï¼Œè¿™æ ·é€šè¿‡å®¢æˆ·ç«¯ç›´æ¥è®¿é—®ä¸åˆé€‚äº†ï¼Œè¿™æ—¶å€™å°±å¯ä»¥é€‰æ‹©ä½¿ç”¨æœåŠ¡æ¥å’ŒPodå»ºç«‹è¿æ¥ï¼Œé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨è¿›è¡Œé€‚é…ã€‚è¿™æ ·å°±èƒ½æœ‰æ•ˆçš„è§£å†³äº†Pod ipåœ°å€åŠ¨æ€å˜æ¢çš„é—®é¢˜äº†ã€‚ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:1:2","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"Headless Service headless serviceä½œä¸ºserviceçš„ä¸€ç§ç±»å‹ï¼Œå®ƒåˆè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿheadless service é¡¾åæ€ä¹‰æ— å¤´æœåŠ¡ã€‚ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:2:0","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"ä¸ºä»€ä¹ˆéœ€è¦æ— å¤´æœåŠ¡ï¼Ÿ å®¢æˆ·ç«¯æƒ³è¦å’ŒæŒ‡å®šçš„çš„Podç›´æ¥é€šä¿¡ å¹¶ä¸æ˜¯éšæœºé€‰æ‹© å¼€å‘äººå‘˜å¸Œæœ›è‡ªå·±æ§åˆ¶è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œä¸ä½¿ç”¨Serviceæä¾›çš„é»˜è®¤çš„è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œæˆ–è€…åº”ç”¨ç¨‹åºå¸Œæœ›çŸ¥é“å±äºåŒç»„æœåŠ¡çš„å…¶å®ƒå®ä¾‹ã€‚ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:2:1","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"Headless Serviceä½¿ç”¨åœºæ™¯ æœ‰çŠ¶æ€åº”ç”¨ï¼Œä¾‹å¦‚æ•°æ®åº“ ä¾‹å¦‚ä¸»èŠ‚ç‚¹å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œå…¶å®ƒçš„ä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹åªèƒ½è¯»ï¼Œåœ¨è¿™é‡Œå®¢æˆ·ç«¯å°±æ²¡å¿…è¦æŒ‡å®špodæœåŠ¡çš„é›†ç¾¤åœ°å€ï¼Œç›´æ¥æŒ‡å®šæ•°æ®åº“Pod ipåœ°å€å³å¯ï¼Œè¿™é‡Œéœ€è¦ç»‘å®šdnsï¼Œå®¢æˆ·ç«¯è®¿é—®dnsï¼Œdnsä¼šè‡ªåŠ¨è¿”å›pod IPåœ°å€åˆ—è¡¨ Service\r","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:2:2","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"æ€»ç»“ æ— å¤´æœåŠ¡ä¸éœ€è¦æŒ‡å®šé›†ç¾¤åœ°å€ æ— å¤´æœåŠ¡é€‚ç”¨æœ‰çŠ¶æ€åº”ç”¨ä¾‹å¦‚æ•°æ®åº“ æ— å¤´æœåŠ¡dnsæŸ¥è¯¢ä¼šè¿”å›podåˆ—è¡¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ æ™®é€šServiceå¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡è·¯ç”±åˆ°ä¸åŒçš„å®¹å™¨åº”ç”¨ ","date":"2021-06-13","objectID":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/:3:0","tags":["Kubernetes"],"title":"K8sé»˜è®¤Serviceå’ŒHeadless Serviceçš„åŒºåˆ«","uri":"/k8s%E9%BB%98%E8%AE%A4service%E5%92%8Cheadless-service%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"categories":["Kubernetes"],"content":"èµ„æºå¯¹è±¡æ¦‚è¿° Kubernetesä¸­çš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­å¤§å¤šæ˜¯å›´ç»•èµ„æºå¯¹è±¡ï¼ˆResource Objectï¼‰æ¥è¯´çš„ï¼Œè€Œèµ„æºå¯¹è±¡åœ¨æ€»ä½“ä¸Šå¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ã€‚ æŸç§èµ„æºçš„å¯¹è±¡ï¼Œä¾‹å¦‚èŠ‚ç‚¹ï¼ˆNodeï¼‰ã€Podã€æœåŠ¡ï¼ˆServiceï¼‰ã€å­˜å‚¨å·ï¼ˆVolumeï¼‰ ä¸èµ„æºå¯¹è±¡ç›¸å…³çš„äº‹ç‰©ä¸åŠ¨ä½œï¼Œä¾‹å¦‚æ ‡ç­¾ï¼ˆLabelï¼‰ã€æ³¨è§£ï¼ˆAnnotationï¼‰ã€å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ã€éƒ¨ç½²ï¼ˆDeploymentï¼‰ã€HPAã€PVCã€‚ é›†ç¾¤ç±» é›†ç¾¤ï¼ˆClusterï¼‰è¡¨ç¤ºä¸€ä¸ªç”±Masterå’ŒNodeç»„æˆçš„Kubernetesé›†ç¾¤ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:0:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Master MasteræŒ‡çš„æ˜¯é›†ç¾¤çš„æ§åˆ¶èŠ‚ç‚¹ã€‚åœ¨æ¯ä¸ªKubernetesé›†ç¾¤ä¸­éƒ½éœ€è¦æœ‰ä¸€ä¸ªæˆ–ä¸€ç»„è¢«ç§°ä¸ºMasterçš„èŠ‚ç‚¹ï¼Œæ¥è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„ç®¡ç†å’Œæ§åˆ¶ã€‚Masteré€šå¸¸å æ®ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ˆåœ¨é«˜å¯ç”¨éƒ¨ç½²ä¸­å»ºè®®è‡³å°‘ä½¿ç”¨3å°æœåŠ¡å™¨ï¼‰ï¼Œæ˜¯æ•´ä¸ªé›†ç¾¤çš„\"å¤§è„‘\"ï¼Œå¦‚æœå®ƒå‘ç”Ÿå®•æœºæˆ–è€…ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå¯¹é›†ç¾¤å†…å®¹å™¨åº”ç”¨çš„ç®¡ç†éƒ½å°†æ— æ³•å®æ–½ã€‚ åœ¨Masterä¸Šè¿è¡Œç€ä»¥ä¸‹å…³é”®è¿›ç¨‹ã€‚ Kubernetes API Serverï¼ˆkube-apiserverï¼‰ï¼šæä¾›HTTP RESTfulAPIæ¥å£çš„ä¸»è¦æœåŠ¡ï¼Œæ˜¯Kubernetesé‡Œå¯¹æ‰€æœ‰èµ„æºè¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œä¹Ÿæ˜¯é›†ç¾¤æ§åˆ¶çš„å…¥å£è¿›ç¨‹ã€‚ Kubernetes Controller Managerï¼ˆkube-controller-managerï¼‰ï¼šKubernetesé‡Œæ‰€æœ‰èµ„æºå¯¹è±¡çš„è‡ªåŠ¨åŒ–æ§åˆ¶ä¸­å¿ƒï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºèµ„æºå¯¹è±¡çš„\"å¤§æ€»ç®¡\"ã€‚ Kubernetes Schedulerï¼ˆkube-schedulerï¼‰ï¼šè´Ÿè´£èµ„æºè°ƒåº¦ï¼ˆPodè°ƒåº¦ï¼‰çš„è¿›ç¨‹ï¼Œç›¸å½“äºå…¬äº¤å…¬å¸çš„è°ƒåº¦å®¤ã€‚ å¦å¤–ï¼Œåœ¨Masterä¸Šé€šå¸¸è¿˜éœ€è¦éƒ¨ç½²etcdæœåŠ¡ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:1:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Node Kubernetesé›†ç¾¤ä¸­é™¤Masterå¤–çš„å…¶ä»–æœåŠ¡å™¨è¢«ç§°ä¸ºNodeï¼ŒNodeåœ¨è¾ƒæ—©çš„ç‰ˆæœ¬ä¸­ä¹Ÿè¢«ç§°ä¸ºMinionã€‚ä¸Masterä¸€æ ·ï¼ŒNodeå¯ä»¥æ˜¯ä¸€å°ç‰©ç†ä¸»æœºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å°è™šæ‹Ÿæœºã€‚Nodeæ˜¯Kubernetesé›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œæ¯ä¸ªNodeéƒ½ä¼šè¢«Masteråˆ†é…ä¸€äº›å·¥ä½œè´Ÿè½½ï¼ˆDockerå®¹å™¨ï¼‰ï¼Œå½“æŸä¸ªNodeå®•æœºæ—¶ï¼Œå…¶ä¸Šçš„å·¥ä½œè´Ÿè½½ä¼šè¢«Masterè‡ªåŠ¨è½¬ç§»åˆ°å…¶ä»–Nodeä¸Šã€‚ åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œç€ä»¥ä¸‹å…³é”®è¿›ç¨‹ã€‚ kubeletï¼šè´Ÿè´£Podå¯¹åº”å®¹å™¨çš„åˆ›å»ºã€å¯åœç­‰ä»»åŠ¡ï¼ŒåŒæ—¶ä¸Masterå¯†åˆ‡åä½œï¼Œå®ç°é›†ç¾¤ç®¡ç†çš„åŸºæœ¬åŠŸèƒ½ã€‚ kube-proxyï¼šå®ç°Kubernetes Serviceçš„é€šä¿¡ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„æœåŠ¡ã€‚ å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚Dockerï¼‰ï¼šè´Ÿè´£æœ¬æœºçš„å®¹å™¨åˆ›å»ºå’Œç®¡ç†ã€‚Nodeå¯ä»¥åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€å¢åŠ åˆ°Kubernetesé›†ç¾¤ä¸­ï¼Œå‰ææ˜¯åœ¨è¿™ä¸ªNodeä¸Šå·²æ­£ç¡®å®‰è£…ã€é…ç½®å’Œå¯åŠ¨äº†ä¸Šè¿°å…³é”®è¿›ç¨‹ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œkubeletä¼šå‘Masteræ³¨å†Œè‡ªå·±ï¼Œè¿™ä¹Ÿæ˜¯Kubernetesæ¨èçš„Nodeç®¡ç†æ–¹å¼ã€‚ä¸€æ—¦Nodeè¢«çº³å…¥é›†ç¾¤ç®¡ç†èŒƒç•´ï¼Œkubeletè¿›ç¨‹å°±ä¼šå®šæ—¶å‘Masteræ±‡æŠ¥è‡ªèº«çš„æƒ…æŠ¥ï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿã€ä¸»æœºCPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠå½“å‰æœ‰å“ªäº›Podåœ¨è¿è¡Œç­‰ï¼Œè¿™æ ·Masterå°±å¯ä»¥è·çŸ¥æ¯ä¸ªNodeçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶å®ç°é«˜æ•ˆå‡è¡¡çš„èµ„æºè°ƒåº¦ç­–ç•¥ã€‚è€ŒæŸä¸ªNodeåœ¨è¶…è¿‡æŒ‡å®šæ—¶é—´ä¸ä¸ŠæŠ¥ä¿¡æ¯æ—¶ï¼Œä¼šè¢«Masteråˆ¤å®šä¸º\"å¤±è”\"ï¼Œè¯¥Nodeçš„çŠ¶æ€å°±è¢«æ ‡è®°ä¸ºä¸å¯ç”¨ï¼ˆNotReadyï¼‰ï¼ŒMasteréšåä¼šè§¦å‘\"å·¥ä½œè´Ÿè½½å¤§è½¬ç§»\"çš„è‡ªåŠ¨æµç¨‹ã€‚ åº”ç”¨ç±» Kubernetesä¸­å±äºåº”ç”¨ç±»çš„æ¦‚å¿µå’Œç›¸åº”çš„èµ„æºå¯¹è±¡ç±»å‹æœ€å¤šï¼Œæ‰€ä»¥åº”ç”¨ç±»ä¹Ÿæ˜¯éœ€è¦é‡ç‚¹å­¦ä¹ çš„ä¸€ç±»ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:2:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Serviceä¸Pod åº”ç”¨ç±»ç›¸å…³çš„èµ„æºå¯¹è±¡ä¸»è¦æ˜¯å›´ç»•Serviceï¼ˆæœåŠ¡ï¼‰å’ŒPodè¿™ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡å±•å¼€çš„ã€‚ ä¸€èˆ¬è¯´æ¥ï¼ŒServiceæŒ‡çš„æ˜¯æ— çŠ¶æ€æœåŠ¡ï¼Œé€šå¸¸ç”±å¤šä¸ªç¨‹åºå‰¯æœ¬æä¾›æœåŠ¡ï¼Œåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„å•å®ä¾‹æœåŠ¡ï¼Œæ¯”å¦‚MySQLè¿™ç§æ•°æ®å­˜å‚¨ç±»çš„æœåŠ¡ã€‚ä¸æˆ‘ä»¬å¸¸è§„ç†è§£çš„æœåŠ¡ä¸åŒï¼ŒKubernetesé‡Œçš„Serviceå…·æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è™šæ‹ŸClusterIPåœ°å€ï¼ŒServiceä¸€æ—¦è¢«åˆ›å»ºï¼ŒKuberneteså°±ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ†é…ä¸€ä¸ªå¯ç”¨çš„ClusterIPåœ°å€ï¼Œè€Œä¸”åœ¨Serviceçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒçš„ClusterIPåœ°å€éƒ½ä¸ä¼šæ”¹å˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªè™šæ‹ŸIPåœ°å€+æœåŠ¡çš„ç«¯å£ç›´æ¥è®¿é—®è¯¥æœåŠ¡ï¼Œå†é€šè¿‡éƒ¨ç½²Kubernetesé›†ç¾¤çš„DNSæœåŠ¡ï¼Œå°±å¯ä»¥å®ç°Service Nameï¼ˆåŸŸåï¼‰åˆ°ClusterIPåœ°å€çš„DNSæ˜ å°„åŠŸèƒ½ï¼Œæˆ‘ä»¬åªè¦ä½¿ç”¨æœåŠ¡çš„åç§°ï¼ˆDNSåç§°ï¼‰å³å¯å®Œæˆåˆ°ç›®æ ‡æœåŠ¡çš„è®¿é—®è¯·æ±‚ã€‚â€œæœåŠ¡å‘ç°\"è¿™ä¸ªä¼ ç»Ÿæ¶æ„ä¸­çš„æ£˜æ‰‹é—®é¢˜åœ¨è¿™é‡Œé¦–æ¬¡å¾—ä»¥å®Œç¾è§£å†³ï¼ŒåŒæ—¶ï¼Œå‡­å€ŸClusterIPåœ°å€çš„ç‹¬ç‰¹è®¾è®¡ï¼ŒKubernetesè¿›ä¸€æ­¥å®ç°äº†Serviceçš„é€æ˜è´Ÿè½½å‡è¡¡å’Œæ•…éšœè‡ªåŠ¨æ¢å¤çš„é«˜çº§ç‰¹æ€§ã€‚ é€šè¿‡åˆ†æã€è¯†åˆ«å¹¶å»ºæ¨¡ç³»ç»Ÿä¸­çš„æ‰€æœ‰æœåŠ¡ä¸ºå¾®æœåŠ¡â€”â€”Kubernetes Serviceï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæœ€ç»ˆç”±å¤šä¸ªæä¾›ä¸åŒä¸šåŠ¡èƒ½åŠ›è€Œåˆå½¼æ­¤ç‹¬ç«‹çš„å¾®æœåŠ¡å•å…ƒç»„æˆï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡TCP/IPè¿›è¡Œé€šä¿¡ï¼Œä»è€Œå½¢æˆå¼ºå¤§åˆçµæ´»çš„å¼¹æ€§ç½‘æ ¼ï¼Œæ‹¥æœ‰å¼ºå¤§çš„åˆ†å¸ƒå¼èƒ½åŠ›ã€å¼¹æ€§æ‰©å±•èƒ½åŠ›ã€å®¹é”™èƒ½åŠ›ï¼Œç¨‹åºæ¶æ„ä¹Ÿå˜å¾—ç®€å•å’Œç›´è§‚è®¸å¤š ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:3:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Pod ä¸ºä»€ä¹ˆKubernetesä¼šè®¾è®¡å‡ºä¸€ä¸ªå…¨æ–°çš„Podæ¦‚å¿µå¹¶ä¸”Podæœ‰è¿™æ ·ç‰¹æ®Šçš„ç»„æˆç»“æ„ï¼ŸåŸå› å¦‚ä¸‹ã€‚ ä¸ºå¤šè¿›ç¨‹ä¹‹é—´çš„åä½œæä¾›ä¸€ä¸ªæŠ½è±¡æ¨¡å‹ï¼Œä½¿ç”¨Podä½œä¸ºåŸºæœ¬çš„è°ƒåº¦ã€å¤åˆ¶ç­‰ç®¡ç†å·¥ä½œçš„æœ€å°å•ä½ï¼Œè®©å¤šä¸ªåº”ç”¨è¿›ç¨‹èƒ½ä¸€èµ·æœ‰æ•ˆåœ°è°ƒåº¦å’Œä¼¸ç¼©ã€‚ Podé‡Œçš„å¤šä¸ªä¸šåŠ¡å®¹å™¨å…±äº«Pauseå®¹å™¨çš„IPï¼Œå…±äº«Pauseå®¹å™¨æŒ‚æ¥çš„Volumeï¼Œè¿™æ ·æ—¢ç®€åŒ–äº†å¯†åˆ‡å…³è”çš„ä¸šåŠ¡å®¹å™¨ä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼Œä¹Ÿå¾ˆå¥½åœ°è§£å†³äº†å®ƒä»¬ä¹‹é—´çš„æ–‡ä»¶å…±äº«é—®é¢˜ã€‚ Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯å®ç°ï¼Œä¾‹å¦‚Flannelã€OpenvSwitchç­‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç‰¢è®°ä¸€ç‚¹ï¼šåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚ Podå…¶å®æœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„PodåŠé™æ€Podï¼ˆStatic Podï¼‰ã€‚åè€…æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå¹¶æ²¡è¢«å­˜æ”¾åœ¨Kubernetesçš„etcdä¸­ï¼Œè€Œæ˜¯è¢«å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªèƒ½åœ¨æ­¤Nodeä¸Šå¯åŠ¨ã€è¿è¡Œã€‚è€Œæ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«æ”¾å…¥etcdä¸­å­˜å‚¨ï¼Œéšåè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶ç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Podè¢«å¯¹åº”çš„Nodeä¸Šçš„kubeletè¿›ç¨‹å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼Œå¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œå°±ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podéƒ½é‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚ Podã€å®¹å™¨ä¸Nodeçš„å…³ç³» Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»\r","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:4:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Labelä¸æ ‡ç­¾é€‰æ‹©å™¨ Labelï¼ˆæ ‡ç­¾ï¼‰æ˜¯Kubernetesç³»ç»Ÿä¸­çš„å¦ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„\"æ ‡ç­¾â€ã€‚ä¸€ä¸ªLabelæ˜¯ä¸€ä¸ªkey=valueçš„é”®å€¼å¯¹ï¼Œå…¶ä¸­çš„keyä¸valueç”±ç”¨æˆ·è‡ªå·±æŒ‡å®šã€‚Labelå¯ä»¥è¢«é™„åŠ åˆ°å„ç§èµ„æºå¯¹è±¡ä¸Šï¼Œä¾‹å¦‚Nodeã€Podã€Serviceã€Deploymentç­‰ï¼Œä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Labelï¼ŒåŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šã€‚Labelé€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™æŒ‡å®šçš„èµ„æºå¯¹è±¡æ†ç»‘ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„Labelæ¥å®ç°å¤šç»´åº¦çš„èµ„æºåˆ†ç»„ç®¡ç†åŠŸèƒ½ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œï¼Œä¾‹å¦‚ï¼Œéƒ¨ç½²ä¸åŒç‰ˆæœ¬çš„åº”ç”¨åˆ°ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œä»¥åŠç›‘æ§ã€åˆ†æåº”ç”¨ï¼ˆæ—¥å¿—è®°å½•ã€ç›‘æ§ã€å‘Šè­¦ï¼‰ç­‰ã€‚ä¸€äº›å¸¸ç”¨çš„Labelç¤ºä¾‹å¦‚ä¸‹ã€‚ ç‰ˆæœ¬æ ‡ç­¾ï¼šreleaseï¼šstableå’Œreleaseï¼šcanaryã€‚ ç¯å¢ƒæ ‡ç­¾ï¼šenvironmentï¼šdevã€environmentï¼šqaå’Œenvironmentï¼šproductionã€‚ æ¶æ„æ ‡ç­¾ï¼štierï¼šfrontendã€tierï¼šbackendå’Œtierï¼šmiddlewareã€‚ åˆ†åŒºæ ‡ç­¾ï¼špartitionï¼šcustomerAå’Œpartitionï¼šcustomerBã€‚ è´¨é‡ç®¡æ§æ ‡ç­¾ï¼štrackï¼šdailyå’Œtrackï¼šweekly Labelä¹Ÿæ˜¯Podçš„é‡è¦å±æ€§ä¹‹ä¸€ï¼Œå…¶é‡è¦æ€§ä»…æ¬¡äºPodçš„ç«¯å£ï¼Œæˆ‘ä»¬å‡ ä¹è§ä¸åˆ°æ²¡æœ‰Labelçš„Pod Serviceå¾ˆé‡è¦çš„ä¸€ä¸ªå±æ€§å°±æ˜¯æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒæŠŠæ ‡ç­¾é€‰æ‹©å™¨å†™é”™äº†ï¼Œå°±ä¼šå‡ºç°æŒ‡é¹¿ä¸ºé©¬çš„é—¹å‰§ã€‚å¦‚æœæ°å¥½åŒ¹ é…åˆ°äº†å¦ä¸€ç§Podå®ä¾‹ï¼Œè€Œä¸”å¯¹åº”çš„å®¹å™¨ç«¯å£æ°å¥½æ­£ç¡®ï¼ŒæœåŠ¡å¯ä»¥æ­£å¸¸è¿æ¥ï¼Œåˆ™å¾ˆéš¾æ’æŸ¥é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨æœ‰ä¼—å¤šServiceçš„å¤æ‚ç³»ç»Ÿä¸­ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:5:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Podä¸Deployment å‰é¢æåˆ°ï¼Œå¤§éƒ¨åˆ†Serviceéƒ½æ˜¯æ— çŠ¶æ€çš„æœåŠ¡ï¼Œå¯ä»¥ç”±å¤šä¸ªPodå‰¯æœ¬å®ä¾‹æä¾›æœåŠ¡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªServiceå¯¹åº”çš„PodæœåŠ¡å®ä¾‹æ•°é‡éƒ½æ˜¯å›ºå®šçš„ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªåœ°æ‰‹å·¥åˆ›å»ºPodå®ä¾‹ï¼Œå°±å¤ªéº»çƒ¦äº†ï¼Œæœ€å¥½æ˜¯ç”¨æ¨¡æ¿çš„æ€è·¯ï¼Œå³æä¾›ä¸€ä¸ªPodæ¨¡æ¿ï¼ˆTemplateï¼‰ï¼Œç„¶åç”±ç¨‹åºæ ¹æ®æˆ‘ä»¬æŒ‡å®šçš„æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºæŒ‡å®šæ•°é‡çš„Podå®ä¾‹ã€‚è¿™å°±æ˜¯Deploymentè¿™ä¸ªèµ„æºå¯¹è±¡æ‰€è¦å®Œæˆçš„äº‹æƒ…äº†ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:6:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Serviceçš„ClusterIPåœ°å€ æ—¢ç„¶æ¯ä¸ªPodéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå•ç‹¬çš„IPåœ°å€ï¼Œè€Œä¸”æ¯ä¸ªPodéƒ½æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„Endpointï¼ˆPod IP+containerPortï¼‰ä»¥è¢«å®¢æˆ·ç«¯è®¿é—®ï¼Œé‚£ä¹ˆç°åœ¨å¤šä¸ªPodå‰¯æœ¬ç»„æˆäº†ä¸€ä¸ªé›†ç¾¤æ¥æä¾›æœåŠ¡ï¼Œå®¢æˆ·ç«¯å¦‚ä½•è®¿é—®å®ƒä»¬å‘¢ï¼Ÿä¼ ç»Ÿçš„åšæ³•æ˜¯éƒ¨ç½²ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼ˆè½¯ä»¶æˆ–ç¡¬ä»¶ï¼‰ï¼Œä¸ºè¿™ç»„Podå¼€å¯ä¸€ä¸ªå¯¹å¤–çš„æœåŠ¡ç«¯å£å¦‚8000ç«¯å£ï¼Œå¹¶ä¸”å°†è¿™äº›Podçš„Endpointåˆ—è¡¨åŠ å…¥8000ç«¯å£çš„è½¬å‘åˆ—è¡¨ä¸­ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨çš„å¯¹å¤–IPåœ°å€+8000ç«¯å£æ¥è®¿é—®æ­¤æœåŠ¡äº†ã€‚Kubernetesä¹Ÿæ˜¯ç±»ä¼¼çš„åšæ³•ï¼ŒKuberneteså†…éƒ¨åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œäº†ä¸€å¥—å…¨å±€çš„è™šæ‹Ÿè´Ÿè½½å‡è¡¡å™¨ï¼Œè‡ªåŠ¨æ³¨å…¥å¹¶è‡ªåŠ¨å®æ—¶æ›´æ–°é›†ç¾¤ä¸­æ‰€æœ‰Serviceçš„è·¯ç”±è¡¨ï¼Œé€šè¿‡iptablesæˆ–è€…IPVSæœºåˆ¶ï¼ŒæŠŠå¯¹Serviceçš„è¯·æ±‚è½¬å‘åˆ°å…¶åç«¯å¯¹åº”çš„æŸä¸ªPodå®ä¾‹ä¸Šï¼Œå¹¶åœ¨å†…éƒ¨å®ç°æœåŠ¡çš„è´Ÿè½½å‡è¡¡ä¸ä¼šè¯ä¿æŒæœºåˆ¶ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒKubernetesè¿˜é‡‡ç”¨äº†ä¸€ç§å¾ˆå·§å¦™åˆå½±å“æ·±è¿œçš„è®¾è®¡â€”â€”ClusterIPåœ°å€ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒPodçš„Endpointåœ°å€ä¼šéšç€Podçš„é”€æ¯å’Œé‡æ–°åˆ›å»ºè€Œå‘ç”Ÿæ”¹å˜ï¼Œå› ä¸ºæ–°Podçš„IPåœ°å€ä¸ä¹‹å‰æ—§Podçš„ä¸åŒã€‚Serviceä¸€æ—¦è¢«åˆ›å»ºï¼ŒKuberneteså°±ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è™šæ‹ŸIPåœ°å€â€”â€”ClusterIPåœ°å€ï¼Œè€Œä¸”åœ¨Serviceçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œå…¶ClusterIPåœ°å€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªæœåŠ¡å°±å˜æˆäº†å…·å¤‡å”¯ä¸€IPåœ°å€çš„é€šä¿¡èŠ‚ç‚¹ï¼Œè¿œç¨‹æœåŠ¡ä¹‹é—´çš„é€šä¿¡é—®é¢˜å°±å˜æˆäº†åŸºç¡€çš„TCPç½‘ç»œé€šä¿¡é—®é¢˜ã€‚ ä¹‹æ‰€ä»¥è¯´ClusterIPåœ°å€æ˜¯ä¸€ç§è™šæ‹ŸIPåœ°å€ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚ ClusterIPåœ°å€ä»…ä»…ä½œç”¨äºKubernetes Serviceè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ç”±Kubernetesç®¡ç†å’Œåˆ†é…IPåœ°å€ï¼ˆæ¥æºäºClusterIPåœ°å€æ± ï¼‰ï¼Œä¸Nodeå’ŒMasteræ‰€åœ¨çš„ç‰©ç†ç½‘ç»œå®Œå…¨æ— å…³ã€‚ å› ä¸ºæ²¡æœ‰ä¸€ä¸ª\"å®ä½“ç½‘ç»œå¯¹è±¡\"æ¥å“åº”ï¼Œæ‰€ä»¥ClusterIPåœ°å€æ— æ³•è¢«Pingé€šã€‚ClusterIPåœ°å€åªèƒ½ä¸Service Portç»„æˆä¸€ä¸ªå…·ä½“çš„æœåŠ¡è®¿é—®ç«¯ç‚¹ï¼Œå•ç‹¬çš„ClusterIPä¸å…·å¤‡TCP/IPé€šä¿¡çš„åŸºç¡€ã€‚ ClusterIPå±äºKubernetesé›†ç¾¤è¿™ä¸ªå°é—­çš„ç©ºé—´ï¼Œé›†ç¾¤å¤–çš„èŠ‚ç‚¹è¦è®¿é—®è¿™ä¸ªé€šä¿¡ç«¯å£ï¼Œåˆ™éœ€è¦åšä¸€äº›é¢å¤–çš„å·¥ä½œ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:7:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"Serviceçš„å¤–ç½‘è®¿é—®é—®é¢˜ å‰é¢æåˆ°ï¼ŒæœåŠ¡çš„ClusterIPåœ°å€åœ¨Kubernetesé›†ç¾¤å†…æ‰èƒ½è¢«è®¿é—®ï¼Œé‚£ä¹ˆå¦‚ä½•è®©é›†ç¾¤å¤–çš„åº”ç”¨è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„é—®é¢˜ã€‚è¦å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜çš„è§£å†³æ€è·¯å’Œè§£å†³æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼„æ˜ç™½ Kubernetesçš„ä¸‰ç§IPï¼Œè¿™ä¸‰ç§IPåˆ†åˆ«å¦‚ä¸‹ã€‚ Node IPï¼šNodeçš„IPåœ°å€ã€‚ Pod IPï¼šPodçš„IPåœ°å€ã€‚ Service IPï¼šServiceçš„IPåœ°å€ã€‚ é¦–å…ˆï¼ŒNode IPæ˜¯Kubernetesé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ç‰©ç†ç½‘å¡çš„IPåœ°å€ï¼Œæ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„ç‰©ç†ç½‘ç»œï¼Œæ‰€æœ‰å±äºè¿™ä¸ªç½‘ç»œçš„æœåŠ¡å™¨éƒ½èƒ½é€šè¿‡è¿™ä¸ªç½‘ç»œç›´æ¥é€šä¿¡ï¼Œä¸ç®¡å…¶ä¸­æ˜¯å¦æœ‰éƒ¨åˆ†èŠ‚ç‚¹ä¸å±äºè¿™ä¸ªKubernetesé›†ç¾¤ã€‚è¿™ä¹Ÿè¡¨æ˜Kubernetesé›†ç¾¤ä¹‹å¤–çš„èŠ‚ç‚¹è®¿é—®Kubernetesé›†ç¾¤å†…çš„æŸä¸ªèŠ‚ç‚¹æˆ–è€…TCP/IPæœåŠ¡æ—¶ï¼Œéƒ½å¿…é¡»é€šè¿‡Node IPé€šä¿¡ã€‚ å…¶æ¬¡ï¼ŒPod IPæ˜¯æ¯ä¸ªPodçš„IPåœ°å€ï¼Œåœ¨ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨æ”¯æŒå¼•æ“çš„æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯Docker Engineæ ¹æ®docker0ç½‘æ¡¥çš„IPåœ°å€æ®µè¿›è¡Œåˆ†é…çš„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè™šæ‹ŸäºŒå±‚ç½‘ç»œã€‚å‰é¢è¯´è¿‡ï¼ŒKubernetesè¦æ±‚ä½äºä¸åŒNodeä¸Šçš„Podéƒ½èƒ½å¤Ÿå½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œæ‰€ä»¥Kubernetesä¸­ä¸€ä¸ªPodé‡Œçš„å®¹å™¨è®¿é—®å¦å¤–ä¸€ä¸ªPodé‡Œçš„å®¹å™¨æ—¶ï¼Œå°±æ˜¯é€šè¿‡Pod IPæ‰€åœ¨çš„è™šæ‹ŸäºŒå±‚ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ï¼Œè€ŒçœŸå®çš„TCP/IPæµé‡æ˜¯é€šè¿‡Node IPæ‰€åœ¨çš„ç‰©ç†ç½‘å¡æµå‡ºçš„ã€‚ åœ¨Kubernetesé›†ç¾¤å†…ï¼ŒServiceçš„ClusterIPåœ°å€å±äºé›†ç¾¤å†…çš„åœ°å€ï¼Œæ— æ³•åœ¨é›†ç¾¤å¤–ç›´æ¥ä½¿ç”¨è¿™ä¸ªåœ°å€ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒKubernetesé¦–å…ˆå¼•å…¥äº†NodePortè¿™ä¸ªæ¦‚å¿µï¼ŒNodePortä¹Ÿæ˜¯è§£å†³é›†ç¾¤å¤–çš„åº”ç”¨è®¿é—®é›†ç¾¤å†…æœåŠ¡çš„ç›´æ¥ã€æœ‰æ•ˆçš„å¸¸è§åšæ³• NodePortçš„å®ç°æ–¹å¼æ˜¯ï¼Œåœ¨Kubernetesé›†ç¾¤çš„æ¯ä¸ªNodeä¸Šéƒ½ä¸ºéœ€è¦å¤–éƒ¨è®¿é—®çš„Serviceå¼€å¯ä¸€ä¸ªå¯¹åº”çš„TCPç›‘å¬ç«¯å£ï¼Œå¤–éƒ¨ç³»ç»Ÿåªè¦ç”¨ä»»æ„ä¸€ä¸ªNodeçš„IPåœ°å€+NodePortç«¯å£å·å³å¯è®¿é—®æ­¤æœåŠ¡ï¼Œåœ¨ä»»æ„Nodeä¸Šè¿è¡Œnetstatå‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°æœ‰NodePortç«¯å£è¢«ç›‘å¬ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:8:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"NodePort å­˜åœ¨çš„ä¸€é—®é¢˜å¼•å‡ºäº†Ingresså¯¹è±¡ NodePortçš„ç¡®åŠŸèƒ½å¼ºå¤§ä¸”é€šç”¨æ€§å¼ºï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³æ¯ä¸ªServiceéƒ½éœ€è¦åœ¨Nodeä¸Šç‹¬å ä¸€ä¸ªç«¯å£ï¼Œè€Œç«¯å£åˆæ˜¯æœ‰é™çš„ç‰©ç†èµ„æºï¼Œé‚£èƒ½ä¸èƒ½è®©å¤šä¸ªServiceå…±ç”¨ä¸€ä¸ªå¯¹å¤–ç«¯å£å‘¢ï¼Ÿè¿™å°±æ˜¯åæ¥å¢åŠ çš„Ingressèµ„æºå¯¹è±¡æ‰€è¦è§£å†³çš„é—®é¢˜ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠIngressçš„å®ç°æœºåˆ¶ç†è§£ä¸ºåŸºäºNginxçš„æ”¯æŒè™šæ‹Ÿä¸»æœºçš„HTTPä»£ç†ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:9:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"æœ‰çŠ¶æ€çš„åº”ç”¨é›†ç¾¤ æˆ‘ä»¬çŸ¥é“ï¼ŒDeploymentå¯¹è±¡æ˜¯ç”¨æ¥å®ç°æ— çŠ¶æ€æœåŠ¡çš„å¤šå‰¯æœ¬è‡ªåŠ¨æ§åˆ¶åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œæ¯”å¦‚ZooKeeperé›†ç¾¤ã€MySQLé«˜å¯ç”¨é›†ç¾¤ï¼ˆ3èŠ‚ç‚¹é›†ç¾¤ï¼‰ã€Kafkaé›†ç¾¤ç­‰æ˜¯æ€ä¹ˆå®ç°è‡ªåŠ¨éƒ¨ç½²å’Œç®¡ç†çš„å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å°±å¤æ‚å¤šäº†ï¼Œè¿™äº›ä¸€å¼€å§‹æ˜¯ä¾èµ–StatefulSetè§£å†³çš„ï¼Œä½†åæ¥å‘ç°å¯¹äºä¸€äº›å¤æ‚çš„æœ‰çŠ¶æ€çš„é›†ç¾¤åº”ç”¨æ¥è¯´ï¼ŒStatefulSetè¿˜æ˜¯ä¸å¤Ÿé€šç”¨å’Œå¼ºå¤§ï¼Œæ‰€ä»¥åé¢åˆå‡ºç°äº†Kubernetes Operatorã€‚ æˆ‘ä»¬å…ˆè¯´è¯´StatefulSetã€‚StatefulSetä¹‹å‰æ›¾ç”¨è¿‡PetSetè¿™ä¸ªåç§°ï¼Œå¾ˆå¤šäººéƒ½çŸ¥é“ï¼Œåœ¨ITä¸–ç•Œé‡Œï¼Œæœ‰çŠ¶æ€çš„åº”ç”¨è¢«ç±»æ¯”ä¸ºå® ç‰©ï¼ˆPetï¼‰ï¼Œæ— çŠ¶æ€çš„åº”ç”¨åˆ™è¢«ç±»æ¯”ä¸ºç‰›ç¾Šï¼Œæ¯ä¸ªå® ç‰©åœ¨ä¸»äººé‚£é‡Œéƒ½æ˜¯\"å”¯ä¸€çš„å­˜åœ¨\"ï¼Œå® ç‰©ç”Ÿç—…äº†ï¼Œæˆ‘ä»¬æ˜¯è¦èŠ±å¾ˆå¤šé’±å»æ²»ç–—çš„ï¼Œéœ€è¦æˆ‘ä»¬ç”¨å¿ƒç…§æ–™ï¼Œè€Œæ— å·®åˆ«çš„ç‰›ç¾Šåˆ™æ²¡æœ‰è¿™ä¸ªå¾…é‡ã€‚æ€»ç»“ä¸‹æ¥ï¼Œåœ¨æœ‰çŠ¶æ€é›†ç¾¤ä¸­ä¸€èˆ¬æœ‰å¦‚ä¸‹ç‰¹æ®Šå…±æ€§ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å›ºå®šçš„èº«ä»½IDï¼Œé€šè¿‡è¿™ä¸ªIDï¼Œé›†ç¾¤ä¸­çš„æˆå‘˜å¯ä»¥ç›¸äº’å‘ç°å¹¶é€šä¿¡ã€‚ é›†ç¾¤çš„è§„æ¨¡æ˜¯æ¯”è¾ƒå›ºå®šçš„ï¼Œé›†ç¾¤è§„æ¨¡ä¸èƒ½éšæ„å˜åŠ¨ã€‚ é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼Œé€šå¸¸ä¼šæŒä¹…åŒ–æ•°æ®åˆ°æ°¸ä¹…å­˜å‚¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨é‡å¯åéƒ½éœ€è¦ä½¿ç”¨åŸæœ‰çš„æŒä¹…åŒ–æ•°æ®ã€‚ é›†ç¾¤ä¸­æˆå‘˜èŠ‚ç‚¹çš„å¯åŠ¨é¡ºåºï¼ˆä»¥åŠå…³é—­é¡ºåºï¼‰é€šå¸¸ä¹Ÿæ˜¯ç¡®å®šçš„ã€‚ å¦‚æœç£ç›˜æŸåï¼Œåˆ™é›†ç¾¤é‡Œçš„æŸä¸ªèŠ‚ç‚¹æ— æ³•æ­£å¸¸è¿è¡Œï¼Œé›†ç¾¤åŠŸèƒ½å—æŸ StatefulSetä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå¯è¢«çœ‹ä½œDeployment/RCçš„ä¸€ä¸ªç‰¹æ®Šå˜ç§ï¼Œå®ƒæœ‰å¦‚ä¸‹ç‰¹æ€§ã€‚ StatefulSeté‡Œçš„æ¯ä¸ªPodéƒ½æœ‰ç¨³å®šã€å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ï¼Œå¯ä»¥ç”¨æ¥å‘ç°é›†ç¾¤å†…çš„å…¶ä»–æˆå‘˜ã€‚å‡è®¾StatefulSetçš„åç§°ä¸ºkafkaï¼Œé‚£ä¹ˆç¬¬1ä¸ªPodå«kafka-0ï¼Œç¬¬2ä¸ªå«kafka-1ï¼Œä»¥æ­¤ç±»æ¨ã€‚ StatefulSetæ§åˆ¶çš„Podå‰¯æœ¬çš„å¯åœé¡ºåºæ˜¯å—æ§çš„ï¼Œæ“ä½œç¬¬nä¸ªPodæ—¶ï¼Œå‰n-1ä¸ªPodå·²ç»æ˜¯è¿è¡Œä¸”å‡†å¤‡å¥½çš„çŠ¶æ€ã€‚ StatefulSeté‡Œçš„Podé‡‡ç”¨ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨å·ï¼Œé€šè¿‡PVæˆ–PVCæ¥å®ç°ï¼Œåˆ é™¤Podæ—¶é»˜è®¤ä¸ä¼šåˆ é™¤ä¸StatefulSetç›¸å…³çš„å­˜å‚¨å·ï¼ˆä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼‰ã€‚ StatefulSeté™¤äº†è¦ä¸PVå·æ†ç»‘ä½¿ç”¨ï¼Œä»¥å­˜å‚¨Podçš„çŠ¶æ€æ•°æ®ï¼Œè¿˜è¦ä¸Headless Serviceé…åˆä½¿ç”¨ï¼Œå³åœ¨æ¯ä¸ªStatefulSetå®šä¹‰ä¸­éƒ½è¦å£°æ˜å®ƒå±äºå“ªä¸ªHeadless Serviceã€‚StatefulSetåœ¨Headless Serviceçš„åŸºç¡€ä¸Šåˆä¸ºStatefulSetæ§åˆ¶çš„æ¯ä¸ªPodå®ä¾‹éƒ½åˆ›å»ºäº†ä¸€ä¸ªDNSåŸŸåï¼Œè¿™ä¸ªåŸŸåçš„æ ¼å¼ å¦‚ä¸‹ï¼š ${podname}.${headless service name} StatefulSetçš„å»ºæ¨¡èƒ½åŠ›æœ‰é™ï¼Œé¢å¯¹å¤æ‚çš„æœ‰çŠ¶æ€é›†ç¾¤æ—¶æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥å°±æœ‰äº†åæ¥çš„Kubernetes Operatoræ¡†æ¶å’Œä¼—å¤šçš„Operatorå®ç°äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒKubernetes Operatoræ¡†æ¶å¹¶ä¸æ˜¯é¢å‘æ™®é€šç”¨æˆ·çš„ï¼Œè€Œæ˜¯é¢å‘Kuberneteså¹³å°å¼€å‘è€…çš„ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:10:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"æ‰¹å¤„ç†åº”ç”¨ é™¤äº†æ— çŠ¶æ€æœåŠ¡ã€æœ‰çŠ¶æ€é›†ç¾¤ã€å¸¸è§çš„ç¬¬ä¸‰ç§åº”ç”¨ï¼Œè¿˜æœ‰æ‰¹å¤„ç†åº”ç”¨ã€‚æ‰¹å¤„ç†åº”ç”¨çš„ç‰¹ç‚¹æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å¤„ç†ä¸€ç»„æ•°æ®ï¼ˆå›¾åƒã€æ–‡ä»¶ã€è§†é¢‘ç­‰ï¼‰ï¼Œåœ¨è¿™ç»„æ•°æ®éƒ½å¤„ç†å®Œæˆåï¼Œæ‰¹å¤„ç†ä»»åŠ¡è‡ªåŠ¨ç»“æŸã€‚ä¸ºäº†æ”¯æŒè¿™ç±»åº”ç”¨ï¼ŒKuberneteså¼•å…¥äº†æ–°çš„èµ„æºå¯¹è±¡â€”â€”Jobã€‚ Jobsæ§åˆ¶å™¨æä¾›äº†ä¸¤ä¸ªæ§åˆ¶å¹¶å‘æ•°çš„å‚æ•°ï¼šcompletionså’Œparallelismï¼Œcompletionsè¡¨ç¤ºéœ€è¦è¿è¡Œä»»åŠ¡æ•°çš„æ€»æ•°ï¼Œparallelismè¡¨ç¤ºå¹¶å‘è¿è¡Œçš„ä¸ªæ•°ï¼Œä¾‹å¦‚è®¾ç½®parallelismä¸º1ï¼Œåˆ™ä¼šä¾æ¬¡è¿è¡Œä»»åŠ¡ï¼Œåœ¨å‰é¢çš„ä»»åŠ¡è¿è¡Œåå†è¿è¡Œåé¢çš„ä»»åŠ¡ã€‚Jobæ‰€æ§åˆ¶çš„Podå‰¯æœ¬æ˜¯çŸ­æš‚è¿è¡Œçš„ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºä¸€ç»„å®¹å™¨ï¼Œå…¶ä¸­çš„æ¯ä¸ªå®¹å™¨éƒ½ä»…è¿è¡Œä¸€æ¬¡ã€‚å½“Jobæ§åˆ¶çš„æ‰€æœ‰Podå‰¯æœ¬éƒ½è¿è¡Œç»“æŸæ—¶ï¼Œå¯¹åº”çš„Jobä¹Ÿå°±ç»“æŸäº†ã€‚Jobåœ¨å®ç°æ–¹å¼ä¸Šä¸Deploymentç­‰å‰¯æœ¬æ§åˆ¶å™¨ä¸åŒï¼ŒJobç”Ÿæˆçš„Podå‰¯æœ¬æ˜¯ä¸èƒ½è‡ªåŠ¨é‡å¯çš„ï¼Œå¯¹åº”Podå‰¯æœ¬çš„restartPolicyéƒ½è¢«è®¾ç½®ä¸ºNeverï¼Œå› æ­¤ï¼Œå½“å¯¹åº”çš„Podå‰¯æœ¬éƒ½æ‰§è¡Œå®Œæˆæ—¶ï¼Œç›¸åº”çš„Jobä¹Ÿå°±å®Œæˆäº†æ§åˆ¶ä½¿å‘½ã€‚åæ¥ï¼ŒKuberneteså¢åŠ äº†CronJobï¼Œå¯ä»¥å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:11:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"åº”ç”¨çš„é…ç½®é—®é¢˜ é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬åˆæ­¥ç†è§£äº†ä¸‰ç§åº”ç”¨å»ºæ¨¡çš„èµ„æºå¯¹è±¡ï¼Œæ€»ç»“å¦‚ä¸‹ã€‚ æ— çŠ¶æ€æœåŠ¡çš„å»ºæ¨¡ï¼šDeploymentã€‚ æœ‰çŠ¶æ€é›†ç¾¤çš„å»ºæ¨¡ï¼šStatefulSetã€‚ æ‰¹å¤„ç†åº”ç”¨çš„å»ºæ¨¡ï¼šJobã€‚ åœ¨è¿›è¡Œåº”ç”¨å»ºæ¨¡æ—¶ï¼Œåº”è¯¥å¦‚ä½•è§£å†³åº”ç”¨éœ€è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä¿®æ”¹é…ç½®çš„é—®é¢˜å‘¢ï¼Ÿè¿™å°±æ¶‰åŠConfigMapå’ŒSecretä¸¤ä¸ªå¯¹è±¡ã€‚ ConfigMapé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¿å­˜é…ç½®é¡¹ï¼ˆkey=valueï¼‰çš„ä¸€ä¸ªMapï¼Œå¦‚æœä½ åªæ˜¯æŠŠå®ƒç†è§£ä¸ºç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ä¸ªMapï¼Œé‚£å°±å¤§é”™ç‰¹é”™äº†ã€‚ConfigMapæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­\"é…ç½®ä¸­å¿ƒ\"çš„ç‹¬ç‰¹å®ç°ä¹‹ä¸€ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå‡ ä¹æ‰€æœ‰åº”ç”¨éƒ½éœ€è¦ä¸€ä¸ªé™æ€çš„é…ç½®æ–‡ä»¶æ¥æä¾›å¯åŠ¨å‚æ•°ï¼Œå½“è¿™ä¸ªåº”ç”¨æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨ï¼Œæœ‰å¤šä¸ªå‰¯æœ¬éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šæ—¶ï¼Œé…ç½®æ–‡ä»¶çš„åˆ†å‘å°±æˆä¸ºä¸€ä¸ªè®©äººå¤´ç–¼çš„é—®é¢˜ï¼Œæ‰€ä»¥å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªé…ç½®ä¸­å¿ƒç»„ä»¶ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†é…ç½®ä¸­å¿ƒé€šå¸¸ä¼šå¼•å…¥æ–°çš„APIï¼Œä»è€Œå¯¼è‡´åº”ç”¨çš„è€¦åˆå’Œä¾µå…¥ã€‚ ç”¨æˆ·å°†é…ç½®æ–‡ä»¶çš„å†…å®¹ä¿å­˜åˆ°ConfigMapä¸­ï¼Œæ–‡ä»¶åå¯ä½œä¸ºkeyï¼Œvalueå°±æ˜¯æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå¤šä¸ªé…ç½®æ–‡ä»¶éƒ½å¯è¢«æ”¾å…¥åŒä¸€ä¸ªConfigMapã€‚ åœ¨å»ºæ¨¡ç”¨æˆ·åº”ç”¨æ—¶ï¼Œåœ¨Podé‡Œå°†ConfigMapå®šä¹‰ä¸ºç‰¹æ®Šçš„Volumeè¿›è¡ŒæŒ‚è½½ã€‚åœ¨Podè¢«è°ƒåº¦åˆ°æŸä¸ªå…·ä½“Nodeä¸Šæ—¶ï¼ŒConfigMapé‡Œçš„é…ç½®æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨è¿˜åŸåˆ°æœ¬åœ°ç›®å½•ä¸‹ï¼Œç„¶åæ˜ å°„åˆ°Podé‡ŒæŒ‡å®šçš„é…ç½®ç›®å½•ä¸‹ï¼Œè¿™æ ·ç”¨æˆ·çš„ç¨‹åºå°±å¯ä»¥æ— æ„ŸçŸ¥åœ°è¯»å–é…ç½®äº†ã€‚ åœ¨ConfigMapçš„å†…å®¹å‘ç”Ÿä¿®æ”¹åï¼ŒKubernetesä¼šè‡ªåŠ¨é‡æ–°è·å–ConfigMapçš„å†…å®¹ï¼Œå¹¶åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šæ›´æ–°å¯¹åº”çš„æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥è¯´è¯´Secretã€‚Secretä¹Ÿç”¨äºè§£å†³åº”ç”¨é…ç½®çš„é—®é¢˜ï¼Œä¸è¿‡å®ƒè§£å†³çš„æ˜¯å¯¹æ•æ„Ÿä¿¡æ¯çš„é…ç½®é—®é¢˜ï¼Œæ¯”å¦‚æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€åº”ç”¨çš„æ•°å­—è¯ä¹¦ã€Tokenã€SSHå¯†é’¥åŠå…¶ä»–éœ€è¦ä¿å¯†çš„æ•æ„Ÿé…ç½®ã€‚å¯¹äºè¿™ç±»æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªSecretå¯¹è±¡ï¼Œç„¶åè¢«Podå¼•ç”¨ã€‚Secretä¸­çš„æ•°æ®è¦æ±‚ä»¥BASE64ç¼–ç æ ¼å¼å­˜æ”¾ã€‚æ³¨æ„ï¼ŒBASE64ç¼–ç å¹¶ä¸æ˜¯åŠ å¯†çš„ï¼Œåœ¨Kubernetes 1.7ç‰ˆæœ¬ä»¥åï¼ŒSecretä¸­çš„æ•°æ®æ‰å¯ä»¥ä»¥åŠ å¯†çš„å½¢å¼è¿›è¡Œä¿å­˜ï¼Œæ›´åŠ å®‰å…¨ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:12:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"åº”ç”¨çš„è¿ç»´é—®é¢˜ æœ€åè¯´è¯´ä¸åº”ç”¨çš„è‡ªåŠ¨è¿ç»´ç›¸å…³çš„å‡ ä¸ªé‡è¦å¯¹è±¡ã€‚ é¦–å…ˆå°±æ˜¯HPAï¼ˆHorizontal Pod Autoscalerï¼‰ï¼Œå¦‚æœæˆ‘ä»¬ç”¨Deploymentæ¥æ§åˆ¶Podçš„å‰¯æœ¬æ•°é‡ï¼Œåˆ™å¯ä»¥é€šè¿‡æ‰‹å·¥è¿è¡Œkubectl scaleå‘½ä»¤æ¥å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ã€‚å¦‚æœä»…ä»…åˆ°æ­¤ä¸ºæ­¢ï¼Œåˆ™æ˜¾ç„¶ä¸ç¬¦åˆè°·æ­Œå¯¹Kubernetesçš„å®šä½ç›®æ ‡â€”â€”è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚åœ¨è°·æ­Œçœ‹æ¥ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¦èƒ½å¤Ÿæ ¹æ®å½“å‰è´Ÿè½½çš„å˜åŒ–è‡ªåŠ¨è§¦å‘æ°´å¹³æ‰©å®¹æˆ–ç¼©å®¹ï¼Œå› ä¸ºè¿™ä¸€è¿‡ç¨‹å¯èƒ½æ˜¯é¢‘ç¹å‘ç”Ÿã€ä¸å¯é¢„æ–™çš„ï¼Œæ‰€ä»¥é‡‡ç”¨æ‰‹åŠ¨æ§åˆ¶çš„æ–¹å¼æ˜¯ä¸ç°å®çš„ï¼Œå› æ­¤å°±æœ‰äº†åæ¥çš„HPAè¿™ä¸ªé«˜çº§åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥å°†HPAç†è§£ä¸ºPodæ¨ªå‘è‡ªåŠ¨æ‰©å®¹ï¼Œå³è‡ªåŠ¨æ§åˆ¶Podæ•°é‡çš„å¢åŠ æˆ–å‡å°‘ã€‚é€šè¿‡è¿½è¸ªåˆ†ææŒ‡å®šDeploymentæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦æœ‰é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°é‡ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚Kuberneteså†…ç½®äº†åŸºäºPodçš„CPUåˆ©ç”¨ç‡è¿›è¡Œè‡ªåŠ¨æ‰©ç¼©å®¹çš„æœºåˆ¶ï¼Œåº”ç”¨å¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡å¦‚æ¯ç§’è¯·æ±‚æ•°ï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„HPAåŠŸèƒ½ã€‚ å­˜å‚¨ç±» å­˜å‚¨ç±»çš„èµ„æºå¯¹è±¡ä¸»è¦åŒ…æ‹¬Volumeã€Persistent Volumeã€PVCå’ŒStorageClassã€‚ é¦–å…ˆçœ‹çœ‹åŸºç¡€çš„å­˜å‚¨ç±»èµ„æºå¯¹è±¡â€”â€”Volumeï¼ˆå­˜å‚¨å·ï¼‰ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ã€‚Kubernetesä¸­çš„Volumeæ¦‚å¿µã€ç”¨é€”å’Œç›®çš„ä¸Dockerä¸­çš„Volumeæ¯”è¾ƒç±»ä¼¼ï¼Œä½†äºŒè€…ä¸èƒ½ç­‰ä»·ã€‚é¦–å…ˆï¼ŒKubernetesä¸­çš„Volumeè¢«å®šä¹‰åœ¨Podä¸Šï¼Œè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼›å…¶æ¬¡ï¼ŒKubernetesä¸­çš„Volumeä¸Podçš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œä½†ä¸å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸ç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼›æœ€åï¼ŒKubernetesæ”¯æŒå¤šç§ç±»å‹çš„Volumeï¼Œä¾‹å¦‚GlusterFSã€Cephç­‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚Volumeçš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…ˆåœ¨Podä¸Šå£°æ˜ä¸€ä¸ªVolumeï¼Œç„¶ååœ¨å®¹å™¨é‡Œå¼•ç”¨è¯¥Volumeå¹¶å°†å…¶æŒ‚è½½ï¼ˆMountï¼‰åˆ°å®¹å™¨é‡Œçš„æŸä¸ªç›®å½•ä¸‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥æˆ‘ä»¬è¦ç»™ä¹‹å‰çš„Tomcat Podå¢åŠ ä¸€ä¸ªåä¸ºdatavolçš„Volumeï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ°å®¹å™¨çš„æŸä¸ªè·¯å¾„/mydata-dataç›®å½•ä¸‹ï¼Œåˆ™åªå¯¹Podçš„å®šä¹‰æ–‡ä»¶åšä¸‹ä¿®æ­£å³å¯ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:13:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"emptyDir ä¸€ä¸ªemptyDiræ˜¯åœ¨Podåˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ã€‚ä»å®ƒçš„åç§°å°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºè¿™æ˜¯Kubernetesè‡ªåŠ¨åˆ†é…çš„ä¸€ä¸ªç›®å½•ï¼Œå½“Podä»Nodeä¸Šç§»é™¤æ—¶ï¼ŒemptyDirä¸­çš„æ•°æ®ä¹Ÿè¢«æ°¸ä¹…ç§»é™¤ã€‚emptyDirçš„ä¸€äº›ç”¨é€”å¦‚ä¸‹ã€‚ ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ã€‚ é•¿æ—¶é—´ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶ç›®å½•ã€‚ ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒemptyDirä½¿ç”¨çš„æ˜¯èŠ‚ç‚¹çš„å­˜å‚¨ä»‹è´¨ï¼Œä¾‹å¦‚ç£ç›˜æˆ–è€…ç½‘ç»œå­˜å‚¨ã€‚è¿˜å¯ä»¥ä½¿ç”¨emptyDir.mediumå±æ€§ï¼ŒæŠŠè¿™ä¸ªå±æ€§è®¾ç½®ä¸º\"Memory\"ï¼Œå°±å¯ä»¥ä½¿ç”¨æ›´å¿«çš„åŸºäºå†…å­˜çš„åç«¯å­˜å‚¨äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸‹çš„emptyDirä½¿ç”¨çš„å†…å­˜ä¼šè¢«è®¡å…¥å®¹å™¨çš„å†…å­˜æ¶ˆè€—ï¼Œå°†å—åˆ°èµ„æºé™åˆ¶å’Œé…é¢æœºåˆ¶çš„ç®¡ç†ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:14:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"hostPath hostPathä¸ºåœ¨Podä¸ŠæŒ‚è½½å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œé€šå¸¸å¯ä»¥ç”¨äºä»¥ä¸‹å‡ æ–¹é¢ã€‚ åœ¨å®¹å™¨åº”ç”¨ç¨‹åºç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶éœ€è¦æ°¸ä¹…ä¿å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„é«˜é€Ÿæ–‡ä»¶ç³»ç»Ÿå¯¹å…¶è¿›è¡Œå­˜å‚¨ã€‚ éœ€è¦è®¿é—®å®¿ä¸»æœºä¸ŠDockerå¼•æ“å†…éƒ¨æ•°æ®ç»“æ„çš„å®¹å™¨åº”ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰hostPathä¸ºå®¿ä¸»æœº/var/lib/dockerç›®å½•ï¼Œä½¿å®¹å™¨å†…éƒ¨çš„åº”ç”¨å¯ä»¥ç›´æ¥è®¿é—®Dockerçš„æ–‡ä»¶ç³»ç»Ÿã€‚ åœ¨ä½¿ç”¨è¿™ç§ç±»å‹çš„Volumeæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚ åœ¨ä¸åŒçš„Nodeä¸Šå…·æœ‰ç›¸åŒé…ç½®çš„Podï¼Œå¯èƒ½ä¼šå› ä¸ºå®¿ä¸»æœºä¸Šçš„ç›®å½•å’Œæ–‡ä»¶ä¸åŒï¼Œè€Œå¯¼è‡´å¯¹Volumeä¸Šç›®å½•å’Œæ–‡ä»¶çš„è®¿é—®ç»“æœä¸ä¸€è‡´ã€‚ å¦‚æœä½¿ç”¨äº†èµ„æºé…é¢ç®¡ç†ï¼Œåˆ™Kubernetesæ— æ³•å°†hostPathåœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨çš„èµ„æºçº³å…¥ç®¡ç†ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:15:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"å…¬æœ‰äº‘Volume å…¬æœ‰äº‘æä¾›çš„Volumeç±»å‹åŒ…æ‹¬è°·æ­Œå…¬æœ‰äº‘æä¾›çš„GCEPersistentDiskã€äºšé©¬é€Šå…¬æœ‰äº‘æä¾›çš„AWS Elastic Block Storeï¼ˆEBSVolumeï¼‰ç­‰ã€‚å½“æˆ‘ä»¬çš„Kubernetesé›†ç¾¤è¿è¡Œåœ¨å…¬æœ‰äº‘ä¸Šæˆ–è€…ä½¿ç”¨å…¬æœ‰äº‘å‚å®¶æä¾›çš„Kubernetesé›†ç¾¤æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç±»Volumeã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:16:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Kubernetes"],"content":"å…¶ä»–ç±»å‹çš„Volume iscsiï¼šå°†iSCSIå­˜å‚¨è®¾å¤‡ä¸Šçš„ç›®å½•æŒ‚è½½åˆ°Podä¸­ã€‚ nfsï¼šå°†NFS Serverä¸Šçš„ç›®å½•æŒ‚è½½åˆ°Podä¸­ã€‚ glusterfsï¼šå°†å¼€æºGlusterFSç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æŒ‚è½½åˆ°Podä¸­ã€‚ rbdï¼šå°†Cephå—è®¾å¤‡å…±äº«å­˜å‚¨ï¼ˆRados Block Deviceï¼‰æŒ‚è½½åˆ°Podä¸­ã€‚ gitRepoï¼šé€šè¿‡æŒ‚è½½ä¸€ä¸ªç©ºç›®å½•ï¼Œå¹¶ä»Gitåº“å…‹éš†ï¼ˆcloneï¼‰ä¸€ä¸ªgit repositoryä»¥ä¾›Podä½¿ç”¨ã€‚ configmapï¼šå°†é…ç½®æ•°æ®æŒ‚è½½ä¸ºå®¹å™¨å†…çš„æ–‡ä»¶ã€‚ secretï¼šå°†Secretæ•°æ®æŒ‚è½½ä¸ºå®¹å™¨å†…çš„æ–‡ä»¶ã€‚ å®‰å…¨ç±» å®‰å…¨å§‹ç»ˆæ˜¯Kuberneteså‘å±•è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå…³é”®é¢†åŸŸã€‚ ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒKuberneteså¯è¢«çœ‹ä½œä¸€ä¸ªå¤šç”¨æˆ·å…±äº«èµ„æºçš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œè¿™é‡Œçš„èµ„æºä¸»è¦æ˜¯å„ç§Kubernetesé‡Œçš„å„ç±»èµ„æºå¯¹è±¡ï¼Œæ¯”å¦‚Podã€Serviceã€Deploymentç­‰ã€‚åªæœ‰é€šè¿‡è®¤è¯çš„ç”¨æˆ·æ‰èƒ½é€šè¿‡Kubernetesçš„API ServeræŸ¥è¯¢ã€åˆ›å»ºåŠç»´æŠ¤ç›¸åº”çš„èµ„æºå¯¹è±¡ï¼Œç†è§£è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚ Kubernetesé‡Œçš„ç”¨æˆ·æœ‰ä¸¤ç±»ï¼šæˆ‘ä»¬å¼€å‘çš„è¿è¡Œåœ¨Podé‡Œçš„åº”ç”¨ï¼›æ™®é€šç”¨æˆ·ï¼Œå¦‚å…¸å‹çš„kubectlå‘½ä»¤è¡Œå·¥å…·ï¼ŒåŸºæœ¬ä¸Šç”±æŒ‡å®šçš„è¿ç»´äººå‘˜ï¼ˆé›†ç¾¤ç®¡ç†å‘˜ï¼‰ä½¿ç”¨ã€‚åœ¨æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¼€å‘çš„Podåº”ç”¨éœ€è¦é€šè¿‡API ServeræŸ¥è¯¢ã€åˆ›å»ºåŠç®¡ç†å…¶ä»–ç›¸å…³èµ„æºå¯¹è±¡ï¼Œæ‰€ä»¥è¿™ç±»ç”¨æˆ·æ‰æ˜¯Kubernetesçš„å…³é”®ç”¨æˆ·ã€‚ä¸ºæ­¤ï¼ŒKubernetesè®¾è®¡äº†Service Accountè¿™ä¸ªç‰¹æ®Šçš„èµ„æºå¯¹è±¡ï¼Œä»£è¡¨Podåº”ç”¨çš„è´¦å·ï¼Œä¸ºPodæä¾›å¿…è¦çš„èº«ä»½è®¤è¯ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒKubernetesè¿›ä¸€æ­¥å®ç°å’Œå®Œå–„äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æƒé™ç³»ç»Ÿâ€”â€”RBACï¼ˆRole-Based Access Controlï¼‰ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetesåœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­éƒ½ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„åç§°ä¸ºdefaultçš„Service Accountï¼Œå› æ­¤Service Accountæ˜¯ä¸èƒ½å…¨å±€ä½¿ç”¨çš„ï¼Œåªèƒ½è¢«å®ƒæ‰€åœ¨å‘½åç©ºé—´ä¸­çš„Podä½¿ç”¨ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹é›†ç¾¤ä¸­çš„æ‰€æœ‰Service Accountï¼š sudo kubectl get sa -A Service Accountæ˜¯é€šè¿‡Secretæ¥ä¿å­˜å¯¹åº”çš„ç”¨æˆ·ï¼ˆåº”ç”¨ï¼‰èº«ä»½å‡­è¯çš„ï¼Œè¿™äº›å‡­è¯ä¿¡æ¯æœ‰CAæ ¹è¯ä¹¦æ•°æ®ï¼ˆca.crtï¼‰å’Œç­¾ååçš„Tokenä¿¡æ¯ï¼ˆTokenï¼‰ã€‚åœ¨Tokenä¿¡æ¯ä¸­å°±åŒ…æ‹¬äº†å¯¹åº”çš„Service Accountçš„åç§°ï¼Œå› æ­¤API Serveré€šè¿‡æ¥æ”¶åˆ°çš„Tokenä¿¡æ¯å°±èƒ½ç¡®å®šService Accountçš„èº«ä»½ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·åˆ›å»ºä¸€ä¸ªPodæ—¶ï¼ŒPodä¼šç»‘å®šå¯¹åº”å‘½åç©ºé—´ä¸­çš„defaultè¿™ä¸ªService Accountä½œä¸ºå…¶\"å…¬æ°‘èº«ä»½è¯\"ã€‚å½“Podé‡Œçš„å®¹å™¨è¢«åˆ›å»ºæ—¶ï¼ŒKubernetesä¼šæŠŠå¯¹åº”çš„Secretå¯¹è±¡ä¸­çš„èº«ä»½ä¿¡æ¯ï¼ˆca.crtã€Tokenç­‰ï¼‰æŒä¹…åŒ–ä¿å­˜åˆ°å®¹å™¨é‡Œå›ºå®šä½ç½®çš„æœ¬åœ°æ–‡ä»¶ä¸­ï¼Œå› æ­¤å½“å®¹å™¨é‡Œçš„ç”¨æˆ·è¿›ç¨‹é€šè¿‡Kubernetesæä¾›çš„å®¢æˆ·ç«¯APIå»è®¿é—®API Serveræ—¶ï¼Œè¿™äº›APIä¼šè‡ªåŠ¨è¯»å–è¿™äº›èº«ä»½ä¿¡æ¯æ–‡ä»¶ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°HTTPSè¯·æ±‚ä¸­ä¼ é€’ç»™API Serverä»¥å®Œæˆèº«ä»½è®¤è¯é€»è¾‘ã€‚åœ¨èº«ä»½è®¤è¯é€šè¿‡ä»¥åï¼Œå°±æ¶‰åŠ\"è®¿é—®æˆæƒ\"çš„é—®é¢˜ï¼Œè¿™å°±æ˜¯RBACè¦è§£å†³çš„é—®é¢˜äº†ã€‚ é¦–å…ˆæˆ‘ä»¬è¦å­¦ä¹ çš„æ˜¯Roleè¿™ä¸ªèµ„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬Roleä¸ClusterRoleä¸¤ç§ç±»å‹çš„è§’è‰²ã€‚è§’è‰²å®šä¹‰äº†ä¸€ç»„ç‰¹å®šæƒé™çš„è§„åˆ™ï¼Œæ¯”å¦‚å¯ä»¥æ“ä½œæŸç±»èµ„æºå¯¹è±¡ã€‚å±€é™äºæŸä¸ªå‘½åç©ºé—´çš„è§’è‰²ç”±Roleå¯¹è±¡å®šä¹‰ï¼Œä½œç”¨äºæ•´ä¸ªKubernetesé›†ç¾¤èŒƒå›´å†…çš„è§’è‰²åˆ™é€šè¿‡ClusterRoleå¯¹è±¡å®šä¹‰ã€‚ åœ¨RoleBindingä¸­ä½¿ç”¨subjectsï¼ˆç›®æ ‡ä¸»ä½“ï¼‰æ¥è¡¨ç¤ºè¦æˆæƒçš„å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥æˆæƒä¸‰ç±»ç›®æ ‡è´¦å·ï¼šGroupï¼ˆç”¨æˆ·ç»„ï¼‰ã€Userï¼ˆæŸä¸ªå…·ä½“ç”¨æˆ·ï¼‰å’ŒService Accountï¼ˆPodåº”ç”¨æ‰€ä½¿ç”¨çš„è´¦å·ï¼‰ã€‚ åœ¨å®‰å…¨é¢†åŸŸï¼Œé™¤äº†ä»¥ä¸Šé’ˆå¯¹API Serverè®¿é—®å®‰å…¨ç›¸å…³çš„èµ„æºå¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„èµ„æºå¯¹è±¡â€”â€”NetworkPolicyï¼ˆç½‘ç»œç­–ç•¥ï¼‰ï¼Œå®ƒæ˜¯ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æºå¯¹è±¡ï¼Œç”¨äºè§£å†³ç”¨æˆ·åº”ç”¨ä¹‹é—´çš„ç½‘ç»œéš”ç¦»å’Œæˆæƒé—®é¢˜ã€‚NetworkPolicyæ˜¯ä¸€ç§å…³äºPodé—´ç›¸äº’é€šä¿¡ï¼Œä»¥åŠPodä¸å…¶ä»–ç½‘ç»œç«¯ç‚¹é—´ç›¸äº’é€šä¿¡çš„å®‰å…¨è§„åˆ™è®¾å®šã€‚ NetworkPolicyèµ„æºä½¿ç”¨æ ‡ç­¾é€‰æ‹©Podï¼Œå¹¶å®šä¹‰é€‰å®šPodæ‰€å…è®¸çš„é€šä¿¡è§„åˆ™ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒPodé—´åŠPodä¸å…¶ä»–ç½‘ç»œç«¯ç‚¹é—´çš„è®¿é—®æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œè¿™å‡è®¾äº†Kubernetesé›†ç¾¤è¢«ä¸€ä¸ªå‚å•†ï¼ˆå…¬å¸/ç§Ÿæˆ·ï¼‰ç‹¬å ï¼Œå…¶ä¸­éƒ¨ç½²çš„åº”ç”¨éƒ½æ˜¯ç›¸äº’å¯ä¿¡çš„ï¼Œæ— é¡»ç›¸äº’é˜²èŒƒã€‚ä½†æ˜¯ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªå‚å•†å…±åŒä½¿ç”¨ä¸€ä¸ªKubernetesé›†ç¾¤çš„æƒ…å†µï¼Œåˆ™ç‰¹åˆ«æ˜¯åœ¨å…¬æœ‰äº‘ç¯å¢ƒä¸­ï¼Œä¸åŒå‚å•†çš„åº”ç”¨è¦ç›¸äº’éš”ç¦»ä»¥å¢åŠ å®‰å…¨æ€§ï¼Œè¿™å°±å¯ä»¥é€šè¿‡NetworkPolicyæ¥å®ç°äº†ã€‚ ","date":"2021-06-13","objectID":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/:17:0","tags":["Kubernetes"],"title":"Kubernetesçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­","uri":"/kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E6%9C%AF%E8%AF%AD/"},{"categories":["Influxdb"],"content":"InfluxDB åŸºç¡€äº†è§£ ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:1:0","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Influxdb"],"content":"ä»‹ç» ä¸€ä¸ªå¼€æºçš„æ—¶é—´åºåˆ—æ•°æ®åº“ ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:1:1","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Influxdb"],"content":"ç‰¹æ€§ 1ã€å†…ç½®HTTP-API,æ— éœ€ç¼–å†™æœåŠ¡ç«¯ä»£ç æ¥å¯åŠ¨å’Œè¿è¡Œã€‚ 2ã€æ•°æ®å¯ä»¥è¢«æ ‡è®°ï¼Œå…è®¸éå¸¸çµæ´»çš„æŸ¥è¯¢ 3ã€ç±»ä¼¼SQLä¸€æ ·çš„æŸ¥è¯¢è¯­è¨€ 4ã€ç®€å•çš„å®‰è£…å’Œç®¡ç†ï¼Œ å¿«é€Ÿçš„è·å–å’Œè¾“å‡ºæ•°æ® 5ã€å®ƒçš„ç›®æ ‡æ˜¯ç¬¦åˆå®æ—¶æŸ¥è¯¢ï¼Œ è¿™æ„å‘³ç€æ¯ä¸€ä¸ªæ•°æ®ç‚¹éƒ½ä¼šè¢«ç´¢å¼•ï¼Œå¹¶ä¸”å¯ä»¥ç«‹å³åœ¨å°äº100msçš„æŸ¥è¯¢ä¸­è·å¾— docker åˆ›å»ºå®¹å™¨å®ä¾‹ docker run --name=cm2-influxdb -d -p 8530:8083 -p 8586:8086 \\ -v /opt/influxdata:/var/lib/influxdb \\ -m 10g \\ --restart=always \\ influxdb:1.8 ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:1:2","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Influxdb"],"content":"é…ç½®é‰´æƒ ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:2:0","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Influxdb"],"content":"æ·»åŠ é‰´æƒé…ç½® [http] enabled = true bind-address = \":8086\" auth-enabled = true log-enabled = true ping-auth-enabled = true é‡å¯influxdbæœåŠ¡ æœªæ·»åŠ é‰´æƒ $ curl -G http://172.16.24.220:8586/query --data-urlencode \"q=SHOW DATABASES\" {\"results\":[{\"statement_id\":0,\"series\":[{\"name\":\"databases\",\"columns\":[\"name\"],\"values\":[[\"host_metrics\"],[\"vnf_metrics\"],[\"events\"],[\"alarm\"],[\"custom_metrics\"],[\"_internal\"],[\"k8s_metrics\"],[\"mw_metrics\"],[\"bss_metrics\"],[\"application_metrics\"],[\"oss_metrics\"],[\"itracing_metrics\"],[\"prometheus_metrics\"],[\"dcm_metrics\"]]}]}]} æ·»åŠ é‰´æƒæœªåˆ›å»ºç”¨æˆ·,æç¤ºéœ€è¦åˆ›å»ºé‰´æƒç”¨æˆ·æˆ–è€…å…³é—­é‰´æƒ curl -G http://172.16.17.82:8586/query --data-urlencode \"q=SHOW DATABASES\" [lushuan@220 nms-influxdb]$ curl -G http://172.16.24.220:8586/query --data-urlencode \"q=SHOW DATABASES\" {\"error\":\"error authorizing query: create admin user first or disable authentication\"} ç™»å½•influxdb å®¹å™¨åˆ›å»ºç”¨æˆ· docker exec -it cm2-influxdb sh \u003e influx \u003e CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES å†æ¬¡æµ‹è¯• $ curl -G http://172.16.24.220:8586/query -u admin:abc@123A --data-urlencode \"q=SHOW DATABASES\" {\"results\":[{\"statement_id\":0,\"series\":[{\"name\":\"databases\",\"columns\":[\"name\"],\"values\":[[\"host_metrics\"],[\"vnf_metrics\"],[\"events\"],[\"alarm\"],[\"custom_metrics\"],[\"_internal\"],[\"k8s_metrics\"],[\"mw_metrics\"],[\"bss_metrics\"],[\"application_metrics\"],[\"oss_metrics\"],[\"itracing_metrics\"],[\"prometheus_metrics\"],[\"dcm_metrics\"]]}]}]} ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:2:1","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Influxdb"],"content":"å‚è€ƒ influxdb å®˜ç½‘ ","date":"2021-05-28","objectID":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/:3:0","tags":["Influxdb"],"title":"Influxdb æ·»åŠ é‰´æƒ","uri":"/influxdb-%E9%85%8D%E7%BD%AE%E9%89%B4%E6%9D%83/"},{"categories":["Kubernetes"],"content":"èƒŒæ™¯ é€šè¿‡ kubeadm å®‰è£…k8s v1.20 é›†ç¾¤æŠ¥é”™ æ“ä½œç³»ç»Ÿç¯å¢ƒä¿¡æ¯ $ cat /etc/os-release NAME=\"Ubuntu\" VERSION=\"18.04.5 LTS (Bionic Beaver)\" ID=ubuntu ID_LIKE=debian PRETTY_NAME=\"Ubuntu 18.04.5 LTS\" VERSION_ID=\"18.04\" HOME_URL=\"https://www.ubuntu.com/\" SUPPORT_URL=\"https://help.ubuntu.com/\" BUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\" PRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\" VERSION_CODENAME=bionic UBUNTU_CODENAME=bionic kubeadm init å®‰è£…æŠ¥é”™ä¿¡æ¯ [kubelet-check] It seems like the kubelet isn't running or healthy. [kubelet-check] The HTTP call equal to 'curl -sSL http://localhost:10248/healthz' failed with error: Get \"http://localhost:10248/healthz\": dial tcp 127.0.0.1:10248: connect: connection refused. [kubelet-check] The HTTP call equal to 'curl -sSL http://localhost:10248/healthz' failed with error: Get \"http://localhost:10248/healthz\": dial tcp 127.0.0.1:10248: connect: connection refused. Unfortunately, an error has occurred: timed out waiting for the condition This error is likely caused by: - The kubelet is not running - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled) If you are on a systemd-powered system, you can try to troubleshoot the error with the following commands: - 'systemctl status kubelet' - 'journalctl -xeu kubelet' Additionally, a control plane component may have crashed or exited when started by the container runtime. To troubleshoot, list all containers using your preferred container runtimes CLI. Here is one example how you may list all Kubernetes containers running in docker: - 'docker ps -a | grep kube | grep -v pause' Once you have found the failing container, you can inspect its logs with: - 'docker logs CONTAINERID' ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:1:0","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kubernetes"],"content":"æ’æŸ¥æ€è·¯ æŸ¥çœ‹å®˜ç½‘ä»‹ç»ä¸º docker å’Œ kubelet æœåŠ¡ä¸­çš„ cgroup é©±åŠ¨ä¸ä¸€è‡´ï¼Œæœ‰ä¸¤ç§æ–¹æ³• æ–¹å¼ä¸€ï¼šé©±åŠ¨å‘ docker çœ‹é½ æ–¹å¼äºŒï¼šé©±åŠ¨ä¸ºå‘ kubelet çœ‹é½ å¦‚æœdocker ä¸æ–¹ä¾¿é‡å¯åˆ™ç»Ÿä¸€å‘ kubeletçœ‹é½ï¼Œå¹¶é‡å¯å¯¹åº”çš„æœåŠ¡å³å¯ ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:2:0","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kubernetes"],"content":"è§£å†³æ–¹å¼ ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:3:0","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kubernetes"],"content":"docker é…ç½®æ–‡ä»¶ è¿™é‡Œé‡‡å–çš„æ˜¯æ–¹å¼äºŒï¼Œdocker é»˜è®¤é©±åŠ¨ä¸º cgroupfs ,åªéœ€è¦æ·»åŠ  \"exec-opts\": [ \"native.cgroupdriver=systemd\" ], ä¿®æ”¹åé…ç½®æ–‡ä»¶ $ cat /etc/docker/daemon.json { \"exec-opts\": [ \"native.cgroupdriver=systemd\" ], \"bip\":\"172.12.0.1/24\", \"registry-mirrors\": [ \"http://docker-registry-mirror.kodekloud.com\" ] } é‡å¯docker systemctl restart docker ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:3:1","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kubernetes"],"content":"kublete é…ç½®æ–‡ä»¶ grep æˆªå–ä¸€ä¸‹,å¯ä»¥çœ‹å¾—å‡ºæ¥kubeleté»˜è®¤ cgoup é©±åŠ¨ä¸ºsystemd $ cat /var/lib/kubelet/config.yaml |grep group cgroupDriver: systemd é‡å¯kubelet ï¼ˆoptionalï¼‰ systemctl restart kubelet ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:3:2","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kubernetes"],"content":"å‚è€ƒ é…ç½®cgroupé©±åŠ¨ Dockerä¸­çš„Cgroup Driver:Cgroupfs ä¸ Systemd ä¸ºä»€ä¹ˆè¦ä¿®æ”¹dockerçš„cgroup driver ","date":"2021-05-28","objectID":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/:4:0","tags":["Kubernetesæ’éšœ"],"title":"Kubeadm å®‰è£…k8sé›†ç¾¤æŠ¥é”™æç¤º kubelet æœªè¿è¡Œ","uri":"/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BAkubelet%E6%9C%AA%E8%BF%90%E8%A1%8C/"},{"categories":["Kafka"],"content":"kafka ç®€ä»‹ Kafka è¢«ç§°ä¸ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯éè¥åˆ©æ€§ç»„ç»‡ASF(Apache Software Foundationï¼Œç®€ç§°ä¸ºASF)åŸºé‡‘ä¼šä¸­çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚HTTP Serverã€Hadoopã€ActiveMQã€Tomcatç­‰å¼€æºè½¯ä»¶éƒ½å±äºApacheåŸºé‡‘ä¼šçš„å¼€æºè½¯ä»¶ï¼Œç±»ä¼¼çš„æ¶ˆæ¯ç³»ç»Ÿè¿˜æœ‰RbbitMQã€ActiveMQã€ZeroMQï¼Œæœ€ä¸»è¦çš„ä¼˜åŠ¿æ˜¯å…¶å…·å¤‡åˆ†å¸ƒå¼åŠŸèƒ½ã€å¹¶ä¸”ç»“åˆzookeeperå¯ä»¥å®ç°åŠ¨æ€æ‰©å®¹ã€‚ kafka ç«å“æ¯”è¾ƒ\r","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:1:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"åå­—çš„ç”±æ¥ kafkaçš„è¯ç”Ÿï¼Œæ˜¯ä¸ºäº†è§£å†³linkedinçš„æ•°æ®ç®¡é“é—®é¢˜ï¼Œèµ·åˆlinkediné‡‡ç”¨äº†ActiveMQæ¥è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå¤§çº¦æ˜¯åœ¨2010å¹´å‰åï¼Œé‚£æ—¶çš„ActiveMQè¿˜è¿œè¿œæ— æ³•æ»¡è¶³linkedinå¯¹æ•°æ®ä¼ é€’ç³»ç»Ÿçš„è¦æ±‚ï¼Œç»å¸¸ç”±äºå„ç§ç¼ºé™·è€Œå¯¼è‡´æ¶ˆæ¯é˜»å¡æˆ–è€…æœåŠ¡æ— æ³•æ­£å¸¸è®¿é—®ï¼Œä¸ºäº†èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œlinkedinå†³å®šç ”å‘è‡ªå·±çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå½“æ—¶linkedinçš„é¦–å¸­æ¶æ„å¸ˆjay krepsä¾¿å¼€å§‹ç»„ç»‡å›¢é˜Ÿè¿›è¡Œæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„ç ”å‘ï¼›ç”±äºjay krepséå¸¸å–œæ¬¢franz kafka,å¹¶ä¸”è§‰å¾—kafkaè¿™ä¸ªåå­—å¾ˆé…·ï¼Œå› æ­¤å–äº†ä¸ªå’Œæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿå®Œå…¨ä¸ç›¸å¹²çš„åç§°kafkaï¼Œè¯¥åå­—å¹¶æ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:1:1","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Kafkaé€‚åˆä»€ä¹ˆæ ·çš„åœºæ™¯? å®ƒå¯ä»¥ç”¨äºä¸¤å¤§ç±»åˆ«çš„åº”ç”¨: æ„é€ å®æ—¶æµæ•°æ®ç®¡é“ï¼Œå®ƒå¯ä»¥åœ¨ç³»ç»Ÿæˆ–åº”ç”¨ä¹‹é—´å¯é åœ°è·å–æ•°æ®ã€‚ (ç›¸å½“äºmessage queue) æ„å»ºå®æ—¶æµå¼åº”ç”¨ç¨‹åºï¼Œå¯¹è¿™äº›æµæ•°æ®è¿›è¡Œè½¬æ¢æˆ–è€…å½±å“ã€‚ (å°±æ˜¯æµå¤„ç†ï¼Œé€šè¿‡kafka stream topicå’Œtopicä¹‹é—´å†…éƒ¨è¿›è¡Œå˜åŒ–) ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:1:2","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"kafka ä¼˜åŠ¿ ååé‡é«˜ï¼Œæ€§èƒ½å¥½ ä¼¸ç¼©æ€§å¥½ï¼Œæ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±• å®¹é”™æ€§å’Œå¯é æ€§ ä¸å¤§æ•°æ®ç”Ÿæ€ç´§å¯†ç»“åˆï¼Œå¯æ— ç¼å¯¹æ¥hadoopã€stream,sparkç­‰ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:1:3","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"å‘è¡Œç‰ˆæœ¬ Confluent Platform Cloudera kafka åå¤§æ•°æ®è§£å†³æ–¹æ¡ˆ hortonworks kafka åå¤§æ•°æ®è§£å†³æ–¹æ¡ˆ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:1:4","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"æ¶ˆæ¯æ¨¡å‹ JMS è§„èŒƒ é˜Ÿåˆ—-ç‚¹å¯¹ç‚¹ ä¸»é¢˜-å‘å¸ƒè®¢é˜… Apache ActiveMQ AMQP(åè®®) AMQPæ¨¡å‹ é˜Ÿåˆ— ä¿¡ç®± ç»‘å®š ç‰¹ç‚¹ï¼šæ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ä¸€è‡´æ€§é«˜ï¼Œå¤šç”¨äºé“¶è¡Œï¼Œé‡‘èè¡Œä¸š Pivotal RabbitMQ Spring AMQPä¸Spring JMS MQTT ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:2:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Kafkaä¸­çš„ç›¸å…³æ¦‚å¿µ åœ¨Kafkaé›†ç¾¤(Cluster)ä¸­ï¼Œä¸€ä¸ªKafkaèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªBrokerï¼Œæ¶ˆæ¯ç”±Topicæ¥æ‰¿è½½ï¼Œå¯ä»¥å­˜å‚¨åœ¨1ä¸ªæˆ–å¤šä¸ªPartitionä¸­ã€‚å‘å¸ƒæ¶ˆæ¯çš„åº”ç”¨ä¸ºProducerã€æ¶ˆè´¹æ¶ˆæ¯çš„åº”ç”¨ä¸ºConsumerï¼Œå¤šä¸ªConsumerå¯ä»¥ä¿ƒæˆConsumer Groupå…±åŒæ¶ˆè´¹ä¸€ä¸ªTopicä¸­çš„æ¶ˆæ¯ã€‚ æ¦‚å¿µ/å¯¹è±¡ ç®€å•è¯´æ˜ Broker KafkaèŠ‚ç‚¹ Topic ä¸»é¢˜ï¼Œç”¨æ¥æ‰¿è½½æ¶ˆæ¯ Partition åˆ†åŒºï¼Œç”¨äºä¸»é¢˜åˆ†ç‰‡å­˜å‚¨ Producer ç”Ÿäº§è€…ï¼Œå‘ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯çš„åº”ç”¨ Consumer æ¶ˆè´¹è€…ï¼Œä»ä¸»é¢˜è®¢é˜…æ¶ˆæ¯çš„åº”ç”¨ Consumer Group æ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆ kafka-concepts\rä¸Šå›¾ä¸­åŒ…å«äº†2ä¸ªProducerï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œä¸€ä¸ªTopicï¼ˆä¸»é¢˜ï¼‰ï¼Œ3ä¸ªPartitionï¼ˆåˆ†åŒºï¼‰ï¼Œ3ä¸ªReplicaï¼ˆå‰¯æœ¬ï¼‰ï¼Œ3ä¸ªBrokerï¼ˆKafkaå®ä¾‹æˆ–èŠ‚ç‚¹ï¼‰ï¼Œä¸€ä¸ªConsumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰ï¼Œå…¶ä¸­åŒ…å«3ä¸ªConsumerï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™äº›æ¦‚å¿µã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Producerï¼ˆç”Ÿäº§è€…ï¼‰ ç”Ÿäº§è€…ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”Ÿäº§ä¸œè¥¿çš„ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ï¼Œç”Ÿäº§è€…æ¯å‘é€ä¸€ä¸ªæ¡æ¶ˆæ¯å¿…é¡»æœ‰ä¸€ä¸ªTopicï¼ˆä¸»é¢˜ï¼‰ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ¶ˆæ¯çš„ç±»åˆ«ï¼Œç”Ÿäº§è€…æºæºä¸æ–­çš„å‘kafkaæœåŠ¡å™¨å‘é€æ¶ˆæ¯ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:1","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Topicï¼ˆä¸»é¢˜ï¼‰ æ¯ä¸€ä¸ªå‘é€åˆ°Kafkaçš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªä¸»é¢˜ï¼Œä¹Ÿå¯å«åšä¸€ä¸ªç±»åˆ«ï¼Œç±»ä¼¼æˆ‘ä»¬ä¼ ç»Ÿæ•°æ®åº“ä¸­çš„è¡¨åä¸€æ ·ï¼Œæ¯”å¦‚è¯´å‘é€ä¸€ä¸ªä¸»é¢˜ä¸ºorderçš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªorderä¸‹è¾¹å°±ä¼šæœ‰å¤šæ¡å…³äºè®¢å•çš„æ¶ˆæ¯ï¼Œåªä¸è¿‡kafkaç§°ä¹‹ä¸ºä¸»é¢˜ï¼Œéƒ½æ˜¯ä¸€æ ·çš„é“ç†ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:2","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Partitionï¼ˆåˆ†åŒºï¼‰ ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯æ•°æ®Topicä¼šè¢«å­˜å‚¨åœ¨åˆ†åŒºä¸­ï¼Œè¿™ä¸ªåˆ†åŒºçš„æ¦‚å¿µå’ŒElasticSearchä¸­åˆ†ç‰‡çš„æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯æƒ³æŠŠæ•°æ®åˆ†æˆå¤šä¸ªå—ï¼Œå¥½è¾¾åˆ°æˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡ï¼Œåˆç†çš„æŠŠæ¶ˆæ¯åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†åŒºä¸Šï¼Œåˆ†åŒºæ˜¯è¢«åˆ†åœ¨ä¸åŒçš„Brokerä¸Šä¹Ÿå°±æ˜¯æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬å¤§é‡çš„æ¶ˆæ¯å°±å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚æ¯ä¸ªTopicå¯ä»¥æŒ‡å®šå¤šä¸ªåˆ†åŒºï¼Œä½†æ˜¯è‡³å°‘æŒ‡å®šä¸€ä¸ªåˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ï¼Œä¸åŒåˆ†åŒºé—´çš„æ•°æ®ä¸ä¿è¯æœ‰åºæ€§ã€‚å› ä¸ºå¦‚æœæœ‰äº†å¤šä¸ªåˆ†åŒºï¼Œæ¶ˆè´¹æ•°æ®çš„æ—¶å€™è‚¯å®šæ˜¯å„ä¸ªåˆ†åŒºç‹¬ç«‹å¼€å§‹çš„ï¼Œæœ‰çš„æ¶ˆè´¹å¾—æ…¢ï¼Œæœ‰çš„æ¶ˆè´¹å¾—å¿«è‚¯å®šå°±ä¸èƒ½ä¿è¯é¡ºåºäº†ã€‚é‚£ä¹ˆå½“éœ€è¦ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªåˆ†åŒºï¼Œåªè¦ä¸€ä¸ªåˆ†åŒºçš„æ—¶å€™å°±åªèƒ½æ¶ˆè´¹è¿™ä¸ªä¸€ä¸ªåˆ†åŒºï¼Œé‚£è‡ªç„¶å°±ä¿è¯æœ‰åºäº†ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:3","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Replicaï¼ˆå‰¯æœ¬ï¼‰ å‰¯æœ¬å°±æ˜¯åˆ†åŒºä¸­æ•°æ®çš„å¤‡ä»½ï¼Œæ˜¯Kafkaä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±æˆ–è€…æœåŠ¡å™¨å®•æœºé‡‡å–çš„ä¿æŠ¤æ•°æ®å®Œæ•´æ€§çš„æªæ–½ï¼Œä¸€èˆ¬çš„æ•°æ®å­˜å‚¨è½¯ä»¶éƒ½åº”è¯¥ä¼šæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚å‡å¦‚æˆ‘ä»¬æœ‰3ä¸ªåˆ†åŒºï¼Œç”±äºä¸åŒåˆ†åŒºä¸­å­˜æ”¾çš„æ˜¯éƒ¨åˆ†æ•°æ®ï¼Œæ‰€ä»¥ä¸ºäº†å…¨éƒ¨æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¤‡ä»½æ‰€æœ‰åˆ†åŒºã€‚è¿™æ—¶å€™æˆ‘ä»¬çš„ä¸€ä»½å‰¯æœ¬å°±åŒ…æ‹¬3ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºä¸­æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸¤ä»½å‰¯æœ¬å°±åŒ…å«6ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªåˆ†åŒºä¸¤ä»½å‰¯æœ¬ã€‚Kafkaåšäº†å‰¯æœ¬ä¹‹ååŒæ ·çš„ä¼šæŠŠå‰¯æœ¬åˆ†åŒºæ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¿è¯è´Ÿè½½å‡è¡¡ã€‚è®²åˆ°è¿™æˆ‘ä»¬å°±å¯ä»¥çœ‹è§ï¼Œè¿™æ ¹æœ¬å°±æ˜¯ä¼ ç»Ÿæ•°æ®åº“ä¸­çš„ä¸»ä»å¤åˆ¶çš„åŠŸèƒ½ï¼Œæ²¡é”™ï¼ŒKafkaä¼šæ‰¾ä¸€ä¸ªåˆ†åŒºä½œä¸ºä¸»åˆ†åŒºï¼ˆleaderï¼‰æ¥æ§åˆ¶æ¶ˆæ¯çš„è¯»å†™ï¼Œå…¶ä»–çš„ï¼ˆå‰¯æœ¬ï¼‰éƒ½æ˜¯ä»åˆ†åŒºï¼ˆfollowerï¼‰ï¼Œè¿™æ ·çš„è¯è¯»å†™å¯ä»¥é€šè¿‡leaderæ¥æ§åˆ¶ï¼Œç„¶ååŒæ­¥åˆ°å‰¯æœ¬ä¸Šå»ï¼Œä¿è¯çš„æ•°æ®çš„å®Œæ•´æ€§ã€‚å¦‚æœæœ‰æŸäº›æœåŠ¡å™¨å®•æœºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‰¯æœ¬æ¢å¤æ•°æ®ï¼Œä¹Ÿå¯ä»¥æš‚æ—¶ç”¨å‰¯æœ¬ä¸­çš„æ•°æ®æ¥ä½¿ç”¨ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:4","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Brokerï¼ˆå®ä¾‹æˆ–èŠ‚ç‚¹ï¼‰ è¿™ä¸ªå°±å¥½è¯´äº†ï¼Œæ„æ€å°±æ˜¯Kafkaçš„å®ä¾‹ï¼Œå¯åŠ¨ä¸€ä¸ªKafkaå°±æ˜¯ä¸€ä¸ªBrokerï¼Œå¤šä¸ªBrokderæ„æˆä¸€ä¸ªKafkaé›†ç¾¤ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼çš„ä½“ç°ï¼ŒæœåŠ¡å™¨å¤šäº†è‡ªç„¶ååç‡æ•ˆç‡å•¥çš„éƒ½ä¸Šæ¥äº†ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:5","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰å’Œ Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ Consumeæ¶ˆè´¹è€…æ¥è¯»å–Kafkaä¸­çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ¶ˆè´¹ä»»ä½•Topicçš„æ•°æ®ï¼Œå¤šä¸ªConsumeç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œä¸€èˆ¬çš„ä¸€ä¸ªæ¶ˆè´¹è€…å¿…é¡»æœ‰ä¸€ä¸ªç»„ï¼ˆGroupï¼‰åï¼Œå¦‚æœæ²¡æœ‰çš„è¯ä¼šè¢«åˆ†ä¸€ä¸ªé»˜è®¤çš„ç»„åã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:3:6","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"kafka é›†ç¾¤æ¶æ„ Kafkaæ˜¯ä½œä¸ºä¸€ä¸ªé›†ç¾¤å»ºç«‹å’Œè¿è¡Œçš„â€”â€”ä¸€ç»„æœåŠ¡å™¨æˆ–ä»£ç†ç®¡ç†ä¸¤ç§ç±»å‹çš„å®¢æˆ·ç«¯ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…(ä¸€èˆ¬Pub/Subæœ¯è¯­ä¸­çš„å‘å¸ƒè€…å’Œè®¢é˜…è€…)ä¹‹é—´çš„é€šä¿¡ã€‚ æ ¹æ®ç¡¬ä»¶ç‰¹æ€§çš„ä¸åŒï¼Œå³ä½¿ä¸€ä¸ªbrokerä»£ç†ä¹Ÿè¶³ä»¥å½¢æˆä¸€ä¸ªæ¯ç§’å¤„ç†æ•°ä¸‡ç”šè‡³æ•°åä¸‡ä¸ªäº‹ä»¶çš„é›†ç¾¤ã€‚ä½†æ˜¯ä¸ºäº†è·å¾—é«˜å¯ç”¨æ€§å’Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå»ºè®®è‡³å°‘è®¾ç½®ä¸‰ä¸ªbrokerä»£ç†ã€‚ Kafka-cluster-architecture\ré›†ç¾¤æ¶æ„å’Œç›¸å…³é‡è¦ç»„ä»¶ Kafka-cluster-architecture-v2\ré›†ç¾¤ä¸­çš„ä¸€ä¸ªä»£ç†è¢«è‡ªåŠ¨é€‰ä¸ºæ§åˆ¶å™¨ã€‚å®ƒè´Ÿè´£è¯¸å¦‚æ•…éšœç›‘è§†ä¹‹ç±»çš„ç®¡ç†ä»»åŠ¡ã€‚ä¸ºäº†åè°ƒé›†ç¾¤å†…çš„ä»£ç†ï¼ŒKafkaä½¿ç”¨äº†ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡â€”â€”Apache ZooKeeperã€‚ Kafka-cluster-architecture\rä¸Šå›¾è¯¥kafkaé›†ç¾¤A,è¯¥é›†ç¾¤æœ‰8ä¸ªå®ä¾‹brokerèŠ‚ç‚¹ï¼Œé›†ç¾¤ä¸­çš„ä¸»é¢˜æœ‰8ä¸ªåˆ†åŒº(p0-p7),å‰¯æœ¬å› å­æ˜¯3ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä»½æ•°æ®å­˜3ä»½ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰1ä¸ªleader å’Œ2ä¸ªfollwer,ä»¥ç¬¬ä¸€ä¸ªbrokerä¸ºä¾‹ï¼Œè¯¥broker æœ‰3ä¸ªåˆ†åŒºï¼Œp1 åˆ†åŒºä¸ºleader,p1åˆ†åŒºä¸Šçš„æ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½æ˜¯ç”±è¿™ä¸ªbroker è¿›è¡Œå¤„ç†çš„ï¼Œp0å’Œp2 åˆ†åŒºæ˜¯follwer,å› æ­¤è¯¥broker åªè´Ÿè´£p0å’Œp2 ä»p1 ä¸­åŒæ­¥æ•°æ®ï¼Œè€Œä¸å¤„ç†è¿™ä¸¤ä¸ªfollwer åˆ†åŒºçš„è¯»å†™è¯·æ±‚ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:4:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"ç¯å¢ƒæ­å»º-æœ¬åœ°ä¼ªåˆ†å¸ƒå¼å®‰è£… ä¸€å°ä¸»æœºéƒ¨ç½²3ä¸ªbrokerçš„ä¼ªåˆ†å¸ƒå¼é›†ç¾¤å®ä¾‹æ¼”ç¤ºï¼Œæ¼”ç¤ºç‰ˆæœ¬ä¸º kafka_2.12-2.1.0,ä¸‹è½½åœ°å€ï¼ŒKafkaå¯åŠ¨æ–¹å¼æœ‰Zookeeperå’ŒKraftï¼Œä¸¤ç§æ–¹å¼åªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ç§å¯åŠ¨ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚è¿™é‡Œé€‰æ‹©çš„æ˜¯zookeeper cd /usr/local tar -zxvf kafka_2.12-2.1.0.tgz cd kafka_2.12-2.1.0 mkdir etc cp config/zookeeper.properties etc/ # config/server.properties æ˜¯ kafka brokerå®ä¾‹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤æ‰€ä»¥éœ€è¦æ‹·è´3ä»½ cp config/server.properties etc/server-0.properties cp config/server.properties etc/server-1.properties cp config/server.properties etc/server-2.properties ä¿®æ”¹broker é…ç½®æ–‡ä»¶server-0.propertiesçš„é…ç½®ï¼Œåˆ†åˆ«æ˜¯2 å¤„ listeners=PLAINTEXT://:9092 ç›‘å¬ç«¯å£æ³¨é‡Šå»æ‰ log.dirs=/tmp/kafka-logs è¿›è¡ŒåŒºåˆ† log.dirs=/tmp/kafka-logs-0 ä¿®æ”¹broker é…ç½®æ–‡ä»¶server-1.propertiesçš„é…ç½®ï¼Œåˆ†åˆ«æ˜¯3 å¤„ broker.id=1 é˜²æ­¢å’Œ server-0 é‡å¤ listeners=PLAINTEXT://:9093 ç›‘å¬ç«¯å£æ³¨é‡Šå»æ‰,å¹¶æ›´æ”¹ä¸º9093 log.dirs=/tmp/kafka-logs è¿›è¡ŒåŒºåˆ† log.dirs=/tmp/kafka-logs-1 ä¿®æ”¹broker é…ç½®æ–‡ä»¶server-2.propertiesçš„é…ç½®ï¼Œåˆ†åˆ«æ˜¯3 å¤„ broker.id=2 é˜²æ­¢å’Œ server-0 é‡å¤ listeners=PLAINTEXT://:9094 ç›‘å¬ç«¯å£æ³¨é‡Šå»æ‰,å¹¶æ›´æ”¹ä¸º9094 log.dirs=/tmp/kafka-logs è¿›è¡ŒåŒºåˆ† log.dirs=/tmp/kafka-logs-2 æ£€æŸ¥ä¸‹ä¿®æ”¹é…ç½® root@k8s-master01:/usr/local/kafka_2.12-2.1.0/etc# cat server-*.properties |grep -e broker.id -e listeners= -e log.dirs=|grep -v \\# broker.id=0 listeners=PLAINTEXT://:9092 log.dirs=/tmp/kafka-logs broker.id=1 listeners=PLAINTEXT://:9093 log.dirs=/tmp/kafka-logs-1 broker.id=2 listeners=PLAINTEXT://:9094 log.dirs=/tmp/kafka-logs-2 å¯åŠ¨å®ä¾‹ cd /usr/local/kafka_2.12-2.1.0/bin # å…ˆå¯åŠ¨zookeeper ./zookeeper-server-start.sh ../etc/zookeeper.properties # å†å¯åŠ¨kafka çš„ä¸‰ä¸ªå®ä¾‹ï¼Œæ–°å¼€ä¸€ä¸ªä¼šè¯ä»¥åå°è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ ./kafka-server-start.sh -daemon ../etc/server-0.properties ./kafka-server-start.sh -daemon ../etc/server-1.properties ./kafka-server-start.sh -daemon ../etc/server-2.properties # æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼ŒæŸ¥çœ‹ç«¯å£ç›‘å¬ $ netstat -anp|grep -e 9092 -e 9093 -e 9094 tcp6 0 0 :::9094 :::* LISTEN 34724/java tcp6 0 0 :::9092 :::* LISTEN 33537/java tcp6 0 0 :::9093 :::* LISTEN 34355/java å¤‡æ³¨ï¼šå¯åŠ¨Kafkaæœ¬åœ°ç¯å¢ƒéœ€JDK 8+ä»¥ä¸Š åˆ›å»ºä¸»é¢˜æµ‹è¯•éƒ¨ç½²çš„é›†ç¾¤,åˆ›å»ºä¸€ä¸ªtest åç§°çš„topic root@k8s-master01:/usr/local/kafka_2.12-2.1.0/bin# ./kafka-topics.sh --zookeeper localhost:2181 --create --topic test --partitions 3 --replication-factor 2 Created topic \"test\". root@k8s-master01:/usr/local/kafka_2.12-2.1.0/bin# ./kafka-topics.sh --zookeeper localhost:2181 --describe --topic test Topic:test PartitionCount:3 ReplicationFactor:2 Configs: Topic: test Partition: 0 Leader: 1 Replicas: 1,0 Isr: 1,0 Topic: test Partition: 1 Leader: 2 Replicas: 2,1 Isr: 2,1 Topic: test Partition: 2 Leader: 0 Replicas: 0,2 Isr: 0,2 åˆ›å»ºå¥½äº†ä¸»é¢˜topic å°±å¯ä»¥ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆæ¯çš„å‘é€å’Œè¯»å–äº†ã€‚é€šè¿‡kafka-console-consumer.shè„šæœ¬æ¨¡æ‹Ÿæ¶ˆè´¹ï¼Œä¼šå‡ºç°ä¸€ä¸ªå…‰æ ‡ï¼Œç­‰å¾…æ˜¾ç¤ºæ¶ˆæ¯ root@k8s-master01:/usr/local/kafka_2.12-2.1.0/bin# ./kafka-console-consumer.sh --bootstrap-server localhost:9092,localhost:9093,localhost:9094 --topic test æä¾›ä¸€ä¸ªkafka-console-producer.shè„šæœ¬è¿›è¡Œå‘é€æ¶ˆæ¯message root@k8s-master01:/usr/local/kafka_2.12-2.1.0/bin# ./kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic test \u003emessage ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:5:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"ç›‘å¬å™¨å’Œå†…å¤–éƒ¨ç½‘ç»œ æ€»ç»“ä¸€ä¸‹kafka server.proerties å¿…è¦é…ç½®é¡¹ broker.id logs.dirs zookeeper.connect ç›‘å¬å™¨ listeners: æŒ‡å®šbroker å¯åŠ¨æ—¶æœ¬æœºçš„ç›‘å¬åç§°ã€ç«¯å£ listeners=PLAINTEXT://:9092 åè®®ï¼šPLAINTEXT listeners=PLAINTEXT://192.168.1.11:9092 åè®®ï¼šSSL listeners=PLAINTEXT://hostname:9092 åè®®ï¼šSASL_PLAINTEXT listeners=PLAINTEXT://0.0.0.0:9092 åè®®ï¼šSASL_SSL listeners: æŒ‡å®šbroker å¯åŠ¨æ—¶çš„æœ¬æœºç›‘å¬ç«¯å£ï¼Œç»™æœåŠ¡å™¨ä½¿ç”¨ advertised.listeners: å¯¹å¤–å‘å¸ƒçš„è®¿é—®IPå’Œç«¯å£ï¼Œæ³¨å†Œåˆ°zookeeper ä¸­ï¼Œç»™å®¢æˆ·ç«¯(client)ä½¿ç”¨ æ›´å¤šè¯¦ç»†é…ç½®è¯·å‚è€ƒKAFAK é…ç½®å†…å¤–ç½‘åˆ†æµï¼Œå®ç°åŒæ—¶æ”¯æŒå†…ç½‘ï¼Œå¤–ç½‘ï¼Œå…¶ä»–ç½‘ç»œ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:5:1","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"kafka æ¶ˆæ¯æ¨¡å‹ ç‚¹å¯¹ç‚¹ å‘å¸ƒè®¢é˜… æ¶ˆæ¯ä¼ æ’­è¯­ä¹‰ è‡³å°‘ä¸€æ¬¡ æœ€å¤šä¸€æ¬¡ ç²¾ç¡®ä¸€æ¬¡ æ¶ˆè´¹è€…æ¨¡å‹\råˆ†åŒºæ˜¯æœ€å°çš„å¹¶è¡Œå•ä½ ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒº ä¸€ä¸ªåˆ†åŒºå¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹ç»„é‡Œæ¶ˆè´¹è€…æ¶ˆè´¹ æ³¨æ„ï¼šä¸€ä¸ªåˆ†åŒºä¸èƒ½åŒæ—¶è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ç»„é‡Œçš„å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:6:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"ç‚¹å¯¹ç‚¹æ¨¡å¼ ç‚¹å¯¹ç‚¹æ¨¡å¼\rç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°queueï¼Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½æ”¶åˆ°ã€‚ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:6:1","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"å‘å¸ƒè®¢é˜…æ¨¡å¼ å‘å¸ƒè®¢é˜…æ¨¡å¼\rå‘å¸ƒè€…å‘é€åˆ°topicçš„æ¶ˆæ¯ï¼Œåªæœ‰è®¢é˜…äº†topicçš„è®¢é˜…è€…æ‰ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚è¿™é‡Œçš„è®¢é˜…è€…ä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…ï¼Œä¸”æ¯ä¸ªæ¶ˆè´¹è€…éƒ½å±äºä¸åŒçš„æ¶ˆè´¹è€…ç»„ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:6:2","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"æ¶ˆæ¯ä¼ æ’­è¯­ä¹‰ æœ€å¤šä¸€æ¬¡â€”â€”æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œæ°¸è¿œä¸é‡å¤å‘é€ æœ€å°‘ä¸€æ¬¡â€”â€”æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯å¯èƒ½ä¼šé‡å¤ ç²¾ç¡®ä¸€æ¬¡â€”â€”ä¿éšœæ¶ˆæ¯è¢«ä¼ é€’åˆ°æœåŠ¡å™¨ä¸”åœ¨æœåŠ¡ç«¯ä¸é‡å¤ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:6:3","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"Kafka API Producer API Allows applications to send streams of data to topics in the Kafka cluster. Consumer API Permits applications to read data streams from topics in the Kafka cluster. Streams API Acts as a stream processor, transforming data streams from input to output topics. Connect API Enables the development and running of reusable producers or consumers that connect Kafka topics to existing data system applications. Admin API Supports administrative operations on a Kafka cluster, like creating or deleting topics. Kafka API use cases Real-time analytics, event sourcing, log aggregation, message queuing, and stream processing. Kafka API compatible alternative Redpanda streaming data platform. Kafka APIæä¾›äº†ä¸€ä¸ªç¼–ç¨‹æ¥å£ï¼Œå…è®¸åº”ç”¨ç¨‹åºå®æ—¶ç”Ÿæˆã€æ¶ˆè´¹å’Œå¤„ç†è®°å½•æµã€‚å®ƒä½œä¸ºKafkaæœåŠ¡å™¨å’Œç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ç‚¹ï¼Œä»¥ä½å»¶è¿Ÿçš„è§„æ¨¡å¤„ç†å®æ—¶æ•°æ®é¦ˆé€ã€‚è¿™äº›å±æ€§ä½¿å®ƒæˆä¸ºæ¶‰åŠå®æ—¶åˆ†æã€äº‹ä»¶æº¯æºå’Œè®¸å¤šå…¶ä»–æ•°æ®å¯†é›†å‹æ“ä½œçš„ç”¨ä¾‹çš„é¦–é€‰å·¥å…·ã€‚ Kafka API æ¶æ„ Kafka API æ¶æ„\r","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:7:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"åºåˆ—åŒ– åºåˆ—åŒ–ä¸ååºåˆ—åŒ– å¸¸ç”¨æ¶ˆæ¯æ ¼å¼ csv é€‚åˆç®€å•çš„æ¶ˆæ¯ json 1. å¯è¯»æ€§é«˜ 2. å ç”¨ç©ºé—´å¤§ åºåˆ—åŒ–æ¶ˆæ¯ 1. avro hadoopã€hive æ”¯æŒå¥½ 2. protobuf Avroä¸Schema åºåˆ—åŒ–æ˜¯æŒ‡å°†å¯¹è±¡ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼åœ¨ç½‘ç»œä¹‹é—´ä¼ è¾“æˆ–è€…ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶å¯ä»¥æ ¹æ®ç‰¹å®šçš„è§„åˆ™è¿›è¡Œè¿˜åŸ åºåˆ—åŒ–çš„å¥½å¤„ èŠ‚çœç©ºé—´ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ è·¨å¹³å° è·¨è¯­è¨€ åºåˆ—åŒ–å’Œååºåˆ—åŒ–å½¢è±¡è§£é‡Š kafka-serdes\rå…³äºåºåˆ—åŒ–å’Œååºåˆ—å‚è€ƒ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:8:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["Kafka"],"content":"å‚è€ƒ https://kafka1x.apachecn.org/intro.html https://kafka.apache.org/ https://developer.confluent.io/quickstart/kafka-on-confluent-cloud/ https://developer.confluent.io/what-is-apache-kafka/ https://kafka.apache.org/downloads https://www.cnblogs.com/xxeleanor/p/15018271.html https://www.altexsoft.com/blog/apache-kafka-pros-cons/ kafkaçš„å‘è¡Œç‰ˆç‰ˆæœ¬é€‰æ‹© https://www.infoq.cn/article/apache-kafka/ https://www.cloudduggu.com/kafka/architecture/ ","date":"2021-05-19","objectID":"/kafka%E4%BB%8B%E7%BB%8D/:9:0","tags":["Kafka"],"title":"Apache kafka ä»‹ç»","uri":"/kafka%E4%BB%8B%E7%BB%8D/"},{"categories":["linux"],"content":"æ‰“ç®—ç»™ä¸€å°æœåŠ¡å™¨åšé€»è¾‘å·åˆ†åŒºï¼Œå‘ç°ç£ç›˜æœªåšåˆ†åŒºï¼Œä¸”ç£ç›˜ç©ºé—´ä½™é‡è¾ƒå¤§ï¼Œæœ¬ç¯‡è®°å½•ä¸€ä¸‹ fdisk ç£ç›˜åˆ†åŒºåˆ’åˆ†çš„è¿‡ç¨‹ fdisk\r","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:0:0","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"äº‹æƒ…çš„èµ·å›  é€šè¿‡pvcreate åˆ›å»ºé€»è¾‘å·ç»„æç¤ºæŠ¥é”™ æŠ¥é”™ä¿¡æ¯ è­¦å‘Š\rCanâ€™t open /dev/sda1 exclusively. Mounted filesystem?\ré€šè¿‡ fdisk -l æŸ¥çœ‹è¯¥åˆ†åŒºä¸ºboot åˆ†åŒºæ— æ³•åˆ›å»ºé€»è¾‘å·ã€‚fdisk -l å¯ä»¥ç”¨æ¥æŸ¥çœ‹ç£ç›˜çš„æ‰€æœ‰åˆ†åŒº $ fdisk -l Disk /dev/sda: 1000.2 GB, 1000171331584 bytes, 1953459632 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 262144 bytes / 262144 bytes Disk label type: dos Disk identifier: 0x0003eb01 Device Boot Start End Blocks Id System /dev/sda1 * 2048 2099199 1048576 83 Linux /dev/sda2 2099200 276834303 137367552 8e Linux LVM ä»ä¸Šé¢çš„ä¿¡æ¯å¯ä»¥äº†è§£åˆ°ç£ç›˜/dev/sdaåˆ’åˆ†äº†ä¸¤ä¸ªåˆ†åŒºï¼Œä¸”æ‰‡åŒºå¤§å°ä¸º512å­—èŠ‚ï¼Œboot åˆ†åŒºå¤§å°ä¸º(2099199-2048)*512/1024/1024=1G, ä¸”é€šè¿‡pvdisplayæŸ¥çœ‹è¯¥/dev/sda2 åˆ†åŒºä¸º131Gï¼Œå·²ç»å…¨éƒ¨ç”¨å®Œã€‚æ€»çš„ç£ç›˜æœ‰1000.2 GB å¯ç”¨ï¼ŒæŠ›å‡ºboot /dev/sda1åˆ†åŒºå’Œ/dev/sda2 çš„ 131GBç©ºé—´ï¼Œè¿˜å‰©800å¤šGBçš„ç£ç›˜ç©ºé—´æœªä½¿ç”¨ã€‚é—²è¨€å°‘å™ï¼Œå¼€å§‹é€šè¿‡fdiskåˆ’åˆ†æ–°çš„ç£ç›˜åˆ†åŒº/dev/sda3 ä¸»åˆ†åŒºå’Œæ‰©å±•åˆ†åŒº fdisk\r","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:1:0","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"åˆ’åˆ†ç£ç›˜åˆ†åŒº ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:2:0","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"é¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯ fdisk å‘½ä»¤ fdisk çš„æ„æ€æ˜¯ å›ºå®šç£ç›˜(Fixed Disk) æˆ– æ ¼å¼åŒ–ç£ç›˜(Format Disk)ï¼Œå®ƒæ˜¯å‘½ä»¤è¡Œä¸‹å…è®¸ç”¨æˆ·å¯¹åˆ†åŒºè¿›è¡ŒæŸ¥çœ‹ã€åˆ›å»ºã€è°ƒæ•´å¤§å°ã€åˆ é™¤ã€ç§»åŠ¨å’Œå¤åˆ¶çš„å·¥å…·ã€‚å®ƒæ”¯æŒ MBRã€Sunã€SGIã€BSD åˆ†åŒºè¡¨ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒ GUID åˆ†åŒºè¡¨ï¼ˆGPTï¼‰ã€‚å®ƒä¸æ˜¯ä¸ºæ“ä½œå¤§åˆ†åŒºè®¾è®¡çš„ã€‚ fdisk å…è®¸æˆ‘ä»¬åœ¨æ¯å—ç¡¬ç›˜ä¸Šåˆ›å»ºæœ€å¤šå››ä¸ªä¸»åˆ†åŒºã€‚å®ƒä»¬ä¸­çš„å…¶ä¸­ä¸€ä¸ªå¯ä»¥ä½œä¸ºæ‰©å±•åˆ†åŒºï¼Œå¹¶ä¸‹è®¾å¤šä¸ªé€»è¾‘åˆ†åŒºã€‚1-4 æ‰‡åŒºä½œä¸ºä¸»åˆ†åŒºè¢«ä¿ç•™ï¼Œé€»è¾‘åˆ†åŒºä»æ‰‡åŒº 5 å¼€å§‹ã€‚ ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:2:1","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"æŸ¥çœ‹åˆ†åŒº fdisk æŸ¥çœ‹ç‰¹å®šåˆ†åŒº fdisk -l /dev/sda fdiskäº¤äº’æŒ‡ä»¤è¯´æ˜ å‘½ä»¤ è¯´æ˜ æ˜¯å¦å¸¸ç”¨ a è®¾ç½®å¯å¼•å¯¼æ ‡è®° å¦ b ç¼–è¾‘bsdç£ç›˜æ ‡ç­¾ å¦ c è®¾ç½®DOSæ“ä½œç³»ç»Ÿå…¼å®¹æ ‡è®° å¦ d åˆ é™¤ä¸€ä¸ªåˆ†åŒº æ³¨ï¼šè¿™æ˜¯åˆ é™¤ä¸€ä¸ªåˆ†åŒºçš„åŠ¨ä½œ æ˜¯ l æ˜¾ç¤ºå·²çŸ¥çš„åˆ†åŒºç±»å‹ã€‚82 ä¸ºLinux swapåˆ†åŒºï¼Œ83ä¸ºLinuxåˆ†åŒº æ³¨ï¼šlæ˜¯åˆ—å‡ºåˆ†åŒºç±»å‹ï¼Œä»¥ä¾›æˆ‘ä»¬è®¾ç½®ç›¸åº”åˆ†åŒºçš„ç±»å‹ï¼› æ˜¯ m m æ˜¯åˆ—å‡ºå¸®åŠ©ä¿¡æ¯ æ˜¯ n æ·»åŠ ä¸€ä¸ªåˆ†åŒº æ˜¯ o å»ºç«‹ç©ºç™½DOSåˆ†åŒºè¡¨ å¦ p påˆ—å‡ºåˆ†åŒºè¡¨ æ˜¯ q ä¸ä¿å­˜é€€å‡º æ˜¯ s æ–°å»ºç©ºç™½SUNç£ç›˜æ ‡ç­¾ å¦ t æ”¹å˜ä¸€ä¸ªåˆ†åŒºçš„ç³»ç»ŸID æ˜¯ u æ”¹å˜æ˜¾ç¤ºè®°å½•å•ä½ å¦ v éªŒè¯åˆ†åŒºè¡¨ å¦ w æŠŠåˆ†åŒºè¡¨å†™å…¥ç¡¬ç›˜å¹¶é€€å‡º æ˜¯ x æ‰©å±•åº”ç”¨ï¼Œä¸“å®¶åŠŸèƒ½ å¦ å…³æ³¨ä¸€ä¸‹å¸¸ç”¨å‘½ä»¤å³å¯ ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:2:2","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"åˆ›å»ºæ‰©å±•åˆ†åŒº åˆ—å‡ºå½“å‰æ“ä½œç¡¬ç›˜çš„åˆ†åŒºæƒ…å†µï¼Œç”¨ p $ fdisk /dev/sda Welcome to fdisk (util-linux 2.23.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): n Partition type: p primary (2 primary, 0 extended, 2 free) e extended Select (default e): p æ–°å»ºç£ç›˜åˆ†åŒºï¼Œç”¨ n,åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæç¤ºé€‰æ‹©æ˜¯ä½¿ç”¨ä¸»åˆ†åŒºè¿˜æ˜¯é€»è¾‘åˆ†åŒºï¼Œè§æ‰©å±•ä¸€ã€‚ ç›´æ¥ä¸‹ä¸€æ­¥ä¼šæç¤ºåˆ›å»ºåˆ†åŒºçš„å¤§å°ï¼ŒæŒ‡å®šåˆ†åŒºå¤§å°æ—¶ç›´æ¥é»˜è®¤èµ·å§‹æ‰‡åŒºåï¼Œåœ¨last Sector size å¤„ç›´æ¥+400GBï¼Œæœ€å é€‰æ‹© wè¿›è¡Œä¿å­˜ï¼Œè¿™ä¸ªä¸è¦å¿˜è®°ã€‚è¿™ä¸ªæ—¶å€™åˆ†åŒºå·²ç»åˆ†é…å¥½äº†ï¼Œä½†æ˜¯è¿˜ä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºæ²¡æœ‰å¯¹è¯¥åˆ†åŒºè¿›è¡Œæ ¼å¼åŒ–æ“ä½œï¼ŒæŒ‡å®šåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿã€‚ ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:3:0","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"æŒ‡å®šåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿå¹¶ç”Ÿæ•ˆåˆ†åŒº é€‰æ‹©ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½ä¹Ÿä¸é€šï¼Œé€‰æ‹©åˆé€‚çš„æ–‡ä»¶ç³»ç»Ÿå¯¹åˆ†åŒºè¿›è¡Œæ ¼å¼ï¼Œåœ¨æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿå‰å…ˆæ›´æ–°åˆ†åŒºè¡¨ã€‚é‡æ–°æ‰«æåˆ†åŒºè¡¨éœ€è¦å€ŸåŠ©partprobeå‘½ä»¤ã€‚ partprobeå‘½ä»¤æ˜¯ç”¨äºé‡æ–°æ‰«æç³»ç»Ÿä¸Šçš„åˆ†åŒºè¡¨ï¼Œä»¥ä¾¿å†…æ ¸èƒ½å¤Ÿè¯†åˆ«æ–°åˆ›å»ºæˆ–ä¿®æ”¹çš„åˆ†åŒºã€‚å½“æ‚¨åœ¨ä¸é‡å¯ç³»ç»Ÿçš„æƒ…å†µä¸‹å¯¹ç£ç›˜è¿›è¡Œäº†åˆ†åŒºæˆ–è°ƒæ•´åˆ†åŒºå¤§å°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨partprobeå‘½ä»¤é€šçŸ¥å†…æ ¸æ›´æ–°åˆ†åŒºä¿¡æ¯ã€‚ partprobeå‘½ä»¤ä¼šè¯»å–åˆ†åŒºè¡¨å¹¶å‘å†…æ ¸å‘é€ä¿¡å·ï¼Œè®©å†…æ ¸é‡æ–°åŠ è½½åˆ†åŒºä¿¡æ¯ã€‚è¿™æ ·ï¼Œç³»ç»Ÿå°±èƒ½å¤Ÿè¯†åˆ«åˆ°æœ€æ–°çš„åˆ†åŒºä¿¡æ¯ï¼Œå¹¶ä½¿å…¶å¯ç”¨äºæŒ‚è½½å’Œè®¿é—®ã€‚ $ partprobe $ cat /proc/partitions major minor #blocks name 8 0 976729816 sda 8 1 1048576 sda1 8 2 137367552 sda2 8 3 412102655 sda3 [root@CENTOS7 temp]# mkfs.ext3 /dev/sda3 æ³¨æ„ï¼špartprobeå‘½ä»¤éœ€è¦rootæƒé™æ‰èƒ½æ‰§è¡Œã€‚åœ¨æ‰§è¡Œpartprobeä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸åº”çš„å‘½ä»¤ï¼ˆä¾‹å¦‚fdiskæˆ–lsblkï¼‰æ¥æ£€æŸ¥åˆ†åŒºæ˜¯å¦å·²æˆåŠŸæ›´æ–°ã€‚ æ ¼å¼åŒ–å®Œåˆ†åŒºè¡¨åé‚£ä¹ˆåˆ°æ­¤å°±å®Œæˆäº†ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯å®Œæˆç¡¬ç›˜åˆ†åŒºæ¥åˆ›å»ºç‰©ç†å·ã€‚åç»­å¯ä»¥å‚è€ƒé€»è¾‘å·ç»„ç®¡ç†æ–‡ç«  å¦‚ï¼š pvcreate /dev/sda3 vgcreate vgdata /dev/sda3 ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:3:1","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"è®¾ç½®å¼€æœºæŒ‚è½½ è®¾ç½®å¼€æœºæŒ‚è½½éœ€åŒæ­¥è‡³ /etc/fstab æ–‡ä»¶ä¸­ ç¤ºä¾‹ mkdir -p /var/lib/kubelet lvcreate -n lvkubelet -L +35G vgdata mkfs.xfs /dev/vgdata/lvkubelet echo \"/dev/mapper/vgdata-lvkubelet /var/lib/kubelet xfs defaults 0 0\" \u003e\u003e /etc/fstab mount -a ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:3:2","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"æ‰©å±•ä¸€ï¼šfdisk æ–°å¢ä¸»åˆ†åŒºå’Œæ‰©å±•åˆ†åŒºçš„ä¸»è¦åŒºåˆ« ä¸»åˆ†åŒº(Primary Partition)æ˜¯ç¡¬ç›˜ä¸Šçš„åŸºæœ¬åˆ†åŒº,æ¯ä¸ªç¡¬ç›˜æœ€å¤šå¯ä»¥åˆ›å»º4ä¸ªä¸»åˆ†åŒºã€‚ æ‰©å±•åˆ†åŒº(Extended Partition)æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸»åˆ†åŒº,å®ƒä¸èƒ½ç›´æ¥å­˜å‚¨æ•°æ®,ä»…å¯ç”¨äºæ‰©å±•æ›´å¤šçš„é€»è¾‘åˆ†åŒºã€‚æ¯ä¸ªç¡¬ç›˜åªèƒ½åˆ›å»º1ä¸ªæ‰©å±•åˆ†åŒºã€‚ ä¸»åˆ†åŒºå¯ä»¥ç›´æ¥å­˜å‚¨æ•°æ®,è€Œæ‰©å±•åˆ†åŒºå†…éœ€è¦å†åˆ›å»ºé€»è¾‘åˆ†åŒº(Logical Partition)æ‰èƒ½å­˜å‚¨æ•°æ®ã€‚ ä¸»åˆ†åŒºå¯¹æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–çš„æ”¯æŒæ›´å¹¿æ³›,å¯æ”¯æŒå„ç§æ–‡ä»¶ç³»ç»Ÿã€‚æ‰©å±•åˆ†åŒºå’Œé€»è¾‘åˆ†åŒºä»…æ”¯æŒéƒ¨åˆ†æ–‡ä»¶ç³»ç»Ÿã€‚ ä¸»åˆ†åŒºçš„è®¿é—®æ•ˆç‡ç¨é«˜ä¸€äº›ã€‚æ‰©å±•åˆ†åŒºå’Œé€»è¾‘åˆ†åŒºçš„è®¿é—®ä¼šç¨å¾®ä½ä¸€äº›ã€‚ å¦‚æœæ²¡æœ‰ç©ºé—´é™åˆ¶,å»ºè®®ä½¿ç”¨ä¸»åˆ†åŒºã€‚å¦‚æœç£ç›˜ç©ºé—´ä¸è¶³,å¯ä»¥ä½¿ç”¨æ‰©å±•åˆ†åŒºé¢å¤–å¢åŠ æ›´å¤šåˆ†åŒºã€‚ æ‰€ä»¥æ€»çš„æ¥è¯´,ä¸»åˆ†åŒºæ›´åŸºç¡€å’Œé€šç”¨,æ‰©å±•åˆ†åŒºå¯ä»¥æä¾›æ›´å¤šé¢å¤–çš„åˆ†åŒºæ•°ã€‚é€‰æ‹©æ—¶éœ€è¦æ ¹æ®å®é™…ç£ç›˜ç©ºé—´åŠä½¿ç”¨éœ€æ±‚æ¥å†³å®šã€‚ å°ç»“ï¼šæœ‰ä¸»é€‰ä¸»ï¼Œä¸»åˆ†åŒºæ›´åŸºç¡€å’Œé€šç”¨ ","date":"2021-04-29","objectID":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/:3:3","tags":["linux"],"title":"fdisk ç£ç›˜ç®¡ç†è¯¦è§£","uri":"/fdisk%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/"},{"categories":["linux"],"content":"èƒŒæ™¯ éƒ¨ç½² k8s æ—¶éœ€è¦å¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºåˆ’åˆ†ï¼Œæ­£å¸¸æ˜¯é›†æˆæ˜¯ç›´æ¥ç»™åˆ›å»ºå¥½çš„ï¼Œç°åœºåœ¨æ²Ÿé€šè¿‡ç¨‹ä¸­åªæä¾›äº†ä¸€å—ç£ç›˜ã€‚ æœ¬ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ç£ç›˜åˆ†åŒºåˆ’åˆ†çš„åŸç†å’Œæ­¥éª¤ï¼Œå°½é‡é€‰æ‹©å¤§ç™½è¯ã€‚ lvm\r","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:1:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"lvm ä»‹ç» LVMâ€”â€”å…¨ç§°Logical Volume Managerï¼Œå¯ä»¥å°†å¤šä¸ªç¡¬ç›˜å’Œç¡¬ç›˜åˆ†åŒºåšæˆä¸€ä¸ªé€»è¾‘å·ï¼Œå¹¶æŠŠè¿™ä¸ªé€»è¾‘å·ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥ç»Ÿä¸€ç®¡ç†ï¼ŒåŠ¨æ€å¯¹åˆ†åŒºè¿›è¡Œæ‰©ç¼©ç©ºé—´å¤§å°ï¼Œæé«˜ç£ç›˜ç®¡ç†çµæ´»æ€§ã€‚ åœ¨å®‰è£…CentOS 7çš„è¿‡ç¨‹ä¸­é€‰æ‹©è‡ªåŠ¨åˆ†åŒºæ—¶ï¼Œé»˜è®¤å°±æ˜¯ä»¥LVMçš„æ–¹æ¡ˆå®‰è£…çš„ç³»ç»Ÿã€‚ ä½†æ˜¯/bootåˆ†åŒºå¿…é¡»ç‹¬ç«‹å‡ºæ¥ï¼Œä¸èƒ½åŸºäºLVMåˆ›å»ºã€‚ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:2:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ä¸‰ä¸ªæ¦‚å¿µ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:3:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"PV(Physical Volume) ç‰©ç†å· ç‰©ç†å·ï¼ŒPhysical Volumeï¼Œæ˜¯LVMæœºåˆ¶çš„åŸºæœ¬å­˜å‚¨è®¾å¤‡ï¼Œé€šå¸¸å¯¹åº”ä¸€ä¸ªæ™®é€šåˆ†åŒºæˆ–æ˜¯æ•´ä¸ªç¡¬ç›˜ã€‚ åˆ›å»ºç‰©ç†å·æ—¶ï¼Œä¼šåœ¨åˆ†åŒºæˆ–ç£ç›˜å¤´éƒ¨åˆ›å»ºä¸€ä¸ªç”¨äºè®°å½•LVMå±æ€§çš„ä¿ç•™åŒºå—ï¼Œå¹¶æŠŠå­˜å‚¨ç©ºé—´åˆ†å‰²æˆé»˜è®¤å¤§å°ä¸º4MBçš„åŸºæœ¬å•å…ƒï¼ˆPhysical Extendï¼ŒPEï¼‰ï¼Œä»è€Œæ„æˆç‰©ç†å·ã€‚ æ™®é€šåˆ†åŒºå…ˆè½¬æ¢åˆ†åŒºç±»å‹ä¸º8eï¼›æ•´å—ç¡¬ç›˜ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ç©ºé—´åˆ’åˆ†ä¸ºä¸€ä¸ªä¸»åˆ†åŒºå†åšè°ƒæ•´ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:3:1","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"VG(Volume Group) å·ç»„ å·ç»„ï¼ŒVolume Groupï¼Œæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†å·ç»„æˆçš„ä¸€ä¸ªæ•´ä½“ã€‚å¯ä»¥åŠ¨æ€æ·»åŠ ã€ç§»é™¤ç‰©ç†å·ï¼Œåˆ›å»ºæ—¶å¯ä»¥æŒ‡å®šPEå¤§å° ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:3:2","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"LV(Logical Volume) é€»è¾‘å· é€»è¾‘å·ï¼ŒLogical Volumeï¼Œå»ºç«‹åœ¨å·ç»„ä¹‹ä¸Šï¼Œä¸ç‰©ç†å·æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚æ ¼å¼åŒ–åï¼Œå³å¯æŒ‚è½½ä½¿ç”¨ã€‚ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:3:3","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ä¸‰è€…å…³ç³» lvm\r","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:4:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"lvmç‰¹ç‚¹ LVMæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å¯¹ç£ç›˜è¿›è¡ŒåŠ¨æ€ç®¡ç†ã€‚å› ä¸ºé€»è¾‘å·çš„å¤§å°æ˜¯å¯ä»¥åŠ¨æ€è°ƒæ•´çš„ï¼Œè€Œä¸”ä¸ä¼šä¸¢å¤±ç°æœ‰çš„æ•°æ®ã€‚æˆ‘ä»¬å¦‚æœæ–°å¢åŠ äº†ç¡¬ç›˜ï¼Œå…¶ä¹Ÿä¸ä¼šæ”¹å˜ç°æœ‰ä¸Šå±‚çš„é€»è¾‘å·ã€‚ä½œä¸ºä¸€ä¸ªåŠ¨æ€ç£ç›˜ç®¡ç†æœºåˆ¶ï¼Œé€»è¾‘å·æŠ€æœ¯å¤§å¤§æé«˜äº†ç£ç›˜ç®¡ç†çš„çµæ´»æ€§ï¼ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:5:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"å·¥ä½œåŸç† ç‰©ç†ç£ç›˜è¢«æ ¼å¼åŒ–ä¸ºPVï¼Œç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„PE ä¸åŒçš„PVåŠ å…¥åˆ°åŒä¸€ä¸ªVGä¸­ï¼Œä¸åŒPVçš„PEå…¨éƒ¨è¿›å…¥åˆ°äº†VGçš„PEæ± å†… LVåŸºäºPEåˆ›å»ºï¼Œå¤§å°ä¸ºPEçš„æ•´æ•°å€ï¼Œç»„æˆLVçš„PEå¯èƒ½æ¥è‡ªä¸åŒçš„ç‰©ç†ç£ç›˜ LVç°åœ¨å°±ç›´æ¥å¯ä»¥æ ¼å¼åŒ–åæŒ‚è½½ä½¿ç”¨äº† LVçš„æ‰©å……ç¼©å‡å®é™…ä¸Šå°±æ˜¯å¢åŠ æˆ–å‡å°‘ç»„æˆè¯¥LVçš„PEæ•°é‡ï¼Œå…¶è¿‡ç¨‹ä¸ä¼šä¸¢å¤±åŸå§‹æ•°æ® ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:6:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"è®²ä¸ªæ•…äº‹ ä¸Šé¢å·¥ä½œåŸç†å¯ä»¥åšä¸€ä¸ªç±»æ¯”ï¼Œé›†æˆæä¾›çš„æŒ‚è½½ç£ç›˜å¯ä»¥ç†è§£ä¸ºä¸€å †å°éº¦ï¼Œpvçš„ä½œç”¨æ˜¯å°†è¿™ä¸€å †å°éº¦æ‰“ç£¨æˆé¢ç²‰ï¼Œ ä¸ç®¡æŒ‚è½½å¤šå°‘ä¸ªç£ç›˜pvéƒ½å¯ä»¥åšæˆé¢ç²‰ï¼Œä¸€å †ä¸€å †çš„é¢ç²‰(pvæ ¼å¼åŒ–çš„å„ä¸ªç£ç›˜)å¯ä»¥åŠ å…¥åˆ°ä¸€ä¸ªVGä¸­ï¼Œ è¿™ä¸ªVGå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¾›é”€ç¤¾å°†æ‰€æœ‰çš„é¢ç²‰è¿›è¡Œäº†çº³ç®¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸åŒçš„é¢ç²‰åˆ’åˆ†ç»™ä¸åŒçš„ä¾›é”€ç¤¾, æ„æ€å°±æ˜¯å››å—ç£ç›˜Aã€Bã€Cã€D é€šè¿‡æ‰“é¢æœºpvåšæˆäº†å››ä»½é¢ç²‰ï¼ŒAã€Cä»½é¢ç²‰å–ç»™äº†å¤§è„šä¾›é”€ç¤¾VG-DJ,Cã€Dä¸¤ä»½é¢ç²‰å–ç»™äº†å°è„šä¾›é”€ç¤¾ VG-XJ,ç°åœ¨äºšæ´²èˆç‹å°¼å¤æ‹‰æ–¯èµµå››æƒ³è¦åƒé¦’å¤´ï¼Œå°±é€‰æ‹©äº†å»å¤§è„šä¾›é”€ç¤¾å»è´­ä¹°é¢ç²‰ï¼Œæ‰“ç®—è´­ä¹°50æ–¤é¢ç²‰ã€‚è¿™50æ–¤é¢ç²‰ä¾›é”€æä¾›çš„lv, lv ä¸€å°ä»½çš„é¢ç²‰æ˜¯æ¥è‡ªäºvgä¾›é”€ç¤¾è€Œä¸æ˜¯pv é¢ç²‰åˆ¶é€ æœºå™¨ã€‚ä¸‹é¢ä¼šç»™å‡ºç¤ºä¾‹ä»å°éº¦ç”Ÿäº§åˆ°èµµå››è´­ä¹°é¢ç²‰ã€‚ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:7:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"æ“ä½œ lvm\r","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:8:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"åˆ†åŒºæ“ä½œ 1ã€ æŸ¥çœ‹ç£ç›˜ é€šè¿‡fdisk -lå¯ä»¥çœ‹å‡ºé›†æˆæä¾›äº†ä¸€å—600å¤šGçš„ç£ç›˜ /dev/xvdc $ fdisk -l .... Disk /dev/xvdc: 644.2 GB, 644245094400 bytes, 1258291200 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes 2ã€ åˆ›å»ºç‰©ç†å· pv å°†å°éº¦åŠ å·¥æˆé¢ç²‰ï¼ŒåŸç†æ˜¯ç‰©ç†ç£ç›˜è¢«æ ¼å¼åŒ–ä¸ºPVï¼Œç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„PE $ pvcreate /dev/xvdc Physical volume \"/dev/xvdc\" successfully created 3ã€ åˆ›å»ºé€»è¾‘å·ç»„ å°†é¢ç²‰è¿è¾“è‡³å¤§è„šä¾›é”€ç¤¾vgdata,vgdata æ˜¯è‡ªå®šä¹‰çš„é€»è¾‘å·ç»„å $ vgcreate vgdata /dev/xvdc Volume group \"vgdata\" successfully created $ vgs VG #PV #LV #SN Attr VSize VFree centos 1 3 0 wz--n- \u003c99.00g 0 datavg 1 1 0 wz--n- \u003c400.00g 4.00m vgdata 1 0 0 wz--n- \u003c600.00g \u003c600.00g 4ã€åˆ›å»ºé€»è¾‘å· å¯ä»¥çœ‹çš„å‡ºæ¥é€»è¾‘å·çš„åˆ›å»ºæ˜¯æ¥è‡ªäºé€»è¾‘å·ç»„vg,åé¢çš„æ‰©å®¹ä¹Ÿæ˜¯ä»é€»è¾‘å·ç»„è¿›è¡Œæ‰©å®¹ï¼Œè¿™ä¸ªæ­¥éª¤å¯ä»¥æ¯”å–»ä¸ºèµµå››å»å¤§è„šè¶…å¸‚ è´­ä¹°äº†35æ–¤çš„é¢ç²‰ mkdir -p /var/lib/kubelet lvcreate -n lvkubelet -L +35G vgdata mkfs.xfs /dev/vgdata/lvkubelet echo \"/dev/mapper/vgdata-lvkubelet /var/lib/kubelet xfs defaults 0 0\" \u003e\u003e /etc/fstab mount -a æŸ¥çœ‹é€»è¾‘å·æ˜¯å¦æŒ‚è½½æˆåŠŸ $ df -h|grep kubelet /dev/mapper/vgdata-lvkubelet 35G 35M 35G 1% /var/lib/kubelet ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:8:1","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ç›¸å…³æ“ä½œå‘½ä»¤ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:9:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"åˆ›å»ºé€»è¾‘å· Linux ç³»ç»Ÿä½¿ç”¨é€»è¾‘å·æ¥æ¨¡æ‹Ÿç‰©ç†åˆ†åŒºï¼Œå¹¶åœ¨å…¶ä¸­ä¿å­˜æ–‡ä»¶ç³»ç»Ÿã€‚ é€‰ é¡¹ é•¿é€‰é¡¹å æ è¿° -c â€“chunksize æŒ‡å®šå¿«ç…§é€»è¾‘å·çš„å•ä½å¤§å° -C â€“contiguous è®¾ç½®æˆ–é‡ç½®è¿ç»­åˆ†é…ç­–ç•¥ -i â€“stripes æŒ‡å®šæ¡å¸¦æ•° -I â€“stripesize æŒ‡å®šæ¯ä¸ªæ¡å¸¦çš„å¤§å° -l â€“extents æŒ‡å®šåˆ†é…ç»™æ–°é€»è¾‘å·çš„é€»è¾‘åŒºæ®µæ•°ï¼Œæˆ–è€…è¦ç”¨çš„é€»è¾‘åŒºæ®µçš„ç™¾åˆ†æ¯” -L â€“size æŒ‡å®šåˆ†é…ç»™æ–°é€»è¾‘å·çš„ç¡¬ç›˜å¤§å° -M â€“persistent è®©æ¬¡è®¾å¤‡å·ä¸€ç›´æœ‰æ•ˆ -n â€“name æŒ‡å®šæ–°é€»è¾‘å·çš„åç§° -p â€“permission ä¸ºé€»è¾‘å·è®¾ç½®è¯»/å†™æƒé™ -r â€“readahead è®¾ç½®é¢„è¯»æ‰‡åŒºæ•° -R â€“regionsize æŒ‡å®šå°†é•œåƒåˆ†æˆå¤šå¤§çš„åŒº -s snapshot åˆ›å»ºå¿«ç…§é€»è¾‘å· -Z â€“zero å°†æ–°é€»è¾‘å·çš„å‰1 KBæ•°æ®è®¾ç½®ä¸ºé›¶ -m â€“mirrors åˆ›å»ºé€»è¾‘å·é•œåƒ ç©º â€“minor æŒ‡å®šè®¾å¤‡çš„æ¬¡è®¾å¤‡å· å‚æ•°å¾ˆå¤šï¼Œå…¶å®å¸¸ç”¨çš„å°±å‡ ä¸ª ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:9:1","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"æŒ‡å®šé€»è¾‘å·å¤§å° å¦‚é€»è¾‘å·ç»„ Vol1 lvcreate -n lvtest -L +32G Vol1 ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:9:2","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ æ­¤æ—¶åªæœ‰é€»è¾‘å·æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦ç»™é€»è¾‘å·æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿ è¿™é‡Œçš„æ–‡ä»¶ç³»ç»ŸæŒ‡å®šçš„æ˜¯ext4ï¼Œå…¬å¸ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„æ˜¯ xfs æ–‡ä»¶ç³»ç»Ÿå¦‚mkfs.xfs /dev/vgdata/lvkubeletï¼Œä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ext4æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„å·®åˆ«è¯·è‡ªè¡Œäº†è§£ï¼Œè¿™é‡Œä¸åšè¯´æ˜ sudo mkfs.ext4 /dev/Vol1/lvtest mke2fs 1.41.12 (17-May-2010) Filesystem label= OS type: Linux Block size=4096 (log=2) Fragment size=4096 (log=2) Stride=0 blocks, Stripe width=0 blocks 131376 inodes, 525312 blocks 26265 blocks (5.00%) reserved for the super user First data block=0 Maximum filesystem blocks=541065216 17 block groups 32768 blocks per group, 32768 fragments per group 7728 inodes per group Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912 Writing inode tables: done Creating journal (16384 blocks): done Writing superblocks and filesystem accounting information: done This filesystem will be automatically checked every 28 mounts or 180 days, whichever comes first.Use tune2fs -c or -i to override. ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:10:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ç›®å½•æŒ‚è½½ åœ¨åˆ›å»ºäº†æ–‡ä»¶ç³»ç»Ÿåéœ€è¦å°†è¯¥é€»è¾‘å·æŒ‚è½½åˆ°æŒ‡å®šçš„è™šæ‹Ÿç›®å½•ä¸‹ï¼Œå°±è·Ÿä»–æ˜¯ç‰©ç†åˆ†åŒºä¸€æ · sudo mount /dev/Vol1/lvtest /mnt/my_partition å‘½ä»¤è§£é‡Šæ˜¯å°†é€»è¾‘å·æŒ‚è½½åˆ°æŒ‡å®šè™šæ‹Ÿç›®å½•ä¸Š è®¾ç½®æŒ‚è½½æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¦åˆ™æœºå™¨é‡å¯åä¼šä¸¢å¤±æ‰ æ³¨æ„ä¿®æ”¹åç§° echo \"/dev/mapper/$vgname-lvdocker /var/lib/docker xfs defaults 0 0\" \u003e\u003e /etc/fstab ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:10:1","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ä¿®æ”¹LVM å‘½ ä»¤ åŠŸ èƒ½ vgchange æ¿€æ´»å’Œç¦ç”¨å·ç»„ vgremove åˆ é™¤å·ç»„ vgextend å°†ç‰©ç†å·åŠ åˆ°å·ç»„ä¸­ vgreduce ä»å·ç»„ä¸­åˆ é™¤ç‰©ç†å· lvextend å¢åŠ é€»è¾‘å·çš„å¤§å° lvreduce å‡å°é€»è¾‘å·çš„å¤§å° é€šè¿‡ä»¥ä¸Šå‘½ä»¤å¯ä»¥å®Œå…¨æ§åˆ¶ä½ çš„LVMç¯å¢ƒ å¦‚æ‰©å®¹ æ‰©å®¹å‰å…ˆå–æ¶ˆæŒ‚è½½ umount /mnt/my_partition # å¯¹/dev/Vol1/lvtest å¢åŠ 1G lvextend -L +1G /dev/Vol1/lvtest -r # é‡æ–°æŒ‚è½½è®¾å¤‡ï¼Œå¹¶æŸ¥çœ‹æŒ‚è½½çŠ¶æ€ mount -a df -h ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:10:2","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"LVM å‘½ä»¤æ±‡æ€» åŠŸèƒ½ pvå‘½ä»¤ vgå‘½ä»¤ lvå‘½ä»¤ æ‰«æ pvscan vgscan lvscan Createåˆ›å»º pvcreate vgcreate lvcreate Displayæ˜¾ç¤º pvdisplay vgdisplay lvdisplay Removeç§»é™¤ pvremove vgremove lvremove Extendæ‰©å±• - vgextend lvextend Reduceå‡å°‘ - vgreduce lvreduce å…³äºæ”¶ç¼© LVM é€»è¾‘å·ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„å‘½ä»¤lvreduceã€‚è¿™ä¼šæ¶‰åŠåˆ°æ•°æ®å®‰å…¨æ€§é—®é¢˜ï¼Œè°¨æ…ä½¿ç”¨ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:11:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"å°ç»“ å°±æ˜¯ä¸‰æ­¥èµ°ï¼Œåˆ›å»ºç‰©ç†å·ï¼Œåˆ›å»ºå·ç»„ï¼Œåˆ›å»ºé€»è¾‘å·ï¼Œç„¶åæ ¼å¼åŒ–å¹¶æŒ‚è½½ä½¿ç”¨ã€‚æ‰©å®¹çš„è¯ï¼Œæ²¡æœ‰æŒ‚è½½ä½¿ç”¨ï¼Œå°±æ­£å¸¸æ‰©ï¼Œç„¶åæ ¼å¼åŒ–æŒ‚è½½ï¼Œå·²ç»æŒ‚è½½ä½¿ç”¨äº†ï¼Œæ‰©å®¹ååœ¨çº¿è°ƒæ•´ç”Ÿæ•ˆã€‚ ","date":"2021-03-18","objectID":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/:12:0","tags":["linux"],"title":"lvm é€»è¾‘å·ç»„ç®¡ç†","uri":"/lvm%E9%80%BB%E8%BE%91%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ç®€ä»‹ ä¹‹æ‰€ä»¥èƒ½ç”¨åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œæ˜¯ç”±äºå¾ˆå¤š linux å‘½ä»¤ä¸æ”¯æŒç”¨ç®¡é“ä¼ é€’å‚æ•°ï¼Œxargs å¯ä»¥ç†è§£ä¸ºå‚æ•°è½¬æ¢å™¨ï¼Œä¾‹å¦‚ #é”™è¯¯æŒ‡ä»¤ find /sbin -perm +700 | ls -l #æ­£ç¡®æŒ‡ä»¤ find /sbin -perm +700 |xargs ls -l é€šå¸¸Linuxå‘½ä»¤å¯ä»¥ç”¨|é¦–å°¾ç›¸è¿ï¼Œä¸Šä¸€ä¸ªå‘½ä»¤çš„ stdout è¿æ¥åˆ°ä¸‹ä¸€ä¸ªå‘½ä»¤çš„ stdinã€‚ä½†æ˜¯æœ‰äº›å‘½ä»¤ï¼Œæ¯”å¦‚lsã€rmç­‰ï¼Œæ˜¯ä»å‘½ä»¤è¡Œå‚æ•°æ¥å—è¾“å…¥çš„ã€‚è¿™æ—¶å€™å¦‚æœæƒ³æŠŠä¸Šä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä¼ ç»™å®ƒä»¬ï¼Œå°±ä¸å¥½åŠäº†ã€‚æ‰€ä»¥å°±æœ‰äº†xargsã€‚ ç®€å•è€Œè¨€ï¼Œxargså¯ä»¥æŠŠä» stdin æ¥å—åˆ°çš„è¾“å…¥ï¼ŒæŒ‰ç©ºç™½ç¬¦æˆ–åŠ è½¦ç¬¦åˆ†éš”å¼€ï¼Œç„¶åä¾æ¬¡ä½œä¸ºå‚æ•°å»è°ƒç”¨xargsåé¢çš„å‘½ä»¤ xargs é»˜è®¤çš„åˆ†éš”ç¬¦ï¼šç©ºæ ¼ æˆ– å›è½¦ ","date":"2021-02-28","objectID":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/:1:0","tags":["linux"],"title":"xargsåŸç†åŠä½¿ç”¨","uri":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/"},{"categories":["linux"],"content":"å‚æ•°ä½¿ç”¨ æƒ³æŠŠæ‰€æœ‰.jpgæ–‡ä»¶åˆ é™¤ï¼Œå½“ç„¶ä½ å¯ä»¥ rm *.jpgï¼Œä½†æ˜¯å¦‚æœè¦é€’å½’æ“ä½œæ‰€æœ‰å­ç›®å½•ä¸‹çš„æ–‡ä»¶å‘¢ï¼Ÿ å¯ä»¥è¿™æ ·ï¼š find . -name \"*.jpg\" | xargs rm è¿™æ ·ï¼Œæ‰€æœ‰è¢«findæ‰¾åˆ°çš„æ–‡ä»¶åï¼Œéƒ½ä¼šä½œä¸ºå‚æ•°æ¥è°ƒç”¨rmå‘½ä»¤äº† å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œè¿™ä¸€è¡Œå‘½ä»¤æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ‰äº›æ–‡ä»¶åä¸­åŒ…å«ç©ºæ ¼ï¼Œå°±ä¼šæœ‰é—®é¢˜äº†ã€‚ xargsé»˜è®¤ä»¥ç©ºç™½ç¬¦åˆ†éš”æ¥å—åˆ°çš„è¾“å…¥ï¼Œæ‰€ä»¥ä¸€ä¸ªå«æœ‰ç©ºæ ¼çš„æ–‡ä»¶åä¼šè¢«å½“åšå¤šä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¼ ç»™rmã€‚æ‰€ä»¥åœ¨å¤„ç†æ–‡ä»¶åè¿™ç±»å‘½ä»¤æ—¶ï¼Œé€šå¸¸è¦è¿™æ · find . -name \"*.jpg\" -print0 | xargs -0 rm è¿™é‡Œçš„ -print0 æ˜¯å‘Šè¯‰findå‘½ä»¤ï¼Œåœ¨æ¯ä¸ªè¾“å‡ºåé¢ä»¥â€™\\0â€™ä½œä¸ºç»“æŸã€‚-0æ˜¯å‘Šè¯‰xargsï¼Œä½¿ç”¨â€™\\0â€™æ¥åˆ†éš”è¾“å…¥ï¼Œè€Œä¸æ˜¯ç©ºç™½ç¬¦ã€‚è¿™æ ·å°±é¿å…å‡ºç°é—®é¢˜äº†ã€‚ ä¸‹é¢å†è€ƒè™‘å¦ä¸€ç§æƒ…å†µï¼Œå‡è®¾ä¸æ˜¯åˆ é™¤ï¼Œè€Œæ˜¯æƒ³æŠŠç¬¦åˆè¦æ±‚çš„æ–‡ä»¶åéƒ½æ·»åŠ ä¸Šåç¼€.bakæ€ä¹ˆåŠï¼Ÿè¿™æ—¶å€™éœ€è¦è¿™æ · find . -name \"*.jpg\" -print0 | xargs -0 -I {} mv {} {}.bak å¸¸ç”¨å‘½ä»¤ å…¶ä¸­çš„-I {} (initial arguments)æ˜¯å‘Šè¯‰xargsï¼Œåé¢çš„å‘½ä»¤ä¸­ï¼Œç”¨{}è¡¨ç¤ºå ä½ç¬¦ï¼Œå°†ä¼šè¢«å®é™…çš„å‚æ•°æ›¿ä»£ã€‚è¿™æ ·å°±è¡Œäº†ã€‚ å…¶ä»–æœ‰ç”¨çš„å‚æ•°è¿˜æœ‰ï¼š -n ç”¨äºæŒ‡å®šæ¯æ¬¡ä¼ é€’å‡ ä¸ªå‚æ•° -d ç”¨äºæŒ‡å®šåˆ‡åˆ†è¾“å…¥å†…å®¹æ—¶ï¼Œå…·ä½“çš„åˆ†éš”ç¬¦ -a file ä»æ–‡ä»¶ä¸­è¯»å…¥ä½œä¸ºsdtin $ cat 1.txt aaa bbb ccc ddd a b $ xargs -a 1.txt echo aaa bbb ccc ddd a b -e flag æ³¨æ„æœ‰çš„æ—¶å€™å¯èƒ½ä¼šæ˜¯-Eï¼Œflagå¿…é¡»æ˜¯ä¸€ä¸ªä»¥ç©ºæ ¼åˆ†éš”çš„æ ‡å¿—ï¼Œå½“xargsåˆ†æåˆ°å«æœ‰flagè¿™ä¸ªæ ‡å¿—çš„æ—¶å€™å°±åœæ­¢ $ xargs -E 'ddd' -a 1.txt echo aaa bbb ccc $ cat 1.txt |xargs -E 'ddd' echo aaa bbb ccc -n num åé¢åŠ æ¬¡æ•°ï¼Œè¡¨ç¤ºå‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸€æ¬¡ç”¨çš„argumentçš„ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ç”¨æ‰€æœ‰çš„ã€‚ $ cat 1.txt |xargs -n 2 echo aaa bbb ccc ddd a b -p æ“ä½œå…·æœ‰å¯äº¤äº’æ€§ï¼Œæ¯æ¬¡æ‰§è¡Œcomandéƒ½äº¤äº’å¼æç¤ºç”¨æˆ·é€‰æ‹©ï¼Œå½“æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªargumentçš„æ—¶å€™è¯¢é—®ä¸€æ¬¡ç”¨æˆ· $ cat 1.txt |xargs -p echo echo aaa bbb ccc ddd a b ?...y aaa bbb ccc ddd a b $ cat 1.txt |xargs -p echo echo aaa bbb ccc ddd a b ?...n -t è¡¨ç¤ºå…ˆæ‰“å°å‘½ä»¤ï¼Œç„¶åå†æ‰§è¡Œ $ cat 1.txt |xargs -t echo echo aaa bbb ccc ddd a b aaa bbb ccc ddd a b å ä½ -i æˆ–è€…æ˜¯-Iï¼Œè¿™å¾—çœ‹linuxæ”¯æŒäº†ï¼Œå°†xargsçš„æ¯é¡¹åç§°ï¼Œä¸€èˆ¬æ˜¯ä¸€è¡Œä¸€è¡Œèµ‹å€¼ç»™{}ï¼Œå¯ä»¥ç”¨{}ä»£æ›¿ã€‚å°å†™çš„-iå¸¦å‚æ•°æ—¶å’Œå¤§å†™çš„-Iæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå°å†™çš„-iå¯ä»¥ä¸å¸¦å‚æ•°ï¼Œè¿™æ—¶å€™ç›¸å½“äºå¤§å†™çš„-I {}ã€‚ ä¸è¿‡æ‰‹å†Œé‡Œé¢ä¸å»ºè®®ä½¿ç”¨å°å†™çš„-iï¼Œå¯èƒ½ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ xargsåŠ ä¸Š-I (è¿™é‡Œæ‰‹å†Œå»ºè®®ä½¿ç”¨å¤§å†™çš„-I)åå°±å¯ä»¥ç”¨ {}è¡¨ç¤ºç®¡é“ä¼ è¿‡æ¥çš„å‚æ•°æ”¾åˆ°è¯¥ä½ç½® $ ls 1.txt 2.txt 3.txt log.xml $ ls *.txt | xargs -t -i mv {} {}.bak mv 1.txt 1.txt.bak mv 2.txt 2.txt.bak mv 3.txt 3.txt.bak $ ls 1.txt.bak 2.txt.bak 3.txt.bak log.xml ç©ºå‚æ•°ä¼ é€’ -r no-run-if-empty å¦‚æœæ²¡æœ‰è¦å¤„ç†çš„å‚æ•°ä¼ é€’ç»™xargs xargs é»˜è®¤æ˜¯å¸¦ç©ºå‚æ•°è¿è¡Œä¸€æ¬¡ï¼Œå¦‚æœä½ å¸Œæœ›æ— å‚æ•°æ—¶ï¼Œåœæ­¢ xargsï¼Œç›´æ¥é€€å‡ºï¼Œä½¿ç”¨ -r é€‰é¡¹å³å¯ï¼Œå…¶å¯ä»¥é˜²æ­¢xargs åé¢å‘½ä»¤å¸¦ç©ºå‚æ•°è¿è¡ŒæŠ¥é”™ $ echo \"\"|xargs -t mv mv mv: missing file operand Try `mv --help' for more information. $ echo \"\"|xargs -t -r mv #ç›´æ¥é€€å‡º -s num xargsåé¢é‚£ä¸ªå‘½ä»¤çš„æœ€å¤§å‘½ä»¤è¡Œå­—ç¬¦æ•°(å«ç©ºæ ¼) -L ä»æ ‡å‡†è¾“å…¥ä¸€æ¬¡è¯»å–numè¡Œé€ç»™Commandå‘½ä»¤ ï¼Œ-lå’Œ-LåŠŸèƒ½ä¸€æ · $ cat 1.txt.bak aaa bbb ccc ddd a b ccc dsds $ cat 1.txt.bak |xargs -L 4 echo aaa bbb ccc ddd a b ccc dsds $ cat 1.txt.bak |xargs -L 1 echo aaa bbb ccc ddd a b ccc dsds -d delim åˆ†éš”ç¬¦ï¼Œé»˜è®¤çš„xargsåˆ†éš”ç¬¦æ˜¯å›è½¦ï¼Œargumentçš„åˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œä¿®æ”¹çš„æ˜¯xargsçš„åˆ†éš”ç¬¦ $ cat 1.txt.bak aaa@ bbb ccc@ ddd a b $ cat 1.txt.bak |xargs -d '@' echo aaa bbb ccc ddd a b ","date":"2021-02-28","objectID":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/:2:0","tags":["linux"],"title":"xargsåŸç†åŠä½¿ç”¨","uri":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/"},{"categories":["linux"],"content":"xargs ç»“åˆfind ä½¿ç”¨ ä¸¾ä¾‹ $find . -name \"install.log\" -print | cat ./install.log #æ˜¾ç¤ºä»ç®¡é“ä¼ æ¥çš„å†…å®¹ï¼Œä»…ä»…ä½œä¸ºå­—ç¬¦ä¸²æ¥å¤„ç† $find . -name \"install.log\" -print | xargs cat aaaaaa #å°†ç®¡é“ä¼ æ¥çš„å†…å®¹ä½œä¸ºæ–‡ä»¶ï¼Œäº¤ç»™catæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å‘½ä»¤æ‰§è¡Œçš„æ˜¯å¦‚æœå­˜åœ¨install.logï¼Œé‚£ä¹ˆå°±æ‰“å°å‡ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚ æ¥çœ‹çœ‹xargså‘½ä»¤æ˜¯å¦‚ä½•åŒfindå‘½ä»¤ä¸€èµ·ä½¿ç”¨çš„ï¼Œå¹¶ç»™å‡ºä¸€äº›ä¾‹å­ã€‚ 1ã€åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·å…·æœ‰è¯»ã€å†™å’Œæ‰§è¡Œæƒé™çš„æ–‡ä»¶ï¼Œå¹¶æ”¶å›ç›¸åº”çš„å†™æƒé™ï¼š # find . -perm -7 -print | xargs chmod o-w 2ã€æŸ¥æ‰¾ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨xargså‘½ä»¤æ¥æµ‹è¯•å®ƒä»¬åˆ†åˆ«å±äºå“ªç±»æ–‡ä»¶ # find . -type f -print | xargs file ./liyao: empty 3ã€å°è¯•ç”¨rm åˆ é™¤å¤ªå¤šçš„æ–‡ä»¶ï¼Œä½ å¯èƒ½å¾—åˆ°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼š/bin/rm Argument list too long. ç”¨xargs å»é¿å…è¿™ä¸ªé—®é¢˜ $find ~ -name â€˜*.logâ€™ -print0 | xargs -i -0 rm -f {} 4ã€æŸ¥æ‰¾æ‰€æœ‰çš„jpg æ–‡ä»¶ï¼Œå¹¶ä¸”å‹ç¼©å®ƒ # find / -name *.jpg -type f -print | xargs tar -cvzf images.tar.gz 5ã€æ‹·è´æ‰€æœ‰çš„å›¾ç‰‡æ–‡ä»¶åˆ°ä¸€ä¸ªå¤–éƒ¨çš„ç¡¬ç›˜é©±åŠ¨ # ls *.jpg | xargs -n1 -i cp {} /external-hard-drive/directory ","date":"2021-02-28","objectID":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/:3:0","tags":["linux"],"title":"xargsåŸç†åŠä½¿ç”¨","uri":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/"},{"categories":["linux"],"content":"æ€»ç»“ å‘½ä»¤ è§£é‡Š echo -n â€œhello#wordâ€ |xargs -d â€œ#â€ é€‚ç”¨#å·è¿›è¡Œæ‹†åˆ† echo â€œhello wordâ€|xargs -n 1 ä¸€æ¬¡ä¼ é€’ä¸€ä¸ªå‚æ•° echo -n â€œhello#wordâ€|xargs -d â€œ#â€ -t ç›´æ¥è¾“å‡ºæ‰“å°å‘½ä»¤æ— ç”¨æˆ·äº¤äº’ echo -n â€œhello#wordâ€|xargs -d â€œ#â€ -p ç”¨æˆ·äº¤äº’é€‰æ‹©æ˜¯å¦æ‰“å°å‘½ä»¤å¹¶ä¸”è¾“å‡ºæ‰“å°å‘½ä»¤ echo -n â€œhello#wordâ€|xargs -I {} echo {} å ä½ç¬¦initial arguments echo -n â€œâ€|xargs -r echo å°å†™r(no run if empty),å¦‚æœä¼ é€’çš„å‚æ•°ä¸ºç©ºåˆ™ä¸æ‰§è¡Œ ","date":"2021-02-28","objectID":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/:4:0","tags":["linux"],"title":"xargsåŸç†åŠä½¿ç”¨","uri":"/xargs%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/"},{"categories":["MySQL"],"content":"èƒŒæ™¯ æ•°æ®æ˜¯ä¼ä¸šç”Ÿäº§çš„é‡ä¸­ä¹‹é‡ï¼Œä¿æŠ¤æ•°æ®å®‰å…¨ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±å¾ˆå…³é”® ","date":"2020-08-17","objectID":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/:1:0","tags":["MySQL"],"title":"MySQL æ•°æ®åº“å¤‡ä»½å’Œè¿˜åŸ","uri":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/"},{"categories":["MySQL"],"content":"ä½¿ç”¨ mysqldump è¿›è¡Œå¤‡ä»½ å¤‡ä»½çš„æ–¹æ¡ˆåœºæ™¯ï¼Œåˆ—ä¸¾éƒ¨åˆ†åœºæ™¯ åªå¤‡ä»½æŸä¸€ä¸ªåº“ï¼Œä¸è¦é‡Œé¢çš„è¡¨ å¤‡ä»½æ‰€æœ‰çš„åº“ï¼Œå’Œæ‰€æœ‰çš„è¡¨ï¼Œä½†æ˜¯ä¸è¦è¡¨ä¸­çš„æ•°æ®ï¼Œåªå¤‡ä»½å®ƒçš„ç»“æ„(åˆ›å»ºçš„SQL) åªè¦æŸä¸€ä¸ªåº“ï¼Œä»¥åŠè¿™ä¸ªåº“ä¸­çš„æ‰€æœ‰è¡¨ï¼Œä»¥åŠæ‰€æœ‰æ•°æ® åªè¦æŸä¸€ä¸ªåº“ï¼Œé‡Œé¢çš„æŸä¸€å¼ è¡¨ mysqldump ç›¸å…³å‘½ä»¤\rmysqldumpå®¢æˆ·ç«¯å¯ç”¨æ¥è½¬å‚¨æ•°æ®åº“æˆ–æœé›†æ•°æ®åº“è¿›è¡Œå¤‡ä»½æˆ–å°†æ•°æ®è½¬ç§»åˆ°å¦ä¸€ä¸ªSQLæœåŠ¡å™¨(ä¸ä¸€å®šæ˜¯ä¸€ä¸ªMySQLæœåŠ¡å™¨)ã€‚è½¬å‚¨åŒ…å«åˆ›å»ºè¡¨å’Œ/æˆ–è£…è½½è¡¨çš„SQLè¯­å¥ã€‚ å¦‚æœä½ åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤‡ä»½ï¼Œå¹¶ä¸”è¡¨å‡ä¸ºMyISAMè¡¨ï¼Œåº”è€ƒè™‘ä½¿ç”¨mysqlhotcopyï¼Œå› ä¸ºå¯ä»¥æ›´å¿«åœ°è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ã€‚å‚è§8.9èŠ‚ï¼Œâ€œmysqlhotcopyï¼šæ•°æ®åº“å¤‡ä»½ç¨‹åºâ€ã€‚ æœ‰3ç§æ–¹å¼æ¥è°ƒç”¨mysqldumpï¼š shell\u003e mysqldump [options] db_name [tables] shell\u003e mysqldump [options] â€”database DB1 [DB2 DB3â€¦] shell\u003e mysqldump [options] â€“allâ€“database å¦‚æœæ²¡æœ‰æŒ‡å®šä»»ä½•è¡¨æˆ–ä½¿ç”¨äº†â€”databaseæˆ–â€“allâ€“databaseé€‰é¡¹ï¼Œåˆ™è½¬å‚¨æ•´ä¸ªæ•°æ®åº“ã€‚ è¦æƒ³è·å¾—ä½ çš„ç‰ˆæœ¬çš„mysqldumpæ”¯æŒçš„é€‰é¡¹ï¼Œæ‰§è¡Œmysqldump â€”helpã€‚ å¦‚æœè¿è¡Œmysqldumpæ²¡æœ‰â€“quickæˆ–â€“opté€‰é¡¹ï¼Œmysqldumpåœ¨è½¬å‚¨ç»“æœå‰å°†æ•´ä¸ªç»“æœé›†è£…å…¥å†…å­˜ã€‚å¦‚æœè½¬å‚¨å¤§æ•°æ®åº“å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œä½†å¯ä»¥ç”¨â€“skip-optç¦ç”¨ã€‚ å¦‚æœä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„mysqldumpç¨‹åºç”Ÿæˆä¸€ä¸ªè½¬å‚¨é‡è£…åˆ°å¾ˆæ—§ç‰ˆæœ¬çš„MySQLæœåŠ¡å™¨ä¸­ï¼Œä¸åº”ä½¿ç”¨â€“optæˆ–-eé€‰é¡¹ã€‚ mysqldumpæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š â€”helpï¼Œ-ï¼Ÿ æ˜¾ç¤ºå¸®åŠ©æ¶ˆæ¯å¹¶é€€å‡ºã€‚ â€“add-dropâ€“database åœ¨æ¯ä¸ªCREATE DATABASEè¯­å¥å‰æ·»åŠ DROP DATABASEè¯­å¥ã€‚\râ€“add-drop-tables åœ¨æ¯ä¸ªCREATE TABLEè¯­å¥å‰æ·»åŠ DROP TABLEè¯­å¥ã€‚\râ€“add-locking ç”¨LOCK TABLESå’ŒUNLOCK TABLESè¯­å¥å¼•ç”¨æ¯ä¸ªè¡¨è½¬å‚¨ã€‚é‡è½½è½¬å‚¨æ–‡ä»¶æ—¶æ’å…¥å¾—æ›´å¿«ã€‚å‚è§7.2.16èŠ‚ï¼Œâ€œINSERTè¯­å¥çš„é€Ÿåº¦â€ã€‚\râ€“allâ€“databaseï¼Œ-A è½¬å‚¨æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚ä¸ä½¿ç”¨---databaseé€‰é¡¹ç›¸åŒï¼Œåœ¨å‘½ä»¤è¡Œä¸­å‘½åæ‰€æœ‰æ•°æ®åº“ã€‚\râ€“allow-keywords å…è®¸åˆ›å»ºå…³é”®å­—åˆ—åã€‚åº”åœ¨æ¯ä¸ªåˆ—åå‰é¢åŠ ä¸Šè¡¨åå‰ç¼€ã€‚\râ€”comments[={0|1}] å¦‚æœè®¾ç½®ä¸º 0ï¼Œç¦æ­¢è½¬å‚¨æ–‡ä»¶ä¸­çš„å…¶å®ƒä¿¡æ¯ï¼Œä¾‹å¦‚ç¨‹åºç‰ˆæœ¬ã€æœåŠ¡å™¨ç‰ˆæœ¬å’Œä¸»æœºã€‚--skipâ€”commentsä¸---comments=0çš„ç»“æœç›¸åŒã€‚ é»˜è®¤å€¼ä¸º1ï¼Œå³åŒ…æ‹¬é¢å¤–ä¿¡æ¯ã€‚\râ€“compact äº§ç”Ÿå°‘é‡è¾“å‡ºã€‚è¯¥é€‰é¡¹ç¦ç”¨æ³¨é‡Šå¹¶å¯ç”¨--skip-add-drop-tablesã€--no-set-namesã€--skip-disable-keyså’Œ--skip-add-lockingé€‰é¡¹ã€‚\râ€“compatible=name äº§ç”Ÿä¸å…¶å®ƒæ•°æ®åº“ç³»ç»Ÿæˆ–æ—§çš„MySQLæœåŠ¡å™¨æ›´å…¼å®¹çš„è¾“å‡ºã€‚å€¼å¯ä»¥ä¸ºansiã€mysql323ã€mysql40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_tables_optionsæˆ–è€…no_field_optionsã€‚è¦ä½¿ç”¨å‡ ä¸ªå€¼ï¼Œç”¨é€—å·å°†å®ƒä»¬éš”å¼€ã€‚è¿™äº›å€¼ä¸è®¾ç½®æœåŠ¡å™¨SQLæ¨¡å¼çš„ç›¸åº”é€‰é¡¹æœ‰ç›¸åŒçš„å«ä¹‰ã€‚å‚è§5.3.2èŠ‚ï¼Œâ€œSQLæœåŠ¡å™¨æ¨¡å¼â€ã€‚\rè¯¥é€‰é¡¹ä¸èƒ½ä¿è¯åŒå…¶å®ƒæœåŠ¡å™¨ä¹‹é—´çš„å…¼å®¹æ€§ã€‚å®ƒåªå¯ç”¨é‚£äº›ç›®å‰èƒ½å¤Ÿä½¿è½¬å‚¨è¾“å‡ºæ›´å…¼å®¹çš„SQLæ¨¡å¼å€¼ã€‚ä¾‹å¦‚ï¼Œ--compatible=oracle ä¸æ˜ å°„Oracleç±»å‹æˆ–ä½¿ç”¨Oracleæ³¨é‡Šè¯­æ³•çš„æ•°æ®ç±»å‹ã€‚\râ€“complete-insertï¼Œ-c ä½¿ç”¨åŒ…æ‹¬åˆ—åçš„å®Œæ•´çš„INSERTè¯­å¥ã€‚\râ€“compressï¼Œ-C å‹ç¼©åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå¦‚æœäºŒè€…å‡æ”¯æŒå‹ç¼©ï¼‰ã€‚\râ€“create-option åœ¨CREATE TABLEè¯­å¥ä¸­åŒ…æ‹¬æ‰€æœ‰MySQLè¡¨é€‰é¡¹ã€‚\râ€”databaseï¼Œ-B è½¬å‚¨å‡ ä¸ªæ•°æ®åº“ã€‚é€šå¸¸æƒ…å†µï¼Œmysqldumpå°†å‘½ä»¤è¡Œä¸­çš„ç¬¬1ä¸ªåå­—å‚é‡çœ‹ä½œæ•°æ®åº“åï¼Œåé¢çš„åçœ‹ä½œè¡¨åã€‚ä½¿ç”¨è¯¥é€‰é¡¹ï¼Œå®ƒå°†æ‰€æœ‰åå­—å‚é‡çœ‹ä½œæ•°æ®åº“åã€‚CREATE DATABASE IF NOT EXISTS db_nameå’ŒUSE db_nameè¯­å¥åŒ…å«åœ¨æ¯ä¸ªæ–°æ•°æ®åº“å‰çš„è¾“å‡ºä¸­ã€‚\râ€”debug[=debug_options]ï¼Œ-# [debug_options] å†™è°ƒè¯•æ—¥å¿—ã€‚debug_optionså­—ç¬¦ä¸²é€šå¸¸ä¸º'd:t:o,file_name'ã€‚\râ€“default-character-set=charset ä½¿ç”¨charsetasé»˜è®¤å­—ç¬¦é›†ã€‚å‚è§5.10.1èŠ‚ï¼Œâ€œæ•°æ®å’Œæ’åºç”¨å­—ç¬¦é›†â€ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œmysqldumpä½¿ç”¨utf8ã€‚\râ€“delayed-insert ä½¿ç”¨INSERT DELAYEDè¯­å¥æ’å…¥è¡Œã€‚\râ€“delete-master-logs åœ¨ä¸»å¤åˆ¶æœåŠ¡å™¨ä¸Šï¼Œå®Œæˆè½¬å‚¨æ“ä½œååˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å¯ç”¨--master-dataã€‚\râ€“disable-keysï¼Œ-K å¯¹äºæ¯ä¸ªè¡¨ï¼Œç”¨/*!40000 ALTER TABLE tbl_name DISABLE KEYS */;å’Œ/*!40000 ALTER TABLE tbl_name ENABLE KEYS */;è¯­å¥å¼•ç”¨INSERTè¯­å¥ã€‚è¿™æ ·å¯ä»¥æ›´å¿«åœ°è£…è½½è½¬å‚¨æ–‡ä»¶ï¼Œå› ä¸ºåœ¨æ’å…¥æ‰€æœ‰è¡Œååˆ›å»ºç´¢å¼•ã€‚è¯¥é€‰é¡¹åªé€‚åˆMyISAMè¡¨ã€‚\râ€“extended-insertï¼Œ-e ä½¿ç”¨åŒ…æ‹¬å‡ ä¸ªVALUESåˆ—è¡¨çš„å¤šè¡ŒINSERTè¯­æ³•ã€‚è¿™æ ·ä½¿è½¬å‚¨æ–‡ä»¶æ›´å°ï¼Œé‡è½½æ–‡ä»¶æ—¶å¯ä»¥åŠ é€Ÿæ’å…¥ã€‚\râ€“fields-terminated-by=â€¦ï¼Œâ€“fields-enclosed-by=â€¦ï¼Œâ€“fields-optionally-enclosed-by=â€¦ï¼Œâ€“fields-escaped-by=â€¦ï¼Œâ€“è¡Œ-terminated-by=â€¦ è¿™äº›é€‰é¡¹ç»“åˆ-Té€‰é¡¹ä½¿ç”¨ï¼Œä¸LOAD DATA INFILEçš„ç›¸åº”å­å¥æœ‰ç›¸åŒçš„å«ä¹‰ã€‚å‚è§13.2.5èŠ‚ï¼Œâ€œLOAD DATA INFILEè¯­æ³•â€ã€‚\râ€“first-slaveï¼Œ-x ä¸èµæˆä½¿ç”¨ï¼Œç°åœ¨é‡æ–°å‘½åä¸º--lock-all-tablesã€‚\râ€“flush-logsï¼Œ-F å¼€å§‹è½¬å‚¨å‰åˆ·æ–°MySQLæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ã€‚è¯¥é€‰é¡¹è¦æ±‚RELOADæƒé™ã€‚è¯·æ³¨æ„å¦‚æœç»“åˆ--all--database(æˆ–-A)é€‰é¡¹ä½¿ç”¨è¯¥é€‰é¡¹ï¼Œæ ¹æ®æ¯ä¸ªè½¬å‚¨çš„æ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚ä¾‹å¤–æƒ…å†µæ˜¯å½“ä½¿ç”¨--lock-all-tablesæˆ–--master-dataçš„æ—¶å€™ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—åªåˆ·æ–°ä¸€æ¬¡ï¼Œåœ¨æ‰€æœ‰ è¡¨è¢«é”å®šååˆ·æ–°ã€‚å¦‚æœä½ æƒ³è¦åŒæ—¶è½¬å‚¨å’Œåˆ·æ–°æ—¥å¿—ï¼Œåº”ä½¿ç”¨--flush-logsè¿åŒ--lock-all-tablesæˆ–--master-dataã€‚\râ€“forceï¼Œ-f åœ¨è¡¨è½¬å‚¨è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å‡ºç°SQLé”™è¯¯ä¹Ÿç»§ç»­ã€‚ â€“host=host_nameï¼Œ-h host_name ä»ç»™å®šä¸»æœºçš„MySQLæœåŠ¡å™¨è½¬å‚¨æ•°æ®ã€‚é»˜è®¤ä¸»æœºæ˜¯localhostã€‚ â€“hex-blob ä½¿ç”¨åå…­è¿›åˆ¶ç¬¦å·è½¬å‚¨äºŒè¿›åˆ¶å­—ç¬¦ä¸²åˆ—(ä¾‹å¦‚ï¼Œâ€˜abcâ€™ å˜ä¸º0x616263)ã€‚å½±å“åˆ°çš„åˆ—æœ‰BINARYã€VARBINARYã€BLOBã€‚ â€“lock-all-tablesï¼Œ-x æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨åŠ é”ã€‚åœ¨æ•´ä½“è½¬å‚¨è¿‡ç¨‹ä¸­é€šè¿‡å…¨å±€è¯»é”å®šæ¥å®ç°ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­â€“single-transactionå’Œâ€“lock-tablesã€‚ â€“lock-tablesï¼Œ-l å¼€å§‹è½¬å‚¨å‰é”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ LOCALé”å®šè¡¨ä»¥å…è®¸å¹¶è¡Œæ’å…¥MyISAMè¡¨ã€‚å¯¹äºäº‹åŠ¡è¡¨ä¾‹å¦‚InnoDBå’ŒBDBï¼Œâ€“single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰é¡¹ï¼Œå› ä¸ºå®ƒä¸æ ¹æœ¬éœ€è¦é”å®šè¡¨ã€‚ è¯·æ³¨æ„å½“è½¬å‚¨å¤šä¸ªæ•°æ®åº“æ—¶ï¼Œâ€“lock-tablesåˆ†åˆ«ä¸ºæ¯ä¸ªæ•°æ®åº“é”å®šè¡¨ã€‚å› æ­¤ï¼Œè¯¥é€‰é¡¹ä¸èƒ½ä¿è¯è½¬å‚¨æ–‡ä»¶ä¸­çš„è¡¨åœ¨æ•°æ®åº“ä¹‹é—´çš„é€»è¾‘ä¸€è‡´æ€§ã€‚ä¸åŒæ•°æ®åº“è¡¨çš„è½¬å‚¨çŠ¶æ€å¯ä»¥å®Œå…¨ä¸åŒã€‚ â€“master-data[=value] è¯¥é€‰é¡¹å°†äºŒè¿›åˆ¶æ—¥å¿—çš„ä½ç½®å’Œæ–‡ä»¶åå†™å…¥åˆ°è¾“å‡ºä¸­ã€‚è¯¥é€‰é¡¹è¦æ±‚æœ‰RELOADæƒé™ï¼Œå¹¶ä¸”å¿…é¡»å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ã€‚å¦‚æœè¯¥é€‰é¡¹å€¼ç­‰äº1ï¼Œä½ç½®å’Œæ–‡ä»¶åè¢«å†™å…¥CHANGE MASTERè¯­å¥å½¢å¼çš„è½¬å‚¨è¾“å‡ºï¼Œå¦‚æœä½ ä½¿ç”¨è¯¥SQLè½¬å‚¨ä¸»æœåŠ¡å™¨ä»¥è®¾ç½®ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—çš„æ­£ç¡®ä½ç½®å¼€å§‹ã€‚å¦‚æœé€‰é¡¹å€¼ç­‰äº2ï¼ŒCHANGE MASTERè¯­å¥è¢«å†™æˆSQLæ³¨é‡Šã€‚å¦‚æœvalueè¢«çœç•¥ï¼Œè¿™æ˜¯é»˜è®¤åŠ¨ä½œã€‚ â€“master-data é€‰é¡¹å¯ç”¨â€“lock-all-tablesï¼Œé™¤éè¿˜æŒ‡å®šâ€“single-transaction(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªåœ¨åˆšå¼€å§‹è½¬å‚¨æ—¶çŸ­æ—¶é—´è·å¾—å…¨å±€è¯»é”å®šã€‚åˆè§â€“single-transactionã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—ç›¸å…³åŠ¨ä½œå‘ç”Ÿåœ¨è½¬å‚¨æ—¶ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­â€“lock-tablesã€‚ â€“no-create-dbï¼Œ-n è¯¥é€‰é¡¹ç¦ç”¨CREATE DATABASE /*!32312 IF NOT EXISTS*/ db_nameè¯­å¥ï¼Œå¦‚æœç»™å‡º---databaseæˆ–--all--databaseé€‰é¡¹ï¼Œåˆ™åŒ…å«åˆ°è¾“å‡ºä¸­ã€‚\râ€“no-create-infoï¼Œ-t ä¸å†™é‡æ–°åˆ›å»ºæ¯ä¸ªè½¬å‚¨è¡¨çš„CREATE TABLEè¯­å¥ã€‚\râ€“no-dataï¼Œ-d ä¸å†™è¡¨çš„ä»»ä½•è¡Œä¿¡æ¯ã€‚å¦‚æœä½ åªæƒ³è½¬å‚¨è¡¨çš„ç»“æ„è¿™å¾ˆæœ‰ç”¨ã€‚\râ€“opt è¯¥é€‰é¡¹æ˜¯é€Ÿè®°ï¼›ç­‰åŒäºæŒ‡å®š --add-drop-tables--add-locking --create-option --disable-keys--extended-insert ","date":"2020-08-17","objectID":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/:2:0","tags":["MySQL"],"title":"MySQL æ•°æ®åº“å¤‡ä»½å’Œè¿˜åŸ","uri":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/"},{"categories":["MySQL"],"content":"æ•°æ®å¤‡ä»½çš„å„ä¸ªåœºæ™¯ åœºæ™¯ä¸€ï¼šå¤‡ä»½æ‰€æœ‰æ•°æ®åº“å®ä¾‹ mysqldump -u root -p --all-databases\u003e all_databases.sql åœºæ™¯äºŒï¼šå¯¼å‡ºæŸä¸ªæˆ–æŸå‡ ä¸ªæ•°æ®åº“ æ•°æ®åº“ä¸ºmyblog mysqldump -u root -p --databases test mysql \u003e db_test_and_mysql.sql åœºæ™¯ä¸‰ï¼šå¯¼å‡ºä¸€å¼ è¡¨ æ•°æ®åº“ä¸ºmyblogï¼Œè¡¨ä¸ºwp_users mysqldump -u dbadmin -p myblog wp_users\u003e blog_users.sql åœºæ™¯å››ï¼šå¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„ å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ç»“æ„ -d æ²¡æœ‰æ•°æ® â€“add-drop-table åœ¨æ¯ä¸ªcreateè¯­å¥ä¹‹å‰å¢åŠ ä¸€ä¸ªdrop table mysqldump -u dbadmin -p -d --add-drop-table myblog \u003e blog_struc.sql åœºæ™¯äº”ï¼šå¯¼å‡ºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ç»“æ„ æ•°æ®åº“ä¸ºmyblogï¼Œè¡¨ä¸ºwp_users mysqldump -u dbadmin -p -d --add-drop-table myblog wp_users\u003e blog_users_struc.sql åœºæ™¯å…­ï¼šå¯¼å‡ºæ•°æ®åº“ä¸€ä¸ªè¡¨æ•°æ®,ä¸åŒ…æ‹¬è¡¨ç»“æ„ æ•°æ®åº“ä¸ºtestï¼Œè¡¨ä¸ºperson mysqldump -u root -p -t test person \u003e order.sql ","date":"2020-08-17","objectID":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/:2:1","tags":["MySQL"],"title":"MySQL æ•°æ®åº“å¤‡ä»½å’Œè¿˜åŸ","uri":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/"},{"categories":["MySQL"],"content":"æ•°æ®è¿˜åŸ æ•°æ®å¯¼å‡ºå°±æœ‰å¯¼å…¥è¿˜åŸ,åº“å®ä¾‹ä¸ºtest,å°†å¤‡ä»½çš„æ•°æ®è¿›è¡Œè¿˜åŸ mysql -h127.0.0.1 -uroot -P3306 -p test \u003c order.sql ","date":"2020-08-17","objectID":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/:2:2","tags":["MySQL"],"title":"MySQL æ•°æ®åº“å¤‡ä»½å’Œè¿˜åŸ","uri":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/"},{"categories":["MySQL"],"content":"é€šè¿‡ crontab å®šæ—¶å¤‡ä»½æŒ‡å®šæ•°æ®åº“è„šæœ¬å‚è€ƒ è„šæœ¬éªŒè¯é€‚ç”¨ç¯å¢ƒCentos7.x #!/bin/bash #set -e # å¤‡ä»½å¹¶æ¸…ç†ï¼Œå°†mysql è¡¨æ•°æ®ä¿ç•™21å¤© dateDir=$(date +%Y%m%d)\"_all\" backUpFolder=/zpaasssd/zcm/mysql_171_grafana_dashboard_bkp host=10.10.168.67 port=20821 username=\"root\" password=\"password\" main(){ mkdir ${backUpFolder}/${dateDir} #rm -rf ${backUpFolder}/$(date -d \"-21 day\" +%Y%m%d)\"_all\".tar.gz if [[ -f ${backUpFolder}/$(date -d \"-21 day\" +%Y%m%d)\"_all\".tar.gz ]];then rm -rf ${backUpFolder}/$(date -d \"-21 day\" +%Y%m%d)\"_all\".tar.gz fi mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_grafana --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_grafana.sql mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_grafpub --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_grafpub.sql #mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_nms --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_nms.sql mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_task --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_task.sql mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_dialing --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_dialing.sql #mysqldump -h $host -P $port -u ${username} -p${password} --databases zcm_idocs --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/zcm_idocs.sql mysqldump -h $host -P $port -u ${username} -p${password} --databases nms_sla --default-character-set utf8 \u003e ${backUpFolder}/${dateDir}/nms_sla.sql #å‹ç¼©å¤‡ä»½æ–‡ä»¶,æ¸…ç†åŸå§‹æ–‡ä»¶ cd ${backUpFolder} tar zcvf ${dateDir}.tar.gz ${dateDir} rm -rf ${backUpFolder}/${dateDir} # è§£å‹ #tar zxvf /zpaasssd/zcm/mysql_171_grafana_dashboard_bkp.tar.gz echo success } main ","date":"2020-08-17","objectID":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/:3:0","tags":["MySQL"],"title":"MySQL æ•°æ®åº“å¤‡ä»½å’Œè¿˜åŸ","uri":"/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/"},{"categories":["Ansible"],"content":"1. Ansible ç®€ä»‹ Ansibleæ˜¯ä¸€ä¸ªå¼€æºçš„ITè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œç”¨äºé…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€ä»»åŠ¡æ‰§è¡Œå’ŒæŒç»­äº¤ä»˜ã€‚å…¶è®¾è®¡ç›®æ ‡æ˜¯ç®€å•æ˜“ç”¨ï¼Œä»¥å¸®åŠ©ç³»ç»Ÿç®¡ç†å‘˜æ›´è½»æ¾åœ°ç®¡ç†æœåŠ¡å™¨åŸºç¡€è®¾æ–½ã€‚Ansibleé€šè¿‡YAMLï¼ˆYAML Ainâ€™t Markup Languageï¼‰æ ¼å¼çš„æ¸…æ™°æ˜“æ‡‚çš„æ–‡æœ¬å®šä¹‰é…ç½®ï¼ˆç§°ä¸ºPlaybookï¼‰ï¼Œè¿™ç§æ ¼å¼æœ‰åŠ©äºç”¨æˆ·å¿«é€Ÿç¼–å†™å’Œé˜…è¯»ä»»åŠ¡åŠé…ç½®ä¿¡æ¯ã€‚ ä»¥ä¸‹æ˜¯Ansibleçš„ä¸»è¦ç‰¹ç‚¹ï¼š ç®€å•æ˜“ç”¨ï¼šAnsibleæ— éœ€å¤æ‚çš„ç¯å¢ƒæ­å»ºå’Œç¼–ç¨‹è¯­è¨€çŸ¥è¯†ï¼Œé‡‡ç”¨YAMLè¯­æ³•ç¼–å†™ä»»åŠ¡ï¼Œå…·æœ‰é«˜åº¦å¯è¯»æ€§ã€‚éƒ¨ç½²åœ¨ç›®æ ‡ä¸»æœºä¸Šä¸éœ€è¦å®‰è£…Agentï¼Œå› æ­¤ä¸ä¼šå¢åŠ é¢å¤–è´Ÿæ‹…ã€‚ ä»£ç†æ— éœ€å®‰è£…ï¼šAnsibleé€šè¿‡SSHåè®®ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸Šæ— éœ€å®‰è£…é¢å¤–çš„ä»£ç†ç¨‹åºï¼Œå‡è½»äº†ç³»ç»Ÿè´Ÿæ‹…ã€‚ å¹‚ç­‰æ€§ï¼šAnsibleä»»åŠ¡çš„æ‰§è¡Œå…·æœ‰å¹‚ç­‰æ€§ï¼Œå³åŒä¸€ä»»åŠ¡è¢«å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œç»“æœç›¸åŒä¸”ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚è¿™ä½¿å¾—Ansibleåœ¨å¤šæ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå§‹ç»ˆä¿æŒç³»ç»Ÿçš„ç¨³å®šã€‚ æ¨¡å—åŒ–ï¼šAnsibleè‡ªå¸¦æ•°ç™¾ä¸ªå¯ç”¨äºå„ç§ä»»åŠ¡çš„æ¨¡å—ï¼Œå¦‚æ–‡ä»¶ç®¡ç†ã€è½¯ä»¶åŒ…å®‰è£…ã€ç³»ç»ŸæœåŠ¡ç®¡ç†ã€ç½‘ç»œè®¾å¤‡é…ç½®ç­‰ã€‚ç”¨æˆ·è¿˜å¯ä»¥ç¼–å†™è‡ªå®šä¹‰æ¨¡å—ä»¥å®ç°ç‰¹å®šåŠŸèƒ½ã€‚ é…ç½®ç®¡ç†ï¼šAnsible Playbookä¸­çš„å˜é‡ã€æ¨¡æ¿å’Œæ¡ä»¶å¤„ç†ç­‰åŠŸèƒ½ï¼Œä½¿å¾—é…ç½®æ–‡ä»¶å¯ä»¥è½»æ¾å®ç°å‚æ•°åŒ–ï¼ŒåŒæ—¶æ»¡è¶³å¤šç§ç¯å¢ƒå’Œä¸»æœºç»„çš„éœ€æ±‚ã€‚ ä»»åŠ¡ç¼–æ’ï¼šä½¿ç”¨Ansible Playbookï¼Œç”¨æˆ·å¯ä»¥ç¼–æ’ä¸€ç³»åˆ—ä»»åŠ¡å¹¶æŒ‰é¡ºåºæ‰§è¡Œã€‚ ç¤¾åŒºæ”¯æŒä¸ç”Ÿæ€ç³»ç»Ÿï¼šAnsibleæœ‰ä¸€ä¸ªåºå¤§ä¸”ç§¯æçš„ç¤¾åŒºï¼Œæä¾›å¤§é‡çš„æ¨¡å—ã€æ’ä»¶ã€æ•™ç¨‹å’ŒæŠ€æœ¯æ”¯æŒã€‚æ­¤å¤–ï¼ŒAnsibleå·²è¢«è®¸å¤šçŸ¥åä¼ä¸šé‡‡ç”¨ï¼ŒæŒç»­åœ°å®Œå–„å’Œæ‹“å±•åŠŸèƒ½ã€‚ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"1.1 ä½¿ç”¨åœºæ™¯ Ansibleä½œä¸ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œåº”ç”¨å¹¿æ³›ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼š ç³»ç»Ÿé…ç½®ç®¡ç†ï¼šä½¿ç”¨Ansibleï¼Œå¯ä»¥è½»æ¾åœ°å¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚è®¾ç½®ç”¨æˆ·ã€ç»„ã€æ–‡ä»¶æƒé™ã€ç½‘ç»œé…ç½®ç­‰ã€‚é€šè¿‡YAMLæ ¼å¼çš„Playbookæ¥ç®¡ç†é…ç½®ï¼Œä¾¿äºç»´æŠ¤åŠç‰ˆæœ¬æ§åˆ¶ã€‚ è½¯ä»¶åŒ…å®‰è£…ä¸å‡çº§ï¼šä½¿ç”¨Ansibleçš„è½¯ä»¶åŒ…ç®¡ç†æ¨¡å—å®‰è£…ã€å‡çº§æˆ–ç§»é™¤è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é’ˆå¯¹å¤§é‡æœåŠ¡å™¨çš„è½¯ä»¶å‡çº§ã€ä½ ä¹Ÿå¯ä»¥ç»Ÿä¸€è§„åˆ’è½¯ä»¶åŒ…çš„å®‰è£…å’Œç‰ˆæœ¬ã€‚ ä¸€é”®éƒ¨ç½²åº”ç”¨ä¸æœåŠ¡ï¼šé€šè¿‡Ansible Playbookå®ç°åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„å¿«é€Ÿã€è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚ä¾‹å¦‚ï¼Œéƒ¨ç½²WebæœåŠ¡ã€æ•°æ®åº“ã€è´Ÿè½½å‡è¡¡å™¨ç­‰ã€‚ æŒç»­é›†æˆä¸æŒç»­éƒ¨ç½²ï¼šå°†Ansibleä¸æŒç»­é›†æˆå·¥å…·ï¼ˆå¦‚Jenkinsï¼‰ç»“åˆï¼Œå®ç°ä»£ç è‡ªåŠ¨æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚å¯ä»¥å¤§å¤§æé«˜è½¯ä»¶å¼€å‘å’Œäº¤ä»˜çš„æ•ˆç‡ã€‚ å®šæ—¶ä»»åŠ¡ç®¡ç†ï¼šä½¿ç”¨Ansibleç®¡ç†å®šæ—¶ä»»åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤Linuxç³»ç»Ÿä¸­çš„crontabä»»åŠ¡ã€‚ ç½‘ç»œè®¾å¤‡ç®¡ç†ï¼šä½¿ç”¨Ansibleç®¡ç†ç½‘ç»œè®¾å¤‡ï¼ŒåŒ…æ‹¬è·¯ç”±å™¨ã€äº¤æ¢æœºå’Œé˜²ç«å¢™ç­‰ã€‚å¯ä»¥å¿«é€Ÿåœ°æ‰§è¡Œé…ç½®æ›´æ”¹ã€æ•…éšœæ’æŸ¥å’Œæ€§èƒ½æ•°æ®é‡‡é›†ç­‰ä»»åŠ¡ã€‚ æ‰©å±•åŸºç¡€è®¾æ–½ï¼šé€‚ç”¨äºäº‘è®¡ç®—ç¯å¢ƒä¸­çš„åŸºç¡€è®¾æ–½ç®¡ç†ï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºã€é…ç½®å’Œé”€æ¯è™šæ‹Ÿæœºæˆ–å®¹å™¨ï¼Œä»¥æ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚ å®‰å…¨æ€§ç®¡ç†ï¼šä½¿ç”¨Ansibleè¿›è¡Œå®‰å…¨åŠ å›ºå’Œå®¡è®¡ï¼Œä¾‹å¦‚ç®¡ç†SSLè¯ä¹¦ã€é˜²ç«å¢™è§„åˆ™ã€OSå®‰å…¨è¡¥ä¸ç­‰ã€‚ ç›‘æ§ä¸å‘Šè­¦ï¼šé€šè¿‡Ansibleéƒ¨ç½²å’Œé…ç½®å„ç§ç›‘æ§å·¥å…·ï¼ˆå¦‚Nagiosã€Zabbixç­‰ï¼‰ï¼Œå®ç°å¯¹æœåŠ¡å™¨ã€åº”ç”¨ç¨‹åºå’Œç½‘ç»œè®¾å¤‡çš„ç›‘æ§ä¸å‘Šè­¦ã€‚ è·¨å¹³å°ç®¡ç†ï¼šAnsibleæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥åœ¨Linuxã€Windowsã€MacOSç­‰ç³»ç»Ÿä¸Šå®ç°ç»Ÿä¸€çš„é…ç½®ç®¡ç†å’Œä»»åŠ¡æ‰§è¡Œã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒAnsibleå‡­å€Ÿå…¶çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¯å¹¿æ³›åº”ç”¨äºå„ç§åœºæ™¯ã€‚æ ¹æ®å…·ä½“éœ€æ±‚ï¼Œç”¨æˆ·å¯ä»¥å¼€å‘è‡ªå®šä¹‰æ¨¡å—å’Œæ’ä»¶ï¼Œè¿›ä¸€æ­¥å®ç°è‡ªåŠ¨åŒ–è¿ç»´çš„é«˜æ•ˆæ€§ã€‚ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:1","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"1.2 å·¥ä½œåŸç† ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:2","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"1.3 å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:3","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"1.4 ansible ç®¡ç†å‘½ä»¤ Ansibleå‘½ä»¤è¡Œæ‰§è¡Œæ–¹å¼æœ‰Ad-Hocã€Ansible-playbookä¸¤ç§æ–¹å¼ï¼š Ad-Hocä¸»è¦ç”¨äºä¸´æ—¶å‘½ä»¤çš„æ‰§è¡Œã€‚ Ansibel-playbookå¯ä»¥ç†è§£ä¸ºAd-Hocçš„é›†åˆï¼Œé€šè¿‡ä¸€å®šçš„è§„åˆ™ç¼–æ’åœ¨ä¸€èµ·ã€‚ ä¸¤è€…çš„æ“ä½œä¹Ÿæå…¶ç®€ä¾¿ï¼Œä¸”æä¾›äº†å¦‚with_itemsã€failed_whenã€changed_whenã€untilã€ignore_errorsç­‰ä¸°å¯Œçš„é€»è¾‘æ¡ä»¶å’ŒDry-runçš„Check Modeã€‚ä½†åœ¨Chceck Modeä¸‹å¹¶ä¸çœŸæ­£æ‰§è¡Œå‘½ä»¤ï¼Œå³å°†æ‰§è¡Œçš„æ“ä½œä¸ä¼šå¯¹ç«¯æœåŠ¡å™¨äº§ç”Ÿä»»ä½•å½±å“ï¼Œåªæ¨¡æ‹Ÿå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡Œã€‚ Ansibleç®¡ç†å‘½ä»¤æœ‰ï¼š ansibleï¼šè¿™ä¸ªå‘½ä»¤æ˜¯æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨ç‡éå¸¸é«˜çš„å‘½ä»¤ä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºä¸´æ—¶ä¸€æ¬¡æ€§æ“ä½œã€‚ ansible-docï¼šAnsibleæ¨¡å—æ–‡æ¡£è¯´æ˜ï¼Œé’ˆå¯¹æ¯ä¸ªæ¨¡å—éƒ½æœ‰è¯¦ç»†çš„ç”¨æ³•è¯´æ˜å’Œåº”ç”¨æ¡ˆä¾‹ä»‹ç»ã€‚ ansible-galaxyï¼šå¯ä»¥ç®€å•çš„ç†è§£ä¸ºGithubæˆ–PIPçš„åŠŸèƒ½ï¼Œæ˜¯Ansibleå®˜æ–¹ä¸€ä¸ªåˆ†äº«roleçš„åŠŸèƒ½å¹³å°ã€‚å¯ä»¥é€šè¿‡ansible-galaxyå‘½ä»¤å¾ˆç®€å•çš„å®ç°roleçš„åˆ†äº«å’Œå®‰è£…ã€‚ ansible-playbookï¼šæ˜¯æ—¥å¸¸åº”ç”¨ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å‘½ä»¤ï¼Œå…¶å·¥ä½œæœºåˆ¶æ˜¯ï¼Œé€šè¿‡è¯»å–é¢„å…ˆç¼–å†™å¥½çš„playbookæ–‡ä»¶å®ç°æ‰¹é‡ç®¡ç†ã€‚ ansible-pullï¼šAnsibleçš„å¦ä¸€ç§å·¥ä½œæ¨¡å¼ï¼ˆpullæ¨¡å¼ï¼‰ï¼ŒAnsibleé»˜è®¤ä½¿ç”¨pushæ¨¡å¼ã€‚ ansible-vaultï¼šä¸»è¦ç”¨äºé…ç½®æ–‡ä»¶åŠ å¯†ã€‚ ansible-consoleï¼šè®©ç”¨æˆ·å¯ä»¥åœ¨ansible-consoleè™šæ‹Ÿå‡ºæ¥çš„ç»ˆç«¯ä¸ŠåƒShellä¸€æ ·ä½¿ç”¨Ansibleå†…ç½®çš„å„ç§å‘½ä»¤ã€‚ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:4","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"2. install éƒ¨ç½² dns resolve(å¯é€‰) install ansible å®‰è£… $ yum install epel-release -y $ yum install ansible -y æ£€æµ‹éƒ¨ç½²æ˜¯å¦å®Œæˆ rpm -ql ansible åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ rpm -qc ansible æŸ¥çœ‹é…ç½®æ–‡ä»¶ ansible --help æŸ¥çœ‹ansibleå¸®åŠ© ansible-doc -l æŸ¥çœ‹ansibleæ‰€æœ‰æ¨¡å— ansible-doc -s yum æŸ¥çœ‹ansible yumæ¨¡å—,å¹¶æŸ¥çœ‹å…¶åŠŸèƒ½ æ³¨æ„ï¼š éƒ¨åˆ†yumæ–¹å¼å®‰è£…ansibleå¯èƒ½ä¼šå‡ºé”™ï¼Œå¯ä»¥é€‰æ‹©é‡‡ç”¨rpmè¿›è¡Œå®‰è£… é‡‡å‘-rpmå®‰è£…çš„ï¼Œè¿è¡Œä¼šæç¤ºç¼ºå°‘argparse modulesï¼Œç”¨yum install python-argparseå®‰è£…å³å¯ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:2:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"2.1 å…å¯†é…ç½®(å¯é€‰) $ ssh-keygen -t dsa $ ssh-copy-id 192.168.143.102 $ ssh 192.168.143.102 Last login: Tue Jan 7 11:44:30 2025 from 192.168.143.1 $ ip a|grep 192.168.143.102 inet 192.168.143.102/24 brd 192.168.143.255 scope global ens32 ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:2:1","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"3. Ansible åŸºç¡€ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:3:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"3.1 é…ç½®ä¸»æœºæ¸…å• root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com 192.168.143.102 ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:3:1","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"3.2 æµ‹è¯• ansible æ¨¡å— æŒ‡å®špingæ¨¡å— $ ansible localhost -m ping localhost | SUCCESS =\u003e { \"changed\": false, \"ping\": \"pong\" } root@localhost:~$ ansible 192.168.143.102 -m ping 192.168.143.102 | SUCCESS =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false, \"ping\": \"pong\" } # å¦‚æœç›®æ ‡ä¸»æœºæœªè®¾ç½®å…å¯†ç™»å½•ï¼Œå¹¶è®¾ç½®ç®€æ´è¾“å‡º root@localhost:~$ ansible 192.168.143.102 -m ping -o -u root -k SSH password: 192.168.143.102 | SUCCESS =\u003e {\"ansible_facts\": {\"discovered_interpreter_python\": \"/usr/bin/python\"}, \"changed\": false, \"ping\": \"pong\"} ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:3:2","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"4. Inventory ä¸»æœºæ¸…å• å¢åŠ ä¸»æœºç»„ root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com [webserver] host1 host2 host3 host4 æµ‹è¯•ç»„ $ ansible webserver -m ping -o -u root -k SSH password: 192.168.143.102 | SUCCESS =\u003e {\"ansible_facts\": {\"discovered_interpreter_python\": \"/usr/bin/python\"}, \"changed\": false, \"ping\": \"pong\"} å¢åŠ ç”¨æˆ·åå’Œå¯†ç  root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com [webserver2] 192.168.143.102 ansible_ssh_user='root' ansible_ssh_pass='123456' æµ‹è¯• root@localhost:~$ ansible webserver2 -m ping -o 192.168.143.102 | SUCCESS =\u003e {\"ansible_facts\": {\"discovered_interpreter_python\": \"/usr/bin/python\"}, \"changed\": false, \"ping\": \"pong\"} å¢åŠ ç«¯å£ root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com [webserver3] 192.168.143.102 ansible_ssh_user='root' ansible_ssh_pass='123456' ansible_ssh_port='22' æµ‹è¯• root@localhost:~$ ansible webserver3 -m ping -o 192.168.143.102 | SUCCESS =\u003e {\"ansible_facts\": {\"discovered_interpreter_python\": \"/usr/bin/python\"}, \"changed\": false, \"ping\": \"pong\"} ç»„ï¼šå˜é‡ root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com [webserver] host1 ansible_ssh_port='2222' # å®šåˆ¶åŒ–ç«¯å£ host2 host3 host4 [webserver:vars] ansible_ssh_user='root' ansible_ssh_pass='123456' å­åˆ†ç»„ root@localhost:~$ vim /etc/ansible/hosts ... ## db-[99:101]-node.example.com [tomcaterver] host1 host2 [mysqlterver] host3 host4 [productserver:children] æµ‹è¯• $ ansible productserver -m ping -o è‡ªå®šä¹‰ä¸»æœºåˆ—è¡¨ $ ansible -i /etc/ansible/hosts webserver -m ping -o 192.168.143.102 | SUCCESS =\u003e {\"ansible_facts\": {\"discovered_interpreter_python\": \"/usr/bin/python\"}, \"changed\": false, \"ping\": \"pong\"} Ansible ä¸»æœºæ¸…å•å‚æ•°è¯´æ˜ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:4:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"6. Add-Hoc ç‚¹å¯¹ç‚¹æ¨¡å¼ å†…éƒ¨æŒ‡ä»¤å¸¸ç”¨æ¨¡å— shell copy user è½¯ä»¶åŒ…ç®¡ç† æœåŠ¡æ¨¡å— æ–‡ä»¶æ¨¡å— æ”¶é›†æ¨¡å— fetch cron group script unarchive copyæ¨¡å—æ¡ˆä¾‹ $ touch /tmp/1.txt $ ansible-doc copy $ ansible webserver -m copy -a 'src=/tmp/1.txt dest=/tmp/11.txt owner=root group=root mode=777' 192.168.143.102 | CHANGED =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": true, \"checksum\": \"da39a3ee5e6b4b0d3255bfef95601890afd80709\", \"dest\": \"/tmp/11.txt\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"d41d8cd98f00b204e9800998ecf8427e\", \"mode\": \"0777\", \"owner\": \"root\", \"secontext\": \"unconfined_u:object_r:admin_home_t:s0\", \"size\": 0, \"src\": \"/root/.ansible/tmp/ansible-tmp-1736236277.53-3361-267624272356035/source\", \"state\": \"file\", \"uid\": 0 } ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:5:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"7. Role è§’è‰²æ‰®æ¼” Roleåˆ™æ˜¯åœ¨ansibleä¸­ï¼Œplaybooksçš„ç›®æ ‡ç»„ç»‡ç»“æ„ã€‚å°†ä»£ç æˆ–æ–‡ä»¶è¿›è¡Œæ¨¡å—åŒ–ï¼Œæˆä¸ºrolesçš„æ–‡ä»¶ç›®å½•ç»„ç»‡ç»“æ„ï¼Œæ˜“è¯»ï¼Œä»£ç å¯é‡ç”¨ï¼Œå±‚æ¬¡æ¸…æ™°ã€‚ è‡ªåŠ¨åŒ–è¿ç»´é¢è¯•çš„æ—¶å€™é—®åˆ°ansibleçš„ä¼šæ¯”è¾ƒå¤šä¸€äº›ï¼Œansibleé—®çš„æ›´å¤šçš„ä¾¿æ˜¯playbookäº†ã€‚ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"1. ç›®å½•ç»“æ„ Ansible çš„ Role æ˜¯ä¸€ç§å°† Playbook ä¸­çš„ä»»åŠ¡ã€å˜é‡ã€æ¨¡æ¿å’Œæ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·çš„æ–¹æ³•ï¼Œä½¿å¾— Playbook æ›´åŠ æ¨¡å—åŒ–ã€å¯é‡ç”¨å’Œæ˜“äºç®¡ç†ã€‚æ¯ä¸ª Role é€šå¸¸å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–æœåŠ¡ï¼ˆå¦‚ web server, database ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ Ansible Role ç›®å½•ç»“æ„ï¼š roles/ â””â”€â”€ myrole â”œâ”€â”€ defaults # å®šä¹‰é»˜è®¤å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥åœ¨å¤–éƒ¨è¢«è¦†ç›–ã€‚ â”‚ â””â”€â”€ main.yml # é»˜è®¤å˜é‡æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºè®¾ç½®å¯é€‰é…ç½®é¡¹ã€‚ â”œâ”€â”€ files # å­˜æ”¾éœ€è¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºä¸Šçš„é™æ€æ–‡ä»¶ã€‚ â”œâ”€â”€ handlers # å®šä¹‰å¯ä»¥ç”±ä»»åŠ¡è§¦å‘çš„åŠ¨ä½œï¼ˆå¦‚é‡å¯æœåŠ¡ï¼‰ã€‚ â”‚ â””â”€â”€ main.yml # å¤„ç†ç¨‹åºæ–‡ä»¶ï¼Œå®šä¹‰äº†å½“æŸäº›æ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡Œçš„æ“ä½œã€‚ â”œâ”€â”€ meta # åŒ…å«è§’è‰²å…ƒæ•°æ®ï¼Œå¦‚ä¾èµ–å…³ç³»ã€å¹³å°å…¼å®¹æ€§ç­‰ã€‚ â”‚ â””â”€â”€ main.yml # å…ƒæ•°æ®æ–‡ä»¶ï¼ŒæŒ‡å®šè§’è‰²ä¾èµ–å’Œå…¶ä»–å±æ€§ã€‚ â”œâ”€â”€ README.md # è¯´æ˜æ–‡æ¡£ï¼Œæè¿°è§’è‰²çš„åŠŸèƒ½ã€ä½¿ç”¨æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹ã€‚ â”œâ”€â”€ tasks # è§’è‰²çš„ä¸»è¦ä»»åŠ¡åˆ—è¡¨ï¼Œå®šä¹‰è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œã€‚ â”‚ â””â”€â”€ main.yml # å¿…é¡»å­˜åœ¨çš„å…¥å£æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—çš„ä»»åŠ¡å®šä¹‰ã€‚å…¶å®ƒç›®å½•å’Œæ–‡ä»¶ä¸ºå¯é€‰ â”œâ”€â”€ templates # å­˜æ”¾ Jinja2 æ¨¡æ¿æ–‡ä»¶ï¼Œç”¨äºç”Ÿæˆé…ç½®æ–‡ä»¶ç­‰æ–‡æœ¬å†…å®¹ã€‚ â”œâ”€â”€ tests # æµ‹è¯•ç”¨ä¾‹ç›®å½•ï¼Œé€šå¸¸åŒ…æ‹¬æµ‹è¯• Playbook å’Œåº“å­˜æ–‡ä»¶ã€‚ â”‚ â”œâ”€â”€ inventory # æµ‹è¯•ç¯å¢ƒçš„åº“å­˜æ–‡ä»¶ï¼Œå®šä¹‰äº†æµ‹è¯•ç›®æ ‡ä¸»æœºã€‚ â”‚ â””â”€â”€ test.yml # æµ‹è¯• Playbook æ–‡ä»¶ï¼Œç”¨äºéªŒè¯è§’è‰²æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚ â””â”€â”€ vars # å®šä¹‰ä¸å¯è¦†ç›–çš„å˜é‡ï¼Œé€šå¸¸ç”¨äºå¼ºåˆ¶æ€§çš„é…ç½®é€‰é¡¹ã€‚ â””â”€â”€ main.yml # å˜é‡æ–‡ä»¶ï¼ŒåŒ…å«äº†è§’è‰²æ‰€éœ€çš„å›ºå®šé…ç½®å€¼ã€‚ å„ä¸ªç›®å½•å’Œæ–‡ä»¶çš„ä½œç”¨ defaults/: æ­¤ç›®å½•ä¸‹çš„ main.yml æ–‡ä»¶åŒ…å«äº†è¯¥è§’è‰²çš„é»˜è®¤å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ç”¨æˆ·è‡ªå®šä¹‰æˆ–è¦†ç›–ã€‚å®ƒä»¬é€šå¸¸æ˜¯å¯é€‰çš„é…ç½®é¡¹ï¼Œæä¾›äº†åˆç†çš„é»˜è®¤å€¼ã€‚ files/: è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾é‚£äº›ä¸éœ€è¦ç»è¿‡æ¨¡æ¿å¤„ç†å°±å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„é™æ€æ–‡ä»¶ã€‚ handlers/: åœ¨è¿™é‡Œå®šä¹‰çš„æ˜¯å¤„ç†ç¨‹åºï¼Œå®ƒä»¬æ˜¯ä¸€äº›ç‰¹æ®Šçš„ä»»åŠ¡ï¼Œåªæœ‰å½“å…¶ä»–ä»»åŠ¡é€šçŸ¥å®ƒä»¬æ—¶æ‰ä¼šè¢«æ‰§è¡Œã€‚å¸¸è§çš„ä¾‹å­æ˜¯é‡å¯æœåŠ¡ï¼Œå› ä¸ºè¿™é€šå¸¸ä¸åº”è¯¥åœ¨æ¯æ¬¡è¿è¡Œæ—¶éƒ½å‘ç”Ÿï¼Œè€Œæ˜¯åœ¨é…ç½®æ›´æ”¹åæ‰éœ€è¦ã€‚ meta/: åŒ…å«æœ‰å…³è§’è‰²çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒå¯èƒ½ä¾èµ–çš„å…¶ä»–è§’è‰²ã€é€‚ç”¨çš„æ“ä½œç³»ç»Ÿç±»å‹ç­‰ã€‚è¿™å¯¹äºç¡®ä¿è§’è‰²æ­£ç¡®å®‰è£…å…¶ä¾èµ–é¡¹éå¸¸é‡è¦ã€‚ README.md: æä¾›å…³äºè§’è‰²çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å¦‚ä½•ä½¿ç”¨å®ƒã€å®ƒçš„åŠŸèƒ½æ˜¯ä»€ä¹ˆä»¥åŠä»»ä½•é‡è¦çš„æç¤ºæˆ–è­¦å‘Šã€‚ tasks/: è¿™æ˜¯è§’è‰²çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œmain.yml æ–‡ä»¶ä¸­åˆ—å‡ºäº†æ‰€æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™æ˜¯å½“ä½ å°†è§’è‰²æ·»åŠ åˆ° Playbook ä¸­æ—¶ä¼šè¢«è°ƒç”¨çš„åœ°æ–¹ã€‚ templates/: å¦‚æœä½ éœ€è¦åˆ›å»ºåŸºäºæ¨¡æ¿çš„æ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›æ¨¡æ¿åº”è¯¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚Ansible ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“è¿™äº›æ¨¡æ¿ï¼Œå¹¶æ ¹æ®éœ€è¦æ’å…¥å˜é‡å€¼ã€‚ tests/: è¯¥ç›®å½•åŒ…å«äº†ç”¨äºæµ‹è¯•è§’è‰²çš„èµ„æºï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ¨¡æ‹Ÿçš„åº“å­˜æ–‡ä»¶å’Œä¸€ä¸ªæˆ–å¤šä¸ªæµ‹è¯• Playbookã€‚è¿™å¯¹äºå¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•éå¸¸æœ‰ç”¨ã€‚ vars/: æ­¤ç›®å½•ä¸­çš„ main.yml æ–‡ä»¶å®šä¹‰äº†è§’è‰²æ‰€éœ€çš„å˜é‡ï¼Œè¿™äº›å˜é‡åº”è¯¥æ˜¯ä¸å¯è½»æ˜“è¦†ç›–çš„ï¼Œå› ä¸ºå®ƒä»¬ä»£è¡¨äº†è§’è‰²å†…éƒ¨çš„å…³é”®é…ç½®ã€‚ é€šè¿‡è¿™æ ·çš„ç»„ç»‡æ–¹å¼ï¼ŒAnsible çš„ Roles ä¸ä»…æ˜“äºç†è§£ï¼Œè€Œä¸”ä¹Ÿä¿ƒè¿›äº†ä»£ç çš„é‡ç”¨æ€§å’Œæ¨¡å—åŒ–è®¾è®¡ã€‚ ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:1","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"2. ç¼–å†™ä»»åŠ¡ åˆ›å»ºä¸€ä¸ª Role ä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸Šè¿°ç›®å½•ç»“æ„ï¼Œæˆ–è€…ä½¿ç”¨ ansible-galaxy å‘½ä»¤æ¥è‡ªåŠ¨åˆ›å»ºã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ ansible-galaxy åˆ›å»º Role çš„æ­¥éª¤ï¼š æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ã€‚ ä½¿ç”¨ ansible-galaxy role init æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Roleã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªåä¸º myrole çš„ Roleï¼Œä½ ä¼šè¿è¡Œï¼š root@localhost:/etc/ansible$ ansible-galaxy role init myrole^C root@localhost:/etc/ansible$ tree roles/ roles/ â””â”€â”€ myrole â”œâ”€â”€ defaults â”‚ â””â”€â”€ main.yml â”œâ”€â”€ files â”œâ”€â”€ handlers â”‚ â””â”€â”€ main.yml â”œâ”€â”€ meta â”‚ â””â”€â”€ main.yml â”œâ”€â”€ README.md â”œâ”€â”€ tasks â”‚ â””â”€â”€ main.yml â”œâ”€â”€ templates â”œâ”€â”€ tests â”‚ â”œâ”€â”€ inventory â”‚ â””â”€â”€ test.yml â””â”€â”€ vars â””â”€â”€ main.yml 9 directories, 8 files ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:2","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"3. å‡†å¤‡é…ç½®æ–‡ä»¶ files ç›®å½•ä¸‹æ˜¯å­˜æ”¾é™æ€æ–‡ä»¶ï¼Œtemplates ç›®å½•ä¸‹æ˜¯å­˜æ”¾æ¨¡æ¿æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è®¾ç½®å ä½ç¬¦ä¸€èˆ¬æ˜¯ç»“åˆvars å˜é‡å’Œsetupæ¨¡å—è¿›è¡Œç»„åˆä½¿ç”¨ã€‚ åœ¨files ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œé€šè¿‡å¤„ç†ç¨‹åºå°†å…¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœº $ cd files $ touch ansible.txt åœ¨templates ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ $ cd templates $ vim ansible-templates.txt the ntp_port is {{ ntp_port }} ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:3","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"4. ç¼–å†™å˜é‡ å˜é‡ç»“åˆæ¨¡æ¿æ–‡ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œæ–¹ä¾¿åŠ¨æ€ä¿®æ”¹ $ cd vars $ vim main.yml ntp_port: 8888 ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:4","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"5. ç¼–å†™å¤„ç†ç¨‹åº å¤„ç†ç¨‹åºtaskså¯ä»¥ç†è§£ä¸ºplaybookçš„å¯¼æ¼” $ cd tasks $ vim main.yml - name: \"Tasks in role demo\" debug: msg=\"Simple role example\" - name: \"copy file to dest host\" copy: src: ansible.txt dest: /tmp/ansible.txt mode: 0644 - name: \"template file to dest host\" template: src: ansible-template.txt dest: /tmp/ansible-template.txt owner: root group: root mode: 0644 ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:5","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"6. å‰§æœ¬ç¼–å†™ site.yaml å¯ä»¥ç†è§£ä¸ºå‰§æœ¬ï¼Œå¯ä»¥è®¾ç½®æ¯ä¸ªroleçš„æ‰§è¡Œé¡ºåºï¼Œä¾‹å¦‚å†¯å°åˆšå¯¼æ¼”çš„ç”µå½±1942çš„å‰§æœ¬å°±æ˜¯åˆ˜éœ‡äº‘ç¼–å‰§çš„ $ cd /etc/ansible/role $ vim site.yaml --- # This playbook install base_vm - hosts: nodes #gather_facts: yes pre_tasks: - name: pre task shell: echo \"hello\" in pre_tasks roles: - role: myrole #when: \"ansible_os_family == 'RedHat'\" # æ¡ä»¶åˆ¤æ–­å¯ä»¥å°†å…¶æ³¨é‡Šæ‰ï¼Œç»“åˆgather_factsä¸€èµ·ä½¿ç”¨ tasks: - name: tasks in site.yaml debug: msg=\"this is task in site.yaml\" post_tasks: - name: post task shell: echo \"goodbye\" in post_tasks ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:6","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"7. æµ‹è¯• å¯¹playbookè¿›è¡Œè¯­æ³•æµ‹è¯• $ ansible-playbook site.yaml --syntax-check playbook: site.yaml # æŸ¥çœ‹è¾“å‡ºçš„ç»†èŠ‚ $ ansible-playbook -i hosts site.yml --verbose # æŸ¥çœ‹è¯¥è„šæœ¬å½±å“å“ªäº›ä¸»æœº $ ansible-playbook -i hosts site.yml --list-hosts # å¹¶è¡Œæ‰§è¡Œè„šæœ¬ $ ansible-playbook site.yml -f 10 # Dry run $ ansible-playbook site.yml --check ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:6:7","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["Ansible"],"content":"å‚è€ƒ Ansible ç¤¾åŒºæ–‡æ¡£ Ansibleä¸­æ–‡æƒå¨æŒ‡å— è‡ªåŠ¨åŒ–è¿ç»´-Ansible03-Ansibleå¸¸ç”¨å‘½ä»¤å’Œæ¨¡å— githubå®˜ç½‘ ansible examples è¿ç»´è‡ªåŠ¨åŒ–ä¹‹ANSIBLE Ansible Galaxy ","date":"2020-06-27","objectID":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:7:0","tags":["Ansible"],"title":"Ansible éƒ¨ç½²åŠå¿«é€Ÿå…¥é—¨","uri":"/ansible%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["learning method"],"content":"\ræ‘˜è¦\ræ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ éœ€è¦ä¸€ä¸ªè‰¯å¥½çš„å­¦ä¹ æƒ…ç»ªå’Œä¸“æ³¨åŠ›ã€‚ ä¸‹é¢ä¸»è¦æ˜¯å­¦ä¹ èŠ‚å¥çš„æ§åˆ¶ æ”¹å˜å­¦ä¹ å¿ƒæ€ï¼Œè€Œä¸æ˜¯åœ¨ç”µè„‘æ—åäº†12å°æ—¶ï¼Œå…¶å®åªæ˜¯å­¦äº†2ä¸ªå°æ—¶\r","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:0:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"1. å¦‚ä½•é€‰æ‹©å­¦ä¹ æ—¶é—´ é€‰æ‹©åœ¨æ—©ä¸Šå’Œä¸‹åˆå­¦ä¹ ï¼Œå°½é‡ä¸è¦é€‰æ‹©åœ¨æ™šä¸Šå­¦ä¹ (ä¿æŠ¤å‘é™…çº¿)ã€‚ åœ¨ç¡å‰å¤§é‡ç”¨è„‘ï¼Œä¼šè®©è„‘è¢‹å³ç´§å¼ æœ‰ç–²åŠ³ï¼Œè¿˜ä¼šå½±å“ç¡çœ è´¨é‡ã€‚ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:1:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"2.æŠŠæ—¶é—´åˆ†æˆå‡ æ®µ å‡è®¾ä½ ä»Šå¤©æ—©ä¸Šæ‰“ç®—å­¦6ä¸ªå°æ—¶ï¼Œå¯ä»¥å®‰æ’æ—©æ™¨2.5å°æ—¶ï¼Œ ä¸‹åˆå®‰æ’2å°æ—¶ï¼Œæ™šä¸Šå®‰æ’1.5å°æ—¶ã€‚æŠŠå°½é‡å¤šçš„ä»»åŠ¡æ”¾åˆ°æ—©ä¸Šå’Œä¸­åˆå»å®Œæˆã€‚ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:2:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"3. åƒé¥­çš„æ—¶å€™ä¿æŒæ‚ é—²å’Œæ”¾æ¾ åƒä¸å¥½å¿ƒæƒ…ä¼šå˜å·® ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:3:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"4. ç»§ç»­æ‰“ç¢æ—¶é—´ æŠŠä¸¤ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´ç æˆä¸è¶³ä¸€ä¸ªå°æ—¶çš„åŒºé—´ã€‚å­¦ä¸€ä¸ªå°æ—¶ï¼Œå°±æ”¾æ¾ ååˆ†é’Ÿï¼Œè¿™ååˆ†é’Ÿä¸€å®šè¦æŠŠè‡ªå·±çš„æ³¨æ„åŠ›è½¬ç§»åˆ°åˆ«çš„äº‹æƒ…ä¸Šã€‚çœ‹ç‚¹ä¸ç›¸å¹²çš„ä¹¦å•Šï¼Œå›ä¸ªå¾®ä¿¡å•¥çš„ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:4:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"5. è½¬æ¢åœ°æ–¹ åœ¨ä¸€ä¸ªåœ°æ–¹å­¦çš„ä¹…äº†ä¼šè®©è‡ªå·±æ„Ÿè§‰æ—¶é—´è¿‡å¾—å¾ˆæ…¢,ä¸è¦åœ¨ä¸€ä¸ªåœ°æ–¹å‘†å¤ªä¹…ï¼Œå¤šè¸©å‡ ä¸ªä½œæ¡ˆåœ°ç‚¹ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:5:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"6. æ¢ææ–™ å‡è®¾å­¦ä¹ äº†ä¸€ä¸ªå°æ—¶è‹±è¯­ï¼Œä¸‹ä¸€ä¸ªå°æ—¶å°±å­¦åˆ«çš„ä¸œè¥¿ï¼Œæ¢ææ–™æœ‰åŠ©äºå‡è½»å¯¹å­¦ä¹ çš„åŒæ¶æ„Ÿå’Œç–²åŠ³åº¦ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»´æŒæ–°é²œæ„Ÿ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:6:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["learning method"],"content":"7. ä¸­åˆæˆ–è€…ä¸‹åˆä¼‘æ¯æ—¶é—´åƒä¸‡ä¸è¦å»å­¦ä¹ ã€‚ ä¸å­¦ä¹ ä¹Ÿæ˜¯ä¼Ÿå¤§è®¡åˆ’ä¸­çš„ä¸€éƒ¨åˆ†,è¦å’Œå­¦ä¹ ä¸€æ ·è®¤çœŸæ‰§è¡Œï¼Œä¸å¥½å¥½åƒé¥­æƒ³å­¦ä¹ çš„äº‹ï¼Œä¼šè®©ä½ æƒ…ç»ªå¾ˆç´§ç»·ã€‚ æ•´ä¸ªå­¦ä¹ çš„æ–¹æ³•å°±æ˜¯ä¿æŒæ—¶é—´çš„è¶…çº§é›†ä¸­ç‚¹ï¼Œåˆ‡æ¢æ‰“æ–­å¸¦æ¥è½»æ¾æ„Ÿï¼Œç©ºéš™å¨±ä¹å¸¦æ¥ å¥–åŠ±æ„Ÿï¼Œå‡å°‘ä½“æ„Ÿæ—¶é—´çš„é•¿åº¦æ¥å‡å°‘å¿ƒç†å‹åŠ›ã€‚ å¦å¤–è¿˜æœ‰ä¸€ç‚¹æˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯ä¿æŒä¸“æ³¨ã€‚ ","date":"2020-06-19","objectID":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/:7:0","tags":["learning method"],"title":"æ¬²ç½¢ä¸èƒ½çš„å­¦ä¹ æ–¹æ³•ç­–ç•¥","uri":"/%E6%AC%B2%E7%BD%A2%E4%B8%8D%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E7%AD%96%E7%95%A5/"},{"categories":["Ansible"],"content":"Ansible ä¸­æ–‡æƒå¨æŒ‡å— Ansible çŸ¥è¯†å›¾è°±\r","date":"2020-05-17","objectID":"/ansible%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/:0:0","tags":["Ansible"],"title":"Ansible çŸ¥è¯†å›¾è°±","uri":"/ansible%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/"},{"categories":["Shell"],"content":"åœ¨å¤§éƒ¨ä»½çš„ UNIX ç³»ç»Ÿï¼Œä¸‰ç§è‘—åä¸”å¹¿è¢«æ”¯æŒçš„ shell æ˜¯ Bourne shellï¼ˆAT\u0026T shellï¼Œåœ¨ Linux ä¸‹æ˜¯ BASHï¼‰ã€C shellï¼ˆBerkeley shellï¼Œåœ¨ Linux ä¸‹æ˜¯ TCSHï¼‰å’Œ Korn shellï¼ˆBourne shell çš„è¶…é›†ï¼‰ã€‚ è¿™ä¸‰ç§ shell åœ¨äº¤è°ˆï¼ˆinteractiveï¼‰æ¨¡å¼ä¸‹çš„è¡¨ç°ç›¸å½“ç±»ä¼¼ï¼Œä½†ä½œä¸ºå‘½ä»¤æ–‡ä»¶è¯­è¨€æ—¶ï¼Œåœ¨è¯­æ³•å’Œæ‰§è¡Œæ•ˆç‡ä¸Šå°±æœ‰äº›ä¸åŒäº†ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:0:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"bash Bourne shell æ˜¯æ ‡å‡†çš„ UNIX shellï¼Œä»¥å‰å¸¸è¢«ç”¨æ¥åšä¸ºç®¡ç†ç³»ç»Ÿä¹‹ç”¨ã€‚å¤§éƒ¨ä»½çš„ç³»ç»Ÿç®¡ç†å‘½ä»¤æ–‡ä»¶ï¼Œä¾‹å¦‚ rc startã€stop ä¸ shutdown éƒ½æ˜¯ Bourne shell çš„å‘½ä»¤æ¡£ï¼Œä¸”åœ¨å•ä¸€ä½¿ç”¨è€…æ¨¡å¼ï¼ˆsingle user modeï¼‰ä¸‹ä»¥ root ç­¾å…¥æ—¶å®ƒå¸¸è¢«ç³»ç»Ÿç®¡ç†è€…ä½¿ç”¨ã€‚ Bourne shell æ˜¯ç”± AT\u0026T å‘å±•çš„ï¼Œä»¥ç®€æ´ã€å¿«é€Ÿè‘—åã€‚ Bourne shell æç¤ºç¬¦å·çš„é»˜è®¤å€¼æ˜¯ $ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:1:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"csh C shell æ˜¯æŸå…‹è±å¤§å­¦ï¼ˆBerkeleyï¼‰æ‰€å¼€å‘çš„ï¼Œä¸”åŠ å…¥äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¦‚å‘½ä»¤åˆ—å†ç¨‹ï¼ˆhistoryï¼‰ã€åˆ«åï¼ˆaliasï¼‰ã€å†…å»ºç®—æœ¯ã€æ¡£åå®Œæˆï¼ˆfilename completionï¼‰ã€å’Œå·¥ä½œæ§åˆ¶ï¼ˆjob controlï¼‰ã€‚ å¯¹äºå¸¸åœ¨äº¤è°ˆæ¨¡å¼ä¸‹æ‰§è¡Œ shell çš„ä½¿ç”¨è€…è€Œè¨€ï¼Œä»–ä»¬è¾ƒå–œçˆ±ä½¿ç”¨ C shellï¼›ä½†å¯¹äºç³»ç»Ÿç®¡ç†è€…è€Œè¨€ï¼Œåˆ™è¾ƒåå¥½ä»¥ Bourne shell æ¥åšå‘½ä»¤æ¡£ï¼Œå› ä¸º Bourne shell å‘½ä»¤æ¡£æ¯” C shell å‘½ä»¤æ¡£æ¥çš„ç®€å•åŠå¿«é€Ÿã€‚C shell æç¤ºç¬¦å·çš„é»˜è®¤å€¼æ˜¯ %ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:2:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"ksh Korn shell æ˜¯ Bourne shell çš„è¶…é›†ï¼ˆsupersetï¼‰ï¼Œç”± AT\u0026T çš„ David Korn æ‰€å¼€å‘ã€‚å®ƒå¢åŠ äº†ä¸€äº›ç‰¹è‰²ï¼Œæ¯” C shell æ›´ä¸ºå…ˆè¿›ã€‚Korn shell çš„ç‰¹è‰²åŒ…æ‹¬äº†å¯ç¼–è¾‘çš„å†ç¨‹ã€åˆ«åã€å‡½å¼ã€æ­£è§„è¡¨è¾¾å¼ä¸‡ç”¨å­—ç¬¦ï¼ˆregular expression wildcardï¼‰ã€å†…å»ºç®—æœ¯ã€å·¥ä½œæ§åˆ¶ï¼ˆjob controlï¼‰ã€å…±ä½œå¤„ç†ï¼ˆcoprocessingï¼‰ã€å’Œç‰¹æ®Šçš„é™¤é”™åŠŸèƒ½ã€‚Bourne shell å‡ ä¹å’Œ Korn shell å®Œå…¨å‘ä¸Šå…¼å®¹ï¼ˆupward compatibleï¼‰ï¼Œæ‰€ä»¥åœ¨ Bourne shell ä¸‹å¼€å‘çš„ç¨‹åºä»èƒ½åœ¨ Korn shell ä¸Šæ‰§è¡Œã€‚Korn shell æç¤ºç¬¦å·çš„é»˜è®¤å€¼ä¹Ÿæ˜¯ $ã€‚ åœ¨ Linux ç³»ç»Ÿä½¿ç”¨çš„ Korn shell å«åš pdkshï¼Œå®ƒæ˜¯æŒ‡ Public Domain Korn Shellã€‚é™¤äº†æ‰§è¡Œæ•ˆç‡ç¨å·®å¤–ï¼ŒKorn shell åœ¨è®¸å¤šæ–¹é¢éƒ½æ¯” Bourne shell ä¸ºä½³ï¼›ä½†æ˜¯ï¼Œè‹¥å°† Korn shell ä¸ C shell ç›¸æ¯”å°±å¾ˆå›°éš¾ï¼Œå› ä¸ºäºŒè€…åœ¨è®¸å¤šæ–¹é¢éƒ½å„æœ‰æ‰€é•¿ï¼Œå°±æ•ˆç‡å’Œå®¹æ˜“ä½¿ç”¨ä¸Šçœ‹ï¼ŒKorn shell æ˜¯ä¼˜äº C shellï¼Œç›¸ä¿¡è®¸å¤šä½¿ç”¨è€…å¯¹äº C Shell çš„æ‰§è¡Œæ•ˆç‡éƒ½æœ‰è´Ÿé¢çš„å°è±¡ã€‚ åœ¨ shell çš„è¯­æ³•æ–¹é¢ï¼ŒKorn shell æ˜¯æ¯”è¾ƒæ¥è¿‘ä¸€èˆ¬ç¨‹åºè¯­è¨€ï¼Œè€Œä¸”å®ƒå…·æœ‰å­ç¨‹åºçš„åŠŸèƒ½åŠæä¾›è¾ƒå¤šçš„èµ„æ–™å‹æ€ã€‚è‡³äº Bourne shellï¼Œå®ƒæ‰€æ‹¥æœ‰çš„èµ„æ–™å‹æ€æ˜¯ä¸‰ç§ shell ä¸­æœ€å°‘çš„ï¼Œä»…æä¾›å­—ç¬¦ä¸²å˜é‡å’Œå¸ƒå°”å‹æ€ã€‚åœ¨æ•´ä½“è€ƒé‡ä¸‹ Korn shell æ˜¯ä¸‰è€…ä¸­è¡¨ç°æœ€ä½³è€…ï¼Œå…¶æ¬¡ä¸º C shellï¼Œæœ€åæ‰æ˜¯ Bourne shellï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ä»æœ‰å…¶å®ƒåº”åˆ—å…¥è€ƒè™‘çš„å› ç´ ï¼Œå¦‚é€Ÿåº¦æ˜¯æœ€é‡è¦çš„é€‰æ‹©æ—¶ï¼Œå¾ˆå¯èƒ½åº”è¯¥é‡‡ç”¨ Bourne shellï¼Œå› å®ƒæ˜¯æœ€åŸºæœ¬çš„ shellï¼Œæ‰§è¡Œçš„é€Ÿåº¦æœ€å¿«ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:3:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"tcsh tcsh æ˜¯è¿‘å‡ å¹´å´›èµ·çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼ˆLinux ä¸‹çš„ C shell å…¶å®å°±æ˜¯ä½¿ç”¨ tcshï¼‰æ‰§è¡Œï¼Œå®ƒè™½ç„¶ä¸æ˜¯ UNIX çš„æ ‡å‡†é…å¤‡ï¼Œä½†æ˜¯ä»è®¸å¤šåœ°æ–¹æ‚¨éƒ½å¯ä»¥ä¸‹è½½åˆ°å®ƒã€‚å¦‚æœæ‚¨æ˜¯ C shell çš„æ‹¥æŠ¤è€…ï¼Œç¬”è€…å»ºè®®ä¸å¦¨è¯•è¯• tcshï¼Œå› ä¸ºæ‚¨è‡³å°‘å¯ä»¥å°†å®ƒå½“ä½œæ˜¯ C shell æ¥ä½¿ç”¨ã€‚å¦‚æœæ‚¨æ„¿æ„èŠ±ç‚¹æ—¶é—´å­¦ä¹ ï¼Œæ‚¨è¿˜å¯ä»¥äº«å—è®¸å¤šå®ƒæ–°å¢çš„ä¼˜è¶ŠåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š tcsh æä¾›äº†ä¸€ä¸ªå‘½ä»¤åˆ—ï¼ˆcommand lineï¼‰ç¼–è¾‘ç¨‹åºã€‚ æä¾›äº†å‘½ä»¤åˆ—è¡¥å…¨åŠŸèƒ½ã€‚ æä¾›äº†æ‹¼å­—æ›´æ­£åŠŸèƒ½ã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å¹¶ä¸”æ›´æ­£åœ¨å‘½ä»¤åˆ—æ‹¼é”™çš„å‘½ä»¤æˆ–æ˜¯å•å­—ã€‚ å±é™©å‘½ä»¤ä¾¦æµ‹å¹¶æé†’çš„åŠŸèƒ½ï¼Œé¿å…æ‚¨ä¸€ä¸ªä¸å°å¿ƒæ‰§è¡Œäº†rm* è¿™ç§æ€ä¼¤åŠ›æå¤§çš„å‘½ä»¤ã€‚ æä¾›å¸¸ç”¨å‘½ä»¤çš„å¿«æ·æ–¹å¼ï¼ˆshortcutï¼‰ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:4:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"ash ä¸€ä¸ªç®€å•çš„è½»é‡çº§çš„ Shellï¼Œå ç”¨èµ„æºå°‘ï¼Œé€‚åˆè¿è¡Œäºä½å†…å­˜ç¯å¢ƒï¼Œä½†æ˜¯ä¸ä¸‹é¢è®²åˆ°çš„ bash shell å®Œå…¨å…¼å®¹ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:5:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"Shellåˆ†ç±»æ€»ç»“ åœ¨å¤§éƒ¨ä»½çš„ UNIX ç³»ç»Ÿï¼Œä¸‰ç§è‘—åä¸”å¹¿è¢«æ”¯æŒçš„ shell æ˜¯ Bourne shellï¼ˆAT\u0026T shellï¼Œåœ¨ Linux ä¸‹æ˜¯ BASHï¼‰ã€C shellï¼ˆBerkeley shellï¼Œåœ¨ Linux ä¸‹æ˜¯ TCSHï¼‰å’Œ Korn shellï¼ˆBourne shell çš„è¶…é›†ï¼‰ã€‚ è¿™ä¸‰ç§ shell åœ¨äº¤è°ˆï¼ˆinteractiveï¼‰æ¨¡å¼ä¸‹çš„è¡¨ç°ç›¸å½“ç±»ä¼¼ï¼Œä½†ä½œä¸ºå‘½ä»¤æ–‡ä»¶è¯­è¨€æ—¶ï¼Œåœ¨è¯­æ³•å’Œæ‰§è¡Œæ•ˆç‡ä¸Šå°±æœ‰äº›ä¸åŒäº†ã€‚ ","date":"2020-04-28","objectID":"/ch0_shell%E5%88%86%E7%B1%BB/:6:0","tags":["Shell"],"title":"shell åˆ†ç±»","uri":"/ch0_shell%E5%88%86%E7%B1%BB/"},{"categories":["Shell"],"content":"å¯¹äºshellè„šæœ¬è€Œè¨€ï¼Œæœ‰äº›å†…å®¹æ˜¯ä¸“é—¨ç”¨äºå¤„ç†å‚æ•°çš„ï¼Œå®ƒä»¬éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰ï¼Œä¾‹å¦‚ /home/shouwang/test.sh para1 para2 para3 $0 $1 $2 $3 å…¶ä¸­$0ä»£è¡¨äº†æ‰§è¡Œçš„è„šæœ¬åï¼Œ$1ï¼Œ$2åˆ†åˆ«ä»£è¡¨äº†ç¬¬ä¸€ä¸ªï¼Œç¬¬äºŒä¸ªå‚æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é»˜è®¤å˜é‡ï¼Œä¾‹å¦‚ï¼š ç¬¦å· é‡Šä¹‰ $# ä»£è¡¨è„šæœ¬åé¢è·Ÿçš„å‚æ•°ä¸ªæ•°ï¼Œå‰é¢çš„ä¾‹å­ä¸­æœ‰3ä¸ªå‚æ•° $@ ä»£è¡¨äº†æ‰€æœ‰å‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥è¢«éå† $* ä»£è¡¨äº†æ‰€æœ‰å‚æ•°ï¼Œä¸”ä½œä¸ºæ•´ä½“ï¼Œå’Œ$@ å¾ˆåƒï¼Œä½†æ˜¯æœ‰åŒºåˆ« $$ ä»£è¡¨äº†å½“å‰è„šæœ¬çš„è¿›ç¨‹ID $? ä»£è¡¨äº†ä¸Šä¸€æ¡å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ ","date":"2020-04-27","objectID":"/ch1_%E5%85%A5%E5%8F%82%E5%92%8C%E9%BB%98%E8%AE%A4%E5%8F%98%E9%87%8F/:0:0","tags":["Shell"],"title":"shell å…¥å‚å’Œé»˜è®¤å˜é‡","uri":"/ch1_%E5%85%A5%E5%8F%82%E5%92%8C%E9%BB%98%E8%AE%A4%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"ç»™å˜é‡èµ‹å€¼ï¼Œä½¿ç”¨ç­‰å·å³å¯ï¼Œä½†æ˜¯ç­‰å·ä¸¤è¾¹åƒä¸‡ä¸è¦æœ‰ç©ºæ ¼ï¼Œç­‰å·å³è¾¹æœ‰ç©ºæ ¼çš„å­—ç¬¦ä¸²ä¹Ÿå¿…é¡»ç”¨å¼•å·å¼•èµ·æ¥ ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:0:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"å˜é‡å®šä¹‰ para1=\"hello world\" #å­—ç¬¦ä¸²ç›´æ¥èµ‹ç»™å˜é‡para1 #unsetç”¨äºå–æ¶ˆå˜é‡ unset para1 å®šä¹‰å˜é‡ç±»å‹ï¼š declare æˆ– typeset -r åªè¯»(readonlyä¸€æ ·) -i æ•´å½¢ -a æ•°ç»„ -f å‡½æ•° -x export declare -i n=0 ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:1:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"ç³»ç»Ÿå˜é‡ command é‡Šä¹‰ $0 è„šæœ¬å¯åŠ¨å(åŒ…æ‹¬è·¯å¾„) $n ç¬¬nä¸ªå‚æ•°,n=1,2,â€¦9 $* æ‰€æœ‰å‚æ•°åˆ—è¡¨(ä¸åŒ…æ‹¬è„šæœ¬æœ¬èº«) $@ æ‰€æœ‰å‚æ•°åˆ—è¡¨(ç‹¬ç«‹å­—ç¬¦ä¸²) $# å‚æ•°ä¸ªæ•°(ä¸åŒ…æ‹¬è„šæœ¬æœ¬èº«) $$ å½“å‰ç¨‹å¼çš„PID $! æ‰§è¡Œä¸Šä¸€ä¸ªæŒ‡ä»¤çš„PID $? æ‰§è¡Œä¸Šä¸€ä¸ªæŒ‡ä»¤çš„è¿”å›å€¼ ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:2:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"å˜é‡å¼•ç”¨æŠ€å·§ command é‡Šä¹‰ ${name:+value} å¦‚æœè®¾ç½®äº†name,å°±æŠŠvalueæ˜¾ç¤º,æœªè®¾ç½®åˆ™ä¸ºç©º ${name:-value} å¦‚æœè®¾ç½®äº†name,å°±æ˜¾ç¤ºå®ƒ,æœªè®¾ç½®å°±æ˜¾ç¤ºvalue ${name:?value} æœªè®¾ç½®æç¤ºç”¨æˆ·é”™è¯¯ä¿¡æ¯value ${name:=value} å¦‚æœªè®¾ç½®å°±æŠŠvalueè®¾ç½®å¹¶æ˜¾ç¤º\u003cå†™å…¥æœ¬åœ°ä¸­\u003e ${#A} å¯å¾—åˆ°å˜é‡ä¸­å­—èŠ‚æ•° ${A:4:9} å–å˜é‡ä¸­ç¬¬4ä½åˆ°åé¢9ä½ ${A:(-1)} å€’å™å–æœ€åä¸€ä¸ªå­—ç¬¦ ${A/www/http} å–å˜é‡å¹¶ä¸”æ›¿æ¢æ¯è¡Œç¬¬ä¸€ä¸ªå…³é”®å­— ${A//www/http} å–å˜é‡å¹¶ä¸”å…¨éƒ¨æ›¿æ¢æ¯è¡Œå…³é”®å­— å®šä¹‰ä¸€ä¸ªå˜é‡ï¼šfile=/dir1/dir2/dir3/my.file.txt command é‡Šä¹‰ ${file#*/} å»æ‰ç¬¬ä¸€æ¡ / åŠå…¶å·¦è¾¹çš„å­—ä¸²ï¼šdir1/dir2/dir3/my.file.txt ${file##*/} å»æ‰æœ€åä¸€æ¡ / åŠå…¶å·¦è¾¹çš„å­—ä¸²ï¼šmy.file.txt ${file#*.} å»æ‰ç¬¬ä¸€ä¸ª . åŠå…¶å·¦è¾¹çš„å­—ä¸²ï¼šfile.txt ${file##*.} å»æ‰æœ€åä¸€ä¸ª . åŠå…¶å·¦è¾¹çš„å­—ä¸²ï¼štxt ${file%/*} å»æ‰æœ€åæ¡ / åŠå…¶å³è¾¹çš„å­—ä¸²ï¼š/dir1/dir2/dir3 ${file%%/*} å»æ‰ç¬¬ä¸€æ¡ / åŠå…¶å³è¾¹çš„å­—ä¸²ï¼š(ç©ºå€¼) ${file%.*} å»æ‰æœ€åä¸€ä¸ª . åŠå…¶å³è¾¹çš„å­—ä¸²ï¼š/dir1/dir2/dir3/my.file ${file%%.*} å»æ‰ç¬¬ä¸€ä¸ª . åŠå…¶å³è¾¹çš„å­—ä¸²ï¼š/dir1/dir2/dir3/my è¯´æ˜ # æ˜¯å»æ‰å·¦è¾¹(åœ¨é”®ç›˜ä¸Š # åœ¨ $ ä¹‹å·¦è¾¹) % æ˜¯å»æ‰å³è¾¹(åœ¨é”®ç›˜ä¸Š % åœ¨ $ ä¹‹å³è¾¹) å•ä¸€ç¬¦å·æ˜¯æœ€å°åŒ¹é…ï¹”ä¸¤ä¸ªç¬¦å·æ˜¯æœ€å¤§åŒ¹é… ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:3:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"æ“ä½œå˜é‡ echo \"para1 is $para1\" #å°†ä¼šè¾“å‡º para1 is hello world # or echo \"para1 is ${para1}!\" #å°†ä¼šè¾“å‡º para1 is hello world! ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:4:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"å˜é‡æ›¿ä»£ foo=\"I'm a cat.\" echo ${foo/cat/dog} # æ‰“å° \"I'm a dog.\" ä½¿ç”¨ä¸¤ä¸ªåæ–œçº¿è¿›è¡Œå…¨åŠ›æ›¿æ¢ foo=\"I'm a cat, and she's cat.\" echo ${foo/cat/dog} # æ‰“å° \"I'm a dog, and she's a cat.\" echo ${foo//cat/dog} # æ‰“å° \"I'm a dog, and she's a dog.\" æ‰“å°æ—¶ä¸ä¼šä¿®æ”¹å˜é‡ foo=\"hello\" echo ${foo/hello/goodbye} # æ‰“å° \"goodbye\" echo $foo # ä»ç„¶æ‰“å° \"hello\" ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:4:1","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"å˜é‡åŒ¹é…åˆ é™¤ æ²¡æœ‰æ›¿æ¢çš„å­—ç¬¦ä¸²åˆ™ç›´æ¥åˆ é™¤ foo=\"I like meatballs.\" echo ${foo/balls} # æ‰“å° I like meat. ${name#pattern}æ“ä½œåˆ é™¤${name}åŒ¹é…æ¨¡å¼çš„æœ€çŸ­å‰ç¼€ï¼Œè€Œ##åˆ é™¤æœ€é•¿å‰ç¼€ï¼š minipath=\"/usr/bin:/bin:/sbin\" echo ${minipath#/usr} # æ‰“å° /bin:/bin:/sbin echo ${minipath#*/bin} # æ‰“å° :/bin:/sbin echo ${minipath##*/bin} # æ‰“å° :/sbin ,å°±æ˜¯*/bin åŒ¹é…çš„/binåŠä¹‹å‰çš„å­—ç¬¦ä¸²ä¸€å¹¶åˆ é™¤ è¿ç®—ç¬¦%æ˜¯ç›¸åŒçš„ï¼Œåªä¸è¿‡åŒ¹é…çš„æ˜¯åç¼€è€Œä¸æ˜¯å‰ç¼€ï¼š minipath=\"/usr/bin:/bin:/sbin\" echo ${minipath%/usr*} # æ‰“å° nothing echo ${minipath%/bin*} # æ‰“å° /usr/bin: echo ${minipath%%/bin*} # æ‰“å° /usr ,å°±æ˜¯%/bin åŒ¹é…çš„/binåŠä¹‹åçš„å­—ç¬¦ä¸²ä¸€å¹¶åˆ é™¤ åˆ†ç‰‡åˆ‡å‰² string=\"I'm a fan of dogs.\" echo ${string:6:3} # æ‰“å° fan ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:4:2","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"æ˜¯å¦å­˜åœ¨é»˜è®¤å€¼ username=shuan_lu unset username echo ${username-default} # æ‰“å° default username=admin echo ${username-default} # æ‰“å° admin å¯¹äºæµ‹è¯•æ˜¯å¦è®¾ç½®äº†å˜é‡çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å†’å·ï¼ˆ\":\"ï¼‰æ¥å¼ºåˆ¶æ£€æŸ¥å˜é‡æ˜¯å¦å·²è®¾ç½®ä¸”æ˜¯å¦ä¸ºç©ºï¼š foo=\"\" bar=\"\" echo ${foo-123} # æ‰“å° nothing echo ${bar:-456} # æ‰“å° 456 è¿ç®—ç¬¦=ï¼ˆæˆ–:=ï¼‰ç±»ä¼¼äºè¿ç®—ç¬¦-ï¼Œåªæ˜¯å¦‚æœå˜é‡æ²¡æœ‰å€¼ï¼Œå®ƒä¹Ÿä¼šè®¾ç½®å˜é‡ï¼š unset cache echo ${cache:=1024} # æ‰“å° 1024 echo $cache # æ‰“å° 1024 echo ${cache:=2048} # æ‰“å° 1024 echo $cache # æ‰“å° 1024 ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:5:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"å•å¼•å·å’ŒåŒå¼•å· shell ä¼šå¿½ç•¥å•å¼•å·ä¸­æ‰€æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå…¶ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«å½“ä½œä¸€ä¸ªå…ƒç´  åŒå¼•å·å‡ ä¹ä¸å•å¼•å·ç›¸ä¼¼ã€‚è¿™é‡Œä¹‹æ‰€ä»¥è¯´â€œå‡ ä¹â€æ˜¯å› ä¸ºä»–ä»¬ä¹Ÿä¼šå¿½ç•¥æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œé™¤äº†ï¼š ç¾å…ƒç¬¦å·ï¼š$ åå¼•å·ï¼š` åæ–œæ ï¼š\\ world=Earth foo='Hello, $world!' bar=\"Hello, $world\" echo $foo # æ‰“å° Hello, $world! echo $bar # æ‰“å° Hello, Earth ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:6:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"æ€»ç»“ command é‡Šä¹‰ A=â€œa b c defâ€ å°†å­—ç¬¦ä¸²å¤åˆ¶ç»™å˜é‡ A=cmd å°†å‘½ä»¤ç»“æœèµ‹ç»™å˜é‡ A=$(cmd) å°†å‘½ä»¤ç»“æœèµ‹ç»™å˜é‡ eval a=$$a é—´æ¥è°ƒç”¨ i=2\u0026\u0026echo $((i+3)) è®¡ç®—åæ‰“å°æ–°å˜é‡ç»“æœ i=2\u0026\u0026echo $[i+3] è®¡ç®—åæ‰“å°æ–°å˜é‡ç»“æœ a=$((2\u003e6?5:8)) åˆ¤æ–­ä¸¤ä¸ªå€¼æ»¡è¶³æ¡ä»¶çš„èµ‹å€¼ç»™å˜é‡,ç±»ä¼¼ä¸‰ç›®è¿ç®—ç¬¦ $1 $2 $* ä½ç½®å‚æ•° *ä»£è¡¨æ‰€æœ‰ env æŸ¥çœ‹ç¯å¢ƒå˜é‡ env grep â€œnameâ€ set æŸ¥çœ‹ç¯å¢ƒå˜é‡å’Œæœ¬åœ°å˜é‡ read name è¾“å…¥å˜é‡ readonly name æŠŠnameè¿™ä¸ªå˜é‡è®¾ç½®ä¸ºåªè¯»å˜é‡,ä¸å…è®¸å†æ¬¡è®¾ç½® readonly æŸ¥çœ‹ç³»ç»Ÿå­˜åœ¨çš„åªè¯»æ–‡ä»¶ export name å˜é‡nameç”±æœ¬åœ°å‡ä¸ºç¯å¢ƒ export name=â€œRedHatâ€ ç›´æ¥å®šä¹‰nameä¸ºç¯å¢ƒå˜é‡ export Stat$nu=2222 å˜é‡å¼•ç”¨å˜é‡èµ‹å€¼ unset name å˜é‡æ¸…é™¤ export -n name å»æ‰åªè¯»å˜é‡ shift ç”¨äºç§»åŠ¨ä½ç½®å˜é‡,è°ƒæ•´ä½ç½®å˜é‡,ä½¿$3çš„å€¼èµ‹ç»™$2.$2çš„å€¼èµ‹äºˆ$1 name + 0 å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­— number \" \" å°†æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸² a=â€˜eeâ€™;b=â€˜aâ€™;echo ${!b} é—´æ¥å¼•ç”¨nameå˜é‡çš„å€¼ : ${a=â€œccâ€} å¦‚æœaæœ‰å€¼åˆ™ä¸æ”¹å˜,å¦‚æœaæ— å€¼åˆ™èµ‹å€¼aå˜é‡ä¸ºcc ","date":"2020-04-26","objectID":"/ch2_%E5%8F%98%E9%87%8F/:7:0","tags":["Shell"],"title":"shell å˜é‡","uri":"/ch2_%E5%8F%98%E9%87%8F/"},{"categories":["Shell"],"content":"åœ¨shellä¸­æ‰§è¡Œå‘½ä»¤é€šå¸¸åªéœ€è¦åƒåœ¨ç»ˆç«¯ä¸€æ ·æ‰§è¡Œå‘½ä»¤å³å¯ï¼Œä¸è¿‡ï¼Œå¦‚æœæƒ³è¦å‘½ä»¤ç»“æœæ‰“å°å‡ºæ¥çš„æ—¶å€™ï¼Œè¿™æ ·çš„æ–¹å¼å°±è¡Œä¸é€šäº†ã€‚å› æ­¤ï¼Œshellçš„å‘½ä»¤æ–¹å¼å¸¸æœ‰ ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:0:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸€ a=`ls` #`æ˜¯å·¦ä¸Šè§’ï½é”®ï¼Œä¸æ˜¯å•å¼•å· ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:1:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"æ–¹å¼äºŒ æˆ–è€…ä½¿ç”¨$ï¼Œåé¢æ‹¬å·å†…æ˜¯æ‰§è¡Œçš„å‘½ä»¤ echo \"current path is $(pwd)\" # ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:2:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸‰ è®¡ç®— å¦å¤–ï¼Œå‰é¢ä¸¤ç§æ–¹å¼å¯¹äºè®¡ç®—è¡¨è¾¾å¼ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œè€Œè¦é‡‡å–ä¸‹é¢çš„æ–¹å¼ï¼š echo \"1+1=$((1+1))\" #æ‰“å°ï¼š1+1=2 ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:3:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"æ–¹å¼å›› å‘½ä»¤èµ‹å€¼ç»™å˜é‡ a=\"ls\" echo \"$($a)\" ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:4:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"æ–¹å¼äº” å¦‚æœå­—ç¬¦ä¸²æ—¶å¤šæ¡å‘½ä»¤çš„æ—¶å€™ï¼Œä¸Šé¢çš„æ–¹å¼åˆä¸å¯è¡Œäº†ï¼Œè€Œè¦é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼ a=\"ls;pwd\" echo \"$(eval $a)\" ","date":"2020-04-26","objectID":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/:5:0","tags":["Shell"],"title":"shell å‘½ä»¤æ‰§è¡Œ","uri":"/ch3_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"ä¸€èˆ¬è¯´æ˜ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™å…¶è¿”å›å€¼ä¸º0ï¼Œå¦åˆ™ä¸ºé0ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼åˆ¤æ–­ä¸Šæ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼š ","date":"2020-04-25","objectID":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/:0:0","tags":["Shell"],"title":"shell æ¡ä»¶åˆ†æ”¯","uri":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/"},{"categories":["Shell"],"content":"if åˆ†æ”¯ if [ $? -eq 0 ] then echo \"success\" elif [ $? -eq 1 ] then echo \"failed,code is 1\" else echo \"other code\" fi ","date":"2020-04-25","objectID":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/:1:0","tags":["Shell"],"title":"shell æ¡ä»¶åˆ†æ”¯","uri":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/"},{"categories":["Shell"],"content":"å¤šä¸ªæ¡ä»¶ æ–¹å¼ä¸€ if [ 10 -gt 5 -o 10 -gt 4 ];then echo \"10\u003e5 or 10 \u003e4\" fi æ–¹å¼äºŒ if [ 10 -gt 5 ] || [ 10 -gt 4 ];then echo \"10\u003e5 or 10 \u003e4\" fi æ€»ç»“ï¼š -o or æˆ–è€…ï¼ŒåŒ|| -a and ä¸ï¼ŒåŒ\u0026\u0026 ! é ","date":"2020-04-25","objectID":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/:1:1","tags":["Shell"],"title":"shell æ¡ä»¶åˆ†æ”¯","uri":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/"},{"categories":["Shell"],"content":"case åˆ†æ”¯ name=\"aa\" case $name in \"aa\") echo \"name is $name\" ;; \"\") echo \"name is empty\" ;; \"bb\") echo \"name is $name\" ;; *) echo \"other name\" ;; esac ```shell æ³¨æ„ï¼š - []å‰é¢è¦æœ‰ç©ºæ ¼ï¼Œå®ƒé‡Œé¢æ˜¯é€»è¾‘è¡¨è¾¾å¼ - if elifåé¢è¦è·Ÿthenï¼Œç„¶åæ‰æ˜¯è¦æ‰§è¡Œçš„è¯­å¥ - å¦‚æœæƒ³æ‰“å°ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œæœ€å¥½çš„åšæ³•æ˜¯å°† $?èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œå› ä¸ºä¸€æ—¦æ‰§è¡Œäº†ä¸€æ¡å‘½ä»¤ï¼Œ$?çš„å€¼å°±å¯èƒ½ä¼šå˜ã€‚ - caseæ¯ä¸ªåˆ†æ”¯æœ€åä»¥ä¸¤ä¸ªåˆ†å·ç»“å°¾ï¼Œæœ€åæ˜¯caseåè¿‡æ¥å†™ï¼Œå³esacã€‚ ","date":"2020-04-25","objectID":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/:2:0","tags":["Shell"],"title":"shell æ¡ä»¶åˆ†æ”¯","uri":"/ch4_%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF/"},{"categories":["Shell"],"content":"Bash Shell å­—ç¬¦ä¸²æ“ä½œè¯¦è§£ Bash ä¸­çš„å­—ç¬¦ä¸²æ“ä½œæ˜¯è„šæœ¬ç¼–å†™çš„æ ¸å¿ƒæŠ€èƒ½ä¹‹ä¸€ï¼Œæ¶µç›–å®šä¹‰ã€æ‹¼æ¥ã€æˆªå–ã€æ›¿æ¢ã€åŒ¹é…ç­‰åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å¸¸è§ç”¨æ³•åŠç¤ºä¾‹ï¼š 1. å­—ç¬¦ä¸²åŸºç¡€ 1.1 å®šä¹‰å­—ç¬¦ä¸² str1=\"Hello World\" # åŒå¼•å·ï¼ˆå…è®¸å˜é‡æ›¿æ¢å’Œè½¬ä¹‰ï¼‰ str2='Hello $USER' # å•å¼•å·ï¼ˆåŸæ ·è¾“å‡ºï¼Œä¸è§£æå˜é‡ï¼‰ str3=$'Line1\\nLine2' # ANSI-C å¼•å·ï¼ˆæ”¯æŒè½¬ä¹‰å­—ç¬¦ï¼‰ 1.2 å­—ç¬¦ä¸²æ‹¼æ¥ name=\"Alice\" greet=\"Hello, \"$name\"!\" # ç›´æ¥æ‹¼æ¥ echo $greet # è¾“å‡º: Hello, Alice! # ä½¿ç”¨åŒå¼•å·ç®€åŒ– greet=\"Hello, ${name}!\" # æ¨èå†™æ³• 1.3 è·å–å­—ç¬¦ä¸²é•¿åº¦ str=\"abcdefg\" echo ${#str} # è¾“å‡º: 7 2. å­—ç¬¦ä¸²æˆªå– 2.1 æŒ‰ä½ç½®æˆªå– è¯­æ³• æè¿° ç¤ºä¾‹ï¼ˆstr=â€œabcdefâ€ï¼‰ ${str:start} ä» start å¼€å§‹æˆªå–åˆ°æœ«å°¾ ${str:2} â†’ â€œcdefâ€ ${str:start:length} ä» start æˆªå– length é•¿åº¦ ${str:1:3} â†’ â€œbcdâ€ 2.2 æŒ‰æ¨¡å¼æˆªå– è¯­æ³• æè¿° ç¤ºä¾‹ï¼ˆstr=â€œapp_log_20231010.txtâ€ï¼‰ ${str#pattern} åˆ é™¤å¼€å¤´åŒ¹é…çš„æœ€çŸ­æ¨¡å¼ ${str#*_} â†’ â€œlog_20231010.txtâ€ ${str##pattern} åˆ é™¤å¼€å¤´åŒ¹é…çš„æœ€é•¿æ¨¡å¼ ${str##*_} â†’ â€œ20231010.txtâ€ ${str%pattern} åˆ é™¤ç»“å°¾åŒ¹é…çš„æœ€çŸ­æ¨¡å¼ ${str%.*} â†’ â€œapp_log_20231010â€ ${str%%pattern} åˆ é™¤ç»“å°¾åŒ¹é…çš„æœ€é•¿æ¨¡å¼ ${str%%.*} â†’ â€œapp_logâ€ 3. å­—ç¬¦ä¸²æ›¿æ¢ 3.1 ç®€å•æ›¿æ¢ è¯­æ³• æè¿° ç¤ºä¾‹ï¼ˆstr=â€œhello world helloâ€ï¼‰ ${str/old/new} æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ ${str/hello/Hi} â†’ â€œHi world helloâ€ ${str//old/new} æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹ ${str//hello/Hi} â†’ â€œHi world Hiâ€ 3.2 å‰ç¼€/åç¼€æ›¿æ¢ è¯­æ³• æè¿° ç¤ºä¾‹ï¼ˆstr=â€œerror.logâ€ï¼‰ ${str/#prefix/new} æ›¿æ¢å¼€å¤´çš„ prefix ${str/#error/access} â†’ â€œaccess.logâ€ ${str/%suffix/new} æ›¿æ¢ç»“å°¾çš„ suffix ${str/%.log/.txt} â†’ â€œerror.txtâ€ 4. å­—ç¬¦ä¸²æŸ¥æ‰¾ 4.1 æŸ¥æ‰¾å­å­—ç¬¦ä¸²ä½ç½® str=\"abcdefg\" index=$(expr index \"$str\" \"cde\") # æŸ¥æ‰¾å­ä¸²èµ·å§‹ä½ç½® echo $index # è¾“å‡º: 3ï¼ˆä½ç½®ä»1å¼€å§‹è®¡æ•°ï¼‰ 4.2 æ£€æŸ¥æ˜¯å¦åŒ…å«å­ä¸² str=\"hello world\" if [[ $str == *\"world\"* ]]; then echo \"åŒ…å« 'world'\" fi 5. å­—ç¬¦ä¸²åˆ†å‰²ä¸ºæ•°ç»„ csv=\"apple,banana,orange\" IFS=',' read -ra arr \u003c\u003c\u003c \"$csv\" # æŒ‰é€—å·åˆ†å‰² echo \"${arr[1]}\" # è¾“å‡º: banana 6. å­—ç¬¦ä¸²æ¯”è¾ƒ æ“ä½œç¬¦ æè¿° ç¤ºä¾‹ == æˆ– = ç›¸ç­‰ [[ \"abc\" == \"abc\" ]] â†’ true != ä¸ç›¸ç­‰ [[ \"abc\" != \"def\" ]] â†’ true \u003e æˆ– \u003c æŒ‰å­—å…¸åºæ¯”è¾ƒ [[ \"apple\" \u003c \"banana\" ]] â†’ true -z å­—ç¬¦ä¸²ä¸ºç©º [[ -z \"\" ]] â†’ true -n å­—ç¬¦ä¸²éç©º [[ -n \"abc\" ]] â†’ true 7. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… 7.1 ä½¿ç”¨ =~ æ“ä½œç¬¦ email=\"user@example.com\" if [[ $email =~ ^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$ ]]; then echo \"æœ‰æ•ˆé‚®ç®±åœ°å€\" fi 7.2 æå–åŒ¹é…ç»„ str=\"Date: 2023-10-10\" if [[ $str =~ ([0-9]{4}-[0-9]{2}-[0-9]{2}) ]]; then echo \"æ—¥æœŸ: ${BASH_REMATCH[1]}\" # è¾“å‡º: æ—¥æœŸ: 2023-10-10 fi 8. é«˜çº§æŠ€å·§ 8.1 å¤„ç†å¸¦ç©ºæ ¼çš„å­—ç¬¦ä¸² file_path=\"/path/with spaces/file.txt\" # åŒå¼•å·ä¿æŠ¤ç©ºæ ¼ cp \"$file_path\" /backup/ # æ•°ç»„å­˜å‚¨å¸¦ç©ºæ ¼å­—ç¬¦ä¸² files=(\"file1.txt\" \"file two.txt\") for file in \"${files[@]}\"; do echo \"$file\" done 8.2 ä½¿ç”¨ heredoc å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸² cat \u003c\u003cEOF ç¬¬ä¸€è¡Œ ç¬¬äºŒè¡Œ å˜é‡æ›¿æ¢: $USER EOF 8.3 é¢œè‰²å’Œæ ¼å¼è¾“å‡º RED='\\033[0;31m' NC='\\033[0m' # é‡ç½®é¢œè‰² echo -e \"${RED}é”™è¯¯ä¿¡æ¯${NC}\" 9. å®ç”¨ç¤ºä¾‹ 9.1 è·å–æ–‡ä»¶åå’Œæ‰©å±•å file=\"image.jpg\" filename=\"${file%.*}\" # image extension=\"${file##*.}\" # jpg 9.2 è·¯å¾„å¤„ç† path=\"/var/log/app.log\" dirname=\"${path%/*}\" # /var/log basename=\"${path##*/}\" # app.log ","date":"2020-04-25","objectID":"/ch19_%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3/:0:1","tags":["Shell"],"title":"shell å­—ç¬¦ä¸²è¯¦è§£","uri":"/ch19_%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3/"},{"categories":["Shell"],"content":"æ€»ç»“ æ ¸å¿ƒæ“ä½œï¼šæˆªå– (${var:start:len})ã€æ›¿æ¢ (${var/old/new})ã€æ¨¡å¼åˆ é™¤ (${var#pattern}) å…³é”®æŠ€å·§ï¼š ä½¿ç”¨ [[ ]] è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒå’Œæ­£åˆ™åŒ¹é… ç”¨åŒå¼•å·ä¿æŠ¤å«ç©ºæ ¼çš„å­—ç¬¦ä¸² çµæ´»ä½¿ç”¨ IFS åˆ†å‰²å­—ç¬¦ä¸²ä¸ºæ•°ç»„ æ³¨æ„ï¼š Bash å­—ç¬¦ä¸²ç´¢å¼•ä» 0 å¼€å§‹ï¼Œä½† ${str:start} çš„ start ä» 0 å¼€å§‹ é¿å…åœ¨ [ ] ä¸­ä½¿ç”¨ ==ï¼ˆæ¨èç”¨ [[ ]]ï¼‰ ","date":"2020-04-25","objectID":"/ch19_%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3/:0:2","tags":["Shell"],"title":"shell å­—ç¬¦ä¸²è¯¦è§£","uri":"/ch19_%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3/"},{"categories":["Shell"],"content":"for å¾ªç¯ ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:1:0","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"for å¾ªç¯ä¸€ #éå†è¾“å‡ºè„šæœ¬çš„å‚æ•° for i in $@; do echo $i done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:1:1","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"for å¾ªç¯æ–¹å¼äºŒ for ((i = 0 ; i \u003c 10 ; i++)); do echo $i done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:1:2","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"for å¾ªç¯æ–¹å¼ä¸‰ for i in {1..5}; do echo \"Welcome $i\" done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:1:3","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"for å¾ªç¯æ–¹å¼å›› for i in {5..15..3}; do echo \"number is $i\" done æ¯éš”3æ‰“å°ä¸€æ¬¡ï¼Œå³æ‰“å°5,8,11,14 ç¤ºä¾‹ for f in *.c do gcc -o ${f%.c} $f done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:1:4","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"while å¾ªç¯ while [ \"$ans\" != \"yes\" ] do read -p \"please input yes to exit loop:\" ans done # åªæœ‰å½“ansä¸æ˜¯yesæ—¶ï¼Œå¾ªç¯å°±ç»ˆæ­¢ã€‚ # or num=1 while [ $num -lt 10 ] do echo $num ((num=$num+2)) done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:2:0","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"until å¾ªç¯ num=1 # å½“commandä¸ä¸º0æ—¶å¾ªç¯ until [ $num -gt 10 ] do echo until $num ((num=$num+2)) done ","date":"2020-04-24","objectID":"/ch5_%E5%BE%AA%E7%8E%AF/:3:0","tags":["Shell"],"title":"shell å¾ªç¯","uri":"/ch5_%E5%BE%AA%E7%8E%AF/"},{"categories":["Shell"],"content":"ä¸ºäº†å®ŒæˆæŸä¸€åŠŸèƒ½çš„ç¨‹åºæŒ‡ä»¤ï¼ˆè¯­å¥ï¼‰çš„é›†åˆï¼Œç§°ä¸ºå‡½æ•°ã€‚Shell å‡½æ•°çš„æœ¬è´¨æ˜¯ä¸€æ®µå¯ä»¥é‡å¤ä½¿ç”¨çš„è„šæœ¬ä»£ç ï¼Œè¿™æ®µä»£ç è¢«æå‰ç¼–å†™å¥½äº†ï¼Œæ”¾åœ¨äº†æŒ‡å®šçš„ä½ç½®ï¼Œä½¿ç”¨æ—¶ç›´æ¥è°ƒå–å³å¯ åœ¨ç¨‹åºä¸­ï¼Œç¼–å†™å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯å°†ä¸€ä¸ªéœ€è¦å¾ˆå¤šè¡Œä»£ç çš„å¤æ‚é—®é¢˜åˆ†è§£ä¸ºä¸€ç³»åˆ—ç®€å•çš„ä»»åŠ¡æ¥è§£å†³ï¼Œè€Œä¸”ï¼ŒåŒä¸€ä¸ªä»»åŠ¡ï¼ˆå‡½æ•°ï¼‰å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œæœ‰åŠ©äºä»£ç é‡ç”¨ã€‚ ","date":"2020-04-23","objectID":"/ch6_%E5%87%BD%E6%95%B0/:0:0","tags":["Shell"],"title":"shell å‡½æ•°","uri":"/ch6_%E5%87%BD%E6%95%B0/"},{"categories":["Shell"],"content":"å®šä¹‰å‡½æ•° function myfunc() { echo \"hello world $1\" } function myfunc { echo \"hello world $1\" } æˆ–è€… myfunc() { echo \"hello world $1\" } è¯´æ˜ å¯ä»¥çœç•¥ function å…³é”®è¯ å¦‚æœå†™äº† function å…³é”®å­—ï¼Œä¹Ÿå¯ä»¥çœç•¥å‡½æ•°ååé¢çš„å°æ‹¬å· ","date":"2020-04-23","objectID":"/ch6_%E5%87%BD%E6%95%B0/:1:0","tags":["Shell"],"title":"shell å‡½æ•°","uri":"/ch6_%E5%87%BD%E6%95%B0/"},{"categories":["Shell"],"content":"å‡½æ•°å‚æ•°åŠè°ƒç”¨ åœ¨ Shell ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ å‡½æ•° æ—¶ï¼Œä¸åƒ C è¯­è¨€ã€ C++ã€ Pythonã€ Java å’Œ Golang é‚£æ ·ï¼Œéœ€è¦ä¼ é€’å‚æ•°ï¼ŒShell ä¸­çš„å‡½æ•°åœ¨å®šä¹‰æ—¶ä¸èƒ½æŒ‡æ˜å‚æ•°ï¼Œä½†æ˜¯åœ¨è°ƒç”¨æ—¶å´å¯ä»¥ä¼ é€’å‚æ•°ã€‚ å‡½æ•°å‚æ•°æ˜¯ Shell ä½ç½®å‚æ•°çš„ä¸€ç§ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨ $n æ¥æ¥æ”¶ï¼Œä¾‹å¦‚ï¼Œ$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¾æ¬¡ç±»æ¨ã€‚é™¤äº† nï¼Œè¿˜æœ‰å¦å¤–ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å˜é‡ï¼Œ# å¯ä»¥è·å–ä¼ é€’çš„å‚æ•°çš„ä¸ªæ•°ï¼Œ$@ æˆ–è€… $* å¯ä»¥ä¸€æ¬¡æ€§è·å–æ‰€æœ‰çš„å‚æ•°ã€‚ #!/bin/bash function show(){ echo \"Name is: $1\" echo \"Site is: $2\" echo \"Age is: $3\" } show shuanlu https://lu_shuan.gitee.io/gitbook 109 ","date":"2020-04-23","objectID":"/ch6_%E5%87%BD%E6%95%B0/:2:0","tags":["Shell"],"title":"shell å‡½æ•°","uri":"/ch6_%E5%87%BD%E6%95%B0/"},{"categories":["Shell"],"content":"é€šå¸¸å‡½æ•°çš„returnè¿”å›å€¼åªæ”¯æŒ0-255ï¼Œå› æ­¤æƒ³è¦è·å¾—è¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ã€‚ function myfunc() { local myresult='some value' echo $myresult } val=$(myfunc) #valçš„å€¼ä¸ºsome value é€šè¿‡returnçš„æ–¹å¼é€‚ç”¨äºåˆ¤æ–­å‡½æ•°çš„æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼š function myfunc() { #do something return 0 } if myfunc;then echo \"success\" else echo \"failed\" fi ","date":"2020-04-22","objectID":"/ch7_%E8%BF%94%E5%9B%9E%E5%80%BC/:0:0","tags":["Shell"],"title":"shell è¿”å›å€¼","uri":"/ch7_%E8%BF%94%E5%9B%9E%E5%80%BC/"},{"categories":["Shell"],"content":"shellé€šè¿‡#æ¥æ³¨é‡Šä¸€è¡Œå†…å®¹ï¼Œå‰é¢æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡äº† #!/bin/bash # è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š :' è¿™æ˜¯ å¤šè¡Œ æ³¨é‡Š ' ls :\u003c\u003cEOF è¿™ä¹Ÿå¯ä»¥ è¾¾åˆ° å¤šè¡Œæ³¨é‡Š çš„ç›®çš„ EOF ","date":"2020-04-21","objectID":"/ch8_%E6%B3%A8%E9%87%8A/:0:0","tags":["Shell"],"title":"shell æ³¨é‡Š","uri":"/ch8_%E6%B3%A8%E9%87%8A/"},{"categories":["Shell"],"content":"è„šæœ¬æ‰§è¡Œåå…ä¸äº†è¦è®°å½•æ—¥å¿—ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯é‡å®šå‘ã€‚ä»¥ä¸‹é¢çš„è„šæœ¬ä¸ºä¾‹ï¼š #!/bin/bash #test.sh lll #è¿™ä¸ªå‘½ä»¤æ˜¯æ²¡æœ‰çš„ï¼Œå› æ­¤ä¼šæŠ¥é”™ date ","date":"2020-04-20","objectID":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/:0:0","tags":["Shell"],"title":"shell æ—¥å¿—ä¿å­˜","uri":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸€ å°†æ ‡å‡†è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæ‰“å°æ ‡å‡†é”™è¯¯ï¼š ./test.sh \u003e log.dat è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯å°†ä¼šæ‰“å°åˆ°æ§åˆ¶å°ã€‚æ‰€ä»¥å¦‚æœä½ åœ¨ç¨‹åºä¸­è°ƒç”¨ï¼Œè¿™æ ·å°†ä¸ä¼šè®²é”™è¯¯ä¿¡æ¯ä¿å­˜åœ¨æ—¥å¿—ä¸­ã€‚ ","date":"2020-04-20","objectID":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/:1:0","tags":["Shell"],"title":"shell æ—¥å¿—ä¿å­˜","uri":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/"},{"categories":["Shell"],"content":"æ–¹å¼äºŒ ./test.sh \u003e log.dat 2\u003e\u00261 æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ è¿™é‡Œçš„2\u003e\u00261æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ è¡¨æ˜å°†./test.shçš„è¾“å‡ºé‡å®šå‘åˆ°log.txtæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶å°†æ ‡å‡†é”™è¯¯ä¹Ÿé‡å®šå‘åˆ°log.txtæ–‡ä»¶ä¸­ã€‚ ","date":"2020-04-20","objectID":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/:2:0","tags":["Shell"],"title":"shell æ—¥å¿—ä¿å­˜","uri":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸‰ ä¿å­˜æ—¥å¿—æ–‡ä»¶çš„åŒæ—¶ï¼Œä¹Ÿè¾“å‡ºåˆ°æ§åˆ¶å° ./test.sh |tee log.dat ","date":"2020-04-20","objectID":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/:3:0","tags":["Shell"],"title":"shell æ—¥å¿—ä¿å­˜","uri":"/ch9_%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98/"},{"categories":["Shell"],"content":"å¸¸è§æ‰§è¡Œæ–¹å¼ ./test.sh ","date":"2020-04-19","objectID":"/ch10_%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C/:1:0","tags":["Shell"],"title":"shell è„šæœ¬æ‰§è¡Œ","uri":"/ch10_%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"å…¶å®ƒæ‰§è¡Œæ–¹å¼ sh test.sh #åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œ sh -x test.sh #ä¼šåœ¨ç»ˆç«¯æ‰“å°æ‰§è¡Œåˆ°å‘½ä»¤ï¼Œé€‚åˆè°ƒè¯• source test.sh #test.shåœ¨çˆ¶è¿›ç¨‹ä¸­æ‰§è¡Œ . test.sh #ä¸éœ€è¦èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œä¸´æ—¶æ‰§è¡Œ ","date":"2020-04-19","objectID":"/ch10_%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C/:2:0","tags":["Shell"],"title":"shell è„šæœ¬æ‰§è¡Œ","uri":"/ch10_%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C/"},{"categories":["Shell"],"content":"å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è·å–è„šæœ¬çš„æ‰§è¡Œç»“æœï¼Œå³é€€å‡ºçŠ¶æ€ï¼Œé€šå¸¸0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œè€Œé0è¡¨ç¤ºå¤±è´¥ã€‚ä¸ºäº†è·å¾—é€€å‡ºç ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨exit #!/bin/bash function myfun() { if [ $# -lt 2 ] then echo \"para num error\" exit 1 fi echo \"ok\" exit 2 } if [ $# -lt 1 ] then echo \"para num error\" exit 1 fi returnVal=`myfun aa` echo \"end shell\" exit 0 ","date":"2020-04-18","objectID":"/ch11_%E8%84%9A%E6%9C%AC%E9%80%80%E5%87%BA%E7%A0%81/:0:0","tags":["Shell"],"title":"shell è„šæœ¬é€€å‡ºç ","uri":"/ch11_%E8%84%9A%E6%9C%AC%E9%80%80%E5%87%BA%E7%A0%81/"},{"categories":["Ansible"],"content":"é—®é¢˜æè¿° é€šè¿‡ansibleå‘½ä»¤ç›´æ¥pingå¤šå°æœºå™¨çš„ç½‘ç»œçŠ¶æ€ï¼Œæç¤ºæŠ¥é”™ å¤±è´¥\r172.16.24.220 | UNREACHABLE! =\u003e { â€œchangedâ€: false, â€œmsgâ€: â€œFailed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\\r\\nâ€, â€œunreachableâ€: true }\r","date":"2020-04-17","objectID":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/:1:0","tags":["Ansible"],"title":"Ansible æƒé™è®¤è¯æŠ¥é”™é—®é¢˜è®°å½•","uri":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"categories":["Ansible"],"content":"é—®é¢˜å¤„ç† è§£å†³æ–¹å¼ï¼šå•å‘çš„sshéªŒè¯ ssh-keygenä¸€è·¯å›è½¦,ä¸»è¦æ˜¯ç”¨æ¥å…å¯†é€šä¿¡çš„ ssh-copy-id 172.16.24.220 éœ€è¦è¾“å…¥å¯¹åº”ä¸»èŠ‚çš„rootå¯†ç  $ ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: 7f:69:87:cf:28:fe:8b:19:55:a7:d0:c9:aa:6d:05:0c root@chm The key's randomart image is: +--[ RSA 2048]----+ | E | | o o . | | + = .| | = o | | S o o | | . + + | | + B . | | .B = | | .+o+.o | +-----------------+ [root@chm log]# [root@chm log]# ssh-copy-id 172.16.24.220 /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys root@172.16.24.220's password: Number of key(s) added: 1 Now try logging into the machine, with: \"ssh '172.16.24.220'\" and check to make sure that only the key(s) you wanted were added. ","date":"2020-04-17","objectID":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/:2:0","tags":["Ansible"],"title":"Ansible æƒé™è®¤è¯æŠ¥é”™é—®é¢˜è®°å½•","uri":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"categories":["Ansible"],"content":"éªŒè¯ å†æ¬¡éªŒè¯ï¼ŒæˆåŠŸ [root@chm log]# ansible 172.16.24.220 -m ping 172.16.24.220 | SUCCESS =\u003e { \"changed\": false, \"failed\": false, \"ping\": \"pong\" } ","date":"2020-04-17","objectID":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/:3:0","tags":["Ansible"],"title":"Ansible æƒé™è®¤è¯æŠ¥é”™é—®é¢˜è®°å½•","uri":"/ansible%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"categories":["Shell"],"content":"è¦ç»™æŸä¸ªç¯å¢ƒå˜é‡è®¾ç½®å¤šä¸ªå€¼ï¼Œå¯ä»¥æŠŠå€¼æ”¾åœ¨æ‹¬å·é‡Œï¼Œå€¼ä¸å€¼ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚ ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:0:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"å£°æ˜ mytest=(one two three four five) echo ${mytest[2]} # è¾“å‡º three echo ${mytest[*]} # è¾“å‡º one two three four five ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:1:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"ä¿®æ”¹æ•°ç»„å€¼ mytest=(one two three four five) mytest[2]=seven ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:2:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"åˆ é™¤æ•°ç»„ä¸­çš„å€¼ mytest=(one two three four five) unset mytest[2] # åˆ é™¤å•ä¸ªå…ƒç´ ï¼Œç´¢å¼•ä¸‹æ ‡ä¿ç•™æ˜ å°„çš„å€¼è¢«ç½®ç©º echo ${mytest[2]} # è¾“å‡ºä¸ºç©º unset mytest # åˆ é™¤æ•´ä¸ªæ•°ç»„ ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:3:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"ç¤ºä¾‹ docker ä¸­çš„åº”ç”¨å¯åŠ¨åå†è¿›è¡Œå¥åº·æ£€æŸ¥æ˜¯ä¸€ä¸ªå¯åŠ¨è„šæœ¬ #!/bin/bash APP=(\"java\" \"health_check\") java=( \"java --add-opens java.base/java.lang=ALL-UNNAMED -DAPP_NAME=zcmMonitor -XX:MaxRAMPercentage=70.0 -Dspring.config.location=/app/conf/monitorConfig.properties -Dlogging.config=/app/conf/logback.xml -cp /app/lib/zcm-monitor-9.1.3-sec-SNAPSHOT.jar:/app/lib/run/* com.lushuan.zsmart.zcm.monitor.App\" # start command \"APP_NAME=zcmMonitor\" # process key \"echo OK\" # liveness check command \"OK\" # liveness successful code \"curl -k -m 10 -s https://127.0.0.1:${NMS_MONITOR_SSL_PORT}/app/health 2\u003e/dev/null\" # readiness check command \"UP\" # readiness successful code ) health_check=( \"sh /app/health_check.sh\" # start command \"health_check.sh\" # process key \"echo OK\" # liveness check command \"OK\" # liveness successful code \"echo OK\" # readiness check command \"OK\" # readiness successful code ) ç„¶åè§£æè¯¥æ•°ç»„é…ç½®è®¾ç½®å¯åŠ¨é¡ºåº ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:4:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"æ€»ç»“ æœ‰æ—¶æ•°ç»„å˜é‡ä¼šè®©äº‹æƒ…å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥åœ¨shellè„šæœ¬ç¼–ç¨‹æ—¶å¹¶ä¸å¸¸ç”¨ã€‚å¯¹å…¶ä»–shellè€Œè¨€ï¼Œæ•°ç»„å˜ é‡çš„å¯ç§»æ¤æ€§å¹¶ä¸å¥½ï¼Œå¦‚æœéœ€è¦åœ¨ä¸åŒçš„shellç¯å¢ƒä¸‹ä»äº‹å¤§é‡çš„è„šæœ¬ç¼–å†™å·¥ä½œï¼Œè¿™ä¼šå¸¦æ¥å¾ˆå¤šä¸ ä¾¿ command é‡Šä¹‰ A=(a b c def) å°†å˜é‡å®šä¹‰ä¸ºæ•°çµ„ ${#A[*]} æ•°ç»„ä¸ªæ•° ${A[*]} æ•°ç»„æ‰€æœ‰å…ƒç´ ,å¤§å­—ç¬¦ä¸² ${A[@]} æ•°ç»„æ‰€æœ‰å…ƒç´ ,ç±»ä¼¼åˆ—è¡¨å¯è¿­ä»£ ${A[2]} è„šæœ¬çš„ä¸€ä¸ªå‚æ•°æˆ–æ•°ç»„ç¬¬ä¸‰ä½ ","date":"2020-04-17","objectID":"/ch12_%E6%95%B0%E7%BB%84/:5:0","tags":["Shell"],"title":"shell æ•°ç»„","uri":"/ch12_%E6%95%B0%E7%BB%84/"},{"categories":["Shell"],"content":"åœ¨shellç¼–ç¨‹ä¸­ï¼Œå­—å…¸æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚å­—å…¸å¯ä»¥ç”¨äºå­˜å‚¨å’Œæ£€ç´¢æ•°æ®ï¼Œå®ƒç±»ä¼¼äºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„å…³è”æ•°ç»„æˆ–å“ˆå¸Œè¡¨ã€‚ åœ¨shellä¸­ï¼Œå¯ä»¥ä½¿ç”¨å…³è”æ•°ç»„æ¥å®ç°å­—å…¸ã€‚å…³è”æ•°ç»„æ˜¯ä¸€ç§æœ‰åºçš„é›†åˆï¼Œå®ƒå°†å”¯ä¸€çš„é”®æ˜ å°„åˆ°å€¼ã€‚é”®å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•´æ•°ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®ã€‚ å­—å…¸çš„ç”¨æ³•å¦‚ä¸‹ï¼š åˆ›å»ºå­—å…¸ï¼šå¯ä»¥ä½¿ç”¨å…³è”æ•°ç»„çš„æ–¹å¼æ¥åˆ›å»ºå­—å…¸ï¼Œä¾‹å¦‚ï¼š declare -A my_dict my_dict[key1]=value1 my_dict[key2]=value2 è®¿é—®å­—å…¸å€¼ï¼šå¯ä»¥é€šè¿‡é”®æ¥è®¿é—®å­—å…¸ä¸­çš„å€¼ï¼Œä¾‹å¦‚ï¼š echo ${my_dict[key1]} # è¾“å‡ºï¼švalue1 éå†å­—å…¸ï¼šå¯ä»¥ä½¿ç”¨å¾ªç¯æ¥éå†å­—å…¸ä¸­çš„æ‰€æœ‰é”®å’Œå€¼ï¼Œä¾‹å¦‚ï¼š for key in \"${!my_dict[@]}\"; do echo \"Key: $key, Value: ${my_dict[$key]}\" done ä¿®æ”¹å­—å…¸å€¼ï¼šå¯ä»¥é€šè¿‡é”®æ¥ä¿®æ”¹å­—å…¸ä¸­çš„å€¼ï¼Œä¾‹å¦‚ï¼š my_dict[key1]=new_value1 åˆ é™¤é”®å€¼å¯¹ï¼šå¯ä»¥ä½¿ç”¨unsetå‘½ä»¤æ¥åˆ é™¤å­—å…¸ä¸­çš„é”®å€¼å¯¹ï¼Œä¾‹å¦‚ï¼š unset my_dict[key1] å­—å…¸é•¿åº¦ï¼šå¯ä»¥ä½¿ç”¨#è¿ç®—ç¬¦æ¥è·å–å­—å…¸çš„é•¿åº¦ï¼Œå³é”®å€¼å¯¹çš„æ•°é‡ï¼Œä¾‹å¦‚ï¼š echo ${#my_dict[@]} # è¾“å‡ºå­—å…¸çš„é•¿åº¦ å­—å…¸åœ¨shellç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œå¦‚é…ç½®æ–‡ä»¶è§£æã€æ•°æ®å­˜å‚¨å’Œä¼ é€’ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥å¤„ç†å’Œç»„ç»‡æ•°æ®ï¼Œæé«˜äº†ç¼–ç¨‹æ•ˆç‡ã€‚ ","date":"2020-04-16","objectID":"/ch13_%E5%AD%97%E5%85%B8/:0:0","tags":["Shell"],"title":"shell å­—å…¸","uri":"/ch13_%E5%AD%97%E5%85%B8/"},{"categories":["Shell"],"content":"ä»‹ç» test æ˜¯ Shell å†…ç½®å‘½ä»¤ï¼Œç”¨æ¥æ£€æµ‹æŸä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚test é€šå¸¸å’Œ if è¯­å¥ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ† if è¯­å¥éƒ½ä¾èµ– testã€‚ test å‘½ä»¤æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œå¯ä»¥è¿›è¡Œæ•°å€¼ã€å­—ç¬¦ä¸²å’Œæ–‡ä»¶ä¸‰ä¸ªæ–¹é¢çš„æ£€æµ‹ã€‚ Shell test å‘½ä»¤çš„ç”¨æ³•ä¸ºï¼š test expression å½“ test åˆ¤æ–­ expression æˆç«‹æ—¶ï¼Œé€€å‡ºçŠ¶æ€ä¸º 0ï¼Œå¦åˆ™ä¸ºé 0 å€¼ã€‚ test å‘½ä»¤ä¹Ÿå¯ä»¥ç®€å†™ä¸º[]ï¼Œå®ƒçš„ç”¨æ³•ä¸ºï¼š [ expression ] æ³¨æ„[]å’Œexpressionä¹‹é—´çš„ç©ºæ ¼ï¼Œè¿™ä¸¤ä¸ªç©ºæ ¼æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚[]çš„å†™æ³•æ›´åŠ ç®€æ´ï¼Œæ¯” test ä½¿ç”¨é¢‘ç‡é«˜ã€‚ test å’Œ [] æ˜¯ç­‰ä»·çš„ï¼Œåç»­æˆ‘ä»¬ä¼šäº¤æ›¿ä½¿ç”¨ test å’Œ []ï¼Œä»¥è®©è¯»è€…å°½å¿«ç†Ÿæ‚‰ã€‚ ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:1:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"å­—ç¬¦ä¸²æ“ä½œ command é‡Šä¹‰ -z â€œ$str1â€ str1æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸² -n â€œ$str1â€ str1æ˜¯å¦ä¸æ˜¯ç©ºå­—ç¬¦ä¸² â€œ$str1â€ == â€œ$str2â€ str1æ˜¯å¦ä¸str2ç›¸ç­‰ â€œ$str1â€ != â€œ$str2â€ str1æ˜¯å¦ä¸str2ä¸ç­‰ â€œ$str1â€ =~ â€œstr2â€ str1æ˜¯å¦åŒ…å«str2 ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:2:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æ•´æ•°æ“ä½œ command é‡Šä¹‰ -eq ä¸¤æ•°æ˜¯å¦ç›¸ç­‰ -ne ä¸¤æ•°æ˜¯å¦ä¸ç­‰ -gt å‰è€…æ˜¯å¦å¤§äºåè€…ï¼ˆgreater thenï¼‰ -lt å‰é¢æ˜¯å¦å°äºåè€…ï¼ˆless thanï¼‰ -ge å‰è€…æ˜¯å¦å¤§äºç­‰äºåè€…ï¼ˆgreater then or equalï¼‰ -le å‰è€…æ˜¯å¦å°äºç­‰äºåè€…ï¼ˆless than or equalï¼‰ ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:3:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æ–‡ä»¶æ“ä½œ command é‡Šä¹‰ -a å¹¶ä¸”ï¼Œä¸¤æ¡ä»¶ä¸ºçœŸ -b æ˜¯å¦å—æ–‡ä»¶ -p æ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªå‘½åç®¡é“ -c æ˜¯å¦å­—ç¬¦æ–‡ä»¶ -r æ–‡ä»¶æ˜¯å¦å¯è¯» -d æ˜¯å¦ä¸€ä¸ªç›®å½• -s æ–‡ä»¶çš„é•¿åº¦æ˜¯å¦ä¸ä¸ºé›¶ -e æ–‡ä»¶æ˜¯å¦å­˜åœ¨ -S æ˜¯å¦ä¸ºå¥—æ¥å­—æ–‡ä»¶ -f æ˜¯å¦æ™®é€šæ–‡ä»¶ -x æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼Œåˆ™ä¸ºçœŸ -g æ˜¯å¦è®¾ç½®äº†æ–‡ä»¶çš„ SGID ä½ -u æ˜¯å¦è®¾ç½®äº†æ–‡ä»¶çš„ SUID ä½ -G æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å½’è¯¥ç»„æ‰€æœ‰ -w æ–‡ä»¶æ˜¯å¦å¯å†™ï¼Œåˆ™ä¸ºçœŸ -k æ–‡ä»¶æ˜¯å¦è®¾ç½®äº†çš„ç²˜è´´ä½ -o æˆ–ï¼Œä¸€ä¸ªæ¡ä»¶ä¸ºçœŸ -O æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å½’è¯¥ç”¨æˆ·æ‰€æœ‰ ! å–å ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:4:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"ç¤ºä¾‹ command é‡Šä¹‰ test 10 -lt 5 åˆ¤æ–­å¤§å° echo $? æŸ¥çœ‹ä¸Šå¥testå‘½ä»¤è¿”å›çŠ¶æ€ # ç»“æœ0ä¸ºçœŸ,1ä¸ºå‡ test -n â€œhelloâ€ åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0 [ $? -eq 0 ] \u0026\u0026 echo â€œsuccessâ€ || exitã€€# åˆ¤æ–­æˆåŠŸæç¤º,å¤±è´¥åˆ™é€€å‡º ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:5:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"åˆ¤æ–­ ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:6:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æ•´æ•°åˆ¤æ–­ -eq ä¸¤æ•°æ˜¯å¦ç›¸ç­‰ -ne ä¸¤æ•°æ˜¯å¦ä¸ç­‰ -gt å‰è€…æ˜¯å¦å¤§äºåè€…ï¼ˆgreater thenï¼‰ -lt å‰é¢æ˜¯å¦å°äºåè€…ï¼ˆless thanï¼‰ -ge å‰è€…æ˜¯å¦å¤§äºç­‰äºåè€…ï¼ˆgreater then or equalï¼‰ -le å‰è€…æ˜¯å¦å°äºç­‰äºåè€…ï¼ˆless than or equalï¼‰ ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:6:1","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"å­—ç¬¦ä¸²åˆ¤æ–­str1 exp str2ï¼š -z â€œ$str1â€ str1æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸² -n â€œ$str1â€ str1æ˜¯å¦ä¸æ˜¯ç©ºå­—ç¬¦ä¸² â€œ$str1â€ == â€œ$str2â€ str1æ˜¯å¦ä¸str2ç›¸ç­‰ â€œ$str1â€ != â€œ$str2â€ str1æ˜¯å¦ä¸str2ä¸ç­‰ â€œ$str1â€ =~ â€œstr2â€ str1æ˜¯å¦åŒ…å«str2 ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:6:2","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æ–‡ä»¶ç›®å½•åˆ¤æ–­ -f $filename æ˜¯å¦ä¸ºæ–‡ä»¶ -e $filename æ˜¯å¦å­˜åœ¨ -d $filename æ˜¯å¦ä¸ºç›®å½• -s $filename æ–‡ä»¶å­˜åœ¨ä¸”ä¸ä¸ºç©º ! -s $filename æ–‡ä»¶æ˜¯å¦ä¸ºç©º ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:6:3","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æµç¨‹æ§åˆ¶ break N # è·³å‡ºå‡ å±‚å¾ªç¯ continue N # è·³å‡ºå‡ å±‚å¾ªç¯ï¼Œå¾ªç¯æ¬¡æ•°ä¸å˜ continue # é‡æ–°å¾ªç¯æ¬¡æ•°ä¸å˜ ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:7:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"ç¤ºä¾‹ #!/bin/bash read age if test $age -le 2; then echo \"å©´å„¿\" elif test $age -ge 3 \u0026\u0026 test $age -le 8; then echo \"å¹¼å„¿\" elif [ $age -ge 9 ] \u0026\u0026 [ $age -le 17 ]; then echo \"å°‘å¹´\" elif [ $age -ge 18 ] \u0026\u0026 [ $age -le 25 ]; then echo \"æˆå¹´\" elif test $age -ge 26 \u0026\u0026 test $age -le 40; then echo \"é’å¹´\" elif test $age -ge 41 \u0026\u0026 [ $age -le 60 ]; then echo \"ä¸­å¹´\" else echo \"è€å¹´\" fi ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:8:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"æ€»ç»“ test å‘½ä»¤æœ‰ç‚¹ç‰¹åˆ«==,=~ åªèƒ½ç”¨æ¥æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œä¸èƒ½ç”¨æ¥æ¯”è¾ƒæ•°å­—ï¼Œæ¯”è¾ƒæ•°å­—éœ€è¦ä½¿ç”¨ -eqã€-gt ç­‰é€‰é¡¹ï¼›ä¸ç®¡æ˜¯æ¯”è¾ƒå­—ç¬¦ä¸²è¿˜æ˜¯æ•°å­—ï¼Œtest éƒ½ä¸æ”¯æŒ \u003e= å’Œ \u003c=ã€‚æœ‰ç»éªŒçš„ç¨‹åºå‘˜éœ€è¦æ…¢æ…¢ä¹ æƒ¯ test å‘½ä»¤çš„è¿™äº›å¥‡è‘©ç”¨æ³• ","date":"2020-04-15","objectID":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/:9:0","tags":["Shell"],"title":"shell test æ¡ä»¶åˆ¤æ–­","uri":"/ch14_test%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/"},{"categories":["Shell"],"content":"Shell å‚æ•°å¤„ç†æ˜¯æŒ‡åœ¨ Shell è„šæœ¬ä¸­ï¼Œå¯¹å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°è¿›è¡Œå¤„ç†å’Œæ“ä½œçš„æŠ€æœ¯ã€‚è¿™åœ¨ç¼–å†™ Shell è„šæœ¬æ—¶éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸è„šæœ¬æ ¹æ®ä¸åŒçš„å‚æ•°æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œå¢å¼ºäº†è„šæœ¬çš„çµæ´»æ€§å’Œé€‚ç”¨æ€§ã€‚ åœ¨ Shell è„šæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šå˜é‡ â€œ$1â€ã€\"$2\"ã€\"$3\" ç­‰æ¥å¼•ç”¨å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œå…¶ä¸­ â€œ$1â€ è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ\"$2\" è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™äº›å‚æ•°å¯ä»¥æ ¹æ®è„šæœ¬éœ€è¦è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚ä½œä¸ºæ–‡ä»¶åã€ç›®å½•åã€ç½‘å€ç­‰ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨ Shell è„šæœ¬ä¸­å¤„ç†å‚æ•°ï¼š ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:0:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"æ˜¾ç¤ºè„šæœ¬åç§°å’Œå‚æ•°ï¼š #!/bin/bash echo \"è„šæœ¬åç§°ï¼š$0\" echo \"ç¬¬ä¸€ä¸ªå‚æ•°ï¼š$1\" echo \"ç¬¬äºŒä¸ªå‚æ•°ï¼š$2\" è¿è¡Œ ./script.sh argument1 argument2ï¼Œå°†ä¼šè¾“å‡ºï¼š è„šæœ¬åç§°ï¼š./script.sh ç¬¬ä¸€ä¸ªå‚æ•°ï¼šargument1 ç¬¬äºŒä¸ªå‚æ•°ï¼šargument2 ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:1:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"åˆ¤æ–­å‚æ•°ä¸ªæ•°æ˜¯å¦æ­£ç¡®ï¼š #!/bin/bash if [ $# -ne 2 ]; then echo \"éœ€è¦ä¸¤ä¸ªå‚æ•°\" exit 1 fi echo \"å‚æ•°ä¸ªæ•°æ­£ç¡®\" è¿è¡Œ ./script.sh argument1ï¼Œå°†ä¼šè¾“å‡ºï¼šéœ€è¦ä¸¤ä¸ªå‚æ•° ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:2:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"ä½¿ç”¨å‚æ•°ä½œä¸ºæ–‡ä»¶åï¼š #!/bin/bash filename=\"$1\" if [ -f \"$filename\" ]; then echo \"æ–‡ä»¶å­˜åœ¨\" else echo \"æ–‡ä»¶ä¸å­˜åœ¨\" fi è¿è¡Œ ./script.sh myfile.txtï¼Œå°†ä¼šè¾“å‡ºï¼šæ–‡ä»¶å­˜åœ¨ ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:3:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"å¾ªç¯å¤„ç†å¤šä¸ªå‚æ•°ï¼š #!/bin/bash for arg in \"$@\" do echo \"å‚æ•°: $arg\" done è¿è¡Œ ./script.sh argument1 argument2 argument3ï¼Œå°†ä¼šè¾“å‡ºï¼š å‚æ•°: argument1 å‚æ•°: argument2 å‚æ•°: argument3 ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:4:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"ç‰¹åˆ«çš„å‚æ•° æ³¨æ„å‚æ•°è¶…è¿‡ä¸ªä½æ•°æ—¶çš„å¤„ç† echo $0 # æ‰“å°è„šæœ¬åç§° echo $1 # æ‰“å°ç¬¬ä¸€ä¸ªå‚æ•° echo $2 # æ‰“å°ç¬¬äºŒä¸ªå‚æ•° echo $9 # æ‰“å°ç¬¬ä¹ä¸ªå‚æ•° echo $10 # æ‰“å°ç¬¬ä¸€ä¸ªå‚æ•°åé¢è·Ÿä¸€ä¸ª0 echo ${10} # æ‰“å°ç¬¬åä¸ªå‚æ•° echo $# # æ‰“å°å‚æ•°çš„æ•°é‡ è¿™äº›ç¤ºä¾‹å±•ç¤ºäº† Shell å‚æ•°å¤„ç†çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»è¿ç”¨ã€‚ ","date":"2020-04-14","objectID":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/:5:0","tags":["Shell"],"title":"shell å‚æ•°å¤„ç†","uri":"/ch15_%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸€ å‘½ä»¤expr å‘½ä»¤expræ‰“å°ç®—æœ¯è¡¨è¾¾å¼çš„ç»“æœï¼Œä½†å¿…é¡»å°å¿ƒ * å· expr 3 + 12 # æ‰“å° 15 expr 3 * 12 # (probably) crashes: * éœ€è¦è¿›è¡Œè½¬ä¹‰ï¼Œè¿™è¡Œè¯­å¥ä¼šæ‰§è¡ŒæŠ¥é”™ expr 3 \\* 12 # æ‰“å° 36 ","date":"2020-04-13","objectID":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/:1:0","tags":["Shell"],"title":"shell ç®—æœ¯è¡¨è¾¾å¼","uri":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/"},{"categories":["Shell"],"content":"æ–¹å¼äºŒ (( assignable = expression )) (( x = 3 + 12 )); echo $x # æ‰“å° 15 (( x = 3 * 12 )); echo $x # æ‰“å° 36 ","date":"2020-04-13","objectID":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/:2:0","tags":["Shell"],"title":"shell ç®—æœ¯è¡¨è¾¾å¼","uri":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/"},{"categories":["Shell"],"content":"æ–¹å¼ä¸‰ echo $(( 3 + 12 )) # æ‰“å° 15 echo $(( 3 * 12 )) # æ‰“å° 36 ","date":"2020-04-13","objectID":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/:3:0","tags":["Shell"],"title":"shell ç®—æœ¯è¡¨è¾¾å¼","uri":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/"},{"categories":["Shell"],"content":"æŒ‡å®šç±»å‹ è™½ç„¶éšå¼å£°æ˜å˜é‡æ˜¯bashä¸­çš„è§„èŒƒï¼Œä½†å¯ä»¥æ˜¾å¼å£°æ˜å˜é‡å¹¶ä¸ºå…¶æŒ‡å®šç±»å‹ æŒ‡å®šæ•´å‹ declare -i number number=2+4*10 echo $number # æ‰“å° 42 another=2+4*10 echo $another # æ‰“å° 2+4*10 number=\"foobar\" echo $number # æ‰“å° 0 ","date":"2020-04-13","objectID":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/:4:0","tags":["Shell"],"title":"shell ç®—æœ¯è¡¨è¾¾å¼","uri":"/ch16_%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E7%AE%97%E6%9C%AF/"},{"categories":["Shell"],"content":"Unixä¸­çš„æ¯ä¸ªè¿›ç¨‹é»˜è®¤éƒ½å¯ä»¥è®¿é—®ä¸‰ä¸ªè¾“å…¥/è¾“å‡ºé€šé“ï¼šSTDINï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ã€STDOUTï¼ˆæ ‡å‡†è¾“å‡ºï¼‰å’ŒSTDERRï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ã€‚ ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:0:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"æ‰“å°myfileä¸­åŒ…å«å•è¯fooçš„è¡Œ grep foo \u003c myfile ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:1:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"æ–‡ä»¶åˆå¹¶ ä¸€èˆ¬é…åˆæ–‡ä»¶åˆ‡å‰²ä½¿ç”¨ å°†æ–‡ä»¶file1ã€file2 åˆå¹¶è‡³æ–°æ–‡ä»¶combined cat file1 file2 \u003e combined ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:2:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"æ–‡ä»¶è¿½åŠ  date \u003e\u003e log ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:3:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"endmarker è¦åœ¨è„šæœ¬ä¸­ä»å­—é¢ä¸ŠæŒ‡å®šSTDINçš„å†…å®¹ï¼Œè¯·ä½¿ç”¨Â«endmarkerè¡¨ç¤ºæ³•ï¼š cat \u003e file1 \u003c\u003cUNTILHERE All of this will be printed out. Since all of this is going into cat on STDIN. UNTILHERE # \u003e\u003e è¿½åŠ  cat \u003e\u003e file1 \u003c\u003cUNTILHERE All of this will be printed out. Since all of this is going into cat on STDIN. UNTILHERE # ä¸€èˆ¬ä½¿ç”¨EOF cat \u003e\u003e file1 \u003c\u003cEOF All of this will be printed out. Since all of this is going into cat on STDIN. EOF ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:4:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"è¾“å‡ºé”™è¯¯æ—¥å¿—è‡³æ–‡ä»¶ httpd 2\u003e error.log ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:5:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"chanel è¾“å‡ºç±»å‹ STDIN is channel 0, STDOUT is channel 1, while STDERR is channel 2. grep foo nofile 2\u003e\u00261 # errors will appear on STDOUTï¼Œæ—¢æ­£å¸¸è¾“å‡ºä¹Ÿè¾“å‡ºé”™è¯¯æ—¥å¿— ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:6:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"æ€»ç»“ é‡å®šå‘ command é‡Šä¹‰ cmd 1\u003e fiel æŠŠ æ ‡å‡†è¾“å‡º é‡å®šå‘åˆ° file æ–‡ä»¶ä¸­ cmd \u003e file 2\u003e\u00261 æŠŠ æ ‡å‡†è¾“å‡º å’Œ æ ‡å‡†é”™è¯¯ ä¸€èµ·é‡å®šå‘åˆ° file æ–‡ä»¶ä¸­ cmd 2\u003e file æŠŠ æ ‡å‡†é”™è¯¯ é‡å®šå‘åˆ° file æ–‡ä»¶ä¸­ cmd 2Â» file æŠŠ æ ‡å‡†é”™è¯¯ é‡å®šå‘åˆ° file æ–‡ä»¶ä¸­(è¿½åŠ ) cmd Â» file 2\u003e\u00261 æŠŠ æ ‡å‡†è¾“å‡º å’Œ æ ‡å‡†é”™è¯¯ ä¸€èµ·é‡å®šå‘åˆ° file æ–‡ä»¶ä¸­(è¿½åŠ ) cmd \u003c file \u003efile2 cmd å‘½ä»¤ä»¥ file æ–‡ä»¶ä½œä¸º stdin(æ ‡å‡†è¾“å…¥)ï¼Œä»¥ file2 æ–‡ä»¶ä½œä¸º æ ‡å‡†è¾“å‡º cat \u003c\u003efile ä»¥è¯»å†™çš„æ–¹å¼æ‰“å¼€ file ","date":"2020-04-12","objectID":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/:7:0","tags":["Shell"],"title":"shell æ–‡ä»¶å’Œé‡å®šå‘","uri":"/ch17_%E6%96%87%E4%BB%B6%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91/"},{"categories":["Shell"],"content":"ä¸€äº›ç”Ÿäº§ä¸­å¸¸ç”¨åˆ°çš„ç‰‡æ®µè„šæœ¬ ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:0:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"å­—ç¬¦ä¸²åˆ†å‰²æ¨¡æ¿ IFS é»˜è®¤æ˜¯ç©ºæ ¼è¿›è¡Œåˆ†å‰² oldIFS=$IFS IFS=\":\" data=\"å¤§ç‰›:äºŒç‹—:ä¸‰é©´\" for item in $data; do echo $item done IFS=$oldIFS ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:1:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"è¿›ç¨‹æ¢æµ‹ #!/bin/bash PROC_NAME=nms-prometheus ProcNumber=`ps -ef |grep -w $PROC_NAME|grep -v grep|wc -l` if [ $ProcNumber -le 0 ];then echo \"nmsprometheus is not run\" sh /home/zoms/monitor/start.sh else echo \"nmsprometheus is running..\" fi ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:2:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"ç›®å½•å¾ªç¯ #!/bin/sh dirlist=\"ls\" for dir in `$dirlist` do if [ -d $dir ]; then helm install $dir $dir -n zcm9 -f ../values.yaml fi done ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:3:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"è¿›ç¨‹æ£€æµ‹ åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œæ‰‹åŠ¨é‡å¯ï¼Œå¦‚æœé‡å¯è¿˜ä¸å­˜åœ¨åˆ™åšå¦å¤–çš„åŠ¨ä½œ #!/bin/sh nginxpid=$(ps -C nginx --no-header|wc -l) #1.åˆ¤æ–­Nginxæ˜¯å¦å­˜æ´»,å¦‚æœä¸å­˜æ´»åˆ™å°è¯•å¯åŠ¨Nginx if [ $nginxpid -eq 0 ];then systemctl start nginx sleep 3 #2.ç­‰å¾…3ç§’åå†æ¬¡è·å–ä¸€æ¬¡NginxçŠ¶æ€ nginxpid=$(ps -C nginx --no-header|wc -l) #3.å†æ¬¡è¿›è¡Œåˆ¤æ–­, å¦‚Nginxè¿˜ä¸å­˜æ´»åˆ™åœæ­¢Keepalived,è®©åœ°å€è¿›è¡Œæ¼‚ç§»,å¹¶é€€å‡ºè„šæœ¬ if [ $nginxpid -eq 0 ];then systemctl stop keepalived fi fi ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:4:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"å®šæ—¶æ¸…ç©ºæ–‡ä»¶å†…å®¹ ç»“åˆcron ä½¿ç”¨ #!/bin/bash logfile=/tmp/`date +%H-%F`.log n=`date +%H` if [ $n -eq 00 ] || [ $n -eq 12 ] then #é€šè¿‡forå¾ªç¯ï¼Œä»¥findå‘½ä»¤ä½œä¸ºéå†æ¡ä»¶ï¼Œå°†ç›®æ ‡ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œéå†å¹¶åšç›¸åº”æ“ä½œ for i in `find /data/log/ -type f` do true \u003e $i done else for i in `find /data/log/ -type f` do du -sh $i \u003e\u003e $logfile done fi ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:5:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":["Shell"],"content":"æ¢æµ‹ä¸»æœºç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ #!/bin/bash ip_list=\"10.1.1.81 10.1.1.83 10.1.11.159\" port=9100 function main() { for ip in $ip_list do result=`echo -e \"\\n\" |timeout --signal=9 2 telnet $ip $port 2\u003e/dev/null | grep Connected | wc -l` if [ $result -ne 1 ] then echo $ip \u003e\u003e $HOME/ip_refused.txt fi done } main ","date":"2020-04-11","objectID":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/:6:0","tags":["Shell"],"title":"shell å¸¸ç”¨è„šæœ¬","uri":"/ch18_%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"categories":[""],"content":"å‰è¨€ ç”Ÿæ´»å¯èƒ½ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆå¥½\ræˆ‘ä»¬åœ¨äººçš„ä¸€ç”Ÿä¸­æœ€ä¸ºè¾‰ç…Œçš„ä¸€å¤©ï¼Œå¹¶ä¸æ˜¯åŠŸæˆåå°±çš„é‚£ä¸€å¤©ï¼Œè€Œæ˜¯ä»æ‚²å¹å’Œç»æœ›ä¸­äº§ç”Ÿå¯¹äººç”ŸæŒ‘æˆ˜çš„æ¬²æœ›ï¼Œå¹¶ä¸”å‹‡æ•¢çš„è¿ˆå‘è¿™ç§æŒ‘æˆ˜çš„é‚£ä¸€å¤©ã€‚ äººç”Ÿå½“ä¸­æˆåŠŸåªæ˜¯ä¸€æ—¶çš„ï¼Œå¤±è´¥å´æ˜¯ä¸»æ—‹å¾‹ã€‚ä½†æ˜¯å¦‚ä½•é¢å¯¹å¤±è´¥å´æŠŠäººåˆ†æˆäº†ä¸åŒçš„æ ·å­ã€‚æœ‰çš„äººä¼šè¢«å¤±è´¥å‡»å®ï¼Œæœ‰çš„äººèƒ½å¤Ÿä¸æ–­çš„çˆ¬èµ·æ¥ï¼Œç»§ç»­å‘å‰ã€‚ æˆ‘æƒ³çœŸæ­£çš„æˆç†Ÿï¼Œåº”è¯¥å¹¶ä¸æ˜¯è¿½æ±‚å®Œç¾ï¼Œè€Œæ˜¯ç›´é¢è‡ªå·±çš„ç¼ºæ†¾ï¼Œè¿™æ‰æ˜¯ç”Ÿæ´»çš„æœ¬è´¨ã€‚ ä¹Ÿè®¸ä»–ä»¬ä¼šæ˜ç™½è«æ³Šæ¡‘çš„ä¸€å¥è¯ï¼šç”Ÿæ´»å¯èƒ½ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆå¥½ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šåƒä½ æƒ³è±¡çš„é‚£ä¹ˆç³Ÿã€‚äººçš„è„†å¼±å’Œåšå¼ºéƒ½è¶…ä¹äº†è‡ªå·±çš„æƒ³è±¡ã€‚æœ‰æ—¶å€™ï¼Œå¯èƒ½è„†å¼±çš„ä¸€å¥è¯å°±æ³ªæµæ»¡é¢ï¼Œæœ‰æ—¶å€™ï¼Œä½ å‘ç°è‡ªå·±å’¬ç€ç‰™å·²ç»èµ°è¿‡äº†å¾ˆé•¿çš„è·¯ï¼Œ\räººçš„ä¸€ç”Ÿä¸­æœ€å¤§çš„é—®é¢˜ä¸æ˜¯æ‰¾ä¸åˆ°æ­£ç¡®çš„æ–¹æ³•è€Œæ˜¯åœ¨å®è·µä¸­é•¿ä¹…çš„æ‚–é€†äººæ€§ æœ€æ·¡çš„å¢¨æ°´ä¹Ÿèƒœè¿‡æœ€å¼ºçš„è®°å¿†\rAbout Persistence(æœ€æ·¡çš„å¢¨æ°´ä¹Ÿèƒœè¿‡æœ€å¼ºçš„è®°å¿†) Nothing in the world can take the place of Persistence. Talent will not; nothing is more common than unsuccessful men with talent. Genius will not; unrewarded genius is almost a proverb. Education will not; the world is full of educated derelicts. Persistence and Determination alone are omnipotent. The slogan â€œPress Onâ€ has solved and will always solve the problems of the human race. ","date":"2019-09-15","objectID":"/about/:1:0","tags":[""],"title":"About","uri":"/about/"},{"categories":[""],"content":"ä¸ªäººä»‹ç» ç®€è¦ä»‹ç»ï¼šç›®å‰å±…ä½å—äº¬ï¼Œå–œæ¬¢äº‘åŸç”Ÿå¹¶é€šè¿‡äº†CKA,CKSè®¤è¯,å¯¹ç›‘æ§è½åœ°æœ‰ç›¸å…³ç»éªŒï¼Œ ç†Ÿç»ƒä½¿ç”¨Dockerã€K8sï¼Œæœ‰ç”Ÿäº§k8sé›†ç¾¤çš„æ„å»ºã€è¿ç»´ã€ä¼˜åŒ–ã€æ’é”™ç»éªŒï¼Œç†Ÿæ‚‰å„ç§å¼€æºä¸­é—´ä»¶çš„éƒ¨ç½²å’Œä¼˜åŒ–ï¼Œæœ‰è¿ç»´è‡ªåŠ¨åŒ–ã€ç›‘æ§ç³»ç»Ÿ ç›¸å…³å¼€å‘ç»éªŒã€‚ ä¸ªäººä¿¡æ¯ï¼šlushuan æ‹¿æ‰‹èœï¼šæ¸…è’¸é²ˆé±¼ã€å¾å·åœ°é”…é¸¡ã€ç‚’èŠ±è›¤ã€é¦™è¾£å°ç‚’è‚‰ å…´è¶£çˆ±å¥½ï¼šç¯®çƒã€éŸ³ä¹ã€é˜…è¯»ã€æ¼è›‹ã€å°çƒã€æ—…æ¸¸ç­‰ é‚®ç®±ï¼šlushuan2071@126.com æˆ‘çš„å¾®ä¿¡ æŠ€èƒ½è¯´æ˜ï¼šæˆ‘ä¼šçš„ä¸œè¥¿åŸºæœ¬ä¸Šéƒ½å†™åœ¨åšå®¢ä¸­äº†ï¼Œä¸æ•¢è¯´æœ‰å¤šä¹ˆç²¾é€šï¼Œä¸€ç›´åœ¨åŠªåŠ›å­¦ä¹ ä¸­ Kubernetes Prometheus InfluxDB Grafana Ansible Docker Helm Linux Shell MySQL Python Java ","date":"2019-09-15","objectID":"/about/:2:0","tags":[""],"title":"About","uri":"/about/"},{"categories":[""],"content":"äº‘è®¡ç®—ç›¸å…³è®¤è¯ CKA CKS ","date":"2019-09-15","objectID":"/about/:3:0","tags":[""],"title":"About","uri":"/about/"},{"categories":["linux"],"content":"LinuxæœåŠ¡å™¨è¿è¡Œä¹…æ—¶ï¼Œç³»ç»Ÿæ—¶é—´å°±ä¼šå­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨dateå‘½ä»¤è¿›è¡Œæ—¶é—´è®¾ç½®ï¼Œä½†åœ¨åšæ•°æ®åº“é›†ç¾¤åˆ†ç‰‡ç­‰æ“ä½œæ—¶å¯¹å¤šå°æœºå™¨çš„æ—¶é—´å·®æ˜¯æœ‰è¦æ±‚çš„ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨ntpdateè¿›è¡Œæ—¶é—´åŒæ­¥ ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:0:0","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"æ‰‹åŠ¨ä¿®æ”¹ æ‰‹åŠ¨è®¾ç½®æ—¶é—´ï¼Œéœ€è¦ä½¿ç”¨ sudo æƒé™ç”¨æˆ· # å½“å‰æ—¶åŒºå…·ä½“çš„æ—¶é—´ date -s \"2022-12-31 23:59:59\" # å†™å…¥ä¿®æ”¹åçš„æ—¶é—´åˆ°ç¡¬ä»¶æ—¶é’Ÿï¼ˆRTCï¼‰ä¸­ï¼Œå°†ç¡®ä¿è®¾ç½®çš„æ—¶é—´åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ä¿æŒä¸å˜ hwclock --systohc æ‰‹åŠ¨ä¿®æ”¹æ—¶é—´ä¼šæœ‰è¯¯å·®ï¼Œå»ºè®®ä½¿ç”¨ä¸‹é¢çš„æ—¶é—´æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥æ›´æ–° ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:1:0","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"é€šè¿‡æ—¶é—´æœåŠ¡å™¨æ ¡æ­£ sudo yum install ntpdate -y ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:2:0","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"åŒæ­¥æ—¶é—´ sudo ntpdate -b time1.aliyun.com ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:2:1","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"é…ç½®å¯åŠ¨ntpd $ vi /etc/ntp.conf ... # For more information about this file, see the man pages # ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5). driftfile /var/lib/ntp/drift # Permit time synchronization with our time source, but do not # permit the source to query or modify the service on this system. restrict default nomodify notrap nopeer noquery # Permit all access over the loopback interface. This could # be tightened as well, but to do so would effect some of # the administrative functions. restrict 127.0.0.1 restrict ::1 # Hosts on local network are less restricted. #restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap # Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server time1.aliyun.com #broadcast 192.168.1.255 autokey # broadcast server #broadcastclient # broadcast client #broadcast 224.0.1.1 autokey # multicast server #multicastclient 224.0.1.1 # multicast client #manycastserver 239.255.254.254 # manycast server #manycastclient 239.255.254.254 autokey # manycast client # Enable public key cryptography. #crypto includefile /etc/ntp/crypto/pw # Key file containing the keys and key identifiers used when operating # with symmetric key cryptography. keys /etc/ntp/keys # Specify the key identifiers which are trusted. #trustedkey 4 8 42 # Specify the key identifier to use with the ntpdc utility. #requestkey 8 # Specify the key identifier to use with the ntpq utility. #controlkey 8 # Enable writing of statistics records. #statistics clockstats cryptostats loopstats peerstats # Disable the monitoring facility to prevent amplification attacks using ntpdc # monlist command when default restrict does not include the noquery flag. See # CVE-2013-5211 for more details. # Note: Monitoring will not be disabled with the limited restriction flag. ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:2:2","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl status ntpd; sudo systemctl start ntpd; sudo systemctl enable ntpd; ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:2:3","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":["linux"],"content":"ntp å¸¸ç”¨æœåŠ¡å™¨ å›½å†… cn.pool.ntp.org ä¸­å›½å¼€æºå…è´¹NTPæœåŠ¡å™¨ ntp1.aliyun.com é˜¿é‡Œäº‘NTPæœåŠ¡å™¨ ntp2.aliyun.com é˜¿é‡Œäº‘NTPæœåŠ¡å™¨ time1.aliyun.com é˜¿é‡Œäº‘NTPæœåŠ¡å™¨ time2.aliyun.com é˜¿é‡Œäº‘NTPæœåŠ¡å™¨ å›½å¤– time1.apple.com è‹¹æœNTPæœåŠ¡å™¨ time2.apple.com è‹¹æœNTPæœåŠ¡å™¨ time3.apple.com è‹¹æœNTPæœåŠ¡å™¨ time4.apple.com è‹¹æœNTPæœåŠ¡å™¨ time5.apple.com è‹¹æœNTPæœåŠ¡å™¨ time1.google.com è°·æ­ŒNTPæœåŠ¡å™¨ time2.google.com è°·æ­ŒNTPæœåŠ¡å™¨ time3.google.com è°·æ­ŒNTPæœåŠ¡å™¨ time4.google.com è°·æ­ŒNTPæœåŠ¡å™¨ pool.ntp.org å¼€æºå…è´¹NTPæœåŠ¡å™¨ ","date":"2019-06-29","objectID":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/:2:4","tags":["linux"],"title":"Linux æ—¶é—´æ ¡æ­£","uri":"/linux%E6%97%B6%E9%97%B4%E6%A0%A1%E6%AD%A3/"},{"categories":null,"content":"å‹é“¾ Hugo LoveIt å®˜æ–¹æ–‡æ¡£ ","date":"0001-01-01","objectID":"/friends/:1:0","tags":null,"title":"å‹é“¾å¢™","uri":"/friends/"},{"categories":null,"content":"èµ„æ–™ äº‘åŸç”Ÿèµ„æ–™åº“ Istioä¸­æ–‡æ–‡æ¡£ ","date":"0001-01-01","objectID":"/friends/:2:0","tags":null,"title":"å‹é“¾å¢™","uri":"/friends/"}]